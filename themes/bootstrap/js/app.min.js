/*! jQuery v1.6.4 http://jquery.com/ | http://jquery.org/license */
(function(a,b){function cu(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cr(a){if(!cg[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){ch||(ch=c.createElement("iframe"),ch.frameBorder=ch.width=ch.height=0),b.appendChild(ch);if(!ci||!ch.createElement){ci=(ch.contentWindow||ch.contentDocument).document,ci.write((c.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),ci.close()}d=ci.createElement(a),ci.body.appendChild(d),e=f.css(d,"display"),b.removeChild(ch)}cg[a]=e}return cg[a]}function cq(a,b){var c={};f.each(cm.concat.apply([],cm.slice(0,b)),function(){c[this]=a});return c}function cp(){cn=b}function co(){setTimeout(cp,0);return cn=f.now()}function cf(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ce(){try{return new a.XMLHttpRequest}catch(b){}}function b$(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1){for(h in a.converters){typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h])}}l=k,k=d[g];if(k==="*"){k=l}else{if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}}return c}function bZ(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g){i in d&&(c[g[i]]=d[i])}while(f[0]==="*"){f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"))}if(h){for(i in e){if(e[i]&&e[i].test(h)){f.unshift(i);break}}}if(f[0] in d){j=f[0]}else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function bY(a,b,c,d){if(f.isArray(b)){f.each(b,function(b,e){c||bA.test(a)?d(a,e):bY(a+"["+(typeof e=="object"||f.isArray(e)?b:"")+"]",e,c,d)})}else{if(!c&&b!=null&&typeof b=="object"){for(var e in b){bY(a+"["+e+"]",b[e],c,d)}}else{d(a,b)}}}function bX(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c){c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d])}e&&f.extend(!0,a,e)}function bW(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bP,l;for(;i<j&&(k||!l);i++){l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=bW(a,c,d,e,l,g)))}(k||!l)&&!g["*"]&&(l=bW(a,c,d,e,"*",g));return l}function bV(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bL),e=0,g=d.length,h,i,j;for(;e<g;e++){h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}}function by(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bt:bu;if(d>0){c!=="border"&&f.each(e,function(){c||(d-=parseFloat(f.css(a,"padding"+this))||0),c==="margin"?d+=parseFloat(f.css(a,c+this))||0:d-=parseFloat(f.css(a,"border"+this+"Width"))||0});return d+"px"}d=bv(a,b,b);if(d<0||d==null){d=a.style[b]||0}d=parseFloat(d)||0,c&&f.each(e,function(){d+=parseFloat(f.css(a,"padding"+this))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+this+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+this))||0)});return d+"px"}function bl(a,b){b.src?f.ajax({url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bd,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function bk(a){f.nodeName(a,"input")?bj(a):"getElementsByTagName" in a&&f.grep(a.getElementsByTagName("input"),bj)}function bj(a){if(a.type==="checkbox"||a.type==="radio"){a.defaultChecked=a.checked}}function bi(a){return"getElementsByTagName" in a?a.getElementsByTagName("*"):"querySelectorAll" in a?a.querySelectorAll("*"):[]}function bh(a,b){var c;if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object"){b.outerHTML=a.outerHTML}else{if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option"){b.selected=a.defaultSelected}else{if(c==="input"||c==="textarea"){b.defaultValue=a.defaultValue}}}else{a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value)}}b.removeAttribute(f.expando)}}function bg(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c=f.expando,d=f.data(a),e=f.data(b,d);if(d=d[c]){var g=d.events;e=e[c]=f.extend({},d);if(g){delete e.handle,e.events={};for(var h in g){for(var i=0,j=g[h].length;i<j;i++){f.event.add(b,h+(g[h][i].namespace?".":"")+g[h][i].namespace,g[h][i],g[h][i].data)}}}}}}function bf(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function V(a,b,c){b=b||0;if(f.isFunction(b)){return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c})}if(b.nodeType){return f.grep(a,function(a,d){return a===b===c})}if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(Q.test(b)){return f.filter(b,d,!c)}b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function U(a){return !a||!a.parentNode||a.parentNode.nodeType===11}function M(a,b){return(a&&a!=="*"?a+".":"")+b.replace(y,"`").replace(z,"&")}function L(a){var b,c,d,e,g,h,i,j,k,l,m,n,o,p=[],q=[],r=f._data(this,"events");if(!(a.liveFired===this||!r||!r.live||a.target.disabled||a.button&&a.type==="click")){a.namespace&&(n=new RegExp("(^|\\.)"+a.namespace.split(".").join("\\.(?:.*\\.)?")+"(\\.|$)")),a.liveFired=this;var s=r.live.slice(0);for(i=0;i<s.length;i++){g=s[i],g.origType.replace(w,"")===a.type?q.push(g.selector):s.splice(i--,1)}e=f(a.target).closest(q,a.currentTarget);for(j=0,k=e.length;j<k;j++){m=e[j];for(i=0;i<s.length;i++){g=s[i];if(m.selector===g.selector&&(!n||n.test(g.namespace))&&!m.elem.disabled){h=m.elem,d=null;if(g.preType==="mouseenter"||g.preType==="mouseleave"){a.type=g.preType,d=f(a.relatedTarget).closest(g.selector)[0],d&&f.contains(h,d)&&(d=h)}(!d||d!==h)&&p.push({elem:h,handleObj:g,level:m.level})}}}for(j=0,k=p.length;j<k;j++){e=p[j];if(c&&e.level>c){break}a.currentTarget=e.elem,a.data=e.handleObj.data,a.handleObj=e.handleObj,o=e.handleObj.origHandler.apply(e.elem,arguments);if(o===!1||a.isPropagationStopped()){c=e.level,o===!1&&(b=!1);if(a.isImmediatePropagationStopped()){break}}}return b}}function J(a,c,d){var e=f.extend({},d[0]);e.type=a,e.originalEvent={},e.liveFired=b,f.event.handle.call(c,e),e.isDefaultPrevented()&&d[0].preventDefault()}function D(){return !0}function C(){return !1}function m(a,c,d){var e=c+"defer",g=c+"queue",h=c+"mark",i=f.data(a,e,b,!0);i&&(d==="queue"||!f.data(a,g,b,!0))&&(d==="mark"||!f.data(a,h,b,!0))&&setTimeout(function(){!f.data(a,g,b,!0)&&!f.data(a,h,b,!0)&&(f.removeData(a,e,!0),i.resolve())},0)}function l(a){for(var b in a){if(b!=="toJSON"){return !1}}return !0}function k(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(j,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNaN(d)?i.test(d)?f.parseJSON(d):d:parseFloat(d)}catch(g){}f.data(a,c,d)}else{d=b}}return d}var c=a.document,d=a.navigator,e=a.location,f=function(){function K(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(K,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/\d/,n=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,o=/^[\],:{}\s]*$/,p=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,q=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,r=/(?:^|:|,)(?:\s*\[)+/g,s=/(webkit)[ \/]([\w.]+)/,t=/(opera)(?:.*version)?[ \/]([\w.]+)/,u=/(msie) ([\w.]+)/,v=/(mozilla)(?:.*? rv:([\w.]+))?/,w=/-([a-z]|[0-9])/ig,x=/^-ms-/,y=function(a,b){return(b+"").toUpperCase()},z=d.userAgent,A,B,C,D=Object.prototype.toString,E=Object.prototype.hasOwnProperty,F=Array.prototype.push,G=Array.prototype.slice,H=String.prototype.trim,I=Array.prototype.indexOf,J={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a){return this}if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=n.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2]){return f.find(a)}this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return !d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a)){return f.ready(a)}a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.6.4",length:0,size:function(){return this.length},toArray:function(){return G.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?F.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),B.done(a);return this},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(G.apply(this,arguments),"slice",G.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:F,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++){if((a=arguments[j])!=null){for(c in a){d=i[c],f=a[c];if(i===f){continue}l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}}}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body){return setTimeout(e.ready,1)}e.isReady=!0;if(a!==!0&&--e.readyWait>0){return}B.resolveWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").unbind("ready")}},bindReady:function(){if(!B){B=e._Deferred();if(c.readyState==="complete"){return setTimeout(e.ready,1)}if(c.addEventListener){c.addEventListener("DOMContentLoaded",C,!1),a.addEventListener("load",e.ready,!1)}else{if(c.attachEvent){c.attachEvent("onreadystatechange",C),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&K()}}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval" in a},isNaN:function(a){return a==null||!m.test(a)||isNaN(a)},type:function(a){return a==null?String(a):J[D.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a)){return !1}try{if(a.constructor&&!E.call(a,"constructor")&&!E.call(a.constructor.prototype,"isPrototypeOf")){return !1}}catch(c){return !1}var d;for(d in a){}return d===b||E.call(a,d)},isEmptyObject:function(a){for(var b in a){return !1}return !0},error:function(a){throw a},parseJSON:function(b){if(typeof b!="string"||!b){return null}b=e.trim(b);if(a.JSON&&a.JSON.parse){return a.JSON.parse(b)}if(o.test(b.replace(p,"@").replace(q,"]").replace(r,""))){return(new Function("return "+b))()}e.error("Invalid JSON: "+b)},parseXML:function(c){var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(x,"ms-").replace(w,y)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a){if(c.apply(a[f],d)===!1){break}}}else{for(;g<h;){if(c.apply(a[g++],d)===!1){break}}}}else{if(i){for(f in a){if(c.call(a[f],f,a[f])===!1){break}}}else{for(;g<h;){if(c.call(a[g],g,a[g++])===!1){break}}}}return a},trim:H?function(a){return a==null?"":H.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?F.call(c,a):e.merge(c,a)}return c},inArray:function(a,b){if(!b){return -1}if(I){return I.call(b,a)}for(var c=0,d=b.length;c<d;c++){if(b[c]===a){return c}}return -1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number"){for(var f=c.length;e<f;e++){a[d++]=c[e]}}else{while(c[e]!==b){a[d++]=c[e++]}}a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++){e=!!b(a[f],f),c!==e&&d.push(a[f])}return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k){for(;i<j;i++){f=c(a[i],i,d),f!=null&&(h[h.length]=f)}}else{for(g in a){f=c(a[g],g,d),f!=null&&(h[h.length]=f)}}return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a)){return b}var f=G.call(arguments,2),g=function(){return a.apply(c,f.concat(G.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h){var i=a.length;if(typeof c=="object"){for(var j in c){e.access(a,j,c[j],f,g,d)}return a}if(d!==b){f=!h&&f&&e.isFunction(d);for(var k=0;k<i;k++){g(a[k],c,f?d.call(a[k],k,g(a[k],c)):d,h)}return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=s.exec(a)||t.exec(a)||u.exec(a)||a.indexOf("compatible")<0&&v.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){J["[object "+b+"]"]=b.toLowerCase()}),A=e.uaMatch(z),A.browser&&(e.browser[A.browser]=!0,e.browser.version=A.version),e.browser.webkit&&(e.browser.safari=!0),j.test(" ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?C=function(){c.removeEventListener("DOMContentLoaded",C,!1),e.ready()}:c.attachEvent&&(C=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",C),e.ready())});return e}(),g="done fail isResolved isRejected promise then always pipe".split(" "),h=[].slice;f.extend({_Deferred:function(){var a=[],b,c,d,e={done:function(){if(!d){var c=arguments,g,h,i,j,k;b&&(k=b,b=0);for(g=0,h=c.length;g<h;g++){i=c[g],j=f.type(i),j==="array"?e.done.apply(e,i):j==="function"&&a.push(i)}k&&e.resolveWith(k[0],k[1])}return this},resolveWith:function(e,f){if(!d&&!b&&!c){f=f||[],c=1;try{while(a[0]){a.shift().apply(e,f)}}finally{b=[e,f],c=0}}return this},resolve:function(){e.resolveWith(this,arguments);return this},isResolved:function(){return !!c||!!b},cancel:function(){d=1,a=[];return this}};return e},Deferred:function(a){var b=f._Deferred(),c=f._Deferred(),d;f.extend(b,{then:function(a,c){b.done(a).fail(c);return this},always:function(){return b.done.apply(b,arguments).fail.apply(this,arguments)},fail:c.done,rejectWith:c.resolveWith,reject:c.resolve,isRejected:c.isResolved,pipe:function(a,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[c,"reject"]},function(a,c){var e=c[0],g=c[1],h;f.isFunction(e)?b[a](function(){h=e.apply(this,arguments),h&&f.isFunction(h.promise)?h.promise().then(d.resolve,d.reject):d[g+"With"](this===b?d:this,[h])}):b[a](d[g])})}).promise()},promise:function(a){if(a==null){if(d){return d}d=a={}}var c=g.length;while(c--){a[g[c]]=b[g[c]]}return a}}),b.done(c.cancel).fail(b.cancel),delete b.cancel,a&&a.call(b,b);return b},when:function(a){function i(a){return function(c){b[a]=arguments.length>1?h.call(arguments,0):c,--e||g.resolveWith(g,h.call(b,0))}}var b=arguments,c=0,d=b.length,e=d,g=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred();if(d>1){for(;c<d;c++){b[c]&&f.isFunction(b[c].promise)?b[c].promise().then(i(c),g.reject):--e}e||g.resolveWith(g,b)}else{g!==a&&g.resolveWith(g,d?[a]:[])}return g.promise()}}),f.support=function(){var a=c.createElement("div"),b=c.documentElement,d,e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;a.setAttribute("className","t"),a.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=a.getElementsByTagName("*"),e=a.getElementsByTagName("a")[0];if(!d||!d.length||!e){return{}}g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=a.getElementsByTagName("input")[0],k={leadingWhitespace:a.firstChild.nodeType===3,tbody:!a.getElementsByTagName("tbody").length,htmlSerialize:!!a.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55$/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:a.className!=="t",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,k.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,k.optDisabled=!h.disabled;try{delete a.test}catch(v){k.deleteExpando=!1}!a.addEventListener&&a.attachEvent&&a.fireEvent&&(a.attachEvent("onclick",function(){k.noCloneEvent=!1}),a.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),k.radioValue=i.value==="t",i.setAttribute("checked","checked"),a.appendChild(i),l=c.createDocumentFragment(),l.appendChild(a.firstChild),k.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked,a.innerHTML="",a.style.width=a.style.paddingLeft="1px",m=c.getElementsByTagName("body")[0],o=c.createElement(m?"div":"body"),p={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},m&&f.extend(p,{position:"absolute",left:"-1000px",top:"-1000px"});for(t in p){o.style[t]=p[t]}o.appendChild(a),n=m||b,n.insertBefore(o,n.firstChild),k.appendChecked=i.checked,k.boxModel=a.offsetWidth===2,"zoom" in a.style&&(a.style.display="inline",a.style.zoom=1,k.inlineBlockNeedsLayout=a.offsetWidth===2,a.style.display="",a.innerHTML="<div style='width:4px;'></div>",k.shrinkWrapBlocks=a.offsetWidth!==2),a.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",q=a.getElementsByTagName("td"),u=q[0].offsetHeight===0,q[0].style.display="",q[1].style.display="none",k.reliableHiddenOffsets=u&&q[0].offsetHeight===0,a.innerHTML="",c.defaultView&&c.defaultView.getComputedStyle&&(j=c.createElement("div"),j.style.width="0",j.style.marginRight="0",a.appendChild(j),k.reliableMarginRight=(parseInt((c.defaultView.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0),o.innerHTML="",n.removeChild(o);if(a.attachEvent){for(t in {submit:1,change:1,focusin:1}){s="on"+t,u=s in a,u||(a.setAttribute(s,"return;"),u=typeof a[s]=="function"),k[t+"Bubbles"]=u}}o=l=g=h=m=j=a=i=null;return k}(),f.boxModel=f.support.boxModel;var i=/^(?:\{.*\}|\[.*\])$/,j=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return !!a&&!l(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i=f.expando,j=typeof c=="string",k=a.nodeType,l=k?f.cache:a,m=k?a[f.expando]:a[f.expando]&&f.expando;if((!m||e&&m&&l[m]&&!l[m][i])&&j&&d===b){return}m||(k?a[f.expando]=m=++f.uuid:m=f.expando),l[m]||(l[m]={},k||(l[m].toJSON=f.noop));if(typeof c=="object"||typeof c=="function"){e?l[m][i]=f.extend(l[m][i],c):l[m]=f.extend(l[m],c)}g=l[m],e&&(g[i]||(g[i]={}),g=g[i]),d!==b&&(g[f.camelCase(c)]=d);if(c==="events"&&!g[c]){return g[i]&&g[i].events}j?(h=g[c],h==null&&(h=g[f.camelCase(c)])):h=g;return h}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e=f.expando,g=a.nodeType,h=g?f.cache:a,i=g?a[f.expando]:f.expando;if(!h[i]){return}if(b){d=c?h[i][e]:h[i];if(d){d[b]||(b=f.camelCase(b)),delete d[b];if(!l(d)){return}}}if(c){delete h[i][e];if(!l(h[i])){return}}var j=h[i][e];f.support.deleteExpando||!h.setInterval?delete h[i]:h[i]=null,j?(h[i]={},g||(h[i].toJSON=f.noop),h[i][e]=j):g&&(f.support.deleteExpando?delete a[f.expando]:a.removeAttribute?a.removeAttribute(f.expando):a[f.expando]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b){return b!==!0&&a.getAttribute("classid")===b}}return !0}}),f.fn.extend({data:function(a,c){var d=null;if(typeof a=="undefined"){if(this.length){d=f.data(this[0]);if(this[0].nodeType===1){var e=this[0].attributes,g;for(var h=0,i=e.length;h<i;h++){g=e[h].name,g.indexOf("data-")===0&&(g=f.camelCase(g.substring(5)),k(this[0],g,d[g]))}}}return d}if(typeof a=="object"){return this.each(function(){f.data(this,a)})}var j=a.split(".");j[1]=j[1]?"."+j[1]:"";if(c===b){d=this.triggerHandler("getData"+j[1]+"!",[j[0]]),d===b&&this.length&&(d=f.data(this[0],a),d=k(this[0],a,d));return d===b&&j[1]?this.data(j[0]):d}return this.each(function(){var b=f(this),d=[j[0],c];b.triggerHandler("setData"+j[1]+"!",d),f.data(this,a,c),b.triggerHandler("changeData"+j[1]+"!",d)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,c){a&&(c=(c||"fx")+"mark",f.data(a,c,(f.data(a,c,b,!0)||0)+1,!0))},_unmark:function(a,c,d){a!==!0&&(d=c,c=a,a=!1);if(c){d=d||"fx";var e=d+"mark",g=a?0:(f.data(c,e,b,!0)||1)-1;g?f.data(c,e,g,!0):(f.removeData(c,e,!0),m(c,d,"mark"))}},queue:function(a,c,d){if(a){c=(c||"fx")+"queue";var e=f.data(a,c,b,!0);d&&(!e||f.isArray(d)?e=f.data(a,c,f.makeArray(d),!0):e.push(d));return e||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e;d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),d.call(a,function(){f.dequeue(a,b)})),c.length||(f.removeData(a,b+"queue",!0),m(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){typeof a!="string"&&(c=a,a="fx");if(c===b){return f.queue(this[0],a)}return this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(){var c=this;setTimeout(function(){f.dequeue(c,b)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--){if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f._Deferred(),!0)){h++,l.done(m)}}m();return d.promise()}});var n=/[\n\t\r]/g,o=/\s+/,p=/\r/g,q=/^(?:button|input)$/i,r=/^(?:button|input|object|select|textarea)$/i,s=/^a(?:rea)?$/i,t=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,u,v;f.fn.extend({attr:function(a,b){return f.access(this,a,b,!0,f.attr)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,a,b,!0,f.prop)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a)){return this.each(function(b){f(this).addClass(a.call(this,b,this.className))})}if(a&&typeof a=="string"){b=a.split(o);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1){if(!e.className&&b.length===1){e.className=a}else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++){~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ")}e.className=f.trim(g)}}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a)){return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))})}if(a&&typeof a=="string"||a===b){c=(a||"").split(o);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className){if(a){h=(" "+g.className+" ").replace(n," ");for(i=0,j=c.length;i<j;i++){h=h.replace(" "+c[i]+" "," ")}g.className=f.trim(h)}else{g.className=""}}}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a)){return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)})}return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(o);while(e=j[g++]){i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}}else{if(c==="undefined"||c==="boolean"){this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""}}})},hasClass:function(a){var b=" "+a+" ";for(var c=0,d=this.length;c<d;c++){if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(n," ").indexOf(b)>-1){return !0}}return !1},val:function(a){var c,d,e=this[0];if(!arguments.length){if(e){c=f.valHooks[e.nodeName.toLowerCase()]||f.valHooks[e.type];if(c&&"get" in c&&(d=c.get(e,"value"))!==b){return d}d=e.value;return typeof d=="string"?d.replace(p,""):d==null?"":d}return b}var g=f.isFunction(a);return this.each(function(d){var e=f(this),h;if(this.nodeType===1){g?h=a.call(this,d,e.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.nodeName.toLowerCase()]||f.valHooks[this.type];if(!c||!("set" in c)||c.set(this,h,"value")===b){this.value=h}}})}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return !b||b.specified?a.value:a.text}},select:{get:function(a){var b,c=a.selectedIndex,d=[],e=a.options,g=a.type==="select-one";if(c<0){return null}for(var h=g?c:0,i=g?c+1:e.length;h<i;h++){var j=e[h];if(j.selected&&(f.support.optDisabled?!j.disabled:j.getAttribute("disabled")===null)&&(!j.parentNode.disabled||!f.nodeName(j.parentNode,"optgroup"))){b=f(j).val();if(g){return b}d.push(b)}}if(g&&!d.length&&e.length){return f(e[c]).val()}return d},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attrFix:{tabindex:"tabIndex"},attr:function(a,c,d,e){var g=a.nodeType;if(!a||g===3||g===8||g===2){return b}if(e&&c in f.attrFn){return f(a)[c](d)}if(!("getAttribute" in a)){return f.prop(a,c,d)}var h,i,j=g!==1||!f.isXMLDoc(a);j&&(c=f.attrFix[c]||c,i=f.attrHooks[c],i||(t.test(c)?i=v:u&&(i=u)));if(d!==b){if(d===null){f.removeAttr(a,c);return b}if(i&&"set" in i&&j&&(h=i.set(a,d,c))!==b){return h}a.setAttribute(c,""+d);return d}if(i&&"get" in i&&j&&(h=i.get(a,c))!==null){return h}h=a.getAttribute(c);return h===null?b:h},removeAttr:function(a,b){var c;a.nodeType===1&&(b=f.attrFix[b]||b,f.attr(a,b,""),a.removeAttribute(b),t.test(b)&&(c=f.propFix[b]||b) in a&&(a[c]=!1))},attrHooks:{type:{set:function(a,b){if(q.test(a.nodeName)&&a.parentNode){f.error("type property can't be changed")}else{if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}}},value:{get:function(a,b){if(u&&f.nodeName(a,"button")){return u.get(a,b)}return b in a?a.value:null},set:function(a,b,c){if(u&&f.nodeName(a,"button")){return u.set(a,b,c)}a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e=a.nodeType;if(!a||e===3||e===8||e===2){return b}var g,h,i=e!==1||!f.isXMLDoc(a);i&&(c=f.propFix[c]||c,h=f.propHooks[c]);return d!==b?h&&"set" in h&&(g=h.set(a,d,c))!==b?g:a[c]=d:h&&"get" in h&&(g=h.get(a,c))!==null?g:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):r.test(a.nodeName)||s.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabIndex=f.propHooks.tabIndex,v={get:function(a,c){var d;return f.prop(a,c)===!0||(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},f.support.getSetAttribute||(u=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&d.nodeValue!==""?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})})),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b)){return a.checked=f.inArray(f(a).val(),b)>=0}}})});var w=/\.(.*)$/,x=/^(?:textarea|input|select)$/i,y=/\./g,z=/ /g,A=/[^\w\s.|`]/g,B=function(a){return a.replace(A,"\\$&")};f.event={add:function(a,c,d,e){if(a.nodeType!==3&&a.nodeType!==8){if(d===!1){d=C}else{if(!d){return}}var g,h;d.handler&&(g=d,d=g.handler),d.guid||(d.guid=f.guid++);var i=f._data(a);if(!i){return}var j=i.events,k=i.handle;j||(i.events=j={}),k||(i.handle=k=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.handle.apply(k.elem,arguments):b}),k.elem=a,c=c.split(" ");var l,m=0,n;while(l=c[m++]){h=g?f.extend({},g):{handler:d,data:e},l.indexOf(".")>-1?(n=l.split("."),l=n.shift(),h.namespace=n.slice(0).sort().join(".")):(n=[],h.namespace=""),h.type=l,h.guid||(h.guid=d.guid);var o=j[l],p=f.event.special[l]||{};if(!o){o=j[l]=[];if(!p.setup||p.setup.call(a,e,n,k)===!1){a.addEventListener?a.addEventListener(l,k,!1):a.attachEvent&&a.attachEvent("on"+l,k)}}p.add&&(p.add.call(a,h),h.handler.guid||(h.handler.guid=d.guid)),o.push(h),f.event.global[l]=!0}a=null}},global:{},remove:function(a,c,d,e){if(a.nodeType!==3&&a.nodeType!==8){d===!1&&(d=C);var g,h,i,j,k=0,l,m,n,o,p,q,r,s=f.hasData(a)&&f._data(a),t=s&&s.events;if(!s||!t){return}c&&c.type&&(d=c.handler,c=c.type);if(!c||typeof c=="string"&&c.charAt(0)==="."){c=c||"";for(h in t){f.event.remove(a,h+c)}return}c=c.split(" ");while(h=c[k++]){r=h,q=null,l=h.indexOf(".")<0,m=[],l||(m=h.split("."),h=m.shift(),n=new RegExp("(^|\\.)"+f.map(m.slice(0).sort(),B).join("\\.(?:.*\\.)?")+"(\\.|$)")),p=t[h];if(!p){continue}if(!d){for(j=0;j<p.length;j++){q=p[j];if(l||n.test(q.namespace)){f.event.remove(a,r,q.handler,j),p.splice(j--,1)}}continue}o=f.event.special[h]||{};for(j=e||0;j<p.length;j++){q=p[j];if(d.guid===q.guid){if(l||n.test(q.namespace)){e==null&&p.splice(j--,1),o.remove&&o.remove.call(a,q)}if(e!=null){break}}}if(p.length===0||e!=null&&p.length===1){(!o.teardown||o.teardown.call(a,m)===!1)&&f.removeEvent(a,h,s.handle),g=null,delete t[h]}}if(f.isEmptyObject(t)){var u=s.handle;u&&(u.elem=null),delete s.events,delete s.handle,f.isEmptyObject(s)&&f.removeData(a,b,!0)}}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){var h=c.type||c,i=[],j;h.indexOf("!")>=0&&(h=h.slice(0,-1),j=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if(!!e&&!f.event.customEvent[h]||!!f.event.global[h]){c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.exclusive=j,c.namespace=i.join("."),c.namespace_re=new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)");if(g||!e){c.preventDefault(),c.stopPropagation()}if(!e){f.each(f.cache,function(){var a=f.expando,b=this[a];b&&b.events&&b.events[h]&&f.event.trigger(c,d,b.handle.elem)});return}if(e.nodeType===3||e.nodeType===8){return}c.result=b,c.target=e,d=d!=null?f.makeArray(d):[],d.unshift(c);var k=e,l=h.indexOf(":")<0?"on"+h:"";do{var m=f._data(k,"handle");c.currentTarget=k,m&&m.apply(k,d),l&&f.acceptData(k)&&k[l]&&k[l].apply(k,d)===!1&&(c.result=!1,c.preventDefault()),k=k.parentNode||k.ownerDocument||k===c.target.ownerDocument&&a}while(k&&!c.isPropagationStopped());if(!c.isDefaultPrevented()){var n,o=f.event.special[h]||{};if((!o._default||o._default.call(e.ownerDocument,c)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)){try{l&&e[h]&&(n=e[l],n&&(e[l]=null),f.event.triggered=h,e[h]())}catch(p){}n&&(e[l]=n),f.event.triggered=b}}return c.result}},handle:function(c){c=f.event.fix(c||a.event);var d=((f._data(this,"events")||{})[c.type]||[]).slice(0),e=!c.exclusive&&!c.namespace,g=Array.prototype.slice.call(arguments,0);g[0]=c,c.currentTarget=this;for(var h=0,i=d.length;h<i;h++){var j=d[h];if(e||c.namespace_re.test(j.namespace)){c.handler=j.handler,c.data=j.data,c.handleObj=j;var k=j.handler.apply(this,g);k!==b&&(c.result=k,k===!1&&(c.preventDefault(),c.stopPropagation()));if(c.isImmediatePropagationStopped()){break}}}return c.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(a){if(a[f.expando]){return a}var d=a;a=f.Event(d);for(var e=this.props.length,g;e;){g=this.props[--e],a[g]=d[g]}a.target||(a.target=a.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),!a.relatedTarget&&a.fromElement&&(a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement);if(a.pageX==null&&a.clientX!=null){var h=a.target.ownerDocument||c,i=h.documentElement,j=h.body;a.pageX=a.clientX+(i&&i.scrollLeft||j&&j.scrollLeft||0)-(i&&i.clientLeft||j&&j.clientLeft||0),a.pageY=a.clientY+(i&&i.scrollTop||j&&j.scrollTop||0)-(i&&i.clientTop||j&&j.clientTop||0)}a.which==null&&(a.charCode!=null||a.keyCode!=null)&&(a.which=a.charCode!=null?a.charCode:a.keyCode),!a.metaKey&&a.ctrlKey&&(a.metaKey=a.ctrlKey),!a.which&&a.button!==b&&(a.which=a.button&1?1:a.button&2?3:a.button&4?2:0);return a},guid:100000000,proxy:f.proxy,special:{ready:{setup:f.bindReady,teardown:f.noop},live:{add:function(a){f.event.add(this,M(a.origType,a.selector),f.extend({},a,{handler:L,guid:a.handler.guid}))},remove:function(a){f.event.remove(this,M(a.origType,a.selector),a)}},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}}},f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!this.preventDefault){return new f.Event(a,b)}a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?D:C):this.type=a,b&&f.extend(this,b),this.timeStamp=f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=D;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=D;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=D,this.stopPropagation()},isDefaultPrevented:C,isPropagationStopped:C,isImmediatePropagationStopped:C};var E=function(a){var b=a.relatedTarget,c=!1,d=a.type;a.type=a.data,b!==this&&(b&&(c=f.contains(this,b)),c||(f.event.handle.apply(this,arguments),a.type=d))},F=function(a){a.type=a.data,f.event.handle.apply(this,arguments)};f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={setup:function(c){f.event.add(this,b,c&&c.selector?F:E,a)},teardown:function(a){f.event.remove(this,b,a&&a.selector?F:E)}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(a,b){if(!f.nodeName(this,"form")){f.event.add(this,"click.specialSubmit",function(a){var b=a.target,c=f.nodeName(b,"input")||f.nodeName(b,"button")?b.type:"";(c==="submit"||c==="image")&&f(b).closest("form").length&&J("submit",this,arguments)}),f.event.add(this,"keypress.specialSubmit",function(a){var b=a.target,c=f.nodeName(b,"input")||f.nodeName(b,"button")?b.type:"";(c==="text"||c==="password")&&f(b).closest("form").length&&a.keyCode===13&&J("submit",this,arguments)})}else{return !1}},teardown:function(a){f.event.remove(this,".specialSubmit")}});if(!f.support.changeBubbles){var G,H=function(a){var b=f.nodeName(a,"input")?a.type:"",c=a.value;b==="radio"||b==="checkbox"?c=a.checked:b==="select-multiple"?c=a.selectedIndex>-1?f.map(a.options,function(a){return a.selected}).join("-"):"":f.nodeName(a,"select")&&(c=a.selectedIndex);return c},I=function(c){var d=c.target,e,g;if(!!x.test(d.nodeName)&&!d.readOnly){e=f._data(d,"_change_data"),g=H(d),(c.type!=="focusout"||d.type!=="radio")&&f._data(d,"_change_data",g);if(e===b||g===e){return}if(e!=null||g){c.type="change",c.liveFired=b,f.event.trigger(c,arguments[1],d)}}};f.event.special.change={filters:{focusout:I,beforedeactivate:I,click:function(a){var b=a.target,c=f.nodeName(b,"input")?b.type:"";(c==="radio"||c==="checkbox"||f.nodeName(b,"select"))&&I.call(this,a)},keydown:function(a){var b=a.target,c=f.nodeName(b,"input")?b.type:"";(a.keyCode===13&&!f.nodeName(b,"textarea")||a.keyCode===32&&(c==="checkbox"||c==="radio")||c==="select-multiple")&&I.call(this,a)},beforeactivate:function(a){var b=a.target;f._data(b,"_change_data",H(b))}},setup:function(a,b){if(this.type==="file"){return !1}for(var c in G){f.event.add(this,c+".specialChange",G[c])}return x.test(this.nodeName)},teardown:function(a){f.event.remove(this,".specialChange");return x.test(this.nodeName)}},G=f.event.special.change.filters,G.focus=G.beforeactivate}f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){function e(a){var c=f.event.fix(a);c.type=b,c.originalEvent={},f.event.trigger(c,null,c.target),c.isDefaultPrevented()&&a.preventDefault()}var d=0;f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.each(["bind","one"],function(a,c){f.fn[c]=function(a,d,e){var g;if(typeof a=="object"){for(var h in a){this[c](h,d,a[h],e)}return this}if(arguments.length===2||d===!1){e=d,d=b}c==="one"?(g=function(a){f(this).unbind(a,g);return e.apply(this,arguments)},g.guid=e.guid||f.guid++):g=e;if(a==="unload"&&c!=="one"){this.one(a,d,e)}else{for(var i=0,j=this.length;i<j;i++){f.event.add(this[i],a,g,d)}}return this}}),f.fn.extend({unbind:function(a,b){if(typeof a=="object"&&!a.preventDefault){for(var c in a){this.unbind(c,a[c])}}else{for(var d=0,e=this.length;d<e;d++){f.event.remove(this[d],a,b)}}return this},delegate:function(a,b,c,d){return this.live(b,c,d,a)},undelegate:function(a,b,c){return arguments.length===0?this.unbind("live"):this.die(b,null,c,a)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0]){return f.event.trigger(a,b,this[0],!0)}},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f.data(this,"lastToggle"+a.guid)||0)%d;f.data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length){b[d++].guid=c}return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var K={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};f.each(["live","die"],function(a,c){f.fn[c]=function(a,d,e,g){var h,i=0,j,k,l,m=g||this.selector,n=g?this:f(this.context);if(typeof a=="object"&&!a.preventDefault){for(var o in a){n[c](o,d,a[o],m)}return this}if(c==="die"&&!a&&g&&g.charAt(0)==="."){n.unbind(g);return this}if(d===!1||f.isFunction(d)){e=d||C,d=b}a=(a||"").split(" ");while((h=a[i++])!=null){j=w.exec(h),k="",j&&(k=j[0],h=h.replace(w,""));if(h==="hover"){a.push("mouseenter"+k,"mouseleave"+k);continue}l=h,K[h]?(a.push(K[h]+k),h=h+k):h=(K[h]||h)+k;if(c==="live"){for(var p=0,q=n.length;p<q;p++){f.event.add(n[p],"live."+M(h,m),{data:d,selector:m,handler:e,origType:h,origHandler:e,preType:l})}}else{n.unbind("live."+M(h,m),e)}}return this}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.bind(b,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0)}),function(){function u(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;g++){var i=d[g];if(i){var j=!1;i=i[a];while(i){if(i.sizcache===c){j=d[i.sizset];break}if(i.nodeType===1){f||(i.sizcache=c,i.sizset=g);if(typeof b!="string"){if(i===b){j=!0;break}}else{if(k.filter(b,[i]).length>0){j=i;break}}}i=i[a]}d[g]=j}}}function t(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;g++){var i=d[g];if(i){var j=!1;i=i[a];while(i){if(i.sizcache===c){j=d[i.sizset];break}i.nodeType===1&&!f&&(i.sizcache=c,i.sizset=g);if(i.nodeName.toLowerCase()===b){j=i;break}i=i[a]}d[g]=j}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d=0,e=Object.prototype.toString,g=!1,h=!0,i=/\\/g,j=/\W/;[0,0].sort(function(){h=!1;return 0});var k=function(b,d,f,g){f=f||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9){return[]}if(!b||typeof b!="string"){return f}var i,j,n,o,q,r,s,t,u=!0,w=k.isXML(d),x=[],y=b;do{a.exec(""),i=a.exec(y);if(i){y=i[3],x.push(i[1]);if(i[2]){o=i[3];break}}}while(i);if(x.length>1&&m.exec(b)){if(x.length===2&&l.relative[x[0]]){j=v(x[0]+x[1],d)}else{j=l.relative[x[0]]?[d]:k(x.shift(),d);while(x.length){b=x.shift(),l.relative[b]&&(b+=x.shift()),j=v(b,j)}}}else{!g&&x.length>1&&d.nodeType===9&&!w&&l.match.ID.test(x[0])&&!l.match.ID.test(x[x.length-1])&&(q=k.find(x.shift(),d,w),d=q.expr?k.filter(q.expr,q.set)[0]:q.set[0]);if(d){q=g?{expr:x.pop(),set:p(g)}:k.find(x.pop(),x.length===1&&(x[0]==="~"||x[0]==="+")&&d.parentNode?d.parentNode:d,w),j=q.expr?k.filter(q.expr,q.set):q.set,x.length>0?n=p(j):u=!1;while(x.length){r=x.pop(),s=r,l.relative[r]?s=x.pop():r="",s==null&&(s=d),l.relative[r](n,s,w)}}else{n=x=[]}}n||(n=j),n||k.error(r||b);if(e.call(n)==="[object Array]"){if(!u){f.push.apply(f,n)}else{if(d&&d.nodeType===1){for(t=0;n[t]!=null;t++){n[t]&&(n[t]===!0||n[t].nodeType===1&&k.contains(d,n[t]))&&f.push(j[t])}}else{for(t=0;n[t]!=null;t++){n[t]&&n[t].nodeType===1&&f.push(j[t])}}}}else{p(n,f)}o&&(k(o,h,f,g),k.uniqueSort(f));return f};k.uniqueSort=function(a){if(r){g=h,a.sort(r);if(g){for(var b=1;b<a.length;b++){a[b]===a[b-1]&&a.splice(b--,1)}}}return a},k.matches=function(a,b){return k(a,null,null,b)},k.matchesSelector=function(a,b){return k(b,null,null,[a]).length>0},k.find=function(a,b,c){var d;if(!a){return[]}for(var e=0,f=l.order.length;e<f;e++){var g,h=l.order[e];if(g=l.leftMatch[h].exec(a)){var j=g[1];g.splice(1,1);if(j.substr(j.length-1)!=="\\"){g[1]=(g[1]||"").replace(i,""),d=l.find[h](g,b,c);if(d!=null){a=a.replace(l.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},k.filter=function(a,c,d,e){var f,g,h=a,i=[],j=c,m=c&&c[0]&&k.isXML(c[0]);while(a&&c.length){for(var n in l.filter){if((f=l.leftMatch[n].exec(a))!=null&&f[2]){var o,p,q=l.filter[n],r=f[1];g=!1,f.splice(1,1);if(r.substr(r.length-1)==="\\"){continue}j===i&&(i=[]);if(l.preFilter[n]){f=l.preFilter[n](f,j,d,i,e,m);if(!f){g=o=!0}else{if(f===!0){continue}}}if(f){for(var s=0;(p=j[s])!=null;s++){if(p){o=q(p,f,s,j);var t=e^!!o;d&&o!=null?t?g=!0:j[s]=!1:t&&(i.push(p),g=!0)}}}if(o!==b){d||(j=i),a=a.replace(l.match[n],"");if(!g){return[]}break}}}if(a===h){if(g==null){k.error(a)}else{break}}h=a}return j},k.error=function(a){throw"Syntax error, unrecognized expression: "+a};var l=k.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!j.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++){if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1){}a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}}e&&k.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!j.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++){c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b)}d&&k.filter(b,a,!0)}},"":function(a,b,c){var e,f=d++,g=u;typeof b=="string"&&!j.test(b)&&(b=b.toLowerCase(),e=b,g=t),g("parentNode",b,f,a,e,c)},"~":function(a,b,c){var e,f=d++,g=u;typeof b=="string"&&!j.test(b)&&(b=b.toLowerCase(),e=b,g=t),g("previousSibling",b,f,a,e,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++){d[e].getAttribute("name")===a[1]&&c.push(d[e])}return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined"){return b.getElementsByTagName(a[1])}}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(i,"")+" ";if(f){return a}for(var g=0,h;(h=b[g])!=null;g++){h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1))}return !1},ID:function(a){return a[1].replace(i,"")},TAG:function(a,b){return a[1].replace(i,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||k.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else{a[2]&&k.error(a[0])}a[0]=d++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(i,"");!f&&l.attrMap[g]&&(a[1]=l.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(i,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not"){if((a.exec(b[3])||"").length>1||/^\w/.test(b[3])){b[3]=k(b[3],null,null,c)}else{var g=k.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return !1}}else{if(l.match.POS.test(b[0])||l.match.CHILD.test(b[0])){return !0}}return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return !!a.firstChild},empty:function(a){return !a.firstChild},has:function(a,b,c){return !!k(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=l.filters[e];if(f){return f(a,c,b,d)}if(e==="contains"){return(a.textContent||a.innerText||k.getText([a])||"").indexOf(b[3])>=0}if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++){if(g[h]===a){return !1}}return !0}k.error(e)},CHILD:function(a,b){var c=b[1],d=a;switch(c){case"only":case"first":while(d=d.previousSibling){if(d.nodeType===1){return !1}}if(c==="first"){return !0}d=a;case"last":while(d=d.nextSibling){if(d.nodeType===1){return !1}}return !0;case"nth":var e=b[2],f=b[3];if(e===1&&f===0){return !0}var g=b[0],h=a.parentNode;if(h&&(h.sizcache!==g||!a.nodeIndex)){var i=0;for(d=h.firstChild;d;d=d.nextSibling){d.nodeType===1&&(d.nodeIndex=++i)}h.sizcache=g}var j=a.nodeIndex-f;return e===0?j===0:j%e===0&&j/e>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=l.attrHandle[c]?l.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=l.setFilters[e];if(f){return f(a,c,b,d)}}}},m=l.match.POS,n=function(a,b){return"\\"+(b-0+1)};for(var o in l.match){l.match[o]=new RegExp(l.match[o].source+/(?![^\[]*\])(?![^\(]*\))/.source),l.leftMatch[o]=new RegExp(/(^(?:.|\r|\n)*?)/.source+l.match[o].source.replace(/\\(\d+)/g,n))}var p=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(q){p=function(a,b){var c=0,d=b||[];if(e.call(a)==="[object Array]"){Array.prototype.push.apply(d,a)}else{if(typeof a.length=="number"){for(var f=a.length;c<f;c++){d.push(a[c])}}else{for(;a[c];c++){d.push(a[c])}}}return d}}var r,s;c.documentElement.compareDocumentPosition?r=function(a,b){if(a===b){g=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition){return a.compareDocumentPosition?-1:1}return a.compareDocumentPosition(b)&4?-1:1}:(r=function(a,b){if(a===b){g=!0;return 0}if(a.sourceIndex&&b.sourceIndex){return a.sourceIndex-b.sourceIndex}var c,d,e=[],f=[],h=a.parentNode,i=b.parentNode,j=h;if(h===i){return s(a,b)}if(!h){return -1}if(!i){return 1}while(j){e.unshift(j),j=j.parentNode}j=i;while(j){f.unshift(j),j=j.parentNode}c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++){if(e[k]!==f[k]){return s(e[k],f[k])}}return k===c?s(a,f[k],-1):s(e[k],b,1)},s=function(a,b,c){if(a===b){return c}var d=a.nextSibling;while(d){if(d===b){return -1}d=d.nextSibling}return 1}),k.getText=function(a){var b="",c;for(var d=0;a[d];d++){c=a[d],c.nodeType===3||c.nodeType===4?b+=c.nodeValue:c.nodeType!==8&&(b+=k.getText(c.childNodes))}return b},function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(l.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},l.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(l.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++){c[e].nodeType===1&&d.push(c[e])}c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(l.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=k,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){k=function(b,e,f,g){e=e||c;if(!g&&!k.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1]){return p(e.getElementsByTagName(b),f)}if(h[2]&&l.find.CLASS&&e.getElementsByClassName){return p(e.getElementsByClassName(h[2]),f)}}if(e.nodeType===9){if(b==="body"&&e.body){return p([e.body],f)}if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode){return p([],f)}if(i.id===h[3]){return p([i],f)}}try{return p(e.querySelectorAll(b),f)}catch(j){}}else{if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var m=e,n=e.getAttribute("id"),o=n||d,q=e.parentNode,r=/^\s*[+~]/.test(b);n?o=o.replace(/'/g,"\\$&"):e.setAttribute("id",o),r&&q&&(e=e.parentNode);try{if(!r||q){return p(e.querySelectorAll("[id='"+o+"'] "+b),f)}}catch(s){}finally{n||m.removeAttribute("id")}}}}return a(b,e,f,g)};for(var e in a){k[e]=a[e]}b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}k.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!k.isXML(a)){try{if(e||!l.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11){return f}}}catch(g){}}return k(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1){return}l.order.splice(1,0,"CLASS"),l.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c){return b.getElementsByClassName(a[1])}},a=null}}(),c.documentElement.contains?k.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?k.contains=function(a,b){return !!(a.compareDocumentPosition(b)&16)}:k.contains=function(){return !1},k.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var v=function(a,b){var c,d=[],e="",f=b.nodeType?[b]:b;while(c=l.match.PSEUDO.exec(a)){e+=c[0],a=a.replace(l.match.PSEUDO,"")}a=l.relative[a]?a+"*":a;for(var g=0,h=f.length;g<h;g++){k(a,f[g],d)}return k.filter(e,d)};f.find=k,f.expr=k.selectors,f.expr[":"]=f.expr.filters,f.unique=k.uniqueSort,f.text=k.getText,f.isXMLDoc=k.isXML,f.contains=k.contains}();var N=/Until$/,O=/^(?:parents|prevUntil|prevAll)/,P=/,/,Q=/^.[^:#\[\.,]*$/,R=Array.prototype.slice,S=f.expr.match.POS,T={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string"){return f(a).filter(function(){for(c=0,d=b.length;c<d;c++){if(f.contains(b[c],this)){return !0}}})}var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0){for(h=g;h<e.length;h++){for(i=0;i<g;i++){if(e[i]===e[h]){e.splice(h--,1);break}}}}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++){if(f.contains(this,b[a])){return !0}}})},not:function(a){return this.pushStack(V(this,a,!1),"not",a)},filter:function(a){return this.pushStack(V(this,a,!0),"filter",a)},is:function(a){return !!a&&(typeof a=="string"?f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h,i,j={},k=1;if(g&&a.length){for(d=0,e=a.length;d<e;d++){i=a[d],j[i]||(j[i]=S.test(i)?f(i,b||this.context):i)}while(g&&g.ownerDocument&&g!==b){for(i in j){h=j[i],(h.jquery?h.index(g)>-1:f(g).is(h))&&c.push({selector:i,elem:g,level:k})}g=g.parentNode,k++}}return c}var l=S.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(l?l.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11){break}}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a){return this[0]&&this[0].parentNode?this.prevAll().length:-1}if(typeof a=="string"){return f.inArray(this[0],f(a))}return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(U(c[0])||U(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c),g=R.call(arguments);N.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!T[a]?f.unique(e):e,(this.length>1||P.test(d))&&O.test(a)&&(e=e.reverse());return this.pushStack(e,a,g.join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d))){g.nodeType===1&&e.push(g),g=g[c]}return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c]){if(a.nodeType===1&&++e===b){break}}return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling){a.nodeType===1&&a!==b&&c.push(a)}return c}});var W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|object|embed|option|style)/i,bb=/checked\s*(?:[^=]|=\s*.checked.)/i,bc=/\/(java|ecma)script/i,bd=/^\s*<!(?:\[CDATA\[|\-\-)/,be={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};be.optgroup=be.option,be.tbody=be.tfoot=be.colgroup=be.caption=be.thead,be.th=be.td,f.support.htmlSerialize||(be._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){if(f.isFunction(a)){return this.each(function(b){var c=f(this);c.text(a.call(this,b,c.text()))})}if(typeof a!="object"&&a!==b){return this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a))}return f.text(this)},wrapAll:function(a){if(f.isFunction(a)){return this.each(function(b){f(this).wrapAll(a.call(this,b))})}if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1){a=a.firstChild}return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a)){return this.each(function(b){f(this).wrapInner(a.call(this,b))})}return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){f(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)})}if(arguments.length){var a=f(arguments[0]);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)})}if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f(arguments[0]).toArray());return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++){if(!a||f.filter(a,[d]).length){!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d)}}return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild){b.removeChild(b.firstChild)}}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){if(a===b){return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(W,""):null}if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!be[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++){this[c].nodeType===1&&(f.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}}catch(e){this.empty().append(a)}}else{f.isFunction(a)?this.each(function(b){var c=f(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a)}return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a)){return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))})}typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bb.test(j)){return this.each(function(){f(this).domManip(a,c,d,!0)})}if(f.isFunction(j)){return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)})}if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++){d.call(c?bf(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}}k.length&&f.each(k,bl)}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i;b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof a[0]=="string"&&a[0].length<512&&i===c&&a[0].charAt(0)==="<"&&!ba.test(a[0])&&(f.support.checkClone||!bb.test(a[0]))&&(g=!0,h=f.fragments[a[0]],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[a[0]]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d=a.cloneNode(!0),e,g,h;if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bh(a,d),e=bi(a),g=bi(d);for(h=0;e[h];++h){g[h]&&bh(e[h],g[h])}}if(b){bg(a,d);if(c){e=bi(a),g=bi(d);for(h=0;e[h];++h){bg(e[h],g[h])}}}e=g=null;return d},clean:function(a,b,d,e){var g;b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);var h=[],i;for(var j=0,k;(k=a[j])!=null;j++){typeof k=="number"&&(k+="");if(!k){continue}if(typeof k=="string"){if(!_.test(k)){k=b.createTextNode(k)}else{k=k.replace(Y,"<$1></$2>");var l=(Z.exec(k)||["",""])[1].toLowerCase(),m=be[l]||be._default,n=m[0],o=b.createElement("div");o.innerHTML=m[1]+k+m[2];while(n--){o=o.lastChild}if(!f.support.tbody){var p=$.test(k),q=l==="table"&&!p?o.firstChild&&o.firstChild.childNodes:m[1]==="<table>"&&!p?o.childNodes:[];for(i=q.length-1;i>=0;--i){f.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])}}!f.support.leadingWhitespace&&X.test(k)&&o.insertBefore(b.createTextNode(X.exec(k)[0]),o.firstChild),k=o.childNodes}}var r;if(!f.support.appendChecked){if(k[0]&&typeof(r=k.length)=="number"){for(i=0;i<r;i++){bk(k[i])}}else{bk(k)}}k.nodeType?h.push(k):h=f.merge(h,k)}if(d){g=function(a){return !a.type||bc.test(a.type)};for(j=0;h[j];j++){if(e&&f.nodeName(h[j],"script")&&(!h[j].type||h[j].type.toLowerCase()==="text/javascript")){e.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j])}else{if(h[j].nodeType===1){var s=f.grep(h[j].getElementsByTagName("script"),g);h.splice.apply(h,[j+1,0].concat(s))}d.appendChild(h[j])}}}return h},cleanData:function(a){var b,c,d=f.cache,e=f.expando,g=f.event.special,h=f.support.deleteExpando;for(var i=0,j;(j=a[i])!=null;i++){if(j.nodeName&&f.noData[j.nodeName.toLowerCase()]){continue}c=j[f.expando];if(c){b=d[c]&&d[c][e];if(b&&b.events){for(var k in b.events){g[k]?f.event.remove(j,k):f.removeEvent(j,k,b.handle)}b.handle&&(b.handle.elem=null)}h?delete j[f.expando]:j.removeAttribute&&j.removeAttribute(f.expando),delete d[c]}}}});var bm=/alpha\([^)]*\)/i,bn=/opacity=([^)]*)/,bo=/([A-Z]|^ms)/g,bp=/^-?\d+(?:px)?$/i,bq=/^-?\d/,br=/^([\-+])=([\-+.\de]+)/,bs={position:"absolute",visibility:"hidden",display:"block"},bt=["Left","Right"],bu=["Top","Bottom"],bv,bw,bx;f.fn.css=function(a,c){if(arguments.length===2&&c===b){return this}return f.access(this,a,c,!0,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)})},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bv(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get" in k&&(g=k.get(a,!1,e))!==b){return g}return j[c]}h=typeof d,h==="string"&&(g=br.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d)){return}h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set" in k)||(d=k.set(a,d))!==b){try{j[c]=d}catch(l){}}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get" in g&&(e=g.get(a,!0,d))!==b){return e}if(bv){return bv(a,c)}},swap:function(a,b,c){var d={};for(var e in b){d[e]=a.style[e],a.style[e]=b[e]}c.call(a);for(e in b){a.style[e]=d[e]}}}),f.curCSS=f.css,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){var e;if(c){if(a.offsetWidth!==0){return by(a,b,d)}f.swap(a,bs,function(){e=by(a,b,d)});return e}},set:function(a,b){if(!bp.test(b)){return b}b=parseFloat(b);if(b>=0){return b+"px"}}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return bn.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNaN(b)?"":"alpha(opacity="+b*100+")",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bm,""))===""){c.removeAttribute("filter");if(d&&!d.filter){return}}c.filter=bm.test(g)?g.replace(bm,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){var c;f.swap(a,{display:"inline-block"},function(){b?c=bv(a,"margin-right","marginRight"):c=a.style.marginRight});return c}})}),c.defaultView&&c.defaultView.getComputedStyle&&(bw=function(a,c){var d,e,g;c=c.replace(bo,"-$1").toLowerCase();if(!(e=a.ownerDocument.defaultView)){return b}if(g=e.getComputedStyle(a,null)){d=g.getPropertyValue(c),d===""&&!f.contains(a.ownerDocument.documentElement,a)&&(d=f.style(a,c))}return d}),c.documentElement.currentStyle&&(bx=function(a,b){var c,d=a.currentStyle&&a.currentStyle[b],e=a.runtimeStyle&&a.runtimeStyle[b],f=a.style;!bp.test(d)&&bq.test(d)&&(c=f.left,e&&(a.runtimeStyle.left=a.currentStyle.left),f.left=b==="fontSize"?"1em":d||0,d=f.pixelLeft+"px",f.left=c,e&&(a.runtimeStyle.left=e));return d===""?"auto":d}),bv=bw||bx,f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return !f.expr.filters.hidden(a)});var bz=/%20/g,bA=/\[\]$/,bB=/\r?\n/g,bC=/#.*$/,bD=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bE=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bF=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bG=/^(?:GET|HEAD)$/,bH=/^\/\//,bI=/\?/,bJ=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bK=/^(?:select|textarea)/i,bL=/\s+/,bM=/([?&])_=[^&]*/,bN=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bO=f.fn.load,bP={},bQ={},bR,bS,bT=["*/"]+["*"];try{bR=e.href}catch(bU){bR=c.createElement("a"),bR.href="",bR=bR.href}bS=bN.exec(bR.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bO){return bO.apply(this,arguments)}if(!this.length){return this}var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bJ,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bK.test(this.nodeName)||bE.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bB,"\r\n")}}):{name:b.name,value:c.replace(bB,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.bind(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?bX(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),bX(a,b);return a},ajaxSettings:{url:bR,isLocal:bF.test(bS[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bT},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bV(bP),ajaxTransport:bV(bQ),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?bZ(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified")){f.lastModified[k]=y}if(z=v.getResponseHeader("Etag")){f.etag[k]=z}}if(a===304){w="notmodified",o=!0}else{try{r=b$(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}}else{u=w;if(!w||a){w="error",a<0&&(a=0)}}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.resolveWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f._Deferred(),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bD.exec(n)){o[c[1].toLowerCase()]=c[2]}}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.done,v.statusCode=function(a){if(a){var b;if(s<2){for(b in a){j[b]=[j[b],a[b]]}}else{b=a[v.status],v.then(b,b)}}return this},d.url=((a||d.url)+"").replace(bC,"").replace(bH,bS[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bL),d.crossDomain==null&&(r=bN.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bS[1]&&r[2]==bS[2]&&(r[3]||(r[1]==="http:"?80:443))==(bS[3]||(bS[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),bW(bP,d,c,v);if(s===2){return !1}t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bG.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bI.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bM,"$1_="+x);d.url=y+(y===d.url?(bI.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bT+"; q=0.01":""):d.accepts["*"]);for(u in d.headers){v.setRequestHeader(u,d.headers[u])}if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return !1}for(u in {success:1,error:1,complete:1}){v[u](d[u])}p=bW(bQ,d,c,v);if(!p){w(-1,"No Transport")}else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){s<2?w(-1,z):f.error(z)}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a)){f.each(a,function(){e(this.name,this.value)})}else{for(var g in a){bY(g,a[g],c,e)}}return d.join("&").replace(bz,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var b_=f.now(),ca=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+b_++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(ca.test(b.url)||e&&ca.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(ca,l),b.url===j&&(e&&(k=k.replace(ca,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState)){d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")}},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var cb=a.ActiveXObject?function(){for(var a in cd){cd[a](0,1)}}:!1,cc=0,cd;f.ajaxSettings.xhr=a.ActiveXObject?function(){return !this.isLocal&&ce()||cf()}:ce,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials" in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields){for(j in c.xhrFields){h[j]=c.xhrFields[j]}}c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e){h.setRequestHeader(j,e[j])}}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,cb&&delete cd[i]);if(e){h.readyState!==4&&h.abort()}else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n),m.text=h.responseText;try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cc,cb&&(cd||(cd={},f(a).unload(cb)),cd[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var cg={},ch,ci,cj=/^(?:toggle|show|hide)$/,ck=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cl,cm=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cn;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0){return this.animate(cq("show",3),a,b,c)}for(var g=0,h=this.length;g<h;g++){d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),e===""&&f.css(d,"display")==="none"&&f._data(d,"olddisplay",cr(d.nodeName)))}for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none"){d.style.display=f._data(d,"olddisplay")||""}}}return this},hide:function(a,b,c){if(a||a===0){return this.animate(cq("hide",3),a,b,c)}for(var d=0,e=this.length;d<e;d++){if(this[d].style){var g=f.css(this[d],"display");g!=="none"&&!f._data(this[d],"olddisplay")&&f._data(this[d],"olddisplay",g)}}for(d=0;d<e;d++){this[d].style&&(this[d].style.display="none")}return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(cq("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=f.speed(b,c,d);if(f.isEmptyObject(a)){return this.each(e.complete,[!1])}a=f.extend({},a);return this[e.queue===!1?"each":"queue"](function(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d){return b.complete.call(this)}c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(f.support.inlineBlockNeedsLayout?(j=cr(this.nodeName),j==="inline"?this.style.display="inline-block":(this.style.display="inline",this.style.zoom=1)):this.style.display="inline-block"))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a){k=new f.fx(this,b,i),h=a[i],cj.test(h)?k[h==="toggle"?d?"show":"hide":h]():(l=ck.exec(h),m=k.cur(),l?(n=parseFloat(l[2]),o=l[3]||(f.cssNumber[i]?"":"px"),o!=="px"&&(f.style(this,i,(n||1)+o),m=(n||1)/k.cur()*m,f.style(this,i,m+o)),l[1]&&(n=(l[1]==="-="?-1:1)*n+m),k.custom(m,n,o)):k.custom(m,h,""))}return !0})},stop:function(a,b){a&&this.queue([]),this.each(function(){var a=f.timers,c=a.length;b||f._unmark(!0,this);while(c--){a[c].elem===this&&(b&&a[c](!0),a.splice(c,1))}}),b||this.dequeue();return this}}),f.each({slideDown:cq("show",1),slideUp:cq("hide",1),slideToggle:cq("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default,d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue!==!1?f.dequeue(this):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+0.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,b,c){function g(a){return d.step(a)}var d=this,e=f.fx;this.startTime=cn||co(),this.start=a,this.end=b,this.unit=c||this.unit||(f.cssNumber[this.prop]?"":"px"),this.now=this.start,this.pos=this.state=0,g.elem=this.elem,g()&&f.timers.push(g)&&!cl&&(cl=setInterval(e.tick,e.interval))},show:function(){this.options.orig[this.prop]=f.style(this.elem,this.prop),this.options.show=!0,this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b=cn||co(),c=!0,d=this.elem,e=this.options,g,h;if(a||b>=e.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),e.animatedProperties[this.prop]=!0;for(g in e.animatedProperties){e.animatedProperties[g]!==!0&&(c=!1)}if(c){e.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){d.style["overflow"+b]=e.overflow[a]}),e.hide&&f(d).hide();if(e.hide||e.show){for(var i in e.animatedProperties){f.style(d,i,e.orig[i])}}e.complete.call(d)}return !1}e.duration==Infinity?this.now=b:(h=b-this.startTime,this.state=h/e.duration,this.pos=f.easing[e.animatedProperties[this.prop]](this.state,h,0,1,e.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return !0}},f.extend(f.fx,{tick:function(){for(var a=f.timers,b=0;b<a.length;++b){a[b]()||a.splice(b--,1)}a.length||f.fx.stop()},interval:13,stop:function(){clearInterval(cl),cl=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit:a.elem[a.prop]=a.now}}}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cs=/^t(?:able|d|h)$/i,ct=/^(?:body|html)$/i;"getBoundingClientRect" in c.documentElement?f.fn.offset=function(a){var b=this[0],c;if(a){return this.each(function(b){f.offset.setOffset(this,a,b)})}if(!b||!b.ownerDocument){return null}if(b===b.ownerDocument.body){return f.offset.bodyOffset(b)}try{c=b.getBoundingClientRect()}catch(d){}var e=b.ownerDocument,g=e.documentElement;if(!c||!f.contains(g,b)){return c?{top:c.top,left:c.left}:{top:0,left:0}}var h=e.body,i=cu(e),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||f.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||f.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;return{top:n,left:o}}:f.fn.offset=function(a){var b=this[0];if(a){return this.each(function(b){f.offset.setOffset(this,a,b)})}if(!b||!b.ownerDocument){return null}if(b===b.ownerDocument.body){return f.offset.bodyOffset(b)}f.offset.initialize();var c,d=b.offsetParent,e=b,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;while((b=b.parentNode)&&b!==i&&b!==h){if(f.offset.supportsFixedPosition&&k.position==="fixed"){break}c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,f.offset.doesNotAddBorder&&(!f.offset.doesAddBorderForTableAndCells||!cs.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),f.offset.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c}if(k.position==="relative"||k.position==="static"){l+=i.offsetTop,m+=i.offsetLeft}f.offset.supportsFixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft));return{top:l,left:m}},f.offset={initialize:function(){var a=c.body,b=c.createElement("div"),d,e,g,h,i=parseFloat(f.css(a,"marginTop"))||0,j="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";f.extend(b.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"}),b.innerHTML=j,a.insertBefore(b,a.firstChild),d=b.firstChild,e=d.firstChild,h=d.nextSibling.firstChild.firstChild,this.doesNotAddBorder=e.offsetTop!==5,this.doesAddBorderForTableAndCells=h.offsetTop===5,e.style.position="fixed",e.style.top="20px",this.supportsFixedPosition=e.offsetTop===20||e.offsetTop===15,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",this.subtractsBorderForOverflowNotVisible=e.offsetTop===-5,this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==i,a.removeChild(b),f.offset.initialize=f.noop},bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.offset.initialize(),f.offset.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using" in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0]){return null}var a=this[0],b=this.offsetParent(),c=this.offset(),d=ct.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!ct.test(a.nodeName)&&f.css(a,"position")==="static"){a=a.offsetParent}return a})}}),f.each(["Left","Top"],function(a,c){var d="scroll"+c;f.fn[d]=function(c){var e,g;if(c===b){e=this[0];if(!e){return null}g=cu(e);return g?"pageXOffset" in g?g[a?"pageYOffset":"pageXOffset"]:f.support.boxModel&&g.document.documentElement[d]||g.document.body[d]:e[d]}return this.each(function(){g=cu(this),g?g.scrollTo(a?f(g).scrollLeft():c,a?c:f(g).scrollTop()):this[d]=c})}}),f.each(["Height","Width"],function(a,c){var d=c.toLowerCase();f.fn["inner"+c]=function(){var a=this[0];return a&&a.style?parseFloat(f.css(a,d,"padding")):null},f.fn["outer"+c]=function(a){var b=this[0];return b&&b.style?parseFloat(f.css(b,d,a?"margin":"border")):null},f.fn[d]=function(a){var e=this[0];if(!e){return a==null?null:this}if(f.isFunction(a)){return this.each(function(b){var c=f(this);c[d](a.call(this,b,c[d]()))})}if(f.isWindow(e)){var g=e.document.documentElement["client"+c],h=e.document.body;return e.document.compatMode==="CSS1Compat"&&g||h&&h["client"+c]||g}if(e.nodeType===9){return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c])}if(a===b){var i=f.css(e,d),j=parseFloat(i);return f.isNaN(j)?i:j}return this.css(d,typeof a=="string"?a:a+"px")}}),a.jQuery=a.$=f})(window);(function(j,f){var u=j.fn.domManip,h="_tmplitem",v=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,q={},e={},z,y={key:0,data:{}},x=0,r=0,g=[];function l(C,B,E,F){var D={data:F||(B?B.data:{}),_wrap:B?B._wrap:null,tmpl:null,parent:B||null,nodes:[],calls:c,nest:b,wrap:o,html:s,update:A};if(C){j.extend(D,C,{nodes:[],parent:B})}if(E){D.tmpl=E;D._ctnt=D._ctnt||D.tmpl(j,D);D.key=++x;(g.length?e:q)[x]=D}return D}j.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(B,C){j.fn[B]=function(D){var G=[],J=j(D),F,H,E,K,I=this.length===1&&this[0].parentNode;z=q||{};if(I&&I.nodeType===11&&I.childNodes.length===1&&J.length===1){J[C](this[0]);G=this}else{for(H=0,E=J.length;H<E;H++){r=H;F=(H>0?this.clone(true):this).get();j.fn[C].apply(j(J[H]),F);G=G.concat(F)}r=0;G=this.pushStack(G,B,J.selector)}K=z;z=null;j.tmpl.complete(K);return G}});j.fn.extend({tmpl:function(D,C,B){return j.tmpl(this[0],D,C,B)},tmplItem:function(){return j.tmplItem(this[0])},template:function(B){return j.template(B,this[0])},domManip:function(D,H,I,C){if(D[0]&&D[0].nodeType){var G=j.makeArray(arguments),F=D.length,E=0,B;while(E<F&&!(B=j.data(D[E++],"tmplItem"))){}if(F>1){G[0]=[j.makeArray(D)]}if(B&&r){G[2]=function(J){j.tmpl.afterManip(this,J,I)}}u.apply(this,G)}else{u.apply(this,arguments)}r=0;if(!z){j.tmpl.complete(q)}return this}});j.extend({tmpl:function(D,G,F,C){var E,B=!C;if(B){C=y;D=j.template[D]||j.template(null,D);e={}}else{if(!D){D=C.tmpl;q[C.key]=C;C.nodes=[];if(C.wrapped){t(C,C.wrapped)}return j(n(C,null,C.tmpl(j,C)))}}if(!D){return[]}if(typeof G==="function"){G=G.call(C||{})}if(F&&F.wrapped){t(F,F.wrapped)}E=j.isArray(G)?j.map(G,function(H){return H?l(F,C,D,H):null}):[l(F,C,D,G)];return B?j(n(C,null,E)):E},tmplItem:function(C){var B;if(C instanceof j){C=C[0]}while(C&&C.nodeType===1&&!(B=j.data(C,"tmplItem"))&&(C=C.parentNode)){}return B||y},template:function(C,B){if(B){if(typeof B==="string"){B=m(B)}else{if(B instanceof j){B=B[0]||{}}}if(B.nodeType){B=j.data(B,"tmpl")||j.data(B,"tmpl",m(B.innerHTML))}return typeof C==="string"?(j.template[C]=B):B}return C?(typeof C!=="string"?j.template(null,C):(j.template[C]||j.template(null,v.test(C)?C:j(C)))):null},encode:function(B){return(""+B).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});j.extend(j.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(B){q={}},afterManip:function w(D,B,E){var C=B.nodeType===11?j.makeArray(B.childNodes):B.nodeType===1?[B]:[];E.call(D,B);p(C);r++}});function n(B,F,D){var E,C=D?j.map(D,function(G){return(typeof G==="string")?(B.key?G.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+h+'="'+B.key+'" $2'):G):n(G,B,G._ctnt)}):B;if(F){return C}C=C.join("");C.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(H,I,G,J){E=j(G).get();p(E);if(I){E=a(I).concat(E)}if(J){E=E.concat(a(J))}});return E?E:a(C)}function a(C){var B=document.createElement("div");B.innerHTML=C;return j.makeArray(B.childNodes)}function m(B){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+j.trim(B).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(J,D,H,E,F,K,G){var M=j.tmpl.tag[H],C,I,L;if(!M){throw"Template command not found: "+H}C=M._default||[];if(K&&!/\w$/.test(F)){F+=K;K=""}if(F){F=k(F);G=G?(","+k(G)+")"):(K?")":"");I=K?(F.indexOf(".")>-1?F+K:("("+F+").call($item"+G)):F;L=K?I:"(typeof("+F+")==='function'?("+F+").call($item):("+F+"))"}else{L=I=C.$1||"null"}E=k(E);return"');"+M[D?"close":"open"].split("$notnull_1").join(F?"typeof("+F+")!=='undefined' && ("+F+")!=null":"true").split("$1a").join(L).split("$1").join(I).split("$2").join(E?E.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(O,N,P,Q){Q=Q?(","+Q+")"):(P?")":"");return Q?("("+N+").call($item"+Q):O}):(C.$2||""))+"_.push('"})+"');}return _;")}function t(C,B){C._wrap=n(C,true,j.isArray(B)?B:[v.test(B)?B:j(B).html()]).join("")}function k(B){return B?B.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function d(B){var C=document.createElement("div");C.appendChild(B.cloneNode(true));return C.innerHTML}function p(H){var J="_"+r,C,B,F={},G,E,D;for(G=0,E=H.length;G<E;G++){if((C=H[G]).nodeType!==1){continue}B=C.getElementsByTagName("*");for(D=B.length-1;D>=0;D--){I(B[D])}I(C)}function I(P){var M,O=P,N,K,L;if((L=P.getAttribute(h))){while(O.parentNode&&(O=O.parentNode).nodeType===1&&!(M=O.getAttribute(h))){}if(M!==L){O=O.parentNode?(O.nodeType===11?0:(O.getAttribute(h)||0)):0;if(!(K=q[L])){K=e[L];K=l(K,q[O]||e[O],null,true);K.key=++x;q[x]=K}if(r){Q(L)}}P.removeAttribute(h)}else{if(r&&(K=j.data(P,"tmplItem"))){Q(K.key);q[K.key]=K;O=j.data(P.parentNode,"tmplItem");O=O?O.key:0}}if(K){N=K;while(N&&N.key!=O){N.nodes.push(P);N=N.parent}delete K._ctnt;delete K._wrap;j.data(P,"tmplItem",K)}function Q(R){R=R+J;K=F[R]=(F[R]||l(K,q[K.parent.key+J]||K.parent,null,true))}}}function c(D,B,E,C){if(!D){return g.pop()}g.push({_:D,tmpl:B,item:this,data:E,options:C})}function b(B,D,C){return j.tmpl(j.template(B),D,C,this)}function o(D,B){var C=D.options||{};C.wrapped=B;return j.tmpl(j.template(D.tmpl),D.data,C,D.item)}function s(C,D){var B=this._wrap;return j.map(j(j.isArray(B)?B.join(""):B).filter(C||"*"),function(E){return D?E.innerText||E.textContent:E.outerHTML||d(E)})}function A(){var B=this.nodes;j.tmpl(null,null,null,this).insertBefore(B[0]);j(B).remove()}})(jQuery);jQuery.easing.jswing=jQuery.easing.swing;jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,f,a,h,g){return jQuery.easing[jQuery.easing.def](e,f,a,h,g)},easeInQuad:function(e,f,a,h,g){return h*(f/=g)*f+a},easeOutQuad:function(e,f,a,h,g){return -h*(f/=g)*(f-2)+a},easeInOutQuad:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f+a}return -h/2*((--f)*(f-2)-1)+a},easeInCubic:function(e,f,a,h,g){return h*(f/=g)*f*f+a},easeOutCubic:function(e,f,a,h,g){return h*((f=f/g-1)*f*f+1)+a},easeInOutCubic:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f*f+a}return h/2*((f-=2)*f*f+2)+a},easeInQuart:function(e,f,a,h,g){return h*(f/=g)*f*f*f+a},easeOutQuart:function(e,f,a,h,g){return -h*((f=f/g-1)*f*f*f-1)+a},easeInOutQuart:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f*f*f+a}return -h/2*((f-=2)*f*f*f-2)+a},easeInQuint:function(e,f,a,h,g){return h*(f/=g)*f*f*f*f+a},easeOutQuint:function(e,f,a,h,g){return h*((f=f/g-1)*f*f*f*f+1)+a},easeInOutQuint:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f*f*f*f+a}return h/2*((f-=2)*f*f*f*f+2)+a},easeInSine:function(e,f,a,h,g){return -h*Math.cos(f/g*(Math.PI/2))+h+a},easeOutSine:function(e,f,a,h,g){return h*Math.sin(f/g*(Math.PI/2))+a},easeInOutSine:function(e,f,a,h,g){return -h/2*(Math.cos(Math.PI*f/g)-1)+a},easeInExpo:function(e,f,a,h,g){return(f==0)?a:h*Math.pow(2,10*(f/g-1))+a},easeOutExpo:function(e,f,a,h,g){return(f==g)?a+h:h*(-Math.pow(2,-10*f/g)+1)+a},easeInOutExpo:function(e,f,a,h,g){if(f==0){return a}if(f==g){return a+h}if((f/=g/2)<1){return h/2*Math.pow(2,10*(f-1))+a}return h/2*(-Math.pow(2,-10*--f)+2)+a},easeInCirc:function(e,f,a,h,g){return -h*(Math.sqrt(1-(f/=g)*f)-1)+a},easeOutCirc:function(e,f,a,h,g){return h*Math.sqrt(1-(f=f/g-1)*f)+a},easeInOutCirc:function(e,f,a,h,g){if((f/=g/2)<1){return -h/2*(Math.sqrt(1-f*f)-1)+a}return h/2*(Math.sqrt(1-(f-=2)*f)+1)+a},easeInElastic:function(f,h,e,m,l){var j=1.70158;var k=0;var g=m;if(h==0){return e}if((h/=l)==1){return e+m}if(!k){k=l*0.3}if(g<Math.abs(m)){g=m;var j=k/4}else{var j=k/(2*Math.PI)*Math.asin(m/g)}return -(g*Math.pow(2,10*(h-=1))*Math.sin((h*l-j)*(2*Math.PI)/k))+e},easeOutElastic:function(f,h,e,m,l){var j=1.70158;var k=0;var g=m;if(h==0){return e}if((h/=l)==1){return e+m}if(!k){k=l*0.3}if(g<Math.abs(m)){g=m;var j=k/4}else{var j=k/(2*Math.PI)*Math.asin(m/g)}return g*Math.pow(2,-10*h)*Math.sin((h*l-j)*(2*Math.PI)/k)+m+e},easeInOutElastic:function(f,h,e,m,l){var j=1.70158;var k=0;var g=m;if(h==0){return e}if((h/=l/2)==2){return e+m}if(!k){k=l*(0.3*1.5)}if(g<Math.abs(m)){g=m;var j=k/4}else{var j=k/(2*Math.PI)*Math.asin(m/g)}if(h<1){return -0.5*(g*Math.pow(2,10*(h-=1))*Math.sin((h*l-j)*(2*Math.PI)/k))+e}return g*Math.pow(2,-10*(h-=1))*Math.sin((h*l-j)*(2*Math.PI)/k)*0.5+m+e},easeInBack:function(e,f,a,j,h,g){if(g==undefined){g=1.70158}return j*(f/=h)*f*((g+1)*f-g)+a},easeOutBack:function(e,f,a,j,h,g){if(g==undefined){g=1.70158}return j*((f=f/h-1)*f*((g+1)*f+g)+1)+a},easeInOutBack:function(e,f,a,j,h,g){if(g==undefined){g=1.70158}if((f/=h/2)<1){return j/2*(f*f*(((g*=(1.525))+1)*f-g))+a}return j/2*((f-=2)*f*(((g*=(1.525))+1)*f+g)+2)+a},easeInBounce:function(e,f,a,h,g){return h-jQuery.easing.easeOutBounce(e,g-f,0,h,g)+a},easeOutBounce:function(e,f,a,h,g){if((f/=g)<(1/2.75)){return h*(7.5625*f*f)+a}else{if(f<(2/2.75)){return h*(7.5625*(f-=(1.5/2.75))*f+0.75)+a}else{if(f<(2.5/2.75)){return h*(7.5625*(f-=(2.25/2.75))*f+0.9375)+a}else{return h*(7.5625*(f-=(2.625/2.75))*f+0.984375)+a}}}},easeInOutBounce:function(e,f,a,h,g){if(f<g/2){return jQuery.easing.easeInBounce(e,f*2,0,h,g)*0.5+a}return jQuery.easing.easeOutBounce(e,f*2-g,0,h,g)*0.5+h*0.5+a}});(function(z,y){function n(e,d,f){f=(f+1)%1;if(f*6<1){return e+(d-e)*6*f}if(f*2<1){return d}if(f*3<2){return e+(d-e)*(2/3-f)*6}return e}function o(a,f,e){if((f.empty||e)&&a==null){return null}if(f.def&&a==null){return f.def}f.type==="int"&&(a=~~a),f.mod&&(a=(a<0?a+f.mod*(1+~~(-a/f.mod)):a)%f.mod),f.type==="float"&&(a=parseFloat(a)),z.isNaN(a)&&(a=f.def);return f.min>a?f.min:f.max<a?f.max:a}var x="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color outlineColor".split(" "),w=/^([\-+])=\s*(\d+\.?\d*)/,v=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(b){return[b[1],b[2],b[3],b[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(b){return[2.55*b[1],2.55*b[2],2.55*b[3],b[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(b){return[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(b){return[parseInt(b[1]+b[1],16),parseInt(b[2]+b[2],16),parseInt(b[3]+b[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(b){return[b[1],b[2]/100,b[3]/100,b[4]]}}],u=z.Color=function(a,h,g,f){return new z.Color.fn.parse(a,h,g,f)},t={rgba:{cache:"_rgba",props:{red:{idx:0,min:0,max:255,type:"int",empty:!0},green:{idx:1,min:0,max:255,type:"int",empty:!0},blue:{idx:2,min:0,max:255,type:"int",empty:!0},alpha:{idx:3,min:0,max:1,type:"float",def:1}}},hsla:{cache:"_hsla",props:{hue:{idx:0,mod:360,type:"int",empty:!0},saturation:{idx:1,min:0,max:1,type:"float",empty:!0},lightness:{idx:2,min:0,max:1,type:"float",empty:!0}}}},s=t.rgba.props,r=u.support={},q,p=z.each;t.hsla.props.alpha=s.alpha,u.fn=u.prototype={constructor:u,parse:function(k,h,b,a){if(k===y){this._rgba=[null,null,null,null];return this}if(k instanceof z||k.nodeType){k=k instanceof z?k.css(h):z(k).css(h),h=y}var j=this,g=z.type(k),f=this._rgba=[],e;h!==y&&(k=[k,h,b,a],g="array");if(g==="string"){k=k.toLowerCase(),p(v,function(l,c){var D=c.re.exec(k),C=D&&c.parse(D),B,A=c.space||"rgba",m=t[A].cache;if(C){B=j[A](C),A!="rgba"&&(j[m]=B[m]),f=j._rgba=B._rgba;return !1}});if(f.length!==0){Math.max.apply(Math,f)===0&&$.extend(f,q.transparent);return this}k=q[k]||q._default;return this.parse(k)}if(g==="array"){p(s,function(d,c){f[c.idx]=o(k[c.idx],c)});return this}if(g==="object"){k instanceof u?p(t,function(d,c){k[c.cache]&&(j[c.cache]=k[c.cache].slice())}):p(t,function(d,c){p(c.props,function(l,A){var m=c.cache;if(!j[m]&&c.to){if(k[l]==null||l==="alpha"){return}j[m]=c.to(j._rgba)}j[m][A.idx]=o(k[l],A,!0)})});return this}},is:function(f){var e=u(f),h=!0,g=this;p(t,function(b,j){var d=e[j.cache],c;d&&(c=g[j.cache]||j.to&&j.to(g._rgba)||[],p(j.props,function(l,k){if(d[k.idx]!=null){h=d[k.idx]==c[k.idx];return h}}));return h});return h},_space:function(){var d=[],c=this;p(t,function(b,a){c[a.cache]&&d.push(b)});return d.pop()},transition:function(g,f){var A=u(g),m=A._space(),l=t[m],k=this[l.cache]||l.to(this._rgba),j=k.slice();A=A[l.cache],p(l.props,function(b,B){var h=k[B.idx],c=A[B.idx];c!==null&&(h===null?j[B.idx]=c:(B.mod&&(c-h>B.mod/2?h+=B.mod:h-c>B.mod/2&&(h-=B.mod)),j[B.idx]=o((c-h)*f+h,B)))});return this[m](j)},blend:function(a){if(this._rgba[3]===1){return this}var h=this._rgba.slice(),g=h.pop(),f=u(a)._rgba;return u(z.map(h,function(d,c){return(1-g)*f[c]+g*d}))},toRgbaString:function(){var a=z.map(this._rgba,function(d,c){return d==null?c>2?1:0:d});a[3]===1&&(a.length=3);return(a.length===3?"rgb(":"rgba(")+a.join(",")+")"},toHslaString:function(){var a=z.map(this.hsla(),function(d,c){d=d==null?c>2?1:0:d;if(c===1||c===2){d=Math.round(d*100)+"%"}return d});a[3]===1&&(a.length=3);return(a.length===3?"hsl(":"hsla(")+a.join(",")+")"},toHexString:function(a){var d=this._rgba.slice();a||(d.length=3);return"#"+z.map(d,function(f,e){var h=e===3?255:1,g=(f*h).toString(16);return g.length===1?"0"+g:g.substr(0,2)}).join("")},toString:function(){if(this._rgba[3]===0){return"transparent"}return this.toRgbaString()}},u.fn.parse.prototype=u.fn,t.hsla.to=function(K){if(K[0]==null||K[1]==null||K[2]==null){return[null,null,null,K[3]]}var J=K[0]/255,I=K[1]/255,H=K[2]/255,G=K[3],F=Math.max(J,I,H),E=Math.min(J,I,H),D=F-E,C=F+E,B=C*0.5,A,m;E===F?A=0:J===F?A=60*(I-H)/D+360:I===F?A=60*(H-J)/D+120:A=60*(J-I)/D+240,B===0||B===1?m=B:B>0.5?m=D/(2-C):m=D/C;return[Math.round(A)%360,m,B,G==null?1:G]},t.hsla.from=function(G){if(G[0]==null||G[1]==null||G[2]==null){return[null,null,null,G[3]]}var F=G[0]/360,E=G[1],D=G[2],C=G[3],B=D<=0.5?D*(1+E):D+E-D*E,A=2*D-B,m,l,k;return[Math.round(n(A,B,F+1/3)*255),Math.round(n(A,B,F)*255),Math.round(n(A,B,F-1/3)*255),C]},p(t,function(l,k){var f=k.props,d=k.cache,b=k.to,a=k.from;u.fn[l]=function(B){b&&!this[d]&&(this[d]=b(this._rgba));if(B===y){return this[d].slice()}var j=z.type(B),h=j==="array"||j==="object"?B:arguments,g=this[d].slice(),A;p(f,function(m,e){var C=h[j==="object"?m:e.idx];C==null&&(C=g[e.idx]),g[e.idx]=o(C,e)});if(a){A=u(a(g)),A[d]=g;return A}return u(g)},p(f,function(c,g){u.fn[c]||(u.fn[c]=function(D){var C=z.type(D),B=c==="alpha"?this._hsla?"hsla":"rgba":l,A=this[B](),m=A[g.idx],e;if(C==="undefined"){return m}C==="function"&&(D=D.call(this,m),C=z.type(D));if(D==null&&g.empty){return this}C==="string"&&(e=w.exec(D),e&&(D=m+parseFloat(e[2])*(e[1]==="+"?1:-1))),A[g.idx]=D;return this[B](A)})})}),p(x,function(a,d){z.cssHooks[d]={set:function(c,j){j=u(j);if(!r.rgba&&j._rgba[3]!==1){var h=d==="backgroundColor"?c.parentNode:c,f;do{f=z.curCSS(h,"backgroundColor");if(f!==""&&f!=="transparent"){break}}while((c=c.parentNode)&&c.style);j=j.blend(u(f||"_default"))}j=j.toRgbaString(),c.style[d]=j}},z.fx.step[d]=function(c){c.colorInit||(c.start=u(c.elem,d),c.end=u(c.end),c.colorInit=!0),z.cssHooks[d].set(c.elem,c.start.transition(c.end,c.pos))}}),z(function(){var d=document.createElement("div"),c=d.style;c.cssText="background-color:rgba(150,255,150,.5)",r.rgba=c.backgroundColor.indexOf("rgba")>-1}),q=z.Color.names={aqua:"#00ffff",azure:"#f0ffff",beige:"#f5f5dc",black:"#000000",blue:"#0000ff",brown:"#a52a2a",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkviolet:"#9400d3",fuchsia:"#ff00ff",gold:"#ffd700",green:"#008000",indigo:"#4b0082",khaki:"#f0e68c",lightblue:"#add8e6",lightcyan:"#e0ffff",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightyellow:"#ffffe0",lime:"#00ff00",magenta:"#ff00ff",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",pink:"#ffc0cb",purple:"#800080",violet:"#800080",red:"#ff0000",silver:"#c0c0c0",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}})(jQuery);(function(F,E,D){function s(d){var c={x:d.offsetLeft,y:d.offsetTop};while(d=d.offsetParent){c.x+=d.offsetLeft,c.y+=d.offsetTop}return c}function t(e,c){for(var f in c){e[f]===D&&(e[f]=c[f])}return e}function u(e,d){for(var f in d){e.style[v(e,f)||f]=d[f]}return e}function v(d,c){var k=d.style,j,h;if(k[c]!==D){return c}c=c.charAt(0).toUpperCase()+c.slice(1);for(h=0;h<C.length;h++){j=C[h]+c;if(k[j]!==D){return j}}}function w(I,H,G,p){var o=["opacity",H,~~(I*100),G,p].join("-"),n=0.01+G/p*100,m=Math.max(1-(1-I)/H*(100-n),I),f=A.substring(0,A.indexOf("Animation")).toLowerCase(),e=f&&"-"+f+"-"||"";B[o]||(x.insertRule("@"+e+"keyframes "+o+"{0%{opacity:"+m+"}"+n+"%{opacity:"+I+"}"+(n+0.01)+"%{opacity:1}"+(n+H)%100+"%{opacity:"+I+"}100%{opacity:"+m+"}}",0),B[o]=1);return o}function y(e,d,f){f&&!f.parentNode&&y(e,f),e.insertBefore(d,f||null);return e}function z(b,h){var g=E.createElement(b||"div"),f;for(f in h){g[f]=h[f]}return g}var C=["webkit","Moz","ms","O"],B={},A;y(E.getElementsByTagName("head")[0],z("style"));var x=E.styleSheets[E.styleSheets.length-1],r=function(b){this.opts=t(b||{},{lines:12,length:7,width:5,radius:10,color:"#000",speed:1,trail:100,opacity:0.25})},q=r.prototype={spin:function(L){var K=this,J=K.el=u(z(),{position:"relative"}),I,H;L&&(H=s(y(L,J,L.firstChild)),I=s(J),u(J,{left:(L.offsetWidth>>1)-I.x+H.x+"px",top:(L.offsetHeight>>1)-I.y+H.y+"px"})),K.lines(J,K.opts);if(!A){var G=K.opts,n=0,l=20/G.speed,h=(1-G.opacity)/(l*G.trail/100),g=l/G.lines;(function f(){n++;for(var b=G.lines;b;b--){var c=Math.max(1-(n+b*g)%l*h,G.opacity);K.opacity(J,G.lines-b,c,G)}K.timeout=K.el&&setTimeout(f,50)})()}return K},stop:function(){var d=this,c=d.el;clearTimeout(d.timeout),c&&c.parentNode&&c.parentNode.removeChild(c),d.el=D;return d}};q.lines=function(g,f){function h(b,c){return u(z(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.width>>1)+"px"})}var k=0,j;for(;k<f.lines;k++){j=u(z(),{position:"absolute",top:1+~(f.width/2)+"px",transform:"translate3d(0,0,0)",opacity:f.opacity,animation:A&&w(f.opacity,f.trail,k,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&y(j,u(h("#000","0 0 4px #000"),{top:"2px"})),y(g,y(j,h(f.color,"0 0 1px rgba(0,0,0,.1)")))}return g},q.opacity=function(e,d,f){e.childNodes[d].style.opacity=f},function(){var d=u(z("group"),{behavior:"url(#default#VML)"}),c;if(!v(d,"transform")&&d.adj){for(c=4;c--;){x.addRule(["group","roundrect","fill","stroke"][c],"behavior:url(#default#VML)")}q.lines=function(H,G){function g(b,f,e){y(m,y(u(n(),{rotation:360/G.lines*b+"deg",left:~~f}),y(u(z("roundrect",{arcsize:1}),{width:p,height:G.width,left:G.radius,top:-G.width>>1,filter:e}),z("fill",{color:G.color,opacity:G.opacity}),z("stroke",{opacity:0}))))}function n(){return u(z("group",{coordsize:o+" "+o,coordorigin:-p+" "+-p}),{width:o,height:o})}var p=G.length+G.width,o=2*p,m=n(),l=~(G.length+G.radius+G.width)+"px",h;if(G.shadow){for(h=1;h<=G.lines;h++){g(h,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)")}}for(h=1;h<=G.lines;h++){g(h)}return y(u(H,{margin:l+" 0 0 "+l}),m)},q.opacity=function(f,e,h,g){g=g.shadow&&g.lines||0,f.firstChild.childNodes[e+g].firstChild.firstChild.opacity=h}}else{A=v(d,"animation")}}(),F.Spinner=r})(window,document);(function(){window.$jit=function(x){x=x||window;for(var y in $jit){if($jit[y].$extend){x[y]=$jit[y]}}};$jit.version="2.0.0b";var c=function(x){return document.getElementById(x)};c.empty=function(){};c.extend=function(z,x){for(var y in (x||{})){z[y]=x[y]}return z};c.lambda=function(x){return(typeof x=="function")?x:function(){return x}};c.time=Date.now||function(){return +new Date};c.splat=function(y){var x=c.type(y);return x?((x!="array")?[y]:y):[]};c.type=function(y){var x=c.type.s.call(y).match(/^\[object\s(.*)\]$/)[1].toLowerCase();if(x!="object"){return x}if(y&&y.$$family){return y.$$family}return(y&&y.nodeName&&y.nodeType==1)?"element":x};c.type.s=Object.prototype.toString;c.each=function(C,B){var A=c.type(C);if(A=="object"){for(var z in C){B(C[z],z)}}else{for(var y=0,x=C.length;y<x;y++){B(C[y],y)}}};c.indexOf=function(A,z){if(Array.indexOf){return A.indexOf(z)}for(var y=0,x=A.length;y<x;y++){if(A[y]===z){return y}}return -1};c.map=function(z,y){var x=[];c.each(z,function(B,A){x.push(y(B,A))});return x};c.reduce=function(B,z,y){var x=B.length;if(x==0){return y}var A=arguments.length==3?y:B[--x];while(x--){A=z(A,B[x])}return A};c.merge=function(){var B={};for(var A=0,x=arguments.length;A<x;A++){var y=arguments[A];if(c.type(y)!="object"){continue}for(var z in y){var D=y[z],C=B[z];B[z]=(C&&c.type(D)=="object"&&c.type(C)=="object")?c.merge(C,D):c.unlink(D)}}return B};c.unlink=function(z){var y;switch(c.type(z)){case"object":y={};for(var B in z){y[B]=c.unlink(z[B])}break;case"array":y=[];for(var A=0,x=z.length;A<x;A++){y[A]=c.unlink(z[A])}break;default:return z}return y};c.zip=function(){if(arguments.length===0){return[]}for(var z=0,y=[],x=arguments.length,C=arguments[0].length;z<C;z++){for(var A=0,B=[];A<x;A++){B.push(arguments[A][z])}y.push(B)}return y};c.rgbToHex=function(B,A){if(B.length<3){return null}if(B.length==4&&B[3]==0&&!A){return"transparent"}var y=[];for(var x=0;x<3;x++){var z=(B[x]-0).toString(16);y.push(z.length==1?"0"+z:z)}return A?y:"#"+y.join("")};c.hexToRgb=function(z){if(z.length!=7){z=z.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);z.shift();if(z.length!=3){return null}var x=[];for(var y=0;y<3;y++){var A=z[y];if(A.length==1){A+=A}x.push(parseInt(A,16))}return x}else{z=parseInt(z.slice(1),16);return[z>>16,z>>8&255,z&255]}};c.destroy=function(x){c.clean(x);if(x.parentNode){x.parentNode.removeChild(x)}if(x.clearAttributes){x.clearAttributes()}};c.clean=function(A){for(var z=A.childNodes,y=0,x=z.length;y<x;y++){c.destroy(z[y])}};c.addEvent=function(z,y,x){if(z.addEventListener){z.addEventListener(y,x,false)}else{z.attachEvent("on"+y,x)}};c.addEvents=function(y,z){for(var x in z){c.addEvent(y,x,z[x])}};c.hasClass=function(y,x){return(" "+y.className+" ").indexOf(" "+x+" ")>-1};c.addClass=function(y,x){if(!c.hasClass(y,x)){y.className=(y.className+" "+x)}};c.removeClass=function(y,x){y.className=y.className.replace(new RegExp("(^|\\s)"+x+"(?:\\s|$)"),"$1")};c.getPos=function(z){var C=B(z);var x=A(z);return{x:C.x-x.x,y:C.y-x.y};function B(E){var D={x:0,y:0};while(E&&!y(E)){D.x+=E.offsetLeft;D.y+=E.offsetTop;E=E.offsetParent}return D}function A(E){var D={x:0,y:0};while(E&&!y(E)){D.x+=E.scrollLeft;D.y+=E.scrollTop;E=E.parentNode}return D}function y(D){return(/^(?:body|html)$/i).test(D.tagName)}};c.event={get:function(y,x){x=x||window;return y||x.event},getWheel:function(x){return x.wheelDelta?x.wheelDelta/120:-(x.detail||0)/3},isRightClick:function(x){return(x.which==3||x.button==2)},getPos:function(A,z){z=z||window;A=A||z.event;var y=z.document;y=y.documentElement||y.body;if(A.touches&&A.touches.length){A=A.touches[0]}var x={x:A.pageX||(A.clientX+y.scrollLeft),y:A.pageY||(A.clientY+y.scrollTop)};return x},stop:function(x){if(x.stopPropagation){x.stopPropagation()}x.cancelBubble=true;if(x.preventDefault){x.preventDefault()}else{x.returnValue=false}}};$jit.util=$jit.id=c;var r=function(y){y=y||{};var x=function(){for(var B in this){if(typeof this[B]!="function"){this[B]=c.unlink(this[B])}}this.constructor=x;if(r.prototyping){return this}var A=this.initialize?this.initialize.apply(this,arguments):this;this.$$family="class";return A};for(var z in r.Mutators){if(!y[z]){continue}y=r.Mutators[z](y,y[z]);delete y[z]}c.extend(x,this);x.constructor=r;x.prototype=y;return x};r.Mutators={Implements:function(x,y){c.each(c.splat(y),function(A){r.prototyping=A;var z=(typeof A=="function")?new A:A;for(var B in z){if(!(B in x)){x[B]=z[B]}}delete r.prototyping});return x}};c.extend(r,{inherit:function(x,A){for(var z in A){var y=A[z];var C=x[z];var B=c.type(y);if(C&&B=="function"){if(y!=C){r.override(x,z,y)}}else{if(B=="object"){x[z]=c.merge(C,y)}else{x[z]=y}}}return x},override:function(y,x,B){var A=r.prototyping;if(A&&y[x]!=A[x]){A=null}var z=function(){var C=this.parent;this.parent=A?A[x]:y[x];var D=B.apply(this,arguments);this.parent=C;return D};y[x]=z}});r.prototype.implement=function(){var x=this.prototype;c.each(Array.prototype.slice.call(arguments||[]),function(y){r.inherit(x,y)});return this};$jit.Class=r;$jit.json={prune:function(y,x){this.each(y,function(A,z){if(z==x&&A.children){delete A.children;A.children=[]}})},getParent:function(x,B){if(x.id==B){return false}var A=x.children;if(A&&A.length>0){for(var z=0;z<A.length;z++){if(A[z].id==B){return x}else{var y=this.getParent(A[z],B);if(y){return y}}}}return false},getSubtree:function(x,B){if(x.id==B){return x}for(var z=0,A=x.children;z<A.length;z++){var y=this.getSubtree(A[z],B);if(y!=null){return y}}return null},eachLevel:function(x,C,z,B){if(C<=z){B(x,C);if(!x.children){return}for(var y=0,A=x.children;y<A.length;y++){this.eachLevel(A[y],C+1,z,B)}}},each:function(x,y){this.eachLevel(x,0,Number.MAX_VALUE,y)}};$jit.Trans={$extend:true,linear:function(x){return x}};var j=$jit.Trans;(function(){var x=function(A,z){z=c.splat(z);return c.extend(A,{easeIn:function(B){return A(B,z)},easeOut:function(B){return 1-A(1-B,z)},easeInOut:function(B){return(B<=0.5)?A(2*B,z)/2:(2-A(2*(1-B),z))/2}})};var y={Pow:function(A,z){return Math.pow(A,z[0]||6)},Expo:function(z){return Math.pow(2,8*(z-1))},Circ:function(z){return 1-Math.sin(Math.acos(z))},Sine:function(z){return 1-Math.sin((1-z)*Math.PI/2)},Back:function(A,z){z=z[0]||1.618;return Math.pow(A,2)*((z+1)*A-z)},Bounce:function(C){var B;for(var A=0,z=1;1;A+=z,z/=2){if(C>=(7-4*A)/11){B=z*z-Math.pow((11-6*A-11*C)/4,2);break}}return B},Elastic:function(A,z){return Math.pow(2,10*--A)*Math.cos(20*A*Math.PI*(z[0]||1)/3)}};c.each(y,function(A,z){j[z]=x(A)});c.each(["Quad","Cubic","Quart","Quint"],function(A,z){j[A]=x(function(B){return Math.pow(B,[z+2])})})})();var v=new r({initialize:function(x){this.setOptions(x)},setOptions:function(x){var y={duration:2500,fps:40,transition:j.Quart.easeInOut,compute:c.empty,complete:c.empty,link:"ignore"};this.opt=c.merge(y,x||{});return this},step:function(){var y=c.time(),x=this.opt;if(y<this.time+x.duration){var z=x.transition((y-this.time)/x.duration);x.compute(z)}else{this.timer=clearInterval(this.timer);x.compute(1);x.complete()}},start:function(){if(!this.check()){return this}this.time=0;this.startTimer();return this},startTimer:function(){var x=this,y=this.opt.fps;if(this.timer){return false}this.time=c.time()-this.time;this.timer=setInterval((function(){x.step()}),Math.round(1000/y));return true},pause:function(){this.stopTimer();return this},resume:function(){this.startTimer();return this},stopTimer:function(){if(!this.timer){return false}this.time=c.time()-this.time;this.timer=clearInterval(this.timer);return true},check:function(){if(!this.timer){return true}if(this.opt.link=="cancel"){this.stopTimer();return true}return false}});var o=function(){var z=arguments;for(var B=0,x=z.length,y={};B<x;B++){var A=o[z[B]];if(A.$extend){c.extend(y,A)}else{y[z[B]]=A}}return y};o.AreaChart={$extend:true,animate:true,labelOffset:3,type:"stacked",Tips:{enable:false,onShow:c.empty,onHide:c.empty},Events:{enable:false,onClick:c.empty},selectOnHover:true,showAggregates:true,showLabels:true,filterOnClick:false,restoreOnRightClick:false};o.Margin={$extend:false,top:0,left:0,right:0,bottom:0};o.Canvas={$extend:true,injectInto:"id",width:false,height:false,useCanvas:false,withLabels:true,background:false};o.Tree={$extend:true,orientation:"left",subtreeOffset:8,siblingOffset:5,indent:10,multitree:false,align:"center"};o.Node={$extend:false,overridable:false,type:"circle",color:"#ccb",alpha:1,dim:3,height:20,width:90,autoHeight:false,autoWidth:false,lineWidth:1,transform:true,align:"center",angularWidth:1,span:1,CanvasStyles:{}};o.Edge={$extend:false,overridable:false,type:"line",color:"#ccb",lineWidth:1,dim:15,alpha:1,epsilon:7,CanvasStyles:{}};o.Fx={$extend:true,fps:40,duration:2500,transition:$jit.Trans.Quart.easeInOut,clearCanvas:true};o.Label={$extend:false,overridable:false,type:"HTML",style:" ",size:10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:"#fff"};o.Tips={$extend:false,enable:false,type:"auto",offsetX:20,offsetY:20,force:false,onShow:c.empty,onHide:c.empty};o.NodeStyles={$extend:false,enable:false,type:"auto",stylesHover:false,stylesClick:false};o.Events={$extend:false,enable:false,enableForEdges:false,type:"auto",onClick:c.empty,onRightClick:c.empty,onMouseMove:c.empty,onMouseEnter:c.empty,onMouseLeave:c.empty,onDragStart:c.empty,onDragMove:c.empty,onDragCancel:c.empty,onDragEnd:c.empty,onTouchStart:c.empty,onTouchMove:c.empty,onTouchEnd:c.empty,onMouseWheel:c.empty};o.Navigation={$extend:false,enable:false,type:"auto",panning:false,zooming:false};o.Controller={$extend:true,onBeforeCompute:c.empty,onAfterCompute:c.empty,onCreateLabel:c.empty,onPlaceLabel:c.empty,onComplete:c.empty,onBeforePlotLine:c.empty,onAfterPlotLine:c.empty,onBeforePlotNode:c.empty,onAfterPlotNode:c.empty,request:false};var u={initialize:function(z,x){this.viz=x;this.canvas=x.canvas;this.config=x.config[z];this.nodeTypes=x.fx.nodeTypes;var y=this.config.type;this.dom=y=="auto"?(x.config.Label.type!="Native"):(y!="Native");this.labelContainer=this.dom&&x.labels.getLabelContainer();this.isEnabled()&&this.initializePost()},initializePost:c.empty,setAsProperty:c.lambda(false),isEnabled:function(){return this.config.enable},isLabel:function(A,z){A=c.event.get(A,z);var x=this.labelContainer,y=A.target||A.srcElement;if(y&&y.parentNode==x){return y}return false}};var h={onMouseUp:c.empty,onMouseDown:c.empty,onMouseMove:c.empty,onMouseOver:c.empty,onMouseOut:c.empty,onMouseWheel:c.empty,onTouchStart:c.empty,onTouchMove:c.empty,onTouchEnd:c.empty,onTouchCancel:c.empty};var t=new r({initialize:function(x){this.viz=x;this.canvas=x.canvas;this.node=false;this.edge=false;this.registeredObjects=[];this.attachEvents()},attachEvents:function(){var z=this.canvas.getElement(),y=this;z.oncontextmenu=c.lambda(false);c.addEvents(z,{mouseup:function(C,B){var A=c.event.get(C,B);y.handleEvent("MouseUp",C,B,y.makeEventObject(C,B),c.event.isRightClick(A))},mousedown:function(C,B){var A=c.event.get(C,B);y.handleEvent("MouseDown",C,B,y.makeEventObject(C,B),c.event.isRightClick(A))},mousemove:function(B,A){y.handleEvent("MouseMove",B,A,y.makeEventObject(B,A))},mouseover:function(B,A){y.handleEvent("MouseOver",B,A,y.makeEventObject(B,A))},mouseout:function(B,A){y.handleEvent("MouseOut",B,A,y.makeEventObject(B,A))},touchstart:function(B,A){y.handleEvent("TouchStart",B,A,y.makeEventObject(B,A))},touchmove:function(B,A){y.handleEvent("TouchMove",B,A,y.makeEventObject(B,A))},touchend:function(B,A){y.handleEvent("TouchEnd",B,A,y.makeEventObject(B,A))}});var x=function(D,C){var B=c.event.get(D,C);var A=c.event.getWheel(B);y.handleEvent("MouseWheel",D,C,A)};if(!document.getBoxObjectFor&&window.mozInnerScreenX==null){c.addEvent(z,"mousewheel",x)}else{z.addEventListener("DOMMouseScroll",x,false)}},register:function(x){this.registeredObjects.push(x)},handleEvent:function(){var y=Array.prototype.slice.call(arguments),B=y.shift();for(var A=0,z=this.registeredObjects,x=z.length;A<x;A++){z[A]["on"+B].apply(z[A],y)}},makeEventObject:function(D,C){var A=this,B=this.viz.graph,z=this.viz.fx,y=z.nodeTypes,x=z.edgeTypes;return{pos:false,node:false,edge:false,contains:false,getNodeCalled:false,getEdgeCalled:false,getPos:function(){var G=A.viz.canvas,H=G.getSize(),I=G.getPos(),F=G.translateOffsetX,E=G.translateOffsetY,L=G.scaleOffsetX,J=G.scaleOffsetY,K=c.event.getPos(D,C);this.pos={x:(K.x-I.x-H.width/2-F)*1/L,y:(K.y-I.y-H.height/2-E)*1/J};return this.pos},getNode:function(){if(this.getNodeCalled){return this.node}this.getNodeCalled=true;for(var H in B.nodes){var G=B.nodes[H],F=G&&y[G.getData("type")],E=F&&F.contains&&F.contains.call(z,G,this.getPos());if(E){this.contains=E;return A.node=this.node=G}}return A.node=this.node=false},getEdge:function(){if(this.getEdgeCalled){return this.edge}this.getEdgeCalled=true;var G={};for(var K in B.edges){var I=B.edges[K];G[K]=true;for(var J in I){if(J in G){continue}var H=I[J],F=H&&x[H.getData("type")],E=F&&F.contains&&F.contains.call(z,H,this.getPos());if(E){this.contains=E;return A.edge=this.edge=H}}}return A.edge=this.edge=false},getContains:function(){if(this.getNodeCalled){return this.contains}this.getNode();return this.contains}}}});var p={initializeExtras:function(){var y=new t(this),x=this;c.each(["NodeStyles","Tips","Navigation","Events"],function(z){var A=new p.Classes[z](z,x);if(A.isEnabled()){y.register(A)}if(A.setAsProperty()){x[z.toLowerCase()]=A}})}};p.Classes={};p.Classes.Events=new r({Implements:[u,h],initializePost:function(){this.fx=this.viz.fx;this.ntypes=this.viz.fx.nodeTypes;this.etypes=this.viz.fx.edgeTypes;this.hovered=false;this.pressed=false;this.touched=false;this.touchMoved=false;this.moved=false},setAsProperty:c.lambda(true),onMouseUp:function(B,A,y,z){var x=c.event.get(B,A);if(!this.moved){if(z){this.config.onRightClick(this.hovered,y,x)}else{this.config.onClick(this.pressed,y,x)}}if(this.pressed){if(this.moved){this.config.onDragEnd(this.pressed,y,x)}else{this.config.onDragCancel(this.pressed,y,x)}this.pressed=this.moved=false}},onMouseOut:function(C,B,A){var y=c.event.get(C,B),z;if(this.dom&&(z=this.isLabel(C,B))){this.config.onMouseLeave(this.viz.graph.getNode(z.id),A,y);this.hovered=false;return}var x=y.relatedTarget,D=this.canvas.getElement();while(x&&x.parentNode){if(D==x.parentNode){return}x=x.parentNode}if(this.hovered){this.config.onMouseLeave(this.hovered,A,y);this.hovered=false}},onMouseOver:function(B,A,z){var x=c.event.get(B,A),y;if(this.dom&&(y=this.isLabel(B,A))){this.hovered=this.viz.graph.getNode(y.id);this.config.onMouseEnter(this.hovered,z,x)}},onMouseMove:function(D,C,B){var y,x=c.event.get(D,C);if(this.pressed){this.moved=true;this.config.onDragMove(this.pressed,B,x);return}if(this.dom){this.config.onMouseMove(this.hovered,B,x)}else{if(this.hovered){var E=this.hovered;var A=E.nodeFrom?this.etypes[E.getData("type")]:this.ntypes[E.getData("type")];var z=A&&A.contains&&A.contains.call(this.fx,E,B.getPos());if(z){this.config.onMouseMove(E,B,x);return}else{this.config.onMouseLeave(E,B,x);this.hovered=false}}if(this.hovered=(B.getNode()||(this.config.enableForEdges&&B.getEdge()))){this.config.onMouseEnter(this.hovered,B,x)}else{this.config.onMouseMove(false,B,x)}}},onMouseWheel:function(y,x,z){this.config.onMouseWheel(z,c.event.get(y,x))},onMouseDown:function(A,z,y){var x=c.event.get(A,z);this.pressed=y.getNode()||(this.config.enableForEdges&&y.getEdge());this.config.onDragStart(this.pressed,y,x)},onTouchStart:function(A,z,y){var x=c.event.get(A,z);this.touched=y.getNode()||(this.config.enableForEdges&&y.getEdge());this.config.onTouchStart(this.touched,y,x)},onTouchMove:function(A,z,y){var x=c.event.get(A,z);if(this.touched){this.touchMoved=true;this.config.onTouchMove(this.touched,y,x)}},onTouchEnd:function(A,z,y){var x=c.event.get(A,z);if(this.touched){if(this.touchMoved){this.config.onTouchEnd(this.touched,y,x)}else{this.config.onTouchCancel(this.touched,y,x)}this.touched=this.touchMoved=false}}});p.Classes.Tips=new r({Implements:[u,h],initializePost:function(){if(document.body){var x=c("_tooltip")||document.createElement("div");x.id="_tooltip";x.className="tip";c.extend(x.style,{position:"absolute",display:"none",zIndex:13000});document.body.appendChild(x);this.tip=x;this.node=false}},setAsProperty:c.lambda(true),onMouseOut:function(z,y){if(this.dom&&this.isLabel(z,y)){this.hide(true);return}var x=z.relatedTarget,A=this.canvas.getElement();while(x&&x.parentNode){if(A==x.parentNode){return}x=x.parentNode}this.hide(false)},onMouseOver:function(z,y){var x;if(this.dom&&(x=this.isLabel(z,y))){this.node=this.viz.graph.getNode(x.id);this.config.onShow(this.tip,this.node,x)}},onMouseMove:function(A,z,x){if(this.dom&&this.isLabel(A,z)){this.setTooltipPosition(c.event.getPos(A,z))}if(!this.dom){var y=x.getNode();if(!y){this.hide(true);return}if(this.config.force||!this.node||this.node.id!=y.id){this.node=y;this.config.onShow(this.tip,y,x.getContains())}this.setTooltipPosition(c.event.getPos(A,z))}},setTooltipPosition:function(G){var C=this.tip,B=C.style,A=this.config;B.display="";var E={height:document.body.clientHeight,width:document.body.clientWidth};var D={width:C.offsetWidth,height:C.offsetHeight};var z=A.offsetX,F=A.offsetY;B.top=((G.y+F+D.height>E.height)?(G.y-D.height-F):G.y+F)+"px";B.left=((G.x+D.width+z>E.width)?(G.x-D.width-z):G.x+z)+"px"},hide:function(x){this.tip.style.display="none";x&&this.config.onHide()}});p.Classes.NodeStyles=new r({Implements:[u,h],initializePost:function(){this.fx=this.viz.fx;this.types=this.viz.fx.nodeTypes;this.nStyles=this.config;this.nodeStylesOnHover=this.nStyles.stylesHover;this.nodeStylesOnClick=this.nStyles.stylesClick;this.hoveredNode=false;this.fx.nodeFxAnimation=new v();this.down=false;this.move=false},onMouseOut:function(z,y){this.down=this.move=false;if(!this.hoveredNode){return}if(this.dom&&this.isLabel(z,y)){this.toggleStylesOnHover(this.hoveredNode,false)}var x=z.relatedTarget,A=this.canvas.getElement();while(x&&x.parentNode){if(A==x.parentNode){return}x=x.parentNode}this.toggleStylesOnHover(this.hoveredNode,false);this.hoveredNode=false},onMouseOver:function(A,z){var x;if(this.dom&&(x=this.isLabel(A,z))){var y=this.viz.graph.getNode(x.id);if(y.selected){return}this.hoveredNode=y;this.toggleStylesOnHover(this.hoveredNode,true)}},onMouseDown:function(B,A,y,z){if(z){return}var x;if(this.dom&&(x=this.isLabel(B,A))){this.down=this.viz.graph.getNode(x.id)}else{if(!this.dom){this.down=y.getNode()}}this.move=false},onMouseUp:function(A,z,x,y){if(y){return}if(!this.move){this.onClick(x.getNode())}this.down=this.move=false},getRestoredStyles:function(y,x){var A={},z=this["nodeStylesOn"+x];for(var B in z){A[B]=y.styles["$"+B]}return A},toggleStylesOnHover:function(x,y){if(this.nodeStylesOnHover){this.toggleStylesOn("Hover",x,y)}},toggleStylesOnClick:function(x,y){if(this.nodeStylesOnClick){this.toggleStylesOn("Click",x,y)}},toggleStylesOn:function(B,x,D){var E=this.viz;var C=this.nStyles;if(D){var A=this;if(!x.styles){x.styles=c.merge(x.data,{})}for(var F in this["nodeStylesOn"+B]){var y="$"+F;if(!(y in x.styles)){x.styles[y]=x.getData(F)}}E.fx.nodeFx(c.extend({elements:{id:x.id,properties:A["nodeStylesOn"+B]},transition:j.Quart.easeOut,duration:300,fps:40},this.config))}else{var z=this.getRestoredStyles(x,B);E.fx.nodeFx(c.extend({elements:{id:x.id,properties:z},transition:j.Quart.easeOut,duration:300,fps:40},this.config))}},onClick:function(x){if(!x){return}var y=this.nodeStylesOnClick;if(!y){return}if(x.selected){this.toggleStylesOnClick(x,false);delete x.selected}else{this.viz.graph.eachNode(function(A){if(A.selected){for(var z in y){A.setData(z,A.styles["$"+z],"end")}delete A.selected}});this.toggleStylesOnClick(x,true);x.selected=true;delete x.hovered;this.hoveredNode=false}},onMouseMove:function(D,C,A){if(this.down){this.move=true}if(this.dom&&this.isLabel(D,C)){return}var B=this.nodeStylesOnHover;if(!B){return}if(!this.dom){if(this.hoveredNode){var y=this.types[this.hoveredNode.getData("type")];var x=y&&y.contains&&y.contains.call(this.fx,this.hoveredNode,A.getPos());if(x){return}}var z=A.getNode();if(!this.hoveredNode&&!z){return}if(z.hovered){return}if(z&&!z.selected){this.fx.nodeFxAnimation.stopTimer();this.viz.graph.eachNode(function(F){if(F.hovered&&!F.selected){for(var E in B){F.setData(E,F.styles["$"+E],"end")}delete F.hovered}});z.hovered=true;this.hoveredNode=z;this.toggleStylesOnHover(z,true)}else{if(this.hoveredNode&&!this.hoveredNode.selected){this.fx.nodeFxAnimation.stopTimer();this.toggleStylesOnHover(this.hoveredNode,false);delete this.hoveredNode.hovered;this.hoveredNode=false}}}}});p.Classes.Navigation=new r({Implements:[u,h],initializePost:function(){this.pos=false;this.pressed=false},onMouseWheel:function(A,z,x){if(!this.config.zooming){return}c.event.stop(c.event.get(A,z));var B=this.config.zooming/1000,y=1+x*B;this.canvas.scale(y,y)},onMouseDown:function(C,B,A){if(!this.config.panning){return}if(this.config.panning=="avoid nodes"&&A.getNode()){return}this.pressed=true;this.pos=A.getPos();var z=this.canvas,y=z.translateOffsetX,x=z.translateOffsetY,E=z.scaleOffsetX,D=z.scaleOffsetY;this.pos.x*=E;this.pos.x+=y;this.pos.y*=D;this.pos.y+=x},onMouseMove:function(E,D,G){if(!this.config.panning){return}if(!this.pressed){return}if(this.config.panning=="avoid nodes"&&G.getNode()){return}var C=this.pos,F=G.getPos(),A=this.canvas,B=A.translateOffsetX,z=A.translateOffsetY,K=A.scaleOffsetX,I=A.scaleOffsetY;F.x*=K;F.y*=I;F.x+=B;F.y+=z;var J=F.x-C.x,H=F.y-C.y;this.pos=F;this.canvas.translate(J*1/K,H*1/I)},onMouseUp:function(A,z,y,x){if(!this.config.panning){return}this.pressed=false}});var m;(function(){var x=typeof HTMLCanvasElement,z=(x=="object"||x=="function");function y(A,B){var C=document.createElement(A);for(var D in B){if(typeof B[D]=="object"){c.extend(C[D],B[D])}else{C[D]=B[D]}}if(A=="canvas"&&!z&&G_vmlCanvasManager){C=G_vmlCanvasManager.initElement(document.body.appendChild(C))}return C}$jit.Canvas=m=new r({canvases:[],pos:false,element:false,labelContainer:false,translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(L,F){this.viz=L;this.opt=F;var C=c.type(F.injectInto)=="string"?F.injectInto:F.injectInto.id,D=C+"-label",A=c(C),E=F.width||A.offsetWidth,M=F.height||A.offsetHeight;this.id=C;var G={injectInto:C,width:E,height:M};this.element=y("div",{id:C+"-canvaswidget",style:{position:"relative",width:E+"px",height:M+"px"}});this.labelContainer=this.createLabelContainer(F.Label.type,D,G);this.canvases.push(new m.Base({config:c.extend({idSuffix:"-canvas"},G),plot:function(N){L.fx.plot()},resize:function(){L.refresh()}}));var H=F.background;if(H){var K=new m.Background[H.type](L,c.extend(H,G));this.canvases.push(new m.Base(K))}var J=this.canvases.length;while(J--){this.element.appendChild(this.canvases[J].canvas);if(J>0){this.canvases[J].plot()}}this.element.appendChild(this.labelContainer);A.appendChild(this.element);var B=null,I=this;c.addEvent(window,"scroll",function(){clearTimeout(B);B=setTimeout(function(){I.getPos(true)},500)})},getCtx:function(A){return this.canvases[A||0].getCtx()},getConfig:function(){return this.opt},getElement:function(){return this.element},getSize:function(A){return this.canvases[A||0].getSize()},resize:function(E,A){this.getPos(true);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;for(var C=0,B=this.canvases.length;C<B;C++){this.canvases[C].resize(E,A)}var D=this.element.style;D.width=E+"px";D.height=A+"px";if(this.labelContainer){this.labelContainer.style.width=E+"px"}},translate:function(A,E,D){this.translateOffsetX+=A*this.scaleOffsetX;this.translateOffsetY+=E*this.scaleOffsetY;for(var C=0,B=this.canvases.length;C<B;C++){this.canvases[C].translate(A,E,D)}},scale:function(F,C,D){var G=this.scaleOffsetX*F,E=this.scaleOffsetY*C;var I=this.translateOffsetX*(F-1)/G,H=this.translateOffsetY*(C-1)/E;this.scaleOffsetX=G;this.scaleOffsetY=E;for(var B=0,A=this.canvases.length;B<A;B++){this.canvases[B].scale(F,C,true)}this.translate(I,H,false)},getPos:function(A){if(A||!this.pos){return this.pos=c.getPos(this.getElement())}return this.pos},clear:function(A){this.canvases[A||0].clear()},path:function(B,C){var A=this.canvases[0].getCtx();A.beginPath();C(A);A[B]();A.closePath()},createLabelContainer:function(C,G,F){var E="http://www.w3.org/2000/svg";if(C=="HTML"||C=="Native"){return y("div",{id:G,style:{overflow:"visible",position:"absolute",top:0,left:0,width:F.width+"px",height:0}})}else{if(C=="SVG"){var D=document.createElementNS(E,"svg:svg");D.setAttribute("width",F.width);D.setAttribute("height",F.height);var B=D.style;B.position="absolute";B.left=B.top="0px";var A=document.createElementNS(E,"svg:g");A.setAttribute("width",F.width);A.setAttribute("height",F.height);A.setAttribute("x",0);A.setAttribute("y",0);A.setAttribute("id",G);D.appendChild(A);return D}}}});m.Base=new r({translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(A){this.viz=A;this.opt=A.config;this.size=false;this.createCanvas();this.translateToCenter()},createCanvas:function(){var B=this.opt,C=B.width,A=B.height;this.canvas=y("canvas",{id:B.injectInto+B.idSuffix,width:C,height:A,style:{position:"absolute",top:0,left:0,width:C+"px",height:A+"px"}})},getCtx:function(){if(!this.ctx){return this.ctx=this.canvas.getContext("2d")}return this.ctx},getSize:function(){if(this.size){return this.size}var A=this.canvas;return this.size={width:A.width,height:A.height}},translateToCenter:function(D){var B=this.getSize(),C=D?(B.width-D.width-this.translateOffsetX*2):B.width;height=D?(B.height-D.height-this.translateOffsetY*2):B.height;var A=this.getCtx();D&&A.scale(1/this.scaleOffsetX,1/this.scaleOffsetY);A.translate(C/2,height/2)},resize:function(D,A){var C=this.getSize(),B=this.canvas,E=B.style;this.size=false;B.width=D;B.height=A;E.width=D+"px";E.height=A+"px";if(!z){this.translateToCenter(C)}else{this.translateToCenter()}this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;this.clear();this.viz.resize(D,A,this)},translate:function(A,E,B){var D=this.scaleOffsetX,C=this.scaleOffsetY;this.translateOffsetX+=A*D;this.translateOffsetY+=E*C;this.getCtx().translate(A,E);!B&&this.plot()},scale:function(A,C,B){this.scaleOffsetX*=A;this.scaleOffsetY*=C;this.getCtx().scale(A,C);!B&&this.plot()},clear:function(){var C=this.getSize(),B=this.translateOffsetX,A=this.translateOffsetY,E=this.scaleOffsetX,D=this.scaleOffsetY;this.getCtx().clearRect((-C.width/2-B)*1/E,(-C.height/2-A)*1/D,C.width*1/E,C.height*1/D)},plot:function(){this.clear();this.viz.plot(this)}});m.Background={};m.Background.Circles=new r({initialize:function(A,B){this.viz=A;this.config=c.merge({idSuffix:"-bkcanvas",levelDistance:100,numberOfCircles:6,CanvasStyles:{},offset:0},B)},resize:function(B,A,C){this.plot(C)},plot:function(A){var B=A.canvas,H=A.getCtx(),E=this.config,G=E.CanvasStyles;for(var I in G){H[I]=G[I]}var C=E.numberOfCircles,F=E.levelDistance;for(var D=1;D<=C;D++){H.beginPath();H.arc(0,0,F*D,0,2*Math.PI,false);H.stroke();H.closePath()}}})})();var b=function(y,x){this.theta=y;this.rho=x};$jit.Polar=b;b.prototype={getc:function(x){return this.toComplex(x)},getp:function(){return this},set:function(x){x=x.getp();this.theta=x.theta;this.rho=x.rho},setc:function(z,A){this.rho=Math.sqrt(z*z+A*A);this.theta=Math.atan2(A,z);if(this.theta<0){this.theta+=Math.PI*2}},setp:function(y,x){this.theta=y;this.rho=x},clone:function(){return new b(this.theta,this.rho)},toComplex:function(B){var z=Math.cos(this.theta)*this.rho;var A=Math.sin(this.theta)*this.rho;if(B){return{x:z,y:A}}return new q(z,A)},add:function(x){return new b(this.theta+x.theta,this.rho+x.rho)},scale:function(x){return new b(this.theta,this.rho*x)},equals:function(x){return this.theta==x.theta&&this.rho==x.rho},$add:function(x){this.theta=this.theta+x.theta;this.rho+=x.rho;return this},$madd:function(x){this.theta=(this.theta+x.theta)%(Math.PI*2);this.rho+=x.rho;return this},$scale:function(x){this.rho*=x;return this},interpolate:function(z,G){var A=Math.PI,D=A*2;var y=function(I){var H=(I<0)?(I%D)+D:I%D;return H};var C=this.theta,F=z.theta;var B,E=Math.abs(C-F);if(E==A){if(C>F){B=y((F+((C-D)-F)*G))}else{B=y((F-D+(C-(F))*G))}}else{if(E>=A){if(C>F){B=y((F+((C-D)-F)*G))}else{B=y((F-D+(C-(F-D))*G))}}else{B=y((F+(C-F)*G))}}var x=(this.rho-z.rho)*G+z.rho;return{theta:B,rho:x}}};var l=function(y,x){return new b(y,x)};b.KER=l(0,0);var q=function(z,A){this.x=z;this.y=A};$jit.Complex=q;q.prototype={getc:function(){return this},getp:function(x){return this.toPolar(x)},set:function(x){x=x.getc(true);this.x=x.x;this.y=x.y},setc:function(z,A){this.x=z;this.y=A},setp:function(y,x){this.x=Math.cos(y)*x;this.y=Math.sin(y)*x},clone:function(){return new q(this.x,this.y)},toPolar:function(z){var x=this.norm();var y=Math.atan2(this.y,this.x);if(y<0){y+=Math.PI*2}if(z){return{theta:y,rho:x}}return new b(y,x)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(x){return new q(this.x+x.x,this.y+x.y)},prod:function(x){return new q(this.x*x.x-this.y*x.y,this.y*x.x+this.x*x.y)},conjugate:function(){return new q(this.x,-this.y)},scale:function(x){return new q(this.x*x,this.y*x)},equals:function(x){return this.x==x.x&&this.y==x.y},$add:function(x){this.x+=x.x;this.y+=x.y;return this},$prod:function(B){var z=this.x,A=this.y;this.x=z*B.x-A*B.y;this.y=A*B.x+z*B.y;return this},$conjugate:function(){this.y=-this.y;return this},$scale:function(x){this.x*=x;this.y*=x;return this},$div:function(C){var z=this.x,B=this.y;var A=C.squaredNorm();this.x=z*C.x+B*C.y;this.y=B*C.x-z*C.y;return this.$scale(1/A)}};var s=function(y,x){return new q(y,x)};q.KER=s(0,0);$jit.Graph=new r({initialize:function(z,y,x,D){var B={complex:false,Node:{}};this.Node=y;this.Edge=x;this.Label=D;this.opt=c.merge(B,z||{});this.nodes={};this.edges={};var A=this;this.nodeList={};for(var C in k){A.nodeList[C]=(function(E){return function(){var F=Array.prototype.slice.call(arguments);A.eachNode(function(G){G[E].apply(G,F)})}})(C)}},getNode:function(x){if(this.hasNode(x)){return this.nodes[x]}return false},getByName:function(x){for(var z in this.nodes){var y=this.nodes[z];if(y.name==x){return y}}return false},getAdjacence:function(y,x){if(y in this.edges){return this.edges[y][x]}return false},addNode:function(y){if(!this.nodes[y.id]){var x=this.edges[y.id]={};this.nodes[y.id]=new e.Node(c.extend({id:y.id,name:y.name,data:c.merge(y.data||{},{}),adjacencies:x},this.opt.Node),this.opt.complex,this.Node,this.Edge,this.Label)}return this.nodes[y.id]},addAdjacence:function(A,z,y){if(!this.hasNode(A.id)){this.addNode(A)}if(!this.hasNode(z.id)){this.addNode(z)}A=this.nodes[A.id];z=this.nodes[z.id];if(!A.adjacentTo(z)){var B=this.edges[A.id]=this.edges[A.id]||{};var x=this.edges[z.id]=this.edges[z.id]||{};B[z.id]=x[A.id]=new e.Adjacence(A,z,y,this.Edge,this.Label);return B[z.id]}return this.edges[A.id][z.id]},removeNode:function(z){if(this.hasNode(z)){delete this.nodes[z];var y=this.edges[z];for(var x in y){delete this.edges[x][z]}delete this.edges[z]}},removeAdjacence:function(y,x){delete this.edges[y][x];delete this.edges[x][y]},hasNode:function(x){return x in this.nodes},empty:function(){this.nodes={};this.edges={}}});var e=$jit.Graph;var k;(function(){var x=function(E,G,B,D,F){var C;B=B||"current";E="$"+(E?E+"-":"");if(B=="current"){C=this.data}else{if(B=="start"){C=this.startData}else{if(B=="end"){C=this.endData}}}var A=E+G;if(D){return C[A]}if(!this.Config.overridable){return F[G]||0}return(A in C)?C[A]:((A in this.data)?this.data[A]:(F[G]||0))};var z=function(D,E,C,A){A=A||"current";D="$"+(D?D+"-":"");var B;if(A=="current"){B=this.data}else{if(A=="start"){B=this.startData}else{if(A=="end"){B=this.endData}}}B[D+E]=C};var y=function(C,A){C="$"+(C?C+"-":"");var B=this;c.each(A,function(E){var D=C+E;delete B.data[D];delete B.endData[D];delete B.startData[D]})};k={getData:function(C,A,B){return x.call(this,"",C,A,B,this.Config)},setData:function(C,B,A){z.call(this,"",C,B,A)},setDataset:function(D,E){D=c.splat(D);for(var A in E){for(var C=0,F=c.splat(E[A]),B=D.length;C<B;C++){this.setData(A,F[C],D[C])}}},removeData:function(){y.call(this,"",Array.prototype.slice.call(arguments))},getCanvasStyle:function(C,A,B){return x.call(this,"canvas",C,A,B,this.Config.CanvasStyles)},setCanvasStyle:function(C,B,A){z.call(this,"canvas",C,B,A)},setCanvasStyles:function(D,E){D=c.splat(D);for(var A in E){for(var C=0,F=c.splat(E[A]),B=D.length;C<B;C++){this.setCanvasStyle(A,F[C],D[C])}}},removeCanvasStyle:function(){y.call(this,"canvas",Array.prototype.slice.call(arguments))},getLabelData:function(C,A,B){return x.call(this,"label",C,A,B,this.Label)},setLabelData:function(C,B,A){z.call(this,"label",C,B,A)},setLabelDataset:function(D,E){D=c.splat(D);for(var A in E){for(var C=0,F=c.splat(E[A]),B=D.length;C<B;C++){this.setLabelData(A,F[C],D[C])}}},removeLabelData:function(){y.call(this,"label",Array.prototype.slice.call(arguments))}}})();e.Node=new r({initialize:function(z,B,y,x,C){var A={id:"",name:"",data:{},startData:{},endData:{},adjacencies:{},selected:false,drawn:false,exist:false,angleSpan:{begin:0,end:0},pos:(B&&s(0,0))||l(0,0),startPos:(B&&s(0,0))||l(0,0),endPos:(B&&s(0,0))||l(0,0)};c.extend(this,c.extend(A,z));this.Config=this.Node=y;this.Edge=x;this.Label=C},adjacentTo:function(x){return x.id in this.adjacencies},getAdjacency:function(x){return this.adjacencies[x]},getPos:function(x){x=x||"current";if(x=="current"){return this.pos}else{if(x=="end"){return this.endPos}else{if(x=="start"){return this.startPos}}}},setPos:function(y,x){x=x||"current";var z;if(x=="current"){z=this.pos}else{if(x=="end"){z=this.endPos}else{if(x=="start"){z=this.startPos}}}z.set(y)}});e.Node.implement(k);e.Adjacence=new r({initialize:function(y,B,z,x,A){this.nodeFrom=y;this.nodeTo=B;this.data=z||{};this.startData={};this.endData={};this.Config=this.Edge=x;this.Label=A}});e.Adjacence.implement(k);e.Util={filter:function(y){if(!y||!(c.type(y)=="string")){return function(){return true}}var x=y.split(" ");return function(A){for(var z=0;z<x.length;z++){if(A[x[z]]){return false}}return true}},getNode:function(x,y){return x.nodes[y]},eachNode:function(B,A,x){var z=this.filter(x);for(var y in B.nodes){if(z(B.nodes[y])){A(B.nodes[y])}}},eachAdjacency:function(C,D,y){var z=C.adjacencies,B=this.filter(y);for(var E in z){var x=z[E];if(B(x)){if(x.nodeFrom!=C){var A=x.nodeFrom;x.nodeFrom=x.nodeTo;x.nodeTo=A}D(x,E)}}},computeLevels:function(D,E,A,z){A=A||0;var B=this.filter(z);this.eachNode(D,function(F){F._flag=false;F._depth=-1},z);var y=D.getNode(E);y._depth=A;var x=[y];while(x.length!=0){var C=x.pop();C._flag=true;this.eachAdjacency(C,function(F){var G=F.nodeTo;if(G._flag==false&&B(G)){if(G._depth<0){G._depth=C._depth+1+A}x.unshift(G)}},z)}},eachBFS:function(C,D,B,y){var z=this.filter(y);this.clean(C);var x=[C.getNode(D)];while(x.length!=0){var A=x.pop();A._flag=true;B(A,A._depth);this.eachAdjacency(A,function(E){var F=E.nodeTo;if(F._flag==false&&z(F)){F._flag=true;x.unshift(F)}},y)}},eachLevel:function(B,F,y,C,A){var E=B._depth,x=this.filter(A),D=this;y=y===false?Number.MAX_VALUE-E:y;(function z(I,G,H){var J=I._depth;if(J>=G&&J<=H&&x(I)){C(I,J)}if(J<H){D.eachAdjacency(I,function(K){var L=K.nodeTo;if(L._depth>J){z(L,G,H)}})}})(B,F+E,y+E)},eachSubgraph:function(y,z,x){this.eachLevel(y,0,false,z,x)},eachSubnode:function(y,z,x){this.eachLevel(y,1,1,z,x)},anySubnode:function(A,z,y){var x=false;z=z||c.lambda(true);var B=c.type(z)=="string"?function(C){return C[z]}:z;this.eachSubnode(A,function(C){if(B(C)){x=true}},y);return x},getSubnodes:function(C,D,x){var z=[],B=this;D=D||0;var A,y;if(c.type(D)=="array"){A=D[0];y=D[1]}else{A=D;y=Number.MAX_VALUE-C._depth}this.eachLevel(C,A,y,function(E){z.push(E)},x);return z},getParents:function(y){var x=[];this.eachAdjacency(y,function(z){var A=z.nodeTo;if(A._depth<y._depth){x.push(A)}});return x},isDescendantOf:function(A,B){if(A.id==B){return true}var z=this.getParents(A),x=false;for(var y=0;!x&&y<z.length;y++){x=x||this.isDescendantOf(z[y],B)}return x},clean:function(x){this.eachNode(x,function(y){y._flag=false})},getClosestNodeToOrigin:function(y,z,x){return this.getClosestNodeToPos(y,b.KER,z,x)},getClosestNodeToPos:function(z,C,B,x){var y=null;B=B||"current";C=C&&C.getc(true)||q.KER;var A=function(E,D){var G=E.x-D.x,F=E.y-D.y;return G*G+F*F};this.eachNode(z,function(D){y=(y==null||A(D.getPos(B).getc(true),C)<A(y.getPos(B).getc(true),C))?D:y},x);return y}};c.each(["getNode","eachNode","computeLevels","eachBFS","clean","getClosestNodeToPos","getClosestNodeToOrigin"],function(x){e.prototype[x]=function(){return e.Util[x].apply(e.Util,[this].concat(Array.prototype.slice.call(arguments)))}});c.each(["eachAdjacency","eachLevel","eachSubgraph","eachSubnode","anySubnode","getSubnodes","getParents","isDescendantOf"],function(x){e.Node.prototype[x]=function(){return e.Util[x].apply(e.Util,[this].concat(Array.prototype.slice.call(arguments)))}});e.Op={options:{type:"nothing",duration:2000,hideLabels:true,fps:30},initialize:function(x){this.viz=x},removeNode:function(C,A){var x=this.viz;var y=c.merge(this.options,x.controller,A);var E=c.splat(C);var z,B,D;switch(y.type){case"nothing":for(z=0;z<E.length;z++){x.graph.removeNode(E[z])}break;case"replot":this.removeNode(E,{type:"nothing"});x.labels.clearLabels();x.refresh(true);break;case"fade:seq":case"fade":B=this;for(z=0;z<E.length;z++){D=x.graph.getNode(E[z]);D.setData("alpha",0,"end")}x.fx.animate(c.merge(y,{modes:["node-property:alpha"],onComplete:function(){B.removeNode(E,{type:"nothing"});x.labels.clearLabels();x.reposition();x.fx.animate(c.merge(y,{modes:["linear"]}))}}));break;case"fade:con":B=this;for(z=0;z<E.length;z++){D=x.graph.getNode(E[z]);D.setData("alpha",0,"end");D.ignore=true}x.reposition();x.fx.animate(c.merge(y,{modes:["node-property:alpha","linear"],onComplete:function(){B.removeNode(E,{type:"nothing"})}}));break;case"iter":B=this;x.fx.sequence({condition:function(){return E.length!=0},step:function(){B.removeNode(E.shift(),{type:"nothing"});x.labels.clearLabels()},onComplete:function(){y.onComplete()},duration:Math.ceil(y.duration/E.length)});break;default:this.doError()}},removeEdge:function(E,C){var x=this.viz;var A=c.merge(this.options,x.controller,C);var z=(c.type(E[0])=="string")?[E]:E;var B,D,y;switch(A.type){case"nothing":for(B=0;B<z.length;B++){x.graph.removeAdjacence(z[B][0],z[B][1])}break;case"replot":this.removeEdge(z,{type:"nothing"});x.refresh(true);break;case"fade:seq":case"fade":D=this;for(B=0;B<z.length;B++){y=x.graph.getAdjacence(z[B][0],z[B][1]);if(y){y.setData("alpha",0,"end")}}x.fx.animate(c.merge(A,{modes:["edge-property:alpha"],onComplete:function(){D.removeEdge(z,{type:"nothing"});x.reposition();x.fx.animate(c.merge(A,{modes:["linear"]}))}}));break;case"fade:con":D=this;for(B=0;B<z.length;B++){y=x.graph.getAdjacence(z[B][0],z[B][1]);if(y){y.setData("alpha",0,"end");y.ignore=true}}x.reposition();x.fx.animate(c.merge(A,{modes:["edge-property:alpha","linear"],onComplete:function(){D.removeEdge(z,{type:"nothing"})}}));break;case"iter":D=this;x.fx.sequence({condition:function(){return z.length!=0},step:function(){D.removeEdge(z.shift(),{type:"nothing"});x.labels.clearLabels()},onComplete:function(){A.onComplete()},duration:Math.ceil(A.duration/z.length)});break;default:this.doError()}},sum:function(B,A){var x=this.viz;var z=c.merge(this.options,x.controller,A),y=x.root;var D;x.root=A.id||x.root;switch(z.type){case"nothing":D=x.construct(B);D.eachNode(function(F){F.eachAdjacency(function(G){x.graph.addAdjacence(G.nodeFrom,G.nodeTo,G.data)})});break;case"replot":x.refresh(true);this.sum(B,{type:"nothing"});x.refresh(true);break;case"fade:seq":case"fade":case"fade:con":that=this;D=x.construct(B);var E=this.preprocessSum(D);var C=!E?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];x.reposition();if(z.type!="fade:con"){x.fx.animate(c.merge(z,{modes:["linear"],onComplete:function(){x.fx.animate(c.merge(z,{modes:C,onComplete:function(){z.onComplete()}}))}}))}else{x.graph.eachNode(function(F){if(F.id!=y&&F.pos.getp().equals(b.KER)){F.pos.set(F.endPos);F.startPos.set(F.endPos)}});x.fx.animate(c.merge(z,{modes:["linear"].concat(C)}))}break;default:this.doError()}},morph:function(F,y,A){var C=this.viz;var G=c.merge(this.options,C.controller,y),B=C.root;var D;C.root=y.id||C.root;switch(G.type){case"nothing":D=C.construct(F);D.eachNode(function(J){var I=C.graph.hasNode(J.id);J.eachAdjacency(function(N){var M=!!C.graph.getAdjacence(N.nodeFrom.id,N.nodeTo.id);C.graph.addAdjacence(N.nodeFrom,N.nodeTo,N.data);if(M){var L=C.graph.getAdjacence(N.nodeFrom.id,N.nodeTo.id);for(var O in (N.data||{})){L.data[O]=N.data[O]}}});if(I){var H=C.graph.getNode(J.id);for(var K in (J.data||{})){H.data[K]=J.data[K]}}});C.graph.eachNode(function(H){H.eachAdjacency(function(I){if(!D.getAdjacence(I.nodeFrom.id,I.nodeTo.id)){C.graph.removeAdjacence(I.nodeFrom.id,I.nodeTo.id)}});if(!D.hasNode(H.id)){C.graph.removeNode(H.id)}});break;case"replot":C.labels.clearLabels(true);this.morph(F,{type:"nothing"});C.refresh(true);C.refresh(true);break;case"fade:seq":case"fade":case"fade:con":that=this;D=C.construct(F);var E=A&&("node-property" in A)&&c.map(c.splat(A["node-property"]),function(H){return"$"+H});C.graph.eachNode(function(I){var J=D.getNode(I.id);if(!J){I.setData("alpha",1);I.setData("alpha",1,"start");I.setData("alpha",0,"end");I.ignore=true}else{var H=J.data;for(var K in H){if(E&&(c.indexOf(E,K)>-1)){I.endData[K]=H[K]}else{I.data[K]=H[K]}}}});C.graph.eachNode(function(H){if(H.ignore){return}H.eachAdjacency(function(I){if(I.nodeFrom.ignore||I.nodeTo.ignore){return}var J=D.getNode(I.nodeFrom.id);var K=D.getNode(I.nodeTo.id);if(!J.adjacentTo(K)){var I=C.graph.getAdjacence(J.id,K.id);x=true;I.setData("alpha",1);I.setData("alpha",1,"start");I.setData("alpha",0,"end")}})});var x=this.preprocessSum(D);var z=!x?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];z[0]=z[0]+((A&&("node-property" in A))?(":"+c.splat(A["node-property"]).join(":")):"");z[1]=(z[1]||"edge-property:alpha")+((A&&("edge-property" in A))?(":"+c.splat(A["edge-property"]).join(":")):"");if(A&&("label-property" in A)){z.push("label-property:"+c.splat(A["label-property"]).join(":"))}C.reposition();C.graph.eachNode(function(H){if(H.id!=B&&H.pos.getp().equals(b.KER)){H.pos.set(H.endPos);H.startPos.set(H.endPos)}});C.fx.animate(c.merge(G,{modes:["polar"].concat(z),onComplete:function(){C.graph.eachNode(function(H){if(H.ignore){C.graph.removeNode(H.id)}});C.graph.eachNode(function(H){H.eachAdjacency(function(I){if(I.ignore){C.graph.removeAdjacence(I.nodeFrom.id,I.nodeTo.id)}})});G.onComplete()}}));break;default:}},contract:function(z,y){var x=this.viz;if(z.collapsed||!z.anySubnode(c.lambda(true))){return}y=c.merge(this.options,x.config,y||{},{modes:["node-property:alpha:span","linear"]});z.collapsed=true;(function A(B){B.eachSubnode(function(C){C.ignore=true;C.setData("alpha",0,y.type=="animate"?"end":"current");A(C)})})(z);if(y.type=="animate"){x.compute("end");if(x.rotated){x.rotate(x.rotated,"none",{property:"end"})}(function A(B){B.eachSubnode(function(C){C.setPos(z.getPos("end"),"end");A(C)})})(z);x.fx.animate(y)}else{if(y.type=="replot"){x.refresh()}}},expand:function(z,y){if(!("collapsed" in z)){return}var x=this.viz;y=c.merge(this.options,x.config,y||{},{modes:["node-property:alpha:span","linear"]});delete z.collapsed;(function A(B){B.eachSubnode(function(C){delete C.ignore;C.setData("alpha",1,y.type=="animate"?"end":"current");A(C)})})(z);if(y.type=="animate"){x.compute("end");if(x.rotated){x.rotate(x.rotated,"none",{property:"end"})}x.fx.animate(y)}else{if(y.type=="replot"){x.refresh()}}},preprocessSum:function(y){var x=this.viz;y.eachNode(function(A){if(!x.graph.hasNode(A.id)){x.graph.addNode(A);var B=x.graph.getNode(A.id);B.setData("alpha",0);B.setData("alpha",0,"start");B.setData("alpha",1,"end")}});var z=false;y.eachNode(function(A){A.eachAdjacency(function(B){var C=x.graph.getNode(B.nodeFrom.id);var D=x.graph.getNode(B.nodeTo.id);if(!C.adjacentTo(D)){var B=x.graph.addAdjacence(C,D,B.data);if(C.startAlpha==C.endAlpha&&D.startAlpha==D.endAlpha){z=true;B.setData("alpha",0);B.setData("alpha",0,"start");B.setData("alpha",1,"end")}}})});return z}};var a={none:{render:c.empty,contains:c.lambda(false)},circle:{render:function(A,B,x,z){var y=z.getCtx();y.beginPath();y.arc(B.x,B.y,x,0,Math.PI*2,true);y.closePath();y[A]()},contains:function(C,B,x){var z=C.x-B.x,y=C.y-B.y,A=z*z+y*y;return A<=x*x}},ellipse:{render:function(B,C,A,x,z){var y=z.getCtx();x/=2;A/=2;y.save();y.scale(A/x,x/A);y.beginPath();y.arc(C.x*(x/A),C.y*(A/x),x,0,Math.PI*2,true);y.closePath();y[B]();y.restore()},contains:function(E,D,A,x){A/=2;x/=2;var C=(A+x)/2,z=E.x-D.x,y=E.y-D.y,B=z*z+y*y;return B<=C*C}},square:{render:function(y,A,z,x){x.getCtx()[y+"Rect"](A.x-z,A.y-z,2*z,2*z)},contains:function(z,y,x){return Math.abs(y.x-z.x)<=x&&Math.abs(y.y-z.y)<=x}},rectangle:{render:function(A,B,z,x,y){y.getCtx()[A+"Rect"](B.x-z/2,B.y-x/2,z,x)},contains:function(A,z,y,x){return Math.abs(z.x-A.x)<=y/2&&Math.abs(z.y-A.y)<=x/2}},triangle:{render:function(D,E,A,x){var H=x.getCtx(),z=E.x,y=E.y-A,G=z-A,F=E.y+A,C=z+A,B=F;H.beginPath();H.moveTo(z,y);H.lineTo(G,F);H.lineTo(C,B);H.closePath();H[D]()},contains:function(z,y,x){return a.circle.contains(z,y,x)}},star:{render:function(B,D,C,y){var x=y.getCtx(),A=Math.PI/5;x.save();x.translate(D.x,D.y);x.beginPath();x.moveTo(C,0);for(var z=0;z<9;z++){x.rotate(A);if(z%2==0){x.lineTo((C/0.525731)*0.200811,0)}else{x.lineTo(C,0)}}x.closePath();x[B]();x.restore()},contains:function(z,y,x){return a.circle.contains(z,y,x)}}};var n={line:{render:function(A,z,y){var x=y.getCtx();x.beginPath();x.moveTo(A.x,A.y);x.lineTo(z.x,z.y);x.stroke()},contains:function(H,z,C,F){var A=Math.min,D=Math.max,y=A(H.x,z.x),G=D(H.x,z.x),x=A(H.y,z.y),E=D(H.y,z.y);if(C.x>=y&&C.x<=G&&C.y>=x&&C.y<=E){if(Math.abs(z.x-H.x)<=F){return true}var B=(z.y-H.y)/(z.x-H.x)*(C.x-H.x)+H.y;return Math.abs(B-C.y)<=F}return false}},arrow:{render:function(G,H,A,y,x){var I=x.getCtx();if(y){var z=G;G=H;H=z}var D=new q(H.x-G.x,H.y-G.y);D.$scale(A/D.norm());var B=new q(H.x-D.x,H.y-D.y),C=new q(-D.y/2,D.x/2),F=B.add(C),E=B.$add(C.$scale(-1));I.beginPath();I.moveTo(G.x,G.y);I.lineTo(H.x,H.y);I.stroke();I.beginPath();I.moveTo(F.x,F.y);I.lineTo(E.x,E.y);I.lineTo(H.x,H.y);I.closePath();I.fill()},contains:function(y,x,A,z){return n.line.contains(y,x,A,z)}},hyperline:{render:function(E,F,x,z){var G=z.getCtx();var A=B(E,F);if(A.a>1000||A.b>1000||A.ratio<0){G.beginPath();G.moveTo(E.x*x,E.y*x);G.lineTo(F.x*x,F.y*x);G.stroke()}else{var D=Math.atan2(F.y-A.y,F.x-A.x);var C=Math.atan2(E.y-A.y,E.x-A.x);var y=y(D,C);G.beginPath();G.arc(A.x*x,A.y*x,A.ratio*x,D,C,y);G.stroke()}function B(T,S){var L=(T.x*S.y-T.y*S.x),H=L;var K=T.squaredNorm(),J=S.squaredNorm();if(L==0){return{x:0,y:0,ratio:-1}}var R=(T.y*J-S.y*K+T.y-S.y)/L;var P=(S.x*K-T.x*J+S.x-T.x)/H;var Q=-R/2;var O=-P/2;var N=(R*R+P*P)/4-1;if(N<0){return{x:0,y:0,ratio:-1}}var M=Math.sqrt(N);var I={x:Q,y:O,ratio:M>1000?-1:M,a:R,b:P};return I}function y(H,I){return(H<I)?((H+Math.PI>I)?false:true):((I+Math.PI>H)?true:false)}},contains:c.lambda(false)}};e.Plot={initialize:function(y,x){this.viz=y;this.config=y.config;this.node=y.config.Node;this.edge=y.config.Edge;this.animation=new v;this.nodeTypes=new x.Plot.NodeTypes;this.edgeTypes=new x.Plot.EdgeTypes;this.labels=y.labels},nodeHelper:a,edgeHelper:n,Interpolator:{map:{border:"color",color:"color",width:"number",height:"number",dim:"number",alpha:"number",lineWidth:"number",angularWidth:"number",span:"number",valueArray:"array-number",dimArray:"array-number"},canvas:{globalAlpha:"number",fillStyle:"color",strokeStyle:"color",lineWidth:"number",shadowBlur:"number",shadowColor:"color",shadowOffsetX:"number",shadowOffsetY:"number",miterLimit:"number"},label:{size:"number",color:"color"},compute:function(z,y,x){return z+(y-z)*x},moebius:function(E,D,G,A){var C=A.scale(-G);if(C.norm()<1){var z=C.x,F=C.y;var B=E.startPos.getc().moebiusTransformation(C);E.pos.setc(B.x,B.y);C.x=z;C.y=F}},linear:function(y,x,B){var A=y.startPos.getc(true);var z=y.endPos.getc(true);y.pos.setc(this.compute(A.x,z.x,B),this.compute(A.y,z.y,B))},polar:function(z,y,C){var B=z.startPos.getp(true);var A=z.endPos.getp();var x=A.interpolate(B,C);z.pos.setp(x.theta,x.rho)},number:function(y,D,C,x,B){var A=y[x](D,"start");var z=y[x](D,"end");y[B](D,this.compute(A,z,C))},color:function(z,x,F,C,A){var D=c.hexToRgb(z[C](x,"start"));var E=c.hexToRgb(z[C](x,"end"));var B=this.compute;var y=c.rgbToHex([parseInt(B(D[0],E[0],F)),parseInt(B(D[1],E[1],F)),parseInt(B(D[2],E[2],F))]);z[A](x,y)},"array-number":function(A,z,K,H,C){var I=A[H](z,"start"),J=A[H](z,"end"),L=[];for(var F=0,B=I.length;F<B;F++){var y=I[F],x=J[F];if(y.length){for(var E=0,G=y.length,D=[];E<G;E++){D.push(this.compute(y[E],x[E],K))}L.push(D)}else{L.push(this.compute(y,x,K))}}A[C](z,L)},node:function(y,D,F,x,E,z){x=this[x];if(D){var C=D.length;for(var A=0;A<C;A++){var B=D[A];this[x[B]](y,B,F,E,z)}}else{for(var B in x){this[x[B]](y,B,F,E,z)}}},edge:function(z,y,E,A,x,D){var C=z.adjacencies;for(var B in C){this["node"](C[B],y,E,A,x,D)}},"node-property":function(y,x,z){this["node"](y,x,z,"map","getData","setData")},"edge-property":function(y,x,z){this["edge"](y,x,z,"map","getData","setData")},"label-property":function(y,x,z){this["node"](y,x,z,"label","getLabelData","setLabelData")},"node-style":function(y,x,z){this["node"](y,x,z,"canvas","getCanvasStyle","setCanvasStyle")},"edge-style":function(y,x,z){this["edge"](y,x,z,"canvas","getCanvasStyle","setCanvasStyle")}},sequence:function(y){var z=this;y=c.merge({condition:c.lambda(false),step:c.empty,onComplete:c.empty,duration:200},y||{});var x=setInterval(function(){if(y.condition()){y.step()}else{clearInterval(x);y.onComplete()}z.viz.refresh(true)},y.duration)},prepare:function(D){var C=this.viz.graph,A={"node-property":{getter:"getData",setter:"setData"},"edge-property":{getter:"getData",setter:"setData"},"node-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"},"edge-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"}};var y={};if(c.type(D)=="array"){for(var B=0,x=D.length;B<x;B++){var z=D[B].split(":");y[z.shift()]=z}}else{for(var E in D){if(E=="position"){y[D.position]=[]}else{y[E]=c.splat(D[E])}}}C.eachNode(function(F){F.startPos.set(F.pos);c.each(["node-property","node-style"],function(I){if(I in y){var J=y[I];for(var H=0,G=J.length;H<G;H++){F[A[I].setter](J[H],F[A[I].getter](J[H]),"start")}}});c.each(["edge-property","edge-style"],function(G){if(G in y){var H=y[G];F.eachAdjacency(function(J){for(var K=0,I=H.length;K<I;K++){J[A[G].setter](H[K],J[A[G].getter](H[K]),"start")}})}})});return y},animate:function(A,z){A=c.merge(this.viz.config,A||{});var B=this,y=this.viz,D=y.graph,E=this.Interpolator,C=A.type==="nodefx"?this.nodeFxAnimation:this.animation;var x=this.prepare(A.modes);if(A.hideLabels){this.labels.hideLabels(true)}C.setOptions(c.merge(A,{$animating:false,compute:function(F){D.eachNode(function(G){for(var H in x){E[H](G,x[H],F,z)}});B.plot(A,this.$animating,F);this.$animating=true},complete:function(){if(A.hideLabels){B.labels.hideLabels(false)}B.plot(A);A.onComplete();A.onAfterCompute()}})).start()},nodeFx:function(z){var E=this.viz,F=E.graph,C=this.nodeFxAnimation,G=c.merge(this.viz.config,{elements:{id:false,properties:{}},reposition:false});z=c.merge(G,z||{},{onBeforeCompute:c.empty,onAfterCompute:c.empty});C.stopTimer();var D=z.elements.properties;if(!z.elements.id){F.eachNode(function(I){for(var H in D){I.setData(H,D[H],"end")}})}else{var x=c.splat(z.elements.id);c.each(x,function(J){var I=F.getNode(J);if(I){for(var H in D){I.setData(H,D[H],"end")}}})}var B=[];for(var y in D){B.push(y)}var A=["node-property:"+B.join(":")];if(z.reposition){A.push("linear");E.compute("end")}this.animate(c.merge(z,{modes:A,type:"nodefx"}))},plot:function(y,H){var F=this.viz,C=F.graph,z=F.canvas,x=F.root,D=this,G=z.getCtx(),B=Math.min,y=y||this.viz.controller;y.clearCanvas&&z.clear();var E=C.getNode(x);if(!E){return}var A=!!E.visited;C.eachNode(function(J){var I=J.getData("alpha");J.eachAdjacency(function(K){var L=K.nodeTo;if(!!L.visited===A&&J.drawn&&L.drawn){!H&&y.onBeforePlotLine(K);G.save();G.globalAlpha=B(I,L.getData("alpha"),K.getData("alpha"));D.plotLine(K,z,H);G.restore();!H&&y.onAfterPlotLine(K)}});G.save();if(J.drawn){!H&&y.onBeforePlotNode(J);D.plotNode(J,z,H);!H&&y.onAfterPlotNode(J)}if(!D.labelsHidden&&y.withLabels){if(J.drawn&&I>=0.95){D.labels.plotLabel(z,J,y)}else{D.labels.hideLabel(J,false)}}G.restore();J.visited=!A})},plotTree:function(B,y,F){var C=this,D=this.viz,z=D.canvas,A=this.config,E=z.getCtx();var x=B.getData("alpha");B.eachSubnode(function(H){if(y.plotSubtree(B,H)&&H.exist&&H.drawn){var G=B.getAdjacency(H.id);!F&&y.onBeforePlotLine(G);E.globalAlpha=Math.min(x,H.getData("alpha"));C.plotLine(G,z,F);!F&&y.onAfterPlotLine(G);C.plotTree(H,y,F)}});if(B.drawn){!F&&y.onBeforePlotNode(B);this.plotNode(B,z,F);!F&&y.onAfterPlotNode(B);if(!y.hideLabels&&y.withLabels&&x>=0.95){this.labels.plotLabel(z,B,y)}else{this.labels.hideLabel(B,false)}}else{this.labels.hideLabel(B,true)}},plotNode:function(z,y,G){var D=z.getData("type"),C=this.node.CanvasStyles;if(D!="none"){var x=z.getData("lineWidth"),B=z.getData("color"),A=z.getData("alpha"),E=y.getCtx();E.lineWidth=x;E.fillStyle=E.strokeStyle=B;E.globalAlpha=A;for(var F in C){E[F]=z.getCanvasStyle(F)}this.nodeTypes[D].render.call(this,z,y,G)}},plotLine:function(C,y,F){var B=C.getData("type"),A=this.edge.CanvasStyles;if(B!="none"){var x=C.getData("lineWidth"),z=C.getData("color"),D=y.getCtx();D.lineWidth=x;D.fillStyle=D.strokeStyle=z;for(var E in A){D[E]=C.getCanvasStyle(E)}this.edgeTypes[B].render.call(this,C,y,F)}}};e.Label={};e.Label.Native=new r({plotLabel:function(z,A,y){var x=z.getCtx();var B=A.pos.getc(true);x.font=A.getLabelData("style")+" "+A.getLabelData("size")+"px "+A.getLabelData("family");x.textAlign=A.getLabelData("textAlign");x.fillStyle=x.strokeStyle=A.getLabelData("color");x.textBaseline=A.getLabelData("textBaseline");this.renderLabel(z,A,y)},renderLabel:function(z,A,y){var x=z.getCtx();var B=A.pos.getc(true);x.fillText(A.name,B.x,B.y+A.getData("height")/2)},hideLabel:c.empty,hideLabels:c.empty});e.Label.DOM=new r({labelsHidden:false,labelContainer:false,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(x){return(x in this.labels&&this.labels[x]!=null)?this.labels[x]:this.labels[x]=document.getElementById(x)},hideLabels:function(y){var x=this.getLabelContainer();if(y){x.style.display="none"}else{x.style.display=""}this.labelsHidden=y},clearLabels:function(x){for(var y in this.labels){if(x||!this.viz.graph.hasNode(y)){this.disposeLabel(y);delete this.labels[y]}}},disposeLabel:function(y){var x=this.getLabel(y);if(x&&x.parentNode){x.parentNode.removeChild(x)}},hideLabel:function(B,x){B=c.splat(B);var y=x?"":"none",z,A=this;c.each(B,function(D){var C=A.getLabel(D.id);if(C){C.style.display=y}})},fitsInCanvas:function(z,x){var y=x.getSize();if(z.x>=y.width||z.x<0||z.y>=y.height||z.y<0){return false}return true}});e.Label.HTML=new r({Implements:e.Label.DOM,plotLabel:function(A,B,z){var C=B.id,x=this.getLabel(C);if(!x&&!(x=document.getElementById(C))){x=document.createElement("div");var y=this.getLabelContainer();x.id=C;x.className="node";x.style.position="absolute";z.onCreateLabel(x,B);y.appendChild(x);this.labels[B.id]=x}this.placeLabel(x,B,z)}});e.Label.SVG=new r({Implements:e.Label.DOM,plotLabel:function(A,C,z){var E=C.id,x=this.getLabel(E);if(!x&&!(x=document.getElementById(E))){var B="http://www.w3.org/2000/svg";x=document.createElementNS(B,"svg:text");var D=document.createElementNS(B,"svg:tspan");x.appendChild(D);var y=this.getLabelContainer();x.setAttribute("id",E);x.setAttribute("class","node");y.appendChild(x);z.onCreateLabel(x,C);this.labels[C.id]=x}this.placeLabel(x,C,z)}});e.Geom=new r({initialize:function(x){this.viz=x;this.config=x.config;this.node=x.config.Node;this.edge=x.config.Edge},translate:function(y,x){x=c.splat(x);this.viz.graph.eachNode(function(z){c.each(x,function(A){z.getPos(A).$add(y)})})},setRightLevelToShow:function(A,x,C){var B=this.getRightLevelToShow(A,x),z=this.viz.labels,y=c.merge({execShow:true,execHide:true,onHide:c.empty,onShow:c.empty},C||{});A.eachLevel(0,this.config.levelsToShow,function(E){var D=E._depth-A._depth;if(D>B){y.onHide(E);if(y.execHide){E.drawn=false;E.exist=false;z.hideLabel(E,false)}}else{y.onShow(E);if(y.execShow){E.exist=true}}});A.drawn=true},getRightLevelToShow:function(A,y){var x=this.config;var B=x.levelsToShow;var z=x.constrained;if(!z){return B}while(!this.treeFitsInCanvas(A,y,B)&&B>1){B--}return B}});var d={construct:function(y){var z=(c.type(y)=="array");var x=new e(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);if(!z){(function(A,C){A.addNode(C);if(C.children){for(var B=0,D=C.children;B<D.length;B++){A.addAdjacence(C,D[B]);arguments.callee(A,D[B])}}})(x,y)}else{(function(I,J){var B=function(N){for(var M=0,K=J.length;M<K;M++){if(J[M].id==N){return J[M]}}var L={id:N,name:N};return I.addNode(L)};for(var F=0,C=J.length;F<C;F++){I.addNode(J[F]);var G=J[F].adjacencies;if(G){for(var D=0,H=G.length;D<H;D++){var A=G[D],E={};if(typeof G[D]!="string"){E=c.merge(A.data,{});A=A.nodeTo}I.addAdjacence(J[F],B(A),E)}}}})(x,y)}return x},loadJSON:function(y,x){this.json=y;if(this.labels&&this.labels.clearLabels){this.labels.clearLabels(true)}this.graph=this.construct(y);if(c.type(y)!="array"){this.root=y.id}else{this.root=y[x?x:0].id}},toJSON:function(B){B=B||"tree";if(B=="tree"){var z={};var y=this.graph.getNode(this.root);var z=(function x(E){var C={};C.id=E.id;C.name=E.name;C.data=E.data;var D=[];E.eachSubnode(function(F){D.push(x(F))});C.children=D;return C})(y);return z}else{var z=[];var A=!!this.graph.getNode(this.root).visited;this.graph.eachNode(function(D){var C={};C.id=D.id;C.name=D.name;C.data=D.data;var E=[];D.eachAdjacency(function(F){var H=F.nodeTo;if(!!H.visited===A){var G={};G.nodeTo=H.id;G.data=F.data;E.push(G)}});C.adjacencies=E;z.push(C);D.visited=!A});return z}}};var g=$jit.Layouts={};var f={label:null,compute:function(A,B,y){this.initializeLabel(y);var x=this.label,z=x.style;A.eachNode(function(E){var I=E.getData("autoWidth"),J=E.getData("autoHeight");if(I||J){delete E.data.$width;delete E.data.$height;delete E.data.$dim;var C=E.getData("width"),K=E.getData("height");z.width=I?"auto":C+"px";z.height=J?"auto":K+"px";x.innerHTML=E.name;var G=x.offsetWidth,D=x.offsetHeight;var H=E.getData("type");if(c.indexOf(["circle","square","triangle","star"],H)===-1){E.setData("width",G);E.setData("height",D)}else{var F=G>D?G:D;E.setData("width",F);E.setData("height",F);E.setData("dim",F)}}})},initializeLabel:function(x){if(!this.label){this.label=document.createElement("div");document.body.appendChild(this.label)}this.setLabelStyles(x)},setLabelStyles:function(x){c.extend(this.label.style,{visibility:"hidden",position:"absolute",width:"auto",height:"auto"});this.label.className="jit-autoadjust-label"}};g.Tree=(function(){var G=Array.prototype.slice;function E(Q,L,I,O,J){var N=L.Node;var K=L.multitree;if(N.overridable){var P=-1,M=-1;Q.eachNode(function(T){if(T._depth==I&&(!K||("$orn" in T.data)&&T.data.$orn==O)){var R=T.getData("width",J);var S=T.getData("height",J);P=(P<R)?R:P;M=(M<S)?S:M}});return{width:P<0?N.width:P,height:M<0?N.height:M}}else{return N}}function H(J,M,L,I){var K=(I=="left"||I=="right")?"y":"x";J.getPos(M)[K]+=L}function C(J,K){var I=[];c.each(J,function(L){L=G.call(L);L[0]+=K;L[1]+=K;I.push(L)});return I}function F(L,I){if(L.length==0){return I}if(I.length==0){return L}var K=L.shift(),J=I.shift();return[[K[0],J[1]]].concat(F(L,I))}function A(I,J){J=J||[];if(I.length==0){return J}var K=I.pop();return A(I,F(K,J))}function D(L,J,M,I,K){if(L.length<=K||J.length<=K){return 0}var O=L[K][1],N=J[K][0];return Math.max(D(L,J,M,I,++K)+M,O-N+I)}function B(L,J,I){function K(O,Q,N){if(Q.length<=N){return[]}var P=Q[N],M=D(O,P,J,I,0);return[M].concat(K(F(O,C(P,M)),Q,++N))}return K([],L,0)}function y(M,L,K){function I(P,R,O){if(R.length<=O){return[]}var Q=R[O],N=-D(Q,P,L,K,0);return[N].concat(I(F(C(Q,N),P),R,++O))}M=G.call(M);var J=I([],M.reverse(),0);return J.reverse()}function x(O,M,J,P){var K=B(O,M,J),N=y(O,M,J);if(P=="left"){N=K}else{if(P=="right"){K=N}}for(var L=0,I=[];L<K.length;L++){I[L]=(K[L]+N[L])/2}return I}function z(I,S,J,Z,X){var L=Z.multitree;var R=["x","y"],O=["width","height"];var K=+(X=="left"||X=="right");var P=R[K],Y=R[1-K];var U=Z.Node;var N=O[K],W=O[1-K];var M=Z.siblingOffset;var V=Z.subtreeOffset;var T=Z.align;function Q(ac,ag,ak){var ab=ac.getData(N,J);var aj=ag||(ac.getData(W,J));var an=[],al=[],ah=false;var aa=aj+Z.levelDistance;ac.eachSubnode(function(ap){if(ap.exist&&(!L||("$orn" in ap.data)&&ap.data.$orn==X)){if(!ah){ah=E(I,Z,ap._depth,X,J)}var ao=Q(ap,ah[W],ak+aa);an.push(ao.tree);al.push(ao.extent)}});var af=x(al,V,M,T);for(var ae=0,ad=[],ai=[];ae<an.length;ae++){H(an[ae],J,af[ae],X);ai.push(C(al[ae],af[ae]))}var am=[[-ab/2,ab/2]].concat(A(ai));ac.getPos(J)[P]=0;if(X=="top"||X=="left"){ac.getPos(J)[Y]=ak}else{ac.getPos(J)[Y]=-ak}return{tree:ac,extent:am}}Q(S,false,0)}return new r({compute:function(K,J){var L=K||"start";var I=this.graph.getNode(this.root);c.extend(I,{drawn:true,exist:true,selected:true});f.compute(this.graph,L,this.config);if(!!J||!("_depth" in I)){this.graph.computeLevels(this.root,0,"ignore")}this.computePositions(I,L)},computePositions:function(M,I){var K=this.config;var J=K.multitree;var P=K.align;var L=P!=="center"&&K.indent;var Q=K.orientation;var O=J?["top","right","bottom","left"]:[Q];var N=this;c.each(O,function(R){z(N.graph,M,I,N.config,R,I);var S=["x","y"][+(R=="left"||R=="right")];(function T(U){U.eachSubnode(function(V){if(V.exist&&(!J||("$orn" in V.data)&&V.data.$orn==R)){V.getPos(I)[S]+=U.getPos(I)[S];if(L){V.getPos(I)[S]+=P=="left"?L:-L}T(V)}})})(M)})}})})();$jit.ST=(function(){var y=[];function z(E){E=E||this.clickedNode;if(!this.config.constrained){return[]}var B=this.geom;var I=this.graph;var C=this.canvas;var A=E._depth,F=[];I.eachNode(function(J){if(J.exist&&!J.selected){if(J.isDescendantOf(E.id)){if(J._depth<=A){F.push(J)}}else{F.push(J)}}});var G=B.getRightLevelToShow(E,C);E.eachLevel(G,G,function(J){if(J.exist&&!J.selected){F.push(J)}});for(var H=0;H<y.length;H++){var D=this.graph.getNode(y[H]);if(!D.isDescendantOf(E.id)){F.push(D)}}return F}function x(C){var B=[],A=this.config;C=C||this.clickedNode;this.clickedNode.eachLevel(0,A.levelsToShow,function(D){if(A.multitree&&!("$orn" in D.data)&&D.anySubnode(function(E){return E.exist&&!E.drawn})){B.push(D)}else{if(D.drawn&&!D.anySubnode("drawn")){B.push(D)}}});return B}return new r({Implements:[d,p,g.Tree],initialize:function(A){var C=$jit.ST;var B={levelsToShow:2,levelDistance:30,constrained:true,Node:{type:"rectangle"},duration:700,offsetX:0,offsetY:0};this.controller=this.config=c.merge(o("Canvas","Fx","Tree","Node","Edge","Controller","Tips","NodeStyles","Events","Navigation","Label"),B,A);var D=this.config;if(D.useCanvas){this.canvas=D.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(D.background){D.background=c.merge({type:"Circles"},D.background)}this.canvas=new m(this,D);this.config.labelContainer=(typeof D.injectInto=="string"?D.injectInto:D.injectInto.id)+"-label"}this.graphOptions={complex:true};this.graph=new e(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new C.Label[D.Label.type](this);this.fx=new C.Plot(this,C);this.op=new C.Op(this);this.group=new C.Group(this);this.geom=new C.Geom(this);this.clickedNode=null;this.initializeExtras()},plot:function(){this.fx.plot(this.controller)},switchPosition:function(F,E,D){var A=this.geom,B=this.fx,C=this;if(!B.busy){B.busy=true;this.contract({onComplete:function(){A.switchOrientation(F);C.compute("end",false);B.busy=false;if(E=="animate"){C.onClick(C.clickedNode.id,D)}else{if(E=="replot"){C.select(C.clickedNode.id,D)}}}},F)}},switchAlignment:function(C,B,A){this.config.align=C;if(B=="animate"){this.select(this.clickedNode.id,A)}else{if(B=="replot"){this.onClick(this.clickedNode.id,A)}}},addNodeInPath:function(A){y.push(A);this.select((this.clickedNode&&this.clickedNode.id)||this.root)},clearNodesInPath:function(A){y.length=0;this.select((this.clickedNode&&this.clickedNode.id)||this.root)},refresh:function(){this.reposition();this.select((this.clickedNode&&this.clickedNode.id)||this.root)},reposition:function(){this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(this.clickedNode,this.canvas);this.graph.eachNode(function(A){if(A.exist){A.drawn=true}});this.compute("end")},requestNodes:function(C,D){var B=c.merge(this.controller,D),A=this.config.levelsToShow;if(B.request){var F=[],E=C._depth;C.eachLevel(0,A,function(G){if(G.drawn&&!G.anySubnode()){F.push(G);G._level=A-(G._depth-E)}});this.group.requestNodes(F,B)}else{B.onComplete()}},contract:function(E,F){var D=this.config.orientation;var A=this.geom,C=this.group;if(F){A.switchOrientation(F)}var B=z.call(this);if(F){A.switchOrientation(D)}C.contract(B,c.merge(this.controller,E))},move:function(B,C){this.compute("end",false);var A=C.Move,D={x:A.offsetX,y:A.offsetY};if(A.enable){this.geom.translate(B.endPos.add(D).$scale(-1),"end")}this.fx.animate(c.merge(this.controller,{modes:["linear"]},C))},expand:function(B,C){var A=x.call(this,B);this.group.expand(A,c.merge(this.controller,C))},selectPath:function(D){var C=this;this.graph.eachNode(function(F){F.selected=false});function E(G){if(G==null||G.selected){return}G.selected=true;c.each(C.group.getSiblings([G])[G.id],function(H){H.exist=true;H.drawn=true});var F=G.getParents();F=(F.length>0)?F[0]:null;E(F)}for(var A=0,B=[D.id].concat(y);A<B.length;A++){E(this.graph.getNode(B[A]))}},setRoot:function(H,G,F){if(this.busy){return}this.busy=true;var E=this,C=this.canvas;var A=this.graph.getNode(this.root);var B=this.graph.getNode(H);function D(){if(this.config.multitree&&B.data.$orn){var J=B.data.$orn;var K={left:"right",right:"left",top:"bottom",bottom:"top"}[J];A.data.$orn=K;(function I(L){L.eachSubnode(function(M){if(M.id!=H){M.data.$orn=K;I(M)}})})(A);delete B.data.$orn}this.root=H;this.clickedNode=B;this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(B,C,{execHide:false,onShow:function(L){if(!L.drawn){L.drawn=true;L.setData("alpha",1,"end");L.setData("alpha",0);L.pos.setc(B.pos.x,B.pos.y)}}});this.compute("end");this.busy=true;this.fx.animate({modes:["linear","node-property:alpha"],onComplete:function(){E.busy=false;E.onClick(H,{onComplete:function(){F&&F.onComplete()}})}})}delete A.data.$orns;if(G=="animate"){D.call(this);E.selectPath(B)}else{if(G=="replot"){D.call(this);this.select(this.root)}}},addSubtree:function(A,C,B){if(C=="replot"){this.op.sum(A,c.extend({type:"replot"},B||{}))}else{if(C=="animate"){this.op.sum(A,c.extend({type:"fade:seq"},B||{}))}}},removeSubtree:function(F,B,E,D){var C=this.graph.getNode(F),A=[];C.eachLevel(+!B,false,function(G){A.push(G.id)});if(E=="replot"){this.op.removeNode(A,c.extend({type:"replot"},D||{}))}else{if(E=="animate"){this.op.removeNode(A,c.extend({type:"fade:seq"},D||{}))}}},select:function(A,D){var I=this.group,G=this.geom;var E=this.graph.getNode(A),C=this.canvas;var H=this.graph.getNode(this.root);var B=c.merge(this.controller,D);var F=this;B.onBeforeCompute(E);this.selectPath(E);this.clickedNode=E;this.requestNodes(E,{onComplete:function(){I.hide(I.prepare(z.call(F)),B);G.setRightLevelToShow(E,C);F.compute("current");F.graph.eachNode(function(L){var K=L.pos.getc(true);L.startPos.setc(K.x,K.y);L.endPos.setc(K.x,K.y);L.visited=false});var J={x:B.offsetX,y:B.offsetY};F.geom.translate(E.endPos.add(J).$scale(-1),["start","current","end"]);I.show(x.call(F));F.plot();B.onAfterCompute(F.clickedNode);B.onComplete()}})},onClick:function(B,I){var D=this.canvas,H=this,A=this.geom,E=this.config;var G={Move:{enable:true,offsetX:E.offsetX||0,offsetY:E.offsetY||0},setRightLevelToShowConfig:false,onBeforeRequest:c.empty,onBeforeContract:c.empty,onBeforeMove:c.empty,onBeforeExpand:c.empty};var C=c.merge(this.controller,G,I);if(!this.busy){this.busy=true;var F=this.graph.getNode(B);this.selectPath(F,this.clickedNode);this.clickedNode=F;C.onBeforeCompute(F);C.onBeforeRequest(F);this.requestNodes(F,{onComplete:function(){C.onBeforeContract(F);H.contract({onComplete:function(){A.setRightLevelToShow(F,D,C.setRightLevelToShowConfig);C.onBeforeMove(F);H.move(F,{Move:C.Move,onComplete:function(){C.onBeforeExpand(F);H.expand(F,{onComplete:function(){H.busy=false;C.onAfterCompute(B);C.onComplete()}})}})}})}})}}})})();$jit.ST.$extend=true;$jit.ST.Op=new r({Implements:e.Op});$jit.ST.Group=new r({initialize:function(x){this.viz=x;this.canvas=x.canvas;this.config=x.config;this.animation=new v;this.nodes=null},requestNodes:function(C,B){var A=0,y=C.length,E={};var z=function(){B.onComplete()};var x=this.viz;if(y==0){z()}for(var D=0;D<y;D++){E[C[D].id]=C[D];B.request(C[D].id,C[D]._level,{onComplete:function(G,F){if(F&&F.children){F.id=G;x.op.sum(F,{type:"nothing"})}if(++A==y){x.graph.computeLevels(x.root,0);z()}}})}},contract:function(z,y){var x=this.viz;var A=this;z=this.prepare(z);this.animation.setOptions(c.merge(y,{$animating:false,compute:function(B){if(B==1){B=0.99}A.plotStep(1-B,y,this.$animating);this.$animating="contract"},complete:function(){A.hide(z,y)}})).start()},hide:function(z,y){var x=this.viz;for(var A=0;A<z.length;A++){if(true||!y||!y.request){z[A].eachLevel(1,false,function(C){if(C.exist){c.extend(C,{drawn:false,exist:false})}})}else{var B=[];z[A].eachLevel(1,false,function(C){B.push(C.id)});x.op.removeNode(B,{type:"nothing"});x.labels.clearLabels()}}y.onComplete()},expand:function(y,x){var z=this;this.show(y);this.animation.setOptions(c.merge(x,{$animating:false,compute:function(A){z.plotStep(A,x,this.$animating);this.$animating="expand"},complete:function(){z.plotStep(undefined,x,false);x.onComplete()}})).start()},show:function(x){var y=this.config;this.prepare(x);c.each(x,function(A){if(y.multitree&&!("$orn" in A.data)){delete A.data.$orns;var z=" ";A.eachSubnode(function(B){if(("$orn" in B.data)&&z.indexOf(B.data.$orn)<0&&B.exist&&!B.drawn){z+=B.data.$orn+" "}});A.data.$orns=z}A.eachLevel(0,y.levelsToShow,function(B){if(B.exist){B.drawn=true}})})},prepare:function(x){this.nodes=this.getNodesWithChildren(x);return this.nodes},getNodesWithChildren:function(z){var y=[],B=this.config,x=this.viz.root;z.sort(function(F,E){return(F._depth<=E._depth)-(F._depth>=E._depth)});for(var C=0;C<z.length;C++){if(z[C].anySubnode("exist")){for(var A=C+1,D=false;!D&&A<z.length;A++){if(!B.multitree||"$orn" in z[A].data){D=D||z[C].isDescendantOf(z[A].id)}}if(!D){y.push(z[C])}}}return y},plotStep:function(H,D,J){var G=this.viz,A=this.config,z=G.canvas,I=z.getCtx(),x=this.nodes;var C,B;var y={};for(C=0;C<x.length;C++){B=x[C];y[B.id]=[];var F=A.multitree&&!("$orn" in B.data);var E=F&&B.data.$orns;B.eachSubgraph(function(K){if(F&&E&&E.indexOf(K.data.$orn)>0&&K.drawn){K.drawn=false;y[B.id].push(K)}else{if((!F||!E)&&K.drawn){K.drawn=false;y[B.id].push(K)}}});B.drawn=true}if(x.length>0){G.fx.plot()}for(C in y){c.each(y[C],function(K){K.drawn=true})}for(C=0;C<x.length;C++){B=x[C];I.save();G.fx.plotSubtree(B,D,H,J);I.restore()}},getSiblings:function(x){var y={};c.each(x,function(B){var A=B.getParents();if(A.length==0){y[B.id]=[B]}else{var z=[];A[0].eachSubnode(function(C){z.push(C)});y[B.id]=z}});return y}});$jit.ST.Geom=new r({Implements:e.Geom,switchOrientation:function(x){this.config.orientation=x},dispatch:function(){var y=Array.prototype.slice.call(arguments);var z=y.shift(),x=y.length;var A=function(B){return typeof B=="function"?B():B};if(x==2){return(z=="top"||z=="bottom")?A(y[0]):A(y[1])}else{if(x==4){switch(z){case"top":return A(y[0]);case"right":return A(y[1]);case"bottom":return A(y[2]);case"left":return A(y[3])}}}return undefined},getSize:function(E,D){var C=E.data,z=this.config;var y=z.siblingOffset;var B=(z.multitree&&("$orn" in C)&&C.$orn)||z.orientation;var x=E.getData("width")+y;var A=E.getData("height")+y;if(!D){return this.dispatch(B,A,x)}else{return this.dispatch(B,x,A)}},getTreeBaseSize:function(B,C,y){var z=this.getSize(B,true),x=0,A=this;if(y(C,B)){return z}if(C===0){return 0}B.eachSubnode(function(D){x+=A.getTreeBaseSize(D,C-1,y)});return(z>x?z:x)+this.config.subtreeOffset},getEdge:function(C,B,A){var y=function(F,E){return function(){return C.pos.add(new q(F,E))}};var D=this.node;var x=C.getData("width");var z=C.getData("height");if(B=="begin"){if(D.align=="center"){return this.dispatch(A,y(0,z/2),y(-x/2,0),y(0,-z/2),y(x/2,0))}else{if(D.align=="left"){return this.dispatch(A,y(0,z),y(0,0),y(0,0),y(x,0))}else{if(D.align=="right"){return this.dispatch(A,y(0,0),y(-x,0),y(0,-z),y(0,0))}else{throw"align: not implemented"}}}}else{if(B=="end"){if(D.align=="center"){return this.dispatch(A,y(0,-z/2),y(x/2,0),y(0,z/2),y(-x/2,0))}else{if(D.align=="left"){return this.dispatch(A,y(0,0),y(x,0),y(0,z),y(0,0))}else{if(D.align=="right"){return this.dispatch(A,y(0,-z),y(0,0),y(0,0),y(-x,0))}else{throw"align: not implemented"}}}}}},getScaledTreePosition:function(B,D){var C=this.node;var x=B.getData("width");var A=B.getData("height");var z=(this.config.multitree&&("$orn" in B.data)&&B.data.$orn)||this.config.orientation;var y=function(F,E){return function(){return B.pos.add(new q(F,E)).$scale(1-D)}};if(C.align=="left"){return this.dispatch(z,y(0,A),y(0,0),y(0,0),y(x,0))}else{if(C.align=="center"){return this.dispatch(z,y(0,A/2),y(-x/2,0),y(0,-A/2),y(x/2,0))}else{if(C.align=="right"){return this.dispatch(z,y(0,0),y(-x,0),y(0,-A),y(0,0))}else{throw"align: not implemented"}}}},treeFitsInCanvas:function(C,x,D){var z=x.getSize();var A=(this.config.multitree&&("$orn" in C.data)&&C.data.$orn)||this.config.orientation;var y=this.dispatch(A,z.width,z.height);var B=this.getTreeBaseSize(C,D,function(F,E){return F===0||!E.anySubnode()});return(B<y)}});$jit.ST.Plot=new r({Implements:e.Plot,plotSubtree:function(A,x,B,F){var D=this.viz,y=D.canvas,z=D.config;B=Math.min(Math.max(0.001,B),1);if(B>=0){A.drawn=false;var E=y.getCtx();var C=D.geom.getScaledTreePosition(A,B);E.translate(C.x,C.y);E.scale(B,B)}this.plotTree(A,c.merge(x,{withLabels:true,hideLabels:!!B,plotSubtree:function(J,H){var G=z.multitree&&!("$orn" in A.data);var I=G&&A.getData("orns");return !G||I.indexOf(elem.getData("orn"))>-1}}),F);if(B>=0){A.drawn=true}},getAlignedPos:function(C,A,x){var z=this.node;var B,y;if(z.align=="center"){B={x:C.x-A/2,y:C.y-x/2}}else{if(z.align=="left"){y=this.config.orientation;if(y=="bottom"||y=="top"){B={x:C.x-A/2,y:C.y}}else{B={x:C.x,y:C.y-x/2}}}else{if(z.align=="right"){y=this.config.orientation;if(y=="bottom"||y=="top"){B={x:C.x-A/2,y:C.y-x}}else{B={x:C.x-A,y:C.y-x/2}}}else{throw"align: not implemented"}}}return B},getOrientation:function(x){var z=this.config;var y=z.orientation;if(z.multitree){var A=x.nodeFrom;var B=x.nodeTo;y=(("$orn" in A.data)&&A.data.$orn)||(("$orn" in B.data)&&B.data.$orn)}return y}});$jit.ST.Label={};$jit.ST.Label.Native=new r({Implements:e.Label.Native,renderLabel:function(z,A,y){var x=z.getCtx();var B=A.pos.getc(true);x.fillText(A.name,B.x,B.y)}});$jit.ST.Label.DOM=new r({Implements:e.Label.DOM,placeLabel:function(P,J,F){var B=J.pos.getc(true),O=this.viz.config,K=O.Node,x=this.viz.canvas,C=J.getData("width"),M=J.getData("height"),y=x.getSize(),G,N;var A=x.translateOffsetX,z=x.translateOffsetY,E=x.scaleOffsetX,D=x.scaleOffsetY,I=B.x*E+A,H=B.y*D+z;if(K.align=="center"){G={x:Math.round(I-C/2+y.width/2),y:Math.round(H-M/2+y.height/2)}}else{if(K.align=="left"){N=O.orientation;if(N=="bottom"||N=="top"){G={x:Math.round(I-C/2+y.width/2),y:Math.round(H+y.height/2)}}else{G={x:Math.round(I+y.width/2),y:Math.round(H-M/2+y.height/2)}}}else{if(K.align=="right"){N=O.orientation;if(N=="bottom"||N=="top"){G={x:Math.round(I-C/2+y.width/2),y:Math.round(H-M+y.height/2)}}else{G={x:Math.round(I-C+y.width/2),y:Math.round(H-M/2+y.height/2)}}}else{throw"align: not implemented"}}}var L=P.style;L.left=G.x+"px";L.top=G.y+"px";L.display=this.fitsInCanvas(G,x)?"":"none";F.onPlaceLabel(P,J)}});$jit.ST.Label.SVG=new r({Implements:[$jit.ST.Label.DOM,e.Label.SVG],initialize:function(x){this.viz=x}});$jit.ST.Label.HTML=new r({Implements:[$jit.ST.Label.DOM,e.Label.HTML],initialize:function(x){this.viz=x}});$jit.ST.Plot.NodeTypes=new r({none:{render:c.empty,contains:c.lambda(false)},circle:{render:function(y,x){var A=y.getData("dim"),B=this.getAlignedPos(y.pos.getc(true),A,A),z=A/2;this.nodeHelper.circle.render("fill",{x:B.x+z,y:B.y+z},z,x)},contains:function(x,B){var z=x.getData("dim"),A=this.getAlignedPos(x.pos.getc(true),z,z),y=z/2;this.nodeHelper.circle.contains({x:A.x+y,y:A.y+y},y)}},square:{render:function(y,x){var A=y.getData("dim"),z=A/2,B=this.getAlignedPos(y.pos.getc(true),A,A);this.nodeHelper.square.render("fill",{x:B.x+z,y:B.y+z},z,x)},contains:function(x,B){var z=x.getData("dim"),A=this.getAlignedPos(x.pos.getc(true),z,z),y=z/2;this.nodeHelper.square.contains({x:A.x+y,y:A.y+y},y)}},ellipse:{render:function(A,y){var z=A.getData("width"),x=A.getData("height"),B=this.getAlignedPos(A.pos.getc(true),z,x);this.nodeHelper.ellipse.render("fill",{x:B.x+z/2,y:B.y+x/2},z,x,y)},contains:function(z,B){var y=z.getData("width"),x=z.getData("height"),A=this.getAlignedPos(z.pos.getc(true),y,x);this.nodeHelper.ellipse.contains({x:A.x+y/2,y:A.y+x/2},y,x,canvas)}},rectangle:{render:function(A,y){var z=A.getData("width"),x=A.getData("height"),B=this.getAlignedPos(A.pos.getc(true),z,x);this.nodeHelper.rectangle.render("fill",{x:B.x+z/2,y:B.y+x/2},z,x,y)},contains:function(z,B){var y=z.getData("width"),x=z.getData("height"),A=this.getAlignedPos(z.pos.getc(true),y,x);this.nodeHelper.rectangle.contains({x:A.x+y/2,y:A.y+x/2},y,x,canvas)}}});$jit.ST.Plot.EdgeTypes=new r({none:c.empty,line:{render:function(y,A){var z=this.getOrientation(y),B=y.nodeFrom,C=y.nodeTo,x=B._depth<C._depth,E=this.viz.geom.getEdge(x?B:C,"begin",z),D=this.viz.geom.getEdge(x?C:B,"end",z);this.edgeHelper.line.render(E,D,A)},contains:function(y,E){var z=this.getOrientation(y),A=y.nodeFrom,B=y.nodeTo,x=A._depth<B._depth,D=this.viz.geom.getEdge(x?A:B,"begin",z),C=this.viz.geom.getEdge(x?B:A,"end",z);return this.edgeHelper.line.contains(D,C,E,this.edge.epsilon)}},arrow:{render:function(D,y){var C=this.getOrientation(D),z=D.nodeFrom,x=D.nodeTo,B=D.getData("dim"),F=this.viz.geom.getEdge(z,"begin",C),G=this.viz.geom.getEdge(x,"end",C),E=D.data.$direction,A=(E&&E.length>1&&E[0]!=z.id);this.edgeHelper.arrow.render(F,G,B,A,y)},contains:function(y,E){var z=this.getOrientation(y),A=y.nodeFrom,B=y.nodeTo,x=A._depth<B._depth,D=this.viz.geom.getEdge(x?A:B,"begin",z),C=this.viz.geom.getEdge(x?B:A,"end",z);return this.edgeHelper.arrow.contains(D,C,E,this.edge.epsilon)}},"quadratic:begin":{render:function(D,x){var C=this.getOrientation(D);var B=D.nodeFrom,E=D.nodeTo,G=B._depth<E._depth,y=this.viz.geom.getEdge(G?B:E,"begin",C),z=this.viz.geom.getEdge(G?E:B,"end",C),A=D.getData("dim"),F=x.getCtx();F.beginPath();F.moveTo(y.x,y.y);switch(C){case"left":F.quadraticCurveTo(y.x+A,y.y,z.x,z.y);break;case"right":F.quadraticCurveTo(y.x-A,y.y,z.x,z.y);break;case"top":F.quadraticCurveTo(y.x,y.y+A,z.x,z.y);break;case"bottom":F.quadraticCurveTo(y.x,y.y-A,z.x,z.y);break}F.stroke()}},"quadratic:end":{render:function(D,x){var C=this.getOrientation(D);var B=D.nodeFrom,E=D.nodeTo,G=B._depth<E._depth,y=this.viz.geom.getEdge(G?B:E,"begin",C),z=this.viz.geom.getEdge(G?E:B,"end",C),A=D.getData("dim"),F=x.getCtx();F.beginPath();F.moveTo(y.x,y.y);switch(C){case"left":F.quadraticCurveTo(z.x-A,z.y,z.x,z.y);break;case"right":F.quadraticCurveTo(z.x+A,z.y,z.x,z.y);break;case"top":F.quadraticCurveTo(z.x,z.y-A,z.x,z.y);break;case"bottom":F.quadraticCurveTo(z.x,z.y+A,z.x,z.y);break}F.stroke()}},bezier:{render:function(D,x){var C=this.getOrientation(D),B=D.nodeFrom,E=D.nodeTo,G=B._depth<E._depth,y=this.viz.geom.getEdge(G?B:E,"begin",C),z=this.viz.geom.getEdge(G?E:B,"end",C),A=D.getData("dim"),F=x.getCtx();F.beginPath();F.moveTo(y.x,y.y);switch(C){case"left":F.bezierCurveTo(y.x+A,y.y,z.x-A,z.y,z.x,z.y);break;case"right":F.bezierCurveTo(y.x-A,y.y,z.x+A,z.y,z.x,z.y);break;case"top":F.bezierCurveTo(y.x,y.y+A,z.x,z.y-A,z.x,z.y);break;case"bottom":F.bezierCurveTo(y.x,y.y-A,z.x,z.y+A,z.x,z.y);break}F.stroke()}}});$jit.ST.Plot.NodeTypes.implement({"areachart-stacked":{render:function(W,E){var U=W.pos.getc(true),z=W.getData("width"),B=W.getData("height"),H=this.getAlignedPos(U,z,B),ab=H.x,aa=H.y,M=W.getData("stringArray"),G=W.getData("dimArray"),C=W.getData("valueArray"),ad=c.reduce(C,function(aj,ak){return aj+ak[0]},0),ac=c.reduce(C,function(aj,ak){return aj+ak[1]},0),J=W.getData("colorArray"),D=J.length,Y=W.getData("config"),K=W.getData("gradient"),ai=Y.showLabels,O=Y.showAggregates,ae=Y.Label,T=W.getData("prev");var N=E.getCtx(),I=W.getData("border");if(J&&G&&M){for(var ah=0,af=G.length,L=0,F=0,X=0;ah<af;ah++){N.fillStyle=N.strokeStyle=J[ah%D];N.save();if(K&&(G[ah][0]>0||G[ah][1]>0)){var R=L+G[ah][0],P=F+G[ah][1],ag=Math.atan((P-R)/z),Z=55;var V=N.createLinearGradient(ab+z/2,aa-(R+P)/2,ab+z/2+Z*Math.sin(ag),aa-(R+P)/2+Z*Math.cos(ag));var Q=c.rgbToHex(c.map(c.hexToRgb(J[ah%D].slice(1)),function(x){return(x*0.85)>>0}));V.addColorStop(0,J[ah%D]);V.addColorStop(1,Q);N.fillStyle=V}N.beginPath();N.moveTo(ab,aa-L);N.lineTo(ab+z,aa-F);N.lineTo(ab+z,aa-F-G[ah][1]);N.lineTo(ab,aa-L-G[ah][0]);N.lineTo(ab,aa-L);N.fill();N.restore();if(I){var S=I.name==M[ah];var A=S?0.7:0.8;var Q=c.rgbToHex(c.map(c.hexToRgb(J[ah%D].slice(1)),function(x){return(x*A)>>0}));N.strokeStyle=Q;N.lineWidth=S?4:1;N.save();N.beginPath();if(I.index===0){N.moveTo(ab,aa-L);N.lineTo(ab,aa-L-G[ah][0])}else{N.moveTo(ab+z,aa-F);N.lineTo(ab+z,aa-F-G[ah][1])}N.stroke();N.restore()}L+=(G[ah][0]||0);F+=(G[ah][1]||0);if(G[ah][0]>0){X+=(C[ah][0]||0)}}if(T&&ae.type=="Native"){N.save();N.beginPath();N.fillStyle=N.strokeStyle=ae.color;N.font=ae.style+" "+ae.size+"px "+ae.family;N.textAlign="center";N.textBaseline="middle";if(O(W.name,ad,ac,W)){N.fillText(X,ab,aa-L-Y.labelOffset-ae.size/2,z)}if(ai(W.name,ad,ac,W)){N.fillText(W.name,ab,aa+ae.size/2+Y.labelOffset)}N.restore()}}},contains:function(D,F){var K=D.pos.getc(true),A=D.getData("width"),O=D.getData("height"),N=this.getAlignedPos(K,A,O),M=N.x,L=N.y,P=D.getData("dimArray"),z=F.x-M;if(F.x<M||F.x>M+A||F.y>L||F.y<L-O){return false}for(var G=0,E=P.length,J=L,B=L;G<E;G++){var C=P[G];J-=C[0];B-=C[1];var H=J+(B-J)*z/A;if(F.y>=H){var I=+(z>A/2);return{name:D.getData("stringArray")[G],color:D.getData("colorArray")[G],value:D.getData("valueArray")[G][I],index:I}}}return false}}});$jit.AreaChart=new r({st:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(z){this.controller=this.config=c.merge(o("Canvas","Margin","Label","AreaChart"),{Label:{type:"Native"}},z);var A=this.config.showLabels,y=c.type(A),B=this.config.showAggregates,x=c.type(B);this.config.showLabels=y=="function"?A:c.lambda(A);this.config.showAggregates=x=="function"?B:c.lambda(B);this.initializeViz()},initializeViz:function(){var z=this.config,C=this,x=z.type.split(":")[0],B={};var y=new $jit.ST({injectInto:z.injectInto,orientation:"bottom",levelDistance:0,siblingOffset:0,subtreeOffset:0,withLabels:z.Label.type!="Native",useCanvas:z.useCanvas,Label:{type:z.Label.type},Node:{overridable:true,type:"areachart-"+x,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:z.Tips.enable,type:"Native",force:true,onShow:function(H,G,E){var F=E;z.Tips.onShow(H,F,G)}},Events:{enable:true,type:"Native",onClick:function(G,H,E){if(!z.filterOnClick&&!z.Events.enable){return}var F=H.getContains();if(F){z.filterOnClick&&C.filter(F.name)}z.Events.enable&&z.Events.onClick(F,H,E)},onRightClick:function(F,G,E){if(!z.restoreOnRightClick){return}C.restore()},onMouseMove:function(G,H,E){if(!z.selectOnHover){return}if(G){var F=H.getContains();C.select(G.id,F.name,F.index)}else{C.select(false,false,false)}}},onCreateLabel:function(K,H){var Q=z.Label,P=H.getData("valueArray"),I=c.reduce(P,function(R,S){return R+S[0]},0),N=c.reduce(P,function(R,S){return R+S[1]},0);if(H.getData("prev")){var M={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")};var E=M.wrapper,O=M.label,F=M.aggregate,G=E.style,L=O.style,J=F.style;B[H.id]=M;E.appendChild(O);E.appendChild(F);if(!z.showLabels(H.name,I,N,H)){O.style.display="none"}if(!z.showAggregates(H.name,I,N,H)){F.style.display="none"}G.position="relative";G.overflow="visible";G.fontSize=Q.size+"px";G.fontFamily=Q.family;G.color=Q.color;G.textAlign="center";J.position=L.position="absolute";K.style.width=H.getData("width")+"px";K.style.height=H.getData("height")+"px";O.innerHTML=H.name;K.appendChild(E)}},onPlaceLabel:function(V,P){if(!P.getData("prev")){return}var T=B[P.id],F=T.wrapper.style,E=T.label.style,O=T.aggregate.style,M=P.getData("width"),K=P.getData("height"),J=P.getData("dimArray"),G=P.getData("valueArray"),L=c.reduce(G,function(W,X){return W+X[0]},0),H=c.reduce(G,function(W,X){return W+X[1]},0),I=parseInt(F.fontSize,10),N=V.style;if(J&&G){if(z.showLabels(P.name,L,H,P)){E.display=""}else{E.display="none"}if(z.showAggregates(P.name,L,H,P)){O.display=""}else{O.display="none"}F.width=O.width=E.width=V.style.width=M+"px";O.left=E.left=-M/2+"px";for(var S=0,Q=G.length,R=0,U=0;S<Q;S++){if(J[S][0]>0){R+=G[S][0];U+=J[S][0]}}O.top=(-I-z.labelOffset)+"px";E.top=(z.labelOffset+U)+"px";V.style.top=parseInt(V.style.top,10)-U+"px";V.style.height=F.height=U+"px";T.aggregate.innerHTML=R}}});var A=y.canvas.getSize(),D=z.Margin;y.config.offsetY=-A.height/2+D.bottom+(z.showLabels&&(z.labelOffset+z.Label.size));y.config.offsetX=(D.right-D.left)/2;this.st=y;this.canvas=this.st.canvas},loadJSON:function(O){var L=c.time(),C=[],H=this.st,R=c.splat(O.label),K=c.splat(O.color||this.colors),P=this.config,y=!!P.type.split(":")[1],A=P.animate;for(var M=0,z=O.values,J=z.length;M<J-1;M++){var Q=z[M],F=z[M-1],G=z[M+1];var N=c.splat(z[M].values),x=c.splat(z[M+1].values);var B=c.zip(N,x);var E=0,D=0;C.push({id:L+Q.label,name:Q.label,data:{value:B,"$valueArray":B,"$colorArray":K,"$stringArray":R,"$next":G.label,"$prev":F?F.label:false,"$config":P,"$gradient":y},children:[]})}var I={id:L+"$root",name:"",data:{"$type":"none","$width":1,"$height":1},children:C};H.loadJSON(I);this.normalizeDims();H.compute();H.select(H.root);if(A){H.fx.animate({modes:["node-property:height:dimArray"],duration:4000})}},updateJSON:function(E,y,B){if(this.busy){return}this.busy=true;if(B==null){B=2000}var F=this.st,D=F.graph,z=E.label&&c.splat(E.label),C=E.values,x=this.config.animate,A=this;c.each(C,function(H){var N=D.getByName(H.label);if(N){H.values=c.splat(H.values);var I=N.getData("stringArray"),M=N.getData("valueArray");c.each(M,function(O,P){O[0]=H.values[P];if(z){I[P]=z[P]}});N.setData("valueArray",M);N.setData("colorArray",E.colors);var K=N.getData("prev"),J=N.getData("next"),G=D.getByName(J);if(K){var L=D.getByName(K);if(L){var M=L.getData("valueArray");c.each(M,function(O,P){O[1]=H.values[P]})}}if(!G){var M=N.getData("valueArray");c.each(M,function(O,P){O[1]=H.values[P]})}}});this.normalizeDims();F.compute();F.select(F.root);if(x){F.fx.animate({modes:["node-property:height:dimArray"],duration:B,transition:$jit.Trans.Quart.easeIn,onComplete:function(){A.busy=false;y&&y.onComplete()}})}},filter:function(){if(this.busy){return}this.busy=true;if(this.config.Tips.enable){this.st.tips.hide()}this.select(false,false,false);var y=Array.prototype.slice.call(arguments);var x=this.st.graph.getNode(this.st.root);var z=this;x.eachAdjacency(function(A){var D=A.nodeTo,C=D.getData("dimArray"),B=D.getData("stringArray");D.setData("dimArray",c.map(C,function(F,E){return(c.indexOf(y,B[E])>-1)?F:[0,0]}),"end")});this.st.fx.animate({modes:["node-property:dimArray"],duration:1500,onComplete:function(){z.busy=false}})},restore:function(){if(this.busy){return}this.busy=true;if(this.config.Tips.enable){this.st.tips.hide()}this.select(false,false,false);this.normalizeDims();var x=this;this.st.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){x.busy=false}})},select:function(C,y,x){if(!this.config.selectOnHover){return}var z=this.selected;if(z.id!=C||z.name!=y||z.index!=x){z.id=C;z.name=y;z.index=x;this.st.graph.eachNode(function(D){D.setData("border",false)});if(C){var B=this.st.graph.getNode(C);B.setData("border",z);var A=x===0?"prev":"next";A=B.getData(A);if(A){B=this.st.graph.getByName(A);if(B){B.setData("border",{name:y,index:1-x})}}}this.st.plot()}},getLegend:function(){var z={};var A;this.st.graph.getNode(this.st.root).eachAdjacency(function(B){A=B.nodeTo});var y=A.getData("colorArray"),x=y.length;c.each(A.getData("stringArray"),function(C,B){z[C]=y[B%x]});return z},getMaxValue:function(){var x=0;this.st.graph.eachNode(function(C){var z=C.getData("valueArray"),y=0,B=0;c.each(z,function(D){y+=+D[0];B+=+D[1]});var A=B>y?B:y;x=x>A?x:A});return x},normalizeDims:function(){var D=this.st.graph.getNode(this.st.root),A=0;D.eachAdjacency(function(){A++});var C=this.getMaxValue()||1,G=this.st.canvas.getSize(),z=this.config,B=z.Margin,E=z.labelOffset+z.Label.size,x=(G.width-(B.left+B.right))/A,y=z.animate,F=G.height-(B.top+B.bottom)-(z.showAggregates&&E)-(z.showLabels&&E);this.st.graph.eachNode(function(M){var J=0,L=0,H=[];c.each(M.getData("valueArray"),function(N){J+=+N[0];L+=+N[1];H.push([0,0])});var K=L>J?L:J;M.setData("width",x);if(y){M.setData("height",K*F/C,"end");M.setData("dimArray",c.map(M.getData("valueArray"),function(N){return[N[0]*F/C,N[1]*F/C]}),"end");var I=M.getData("dimArray");if(!I){M.setData("dimArray",H)}}else{M.setData("height",K*F/C);M.setData("dimArray",c.map(M.getData("valueArray"),function(N){return[N[0]*F/C,N[1]*F/C]}))}})}});o.BarChart={$extend:true,animate:true,type:"stacked",labelOffset:3,barsOffset:0,hoveredColor:"#9fd4ff",orientation:"horizontal",showAggregates:true,showLabels:true,Tips:{enable:false,onShow:c.empty,onHide:c.empty},Events:{enable:false,onClick:c.empty}};$jit.ST.Plot.NodeTypes.implement({"barchart-stacked":{render:function(R,D){var I=R.pos.getc(true),Q=R.getData("width"),O=R.getData("height"),M=this.getAlignedPos(I,Q,O),L=M.x,K=M.y,N=R.getData("dimArray"),G=R.getData("valueArray"),F=R.getData("colorArray"),C=F.length,Y=R.getData("stringArray");var T=D.getCtx(),z={},U=R.getData("border"),A=R.getData("gradient"),aa=R.getData("config"),B=aa.orientation=="horizontal",E=aa.showAggregates,P=aa.showLabels,J=aa.Label;if(F&&N&&Y){for(var X=0,S=N.length,W=0,H=0;X<S;X++){T.fillStyle=T.strokeStyle=F[X%C];if(A){var Z;if(B){Z=T.createLinearGradient(L+W+N[X]/2,K,L+W+N[X]/2,K+O)}else{Z=T.createLinearGradient(L,K-W-N[X]/2,L+Q,K-W-N[X]/2)}var V=c.rgbToHex(c.map(c.hexToRgb(F[X%C].slice(1)),function(x){return(x*0.5)>>0}));Z.addColorStop(0,V);Z.addColorStop(0.5,F[X%C]);Z.addColorStop(1,V);T.fillStyle=Z}if(B){T.fillRect(L+W,K,N[X],O)}else{T.fillRect(L,K-W-N[X],Q,N[X])}if(U&&U.name==Y[X]){z.acum=W;z.dimValue=N[X]}W+=(N[X]||0);H+=(G[X]||0)}if(U){T.save();T.lineWidth=2;T.strokeStyle=U.color;if(B){T.strokeRect(L+z.acum+1,K+1,z.dimValue-2,O-2)}else{T.strokeRect(L+1,K-z.acum-z.dimValue+1,Q-2,z.dimValue-2)}T.restore()}if(J.type=="Native"){T.save();T.fillStyle=T.strokeStyle=J.color;T.font=J.style+" "+J.size+"px "+J.family;T.textBaseline="middle";if(E(R.name,H)){if(B){T.textAlign="right";T.fillText(H,L+W-aa.labelOffset,K+O/2)}else{T.textAlign="center";T.fillText(H,L+Q/2,K-O-J.size/2-aa.labelOffset)}}if(P(R.name,H,R)){if(B){T.textAlign="center";T.translate(L-aa.labelOffset-J.size/2,K+O/2);T.rotate(Math.PI/2);T.fillText(R.name,0,0)}else{T.textAlign="center";T.fillText(R.name,L+Q/2,K+J.size/2+aa.labelOffset)}}T.restore()}}},contains:function(E,G){var J=E.pos.getc(true),B=E.getData("width"),O=E.getData("height"),N=this.getAlignedPos(J,B,O),M=N.x,K=N.y,P=E.getData("dimArray"),C=E.getData("config"),A=G.x-M,z=C.orientation=="horizontal";if(z){if(G.x<M||G.x>M+B||G.y>K+O||G.y<K){return false}}else{if(G.x<M||G.x>M+B||G.y>K||G.y<K-O){return false}}for(var H=0,F=P.length,L=(z?M:K);H<F;H++){var D=P[H];if(z){L+=D;var I=L;if(G.x<=I){return{name:E.getData("stringArray")[H],color:E.getData("colorArray")[H],value:E.getData("valueArray")[H],label:E.name}}}else{L-=D;var I=L;if(G.y>=I){return{name:E.getData("stringArray")[H],color:E.getData("colorArray")[H],value:E.getData("valueArray")[H],label:E.name}}}}return false}},"barchart-grouped":{render:function(S,D){var J=S.pos.getc(true),R=S.getData("width"),P=S.getData("height"),N=this.getAlignedPos(J,R,P),M=N.x,L=N.y,O=S.getData("dimArray"),H=S.getData("valueArray"),Y=H.length,G=S.getData("colorArray"),C=G.length,aa=S.getData("stringArray");var U=D.getCtx(),z={},V=S.getData("border"),A=S.getData("gradient"),ac=S.getData("config"),B=ac.orientation=="horizontal",F=ac.showAggregates,Q=ac.showLabels,K=ac.Label,E=(B?P:R)/Y;if(G&&O&&aa){for(var Z=0,T=Y,X=0,I=0;Z<T;Z++){U.fillStyle=U.strokeStyle=G[Z%C];if(A){var ab;if(B){ab=U.createLinearGradient(M+O[Z]/2,L+E*Z,M+O[Z]/2,L+E*(Z+1))}else{ab=U.createLinearGradient(M+E*Z,L-O[Z]/2,M+E*(Z+1),L-O[Z]/2)}var W=c.rgbToHex(c.map(c.hexToRgb(G[Z%C].slice(1)),function(x){return(x*0.5)>>0}));ab.addColorStop(0,W);ab.addColorStop(0.5,G[Z%C]);ab.addColorStop(1,W);U.fillStyle=ab}if(B){U.fillRect(M,L+E*Z,O[Z],E)}else{U.fillRect(M+E*Z,L-O[Z],E,O[Z])}if(V&&V.name==aa[Z]){z.acum=E*Z;z.dimValue=O[Z]}X+=(O[Z]||0);I+=(H[Z]||0)}if(V){U.save();U.lineWidth=2;U.strokeStyle=V.color;if(B){U.strokeRect(M+1,L+z.acum+1,z.dimValue-2,E-2)}else{U.strokeRect(M+z.acum+1,L-z.dimValue+1,E-2,z.dimValue-2)}U.restore()}if(K.type=="Native"){U.save();U.fillStyle=U.strokeStyle=K.color;U.font=K.style+" "+K.size+"px "+K.family;U.textBaseline="middle";if(F(S.name,I)){if(B){U.textAlign="right";U.fillText(I,M+Math.max.apply(null,O)-ac.labelOffset,L+P/2)}else{U.textAlign="center";U.fillText(I,M+R/2,L-Math.max.apply(null,O)-K.size/2-ac.labelOffset)}}if(Q(S.name,I,S)){if(B){U.textAlign="center";U.translate(M-ac.labelOffset-K.size/2,L+P/2);U.rotate(Math.PI/2);U.fillText(S.name,0,0)}else{U.textAlign="center";U.fillText(S.name,M+R/2,L+K.size/2+ac.labelOffset)}}U.restore()}}},contains:function(K,G){var C=K.pos.getc(true),J=K.getData("width"),I=K.getData("height"),F=this.getAlignedPos(C,J,I),E=F.x,D=F.y,H=K.getData("dimArray"),N=H.length,Q=K.getData("config"),B=G.x-E,z=Q.orientation=="horizontal",A=(z?I:J)/N;if(z){if(G.x<E||G.x>E+J||G.y>D+I||G.y<D){return false}}else{if(G.x<E||G.x>E+J||G.y>D||G.y<D-I){return false}}for(var M=0,L=H.length;M<L;M++){var P=H[M];if(z){var O=D+A*M;if(G.x<=E+P&&G.y>=O&&G.y<=O+A){return{name:K.getData("stringArray")[M],color:K.getData("colorArray")[M],value:K.getData("valueArray")[M],label:K.name}}}else{var O=E+A*M;if(G.x>=O&&G.x<=O+A&&G.y>=D-P){return{name:K.getData("stringArray")[M],color:K.getData("colorArray")[M],value:K.getData("valueArray")[M],label:K.name}}}}return false}}});$jit.BarChart=new r({st:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(z){this.controller=this.config=c.merge(o("Canvas","Margin","Label","BarChart"),{Label:{type:"Native"}},z);var A=this.config.showLabels,y=c.type(A),B=this.config.showAggregates,x=c.type(B);this.config.showLabels=y=="function"?A:c.lambda(A);this.config.showAggregates=x=="function"?B:c.lambda(B);this.initializeViz()},initializeViz:function(){var z=this.config,C=this;var x=z.type.split(":")[0],E=z.orientation=="horizontal",B={};var y=new $jit.ST({injectInto:z.injectInto,orientation:E?"left":"bottom",levelDistance:0,siblingOffset:z.barsOffset,subtreeOffset:0,withLabels:z.Label.type!="Native",useCanvas:z.useCanvas,Label:{type:z.Label.type},Node:{overridable:true,type:"barchart-"+x,align:"left",width:1,height:1},Edge:{type:"none"},Tips:{enable:z.Tips.enable,type:"Native",force:true,onShow:function(I,H,F){var G=F;z.Tips.onShow(I,G,H)}},Events:{enable:true,type:"Native",onClick:function(H,I,F){if(!z.Events.enable){return}var G=I.getContains();z.Events.onClick(G,I,F)},onMouseMove:function(H,I,F){if(!z.hoveredColor){return}if(H){var G=I.getContains();C.select(H.id,G.name,G.index)}else{C.select(false,false,false)}}},onCreateLabel:function(K,I){var Q=z.Label,O=I.getData("valueArray"),N=c.reduce(O,function(R,S){return R+S},0);var M={wrapper:document.createElement("div"),aggregate:document.createElement("div"),label:document.createElement("div")};var F=M.wrapper,P=M.label,G=M.aggregate,H=F.style,L=P.style,J=G.style;B[I.id]=M;F.appendChild(P);F.appendChild(G);if(!z.showLabels(I.name,N,I)){L.display="none"}if(!z.showAggregates(I.name,N,I)){J.display="none"}H.position="relative";H.overflow="visible";H.fontSize=Q.size+"px";H.fontFamily=Q.family;H.color=Q.color;H.textAlign="center";J.position=L.position="absolute";K.style.width=I.getData("width")+"px";K.style.height=I.getData("height")+"px";J.left=L.left="0px";P.innerHTML=I.name;K.appendChild(F)},onPlaceLabel:function(M,I){if(!B[I.id]){return}var O=B[I.id],J=O.wrapper.style,Q=O.label.style,N=O.aggregate.style,R=z.type.split(":")[0]=="grouped",F=z.orientation=="horizontal",U=I.getData("dimArray"),V=I.getData("valueArray"),G=(R&&F)?Math.max.apply(null,U):I.getData("width"),T=(R&&!F)?Math.max.apply(null,U):I.getData("height"),H=parseInt(J.fontSize,10),P=M.style;if(U&&V){J.width=N.width=Q.width=M.style.width=G+"px";for(var L=0,K=V.length,S=0;L<K;L++){if(U[L]>0){S+=V[L]}}if(z.showLabels(I.name,S,I)){Q.display=""}else{Q.display="none"}if(z.showAggregates(I.name,S,I)){N.display=""}else{N.display="none"}if(z.orientation=="horizontal"){N.textAlign="right";Q.textAlign="left";Q.textIndex=N.textIndent=z.labelOffset+"px";N.top=Q.top=(T-H)/2+"px";M.style.height=J.height=T+"px"}else{N.top=(-H-z.labelOffset)+"px";Q.top=(z.labelOffset+T)+"px";M.style.top=parseInt(M.style.top,10)-T+"px";M.style.height=J.height=T+"px"}O.aggregate.innerHTML=S}}});var A=y.canvas.getSize(),D=z.Margin;if(E){y.config.offsetX=A.width/2-D.left-(z.showLabels&&(z.labelOffset+z.Label.size));y.config.offsetY=(D.bottom-D.top)/2}else{y.config.offsetY=-A.height/2+D.bottom+(z.showLabels&&(z.labelOffset+z.Label.size));y.config.offsetX=(D.right-D.left)/2}this.st=y;this.canvas=this.st.canvas},loadJSON:function(L){if(this.busy){return}this.busy=true;var J=c.time(),D=[],E=this.st,O=c.splat(L.label),I=c.splat(L.color||this.colors),M=this.config,x=!!M.type.split(":")[1],A=M.animate,z=M.orientation=="horizontal",B=this;for(var K=0,y=L.values,G=y.length;K<G;K++){var N=y[K];var C=c.splat(y[K].values);var H=0;D.push({id:J+N.label,name:N.label,data:{value:C,"$valueArray":C,"$colorArray":I,"$stringArray":O,"$gradient":x,"$config":M},children:[]})}var F={id:J+"$root",name:"",data:{"$type":"none","$width":1,"$height":1},children:D};E.loadJSON(F);this.normalizeDims();E.compute();E.select(E.root);if(A){if(z){E.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){B.busy=false}})}else{E.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){B.busy=false}})}}else{this.busy=false}},updateJSON:function(A,D){if(this.busy){return}this.busy=true;var z=this.st;var C=z.graph;var y=A.values;var x=this.config.animate;var B=this;var E=this.config.orientation=="horizontal";c.each(y,function(F){var G=C.getByName(F.label);if(G){G.setData("valueArray",c.splat(F.values));if(A.label){G.setData("stringArray",c.splat(A.label))}}});this.normalizeDims();z.compute();z.select(z.root);if(x){if(E){z.fx.animate({modes:["node-property:width:dimArray"],duration:1500,onComplete:function(){B.busy=false;D&&D.onComplete()}})}else{z.fx.animate({modes:["node-property:height:dimArray"],duration:1500,onComplete:function(){B.busy=false;D&&D.onComplete()}})}}},select:function(z,x){if(!this.config.hoveredColor){return}var y=this.selected;if(y.id!=z||y.name!=x){y.id=z;y.name=x;y.color=this.config.hoveredColor;this.st.graph.eachNode(function(A){if(z==A.id){A.setData("border",y)}else{A.setData("border",false)}});this.st.plot()}},getLegend:function(){var z={};var A;this.st.graph.getNode(this.st.root).eachAdjacency(function(B){A=B.nodeTo});var y=A.getData("colorArray"),x=y.length;c.each(A.getData("stringArray"),function(C,B){z[C]=y[B%x]});return z},getMaxValue:function(){var y=0,x=this.config.type.split(":")[0]=="stacked";this.st.graph.eachNode(function(B){var z=B.getData("valueArray"),A=0;if(!z){return}if(x){c.each(z,function(C){A+=+C})}else{A=Math.max.apply(null,z)}y=y>A?y:A});return y},setBarType:function(x){this.config.type=x;this.st.config.Node.type="barchart-"+x.split(":")[0]},normalizeDims:function(){var H=this.st.graph.getNode(this.st.root),C=0;H.eachAdjacency(function(){C++});var E=this.getMaxValue()||1,K=this.st.canvas.getSize(),A=this.config,D=A.Margin,I=D.left+D.right,B=D.top+D.bottom,y=A.orientation=="horizontal",x=(K[y?"height":"width"]-(y?B:I)-(C-1)*A.barsOffset)/C,z=A.animate,J=K[y?"width":"height"]-(y?I:B)-(!y&&A.showAggregates&&(A.Label.size+A.labelOffset))-(A.showLabels&&(A.Label.size+A.labelOffset)),G=y?"height":"width",F=y?"width":"height";this.st.graph.eachNode(function(O){var N=0,L=[];c.each(O.getData("valueArray"),function(P){N+=+P;L.push(0)});O.setData(G,x);if(z){O.setData(F,N*J/E,"end");O.setData("dimArray",c.map(O.getData("valueArray"),function(P){return P*J/E}),"end");var M=O.getData("dimArray");if(!M){O.setData("dimArray",L)}}else{O.setData(F,N*J/E);O.setData("dimArray",c.map(O.getData("valueArray"),function(P){return P*J/E}))}})}});o.PieChart={$extend:true,animate:true,offset:25,sliceOffset:0,labelOffset:3,type:"stacked",hoveredColor:"#9fd4ff",Events:{enable:false,onClick:c.empty},Tips:{enable:false,onShow:c.empty,onHide:c.empty},showLabels:true,resizeLabels:false,updateHeights:false};g.Radial=new r({compute:function(y){var z=c.splat(y||["current","start","end"]);f.compute(this.graph,z,this.config);this.graph.computeLevels(this.root,0,"ignore");var x=this.createLevelDistanceFunc();this.computeAngularWidths(z);this.computePositions(z,x)},computePositions:function(E,B){var G=E;var F=this.graph;var C=F.getNode(this.root);var D=this.parent;var x=this.config;for(var z=0,y=G.length;z<y;z++){var A=G[z];C.setPos(l(0,0),A);C.setData("span",Math.PI*2,A)}C.angleSpan={begin:0,end:2*Math.PI};F.eachBFS(this.root,function(L){var R=L.angleSpan.end-L.angleSpan.begin;var T=L.angleSpan.begin;var S=B(L);var U=0,H=[],K={};L.eachSubnode(function(X){U+=X._treeAngularWidth;for(var Y=0,W=G.length;Y<W;Y++){var aa=G[Y],Z=X.getData("dim",aa);K[aa]=(aa in K)?(Z>K[aa]?Z:K[aa]):Z}H.push(X)},"ignore");if(D&&D.id==L.id&&H.length>0&&H[0].dist){H.sort(function(X,W){return(X.dist>=W.dist)-(X.dist<=W.dist)})}for(var N=0,P=H.length;N<P;N++){var J=H[N];if(!J._flag){var V=J._treeAngularWidth/U*R;var I=T+V/2;for(var O=0,M=G.length;O<M;O++){var Q=G[O];J.setPos(l(I,S),Q);J.setData("span",V,Q);J.setData("dim-quotient",J.getData("dim",Q)/K[Q],Q)}J.angleSpan={begin:T,end:T+V};T+=V}}},"ignore")},setAngularWidthForNodes:function(x){this.graph.eachBFS(this.root,function(A,y){var z=A.getData("angularWidth",x[0])||5;A._angularWidth=z/y},"ignore")},setSubtreesAngularWidth:function(){var x=this;this.graph.eachNode(function(y){x.setSubtreeAngularWidth(y)},"ignore")},setSubtreeAngularWidth:function(A){var z=this,y=A._angularWidth,x=0;A.eachSubnode(function(B){z.setSubtreeAngularWidth(B);x+=B._treeAngularWidth},"ignore");A._treeAngularWidth=Math.max(y,x)},computeAngularWidths:function(x){this.setAngularWidthForNodes(x);this.setSubtreesAngularWidth()}});$jit.Sunburst=new r({Implements:[d,p,g.Radial],initialize:function(x){var z=$jit.Sunburst;var y={interpolation:"linear",levelDistance:100,Node:{type:"multipie",height:0},Edge:{type:"none"},Label:{textAlign:"start",textBaseline:"middle"}};this.controller=this.config=c.merge(o("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),y,x);var A=this.config;if(A.useCanvas){this.canvas=A.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(A.background){A.background=c.merge({type:"Circles"},A.background)}this.canvas=new m(this,A);this.config.labelContainer=(typeof A.injectInto=="string"?A.injectInto:A.injectInto.id)+"-label"}this.graphOptions={complex:false,Node:{selected:false,exist:true,drawn:true}};this.graph=new e(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new z.Label[A.Label.type](this);this.fx=new z.Plot(this,z);this.op=new z.Op(this);this.json=null;this.root=null;this.rotated=null;this.busy=false;this.initializeExtras()},createLevelDistanceFunc:function(){var x=this.config.levelDistance;return function(y){return(y._depth+1)*x}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},rotate:function(z,A,y){var x=z.getPos(y.property||"current").getp(true).theta;this.rotated=z;this.rotateAngle(-x,A,y)},rotateAngle:function(z,C,y){var A=this;var x=c.merge(this.config,y||{},{modes:["polar"]});var B=y.property||(C==="animate"?"end":"current");if(C==="animate"){this.fx.animation.pause()}this.graph.eachNode(function(E){var D=E.getPos(B);D.theta+=z;if(D.theta<0){D.theta+=Math.PI*2}});if(C=="animate"){this.fx.animate(x)}else{if(C=="replot"){this.fx.plot();this.busy=false}}},plot:function(){this.fx.plot()}});$jit.Sunburst.$extend=true;(function(x){x.Op=new r({Implements:e.Op});x.Plot=new r({Implements:e.Plot});x.Label={};x.Label.Native=new r({Implements:e.Label.Native,initialize:function(y){this.viz=y;this.label=y.config.Label;this.config=y.config},renderLabel:function(C,E,G){var N=E.getData("span");if(N<Math.PI/2&&Math.tan(N)*this.config.levelDistance*E._depth<10){return}var O=C.getCtx();var A=O.measureText(E.name);if(E.id==this.viz.root){var M=-A.width/2,K=0,L=0;var z=0}else{var D=5;var z=G.levelDistance-D;var J=E.pos.clone();J.rho+=D;var B=J.getp(true);var H=J.getc(true);var M=H.x,K=H.y;var F=Math.PI;var I=(B.theta>F/2&&B.theta<3*F/2);var L=I?B.theta+F:B.theta;if(I){M-=Math.abs(Math.cos(B.theta)*A.width);K+=Math.sin(B.theta)*A.width}else{if(E.id==this.viz.root){M-=A.width/2}}}O.save();O.translate(M,K);O.rotate(L);O.fillText(E.name,0,0);O.restore()}});x.Label.SVG=new r({Implements:e.Label.SVG,initialize:function(y){this.viz=y},placeLabel:function(N,C,E){var J=C.pos.getc(true),M=this.viz,A=this.viz.canvas;var F=A.getSize();var B={x:Math.round(J.x+F.width/2),y:Math.round(J.y+F.height/2)};N.setAttribute("x",B.x);N.setAttribute("y",B.y);var G=N.getBBox();if(G){var L=N.getAttribute("x");var I=N.getAttribute("y");var z=C.pos.getp(true);var D=Math.PI;var H=(z.theta>D/2&&z.theta<3*D/2);if(H){N.setAttribute("x",L-G.width);N.setAttribute("y",I-G.height)}else{if(C.id==M.root){N.setAttribute("x",L-G.width/2)}}var K=H?z.theta+D:z.theta;if(C._depth){N.setAttribute("transform","rotate("+K*360/(2*D)+" "+L+" "+I+")")}}E.onPlaceLabel(N,C)}});x.Label.HTML=new r({Implements:e.Label.HTML,initialize:function(y){this.viz=y},placeLabel:function(H,B,D){var F=B.pos.clone(),z=this.viz.canvas,G=B.getData("height"),C=((G||B._depth==0)?G:this.viz.config.levelDistance)/2,E=z.getSize();F.rho+=C;F=F.getc(true);var A={x:Math.round(F.x+E.width/2),y:Math.round(F.y+E.height/2)};var y=H.style;y.left=A.x+"px";y.top=A.y+"px";y.display=this.fitsInCanvas(A,z)?"":"none";D.onPlaceLabel(H,B)}});x.Plot.NodeTypes=new r({none:{render:c.empty,contains:c.lambda(false),anglecontains:function(C,E){var B=C.getData("span")/2,z=C.pos.theta;var A=z-B,y=z+B;if(A<0){A+=Math.PI*2}var D=Math.atan2(E.y,E.x);if(D<0){D+=Math.PI*2}if(A>y){return(D>A&&D<=Math.PI*2)||D<y}else{return D>A&&D<y}}},pie:{render:function(D,B){var H=D.getData("span")/2,A=D.pos.theta;var C=A-H,E=A+H;var G=D.pos.getp(true);var y=new b(G.rho,C);var z=y.getc(true);y.theta=E;var F=y.getc(true);var I=B.getCtx();I.beginPath();I.moveTo(0,0);I.lineTo(z.x,z.y);I.moveTo(0,0);I.lineTo(F.x,F.y);I.moveTo(0,0);I.arc(0,0,G.rho*D.getData("dim-quotient"),C,E,false);I.fill()},contains:function(A,C){if(this.nodeTypes.none.anglecontains.call(this,A,C)){var y=Math.sqrt(C.x*C.x+C.y*C.y);var z=this.config.levelDistance,B=A._depth;return(y<=z*B)}return false}},multipie:{render:function(E,C){var L=E.getData("height");var F=L?L:this.config.levelDistance;var K=E.getData("span")/2,B=E.pos.theta;var D=B-K,H=B+K;var J=E.pos.getp(true);var z=new b(J.rho,D);var A=z.getc(true);z.theta=H;var I=z.getc(true);z.rho+=F;var y=z.getc(true);z.theta=D;var G=z.getc(true);var M=C.getCtx();M.moveTo(0,0);M.beginPath();M.arc(0,0,J.rho,D,H,false);M.arc(0,0,J.rho+F,H,D,true);M.moveTo(A.x,A.y);M.lineTo(G.x,G.y);M.moveTo(I.x,I.y);M.lineTo(y.x,y.y);M.fill();if(E.collapsed){M.save();M.lineWidth=2;M.moveTo(0,0);M.beginPath();M.arc(0,0,J.rho+F+5,H-0.01,D+0.01,true);M.stroke();M.restore()}},contains:function(B,E){if(this.nodeTypes.none.anglecontains.call(this,B,E)){var z=Math.sqrt(E.x*E.x+E.y*E.y);var y=B.getData("height");var C=y?y:this.config.levelDistance;var A=this.config.levelDistance,D=B._depth;return(z>=A*D)&&(z<=(A*D+C))}return false}},"gradient-multipie":{render:function(B,y){var G=y.getCtx();var F=B.getData("height");var C=F?F:this.config.levelDistance;var z=G.createRadialGradient(0,0,B.getPos().rho,0,0,B.getPos().rho+C);var E=c.hexToRgb(B.getData("color")),D=[];c.each(E,function(H){D.push(parseInt(H*0.5,10))});var A=c.rgbToHex(D);z.addColorStop(0,A);z.addColorStop(1,B.getData("color"));G.fillStyle=z;this.nodeTypes.multipie.render.call(this,B,y)},contains:function(y,z){return this.nodeTypes.multipie.contains.call(this,y,z)}},"gradient-pie":{render:function(D,A){var y=A.getCtx();var E=y.createRadialGradient(0,0,0,0,0,D.getPos().rho);var C=c.hexToRgb(D.getData("color")),z=[];c.each(C,function(F){z.push(parseInt(F*0.5,10))});var B=c.rgbToHex(z);E.addColorStop(1,B);E.addColorStop(0,D.getData("color"));y.fillStyle=E;this.nodeTypes.pie.render.call(this,D,A)},contains:function(y,z){return this.nodeTypes.pie.contains.call(this,y,z)}}});x.Plot.EdgeTypes=new r({none:c.empty,line:{render:function(y,z){var B=y.nodeFrom.pos.getc(true),A=y.nodeTo.pos.getc(true);this.edgeHelper.line.render(B,A,z)},contains:function(y,B){var A=y.nodeFrom.pos.getc(true),z=y.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(A,z,B,this.edge.epsilon)}},arrow:{render:function(z,A){var E=z.nodeFrom.pos.getc(true),D=z.nodeTo.pos.getc(true),C=z.getData("dim"),B=z.data.$direction,y=(B&&B.length>1&&B[0]!=z.nodeFrom.id);this.edgeHelper.arrow.render(E,D,C,y,A)},contains:function(y,B){var A=y.nodeFrom.pos.getc(true),z=y.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(A,z,B,this.edge.epsilon)}},hyperline:{render:function(y,z){var C=y.nodeFrom.pos.getc(),B=y.nodeTo.pos.getc(),A=Math.max(C.norm(),B.norm());this.edgeHelper.hyperline.render(C.$scale(1/A),B.$scale(1/A),A,z)},contains:c.lambda(false)}})})($jit.Sunburst);$jit.Sunburst.Plot.NodeTypes.implement({"piechart-stacked":{render:function(V,B){var U=V.pos.getp(true),D=V.getData("dimArray"),T=V.getData("valueArray"),H=V.getData("colorArray"),A=H.length,N=V.getData("stringArray"),Q=V.getData("span")/2,L=V.pos.theta,G=L-Q,K=L+Q,S=new b;var O=B.getCtx(),M={},J=V.getData("gradient"),E=V.getData("border"),aa=V.getData("config"),aj=aa.showLabels,Z=aa.resizeLabels,ac=aa.Label;var af=aa.sliceOffset*Math.cos((G+K)/2);var F=aa.sliceOffset*Math.sin((G+K)/2);if(H&&D&&N){for(var ag=0,ad=D.length,x=0,Y=0;ag<ad;ag++){var C=D[ag],ah=H[ag%A];if(C<=0){continue}O.fillStyle=O.strokeStyle=ah;if(J&&C){var ae=O.createRadialGradient(af,F,x+aa.sliceOffset,af,F,x+C+aa.sliceOffset);var y=c.hexToRgb(ah),X=c.map(y,function(am){return(am*0.8)>>0}),z=c.rgbToHex(X);ae.addColorStop(0,ah);ae.addColorStop(0.5,ah);ae.addColorStop(1,z);O.fillStyle=ae}S.rho=x+aa.sliceOffset;S.theta=G;var ai=S.getc(true);S.theta=K;var P=S.getc(true);S.rho+=C;var ak=S.getc(true);S.theta=G;var R=S.getc(true);O.beginPath();O.arc(af,F,x+0.01,G,K,false);O.arc(af,F,x+C+0.01,K,G,true);O.fill();if(E&&E.name==N[ag]){M.acum=x;M.dimValue=D[ag];M.begin=G;M.end=K}x+=(C||0);Y+=(T[ag]||0)}if(E){O.save();O.globalCompositeOperation="source-over";O.lineWidth=2;O.strokeStyle=E.color;var ab=G<K?1:-1;O.beginPath();O.arc(af,F,M.acum+0.01+1,M.begin,M.end,false);O.arc(af,F,M.acum+M.dimValue+0.01-1,M.end,M.begin,true);O.closePath();O.stroke();O.restore()}if(aj&&ac.type=="Native"){O.save();O.fillStyle=O.strokeStyle=ac.color;var W=Z?V.getData("normalizedDim"):1,I=(ac.size*W)>>0;I=I<+Z?+Z:I;O.font=ac.style+" "+I+"px "+ac.family;O.textBaseline="middle";O.textAlign="center";S.rho=x+aa.labelOffset+aa.sliceOffset;S.theta=V.pos.theta;var al=S.getc(true);O.fillText(V.name,al.x,al.y);O.restore()}}},contains:function(A,E){if(this.nodeTypes.none.anglecontains.call(this,A,E)){var G=Math.sqrt(E.x*E.x+E.y*E.y);var x=this.config.levelDistance,D=A._depth;var y=A.getData("config");if(G<=x*D+y.sliceOffset){var H=A.getData("dimArray");for(var C=0,B=H.length,F=y.sliceOffset;C<B;C++){var z=H[C];if(G>=F&&G<=F+z){return{name:A.getData("stringArray")[C],color:A.getData("colorArray")[C],value:A.getData("valueArray")[C],label:A.name}}F+=z}}return false}return false}}});$jit.PieChart=new r({sb:null,colors:["#416D9C","#70A35E","#EBB056","#C74243","#83548B","#909291","#557EAA"],selected:{},busy:false,initialize:function(x){this.controller=this.config=c.merge(o("Canvas","PieChart","Label"),{Label:{type:"Native"}},x);this.initializeViz()},initializeViz:function(){var y=this.config,B=this;var x=y.type.split(":")[0];var C=new $jit.Sunburst({injectInto:y.injectInto,useCanvas:y.useCanvas,withLabels:y.Label.type!="Native",Label:{type:y.Label.type},Node:{overridable:true,type:"piechart-"+x,width:1,height:1},Edge:{type:"none"},Tips:{enable:y.Tips.enable,type:"Native",force:true,onShow:function(G,F,D){var E=D;y.Tips.onShow(G,E,F)}},Events:{enable:true,type:"Native",onClick:function(F,G,D){if(!y.Events.enable){return}var E=G.getContains();y.Events.onClick(E,G,D)},onMouseMove:function(F,G,D){if(!y.hoveredColor){return}if(F){var E=G.getContains();B.select(F.id,E.name,E.index)}else{B.select(false,false,false)}}},onCreateLabel:function(G,F){var D=y.Label;if(y.showLabels){var E=G.style;E.fontSize=D.size+"px";E.fontFamily=D.family;E.color=D.color;E.textAlign="center";G.innerHTML=F.name}},onPlaceLabel:function(T,N){if(!y.showLabels){return}var H=N.pos.getp(true),K=N.getData("dimArray"),Q=N.getData("span")/2,I=N.pos.theta,S=I-Q,E=I+Q,V=new b;var M=y.showLabels,G=y.resizeLabels,J=y.Label;if(K){for(var R=0,O=K.length,P=0;R<O;R++){P+=K[R]}var U=G?N.getData("normalizedDim"):1,D=(J.size*U)>>0;D=D<+G?+G:D;T.style.fontSize=D+"px";V.rho=P+y.labelOffset+y.sliceOffset;V.theta=(S+E)/2;var H=V.getc(true);var F=B.canvas.getSize();var L={x:Math.round(H.x+F.width/2),y:Math.round(H.y+F.height/2)};T.style.left=L.x+"px";T.style.top=L.y+"px"}}});var A=C.canvas.getSize(),z=Math.min;C.config.levelDistance=z(A.width,A.height)/2-y.offset-y.sliceOffset;this.sb=C;this.canvas=this.sb.canvas;this.canvas.getCtx().globalCompositeOperation="lighter"},loadJSON:function(L){var J=c.time(),D=[],x=this.sb,O=c.splat(L.label),F=O.length,I=c.splat(L.color||this.colors),A=I.length,M=this.config,y=!!M.type.split(":")[1],B=M.animate,H=F==1;for(var K=0,z=L.values,G=z.length;K<G;K++){var N=z[K];var C=c.splat(N.values);D.push({id:J+N.label,name:N.label,data:{value:C,"$valueArray":C,"$colorArray":H?c.splat(I[K%A]):I,"$stringArray":O,"$gradient":y,"$config":M,"$angularWidth":c.reduce(C,function(P,Q){return P+Q})},children:[]})}var E={id:J+"$root",name:"",data:{"$type":"none","$width":1,"$height":1},children:D};x.loadJSON(E);this.normalizeDims();x.refresh();if(B){x.fx.animate({modes:["node-property:dimArray"],duration:1500})}},updateJSON:function(z,C){if(this.busy){return}this.busy=true;var D=this.sb;var B=D.graph;var y=z.values;var x=this.config.animate;var A=this;c.each(y,function(E){var G=B.getByName(E.label),F=c.splat(E.values);if(G){G.setData("valueArray",F);G.setData("angularWidth",c.reduce(F,function(H,I){return H+I}));if(z.label){G.setData("stringArray",c.splat(z.label))}}});this.normalizeDims();if(x){D.compute("end");D.fx.animate({modes:["node-property:dimArray:span","linear"],duration:1500,onComplete:function(){A.busy=false;C&&C.onComplete()}})}else{D.refresh()}},select:function(z,x){if(!this.config.hoveredColor){return}var y=this.selected;if(y.id!=z||y.name!=x){y.id=z;y.name=x;y.color=this.config.hoveredColor;this.sb.graph.eachNode(function(A){if(z==A.id){A.setData("border",y)}else{A.setData("border",false)}});this.sb.plot()}},getLegend:function(){var z={};var A;this.sb.graph.getNode(this.sb.root).eachAdjacency(function(B){A=B.nodeTo});var y=A.getData("colorArray"),x=y.length;c.each(A.getData("stringArray"),function(C,B){z[C]=y[B%x]});return z},getMaxValue:function(){var x=0;this.sb.graph.eachNode(function(A){var y=A.getData("valueArray"),z=0;c.each(y,function(B){z+=+B});x=x>z?x:z});return x},normalizeDims:function(){var y=this.sb.graph.getNode(this.sb.root),x=0;y.eachAdjacency(function(){x++});var C=this.getMaxValue()||1,B=this.config,z=B.animate,A=this.sb.config.levelDistance;this.sb.graph.eachNode(function(H){var G=0,D=[];c.each(H.getData("valueArray"),function(I){G+=+I;D.push(1)});var F=(D.length==1)&&!B.updateHeights;if(z){H.setData("dimArray",c.map(H.getData("valueArray"),function(I){return F?A:(I*A/C)}),"end");var E=H.getData("dimArray");if(!E){H.setData("dimArray",D)}}else{H.setData("dimArray",c.map(H.getData("valueArray"),function(I){return F?A:(I*A/C)}))}H.setData("normalizedDim",G/C)})}});g.TM={};g.TM.SliceAndDice=new r({compute:function(C){var y=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(y);var A=this.canvas.getSize(),z=this.config,B=A.width,x=A.height;this.graph.computeLevels(this.root,0,"ignore");y.getPos(C).setc(-B/2,-x/2);y.setData("width",B,C);y.setData("height",x+z.titleHeight,C);this.computePositions(y,y,this.layout.orientation,C);this.controller.onAfterCompute(y)},computePositions:function(G,E,Q,z){var N=0;G.eachSubnode(function(S){N+=S.getData("area",z)});var R=this.config,O=R.offset,K=G.getData("width",z),I=G.getData("height",z)-R.titleHeight,y=G==E?1:(E.getData("area",z)/N);var J,H,M,C,B,F,D;var P=(Q=="h");if(P){Q="v";J=I;H=K*y;M="height";C="y";B="x";F=R.titleHeight;D=0}else{Q="h";J=I*y;H=K;M="width";C="x";B="y";F=0;D=R.titleHeight}var x=E.getPos(z);E.setData("width",H,z);E.setData("height",J,z);var L=0,A=this;E.eachSubnode(function(T){var S=T.getPos(z);S[C]=L+x[C]+F;S[B]=x[B]+D;A.computePositions(E,T,Q,z);L+=T.getData(M,z)})}});g.TM.Area={compute:function(x){x=x||"current";var D=this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root);this.controller.onBeforeCompute(D);var z=this.config,G=this.canvas.getSize(),y=G.width,F=G.height,E=z.offset,A=y-E,C=F-E;this.graph.computeLevels(this.root,0,"ignore");D.getPos(x).setc(-y/2,-F/2);D.setData("width",y,x);D.setData("height",F,x);var B={top:-F/2+z.titleHeight,left:-y/2,width:A,height:C-z.titleHeight};this.computePositions(D,B,x);this.controller.onAfterCompute(D)},computeDim:function(B,C,E,A,z,x){if(B.length+C.length==1){var y=(B.length==1)?B:C;this.layoutLast(y,E,A,x);return}if(B.length>=2&&C.length==0){C=[B.shift()]}if(B.length==0){if(C.length>0){this.layoutRow(C,E,A,x)}return}var D=B[0];if(z(C,E)>=z([D].concat(C),E)){this.computeDim(B.slice(1),C.concat([D]),E,A,z,x)}else{var F=this.layoutRow(C,E,A,x);this.computeDim(B,[],F.dim,F,z,x)}},worstAspectRatio:function(x,F){if(!x||x.length==0){return Number.MAX_VALUE}var y=0,G=0,B=Number.MAX_VALUE;for(var D=0,C=x.length;D<C;D++){var z=x[D]._area;y+=z;B=B<z?B:z;G=G>z?G:z}var E=F*F,A=y*y;return Math.max(E*G/A,A/(E*B))},avgAspectRatio:function(B,y){if(!B||B.length==0){return Number.MAX_VALUE}var D=0;for(var z=0,x=B.length;z<x;z++){var C=B[z]._area;var A=C/y;D+=y>A?y/A:A/y}return D/x},layoutLast:function(y,x,B,A){var z=y[0];z.getPos(A).setc(B.left,B.top);z.setData("width",B.width,A);z.setData("height",B.height,A)}};g.TM.Squarified=new r({Implements:g.TM.Area,computePositions:function(B,E,y){var A=this.config;if(E.width>=E.height){this.layout.orientation="h"}else{this.layout.orientation="v"}var x=B.getSubnodes([1,1],"ignore");if(x.length>0){this.processChildrenLayout(B,x,E,y);for(var D=0,C=x.length;D<C;D++){var G=x[D];var H=A.offset,I=G.getData("height",y)-H-A.titleHeight,z=G.getData("width",y)-H;var F=G.getPos(y);E={width:z,height:I,top:F.y+A.titleHeight,left:F.x};this.computePositions(G,E,y)}}},processChildrenLayout:function(H,x,D,y){var B=D.width*D.height;var C,z=x.length,E=0,I=[];for(C=0;C<z;C++){I[C]=parseFloat(x[C].getData("area",y));E+=I[C]}for(C=0;C<z;C++){x[C]._area=B*I[C]/E}var A=this.layout.horizontal()?D.height:D.width;x.sort(function(K,J){var L=J._area-K._area;return L?L:(J.id==K.id?0:(J.id<K.id?1:-1))});var G=[x[0]];var F=x.slice(1);this.squarify(F,G,A,D,y)},squarify:function(y,B,x,A,z){this.computeDim(y,B,x,A,this.worstAspectRatio,z)},layoutRow:function(y,x,A,z){if(this.layout.horizontal()){return this.layoutV(y,x,A,z)}else{return this.layoutH(y,x,A,z)}},layoutV:function(x,I,E,y){var J=0,A=function(K){return K};c.each(x,function(K){J+=K._area});var z=A(J/I),F=0;for(var C=0,B=x.length;C<B;C++){var D=A(x[C]._area/z);var G=x[C];G.getPos(y).setc(E.left,E.top+F);G.setData("width",z,y);G.setData("height",D,y);F+=D}var H={height:E.height,width:E.width-z,top:E.top,left:E.left+z};H.dim=Math.min(H.width,H.height);if(H.dim!=H.height){this.layout.change()}return H},layoutH:function(x,G,C,y){var I=0;c.each(x,function(J){I+=J._area});var H=I/G,D=C.top,z=0;for(var B=0,A=x.length;B<A;B++){var E=x[B];var G=E._area/H;E.getPos(y).setc(C.left+z,D);E.setData("width",G,y);E.setData("height",H,y);z+=G}var F={height:C.height-H,width:C.width,top:C.top+H,left:C.left};F.dim=Math.min(F.width,F.height);if(F.dim!=F.width){this.layout.change()}return F}});g.TM.Strip=new r({Implements:g.TM.Area,computePositions:function(B,E,y){var x=B.getSubnodes([1,1],"ignore"),A=this.config;if(x.length>0){this.processChildrenLayout(B,x,E,y);for(var D=0,C=x.length;D<C;D++){var G=x[D];var H=A.offset,I=G.getData("height",y)-H-A.titleHeight,z=G.getData("width",y)-H;var F=G.getPos(y);E={width:z,height:I,top:F.y+A.titleHeight,left:F.x};this.computePositions(G,E,y)}}},processChildrenLayout:function(H,x,C,y){var A=C.width*C.height;var B,z=x.length,D=0,I=[];for(B=0;B<z;B++){I[B]=+x[B].getData("area",y);D+=I[B]}for(B=0;B<z;B++){x[B]._area=A*I[B]/D}var G=this.layout.horizontal()?C.width:C.height;var F=[x[0]];var E=x.slice(1);this.stripify(E,F,G,C,y)},stripify:function(y,B,x,A,z){this.computeDim(y,B,x,A,this.avgAspectRatio,z)},layoutRow:function(y,x,A,z){if(this.layout.horizontal()){return this.layoutH(y,x,A,z)}else{return this.layoutV(y,x,A,z)}},layoutV:function(x,G,D,y){var H=0;c.each(x,function(I){H+=I._area});var z=H/G,E=0;for(var B=0,A=x.length;B<A;B++){var F=x[B];var C=F._area/z;F.getPos(y).setc(D.left,D.top+(G-C-E));F.setData("width",z,y);F.setData("height",C,y);E+=C}return{height:D.height,width:D.width-z,top:D.top,left:D.left+z,dim:G}},layoutH:function(x,F,C,y){var H=0;c.each(x,function(J){H+=J._area});var G=H/F,D=C.height-G,z=0;for(var B=0,A=x.length;B<A;B++){var E=x[B];var I=E._area/G;E.getPos(y).setc(C.left+z,C.top+D);E.setData("width",I,y);E.setData("height",G,y);z+=I}return{height:C.height-G,width:C.width,top:C.top,left:C.left,dim:F}}});g.Icicle=new r({compute:function(F){F=F||"current";var E=this.graph.getNode(this.root),A=this.config,I=this.canvas.getSize(),x=I.width,H=I.height,B=A.offset,D=A.constrained?A.levelsToShow:Number.MAX_VALUE;this.controller.onBeforeCompute(E);e.Util.computeLevels(this.graph,E.id,0,"ignore");var G=0;e.Util.eachLevel(E,0,false,function(K,J){if(J>G){G=J}});var z=this.graph.getNode(this.clickedNode&&this.clickedNode.id||E.id);var y=Math.min(G,D-1);var C=z._depth;if(this.layout.horizontal()){this.computeSubtree(z,-x/2,-H/2,x/(y+1),H,C,y,F)}else{this.computeSubtree(z,-x/2,-H/2,x,H/(y+1),C,y,F)}},computeSubtree:function(H,J,G,z,M,F,B,I){H.getPos(I).setc(J,G);H.setData("width",z,I);H.setData("height",M,I);var D,L=0,K=0;var A=e.Util.getSubnodes(H,[1,1]);if(!A.length){return}c.each(A,function(x){K+=x.getData("dim")});for(var E=0,C=A.length;E<C;E++){if(this.layout.horizontal()){D=M*A[E].getData("dim")/K;this.computeSubtree(A[E],J+z,G,z,D,F,B,I);G+=D}else{D=z*A[E].getData("dim")/K;this.computeSubtree(A[E],J,G+M,D,M,F,B,I);J+=D}}}});$jit.Icicle=new r({Implements:[d,p,g.Icicle],layout:{orientation:"h",vertical:function(){return this.orientation=="v"},horizontal:function(){return this.orientation=="h"},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(x){var y={animate:false,orientation:"h",offset:2,levelsToShow:Number.MAX_VALUE,constrained:false,Node:{type:"rectangle",overridable:true},Edge:{type:"none"},Label:{type:"Native"},duration:700,fps:45};var A=o("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label");this.controller=this.config=c.merge(A,y,x);this.layout.orientation=this.config.orientation;var z=this.config;if(z.useCanvas){this.canvas=z.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{this.canvas=new m(this,z);this.config.labelContainer=(typeof z.injectInto=="string"?z.injectInto:z.injectInto.id)+"-label"}this.graphOptions={complex:true,Node:{selected:false,exist:true,drawn:true}};this.graph=new e(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);this.labels=new $jit.Icicle.Label[this.config.Label.type](this);this.fx=new $jit.Icicle.Plot(this,$jit.Icicle);this.op=new $jit.Icicle.Op(this);this.group=new $jit.Icicle.Group(this);this.clickedNode=null;this.initializeExtras()},refresh:function(){var x=this.config.Label.type;if(x!="Native"){var y=this;this.graph.eachNode(function(z){y.labels.hideLabel(z,false)})}this.compute();this.plot()},plot:function(){this.fx.plot(this.config)},enter:function(z){if(this.busy){return}this.busy=true;var y=this,x=this.config;var A={onComplete:function(){if(x.request){y.compute()}if(x.animate){y.graph.nodeList.setDataset(["current","end"],{alpha:[1,0]});e.Util.eachSubgraph(z,function(B){B.setData("alpha",1,"end")},"ignore");y.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){y.clickedNode=z;y.compute("end");y.fx.animate({modes:["linear","node-property:width:height"],duration:1000,onComplete:function(){y.busy=false;y.clickedNode=z}})}})}else{y.clickedNode=z;y.busy=false;y.refresh()}}};if(x.request){this.requestNodes(clickedNode,A)}else{A.onComplete()}},out:function(){if(this.busy){return}var C=this,B=e.Util,z=this.config,E=this.graph,y=B.getParents(E.getNode(this.clickedNode&&this.clickedNode.id||this.root)),A=y[0],x=A,D=this.clickedNode;this.busy=true;this.events.hoveredNode=false;if(!A){this.busy=false;return}callback={onComplete:function(){C.clickedNode=A;if(z.request){C.requestNodes(A,{onComplete:function(){C.compute();C.plot();C.busy=false}})}else{C.compute();C.plot();C.busy=false}}};if(z.animate){this.clickedNode=x;this.compute("end");this.clickedNode=D;this.fx.animate({modes:["linear","node-property:width:height"],duration:1000,onComplete:function(){C.clickedNode=x;E.nodeList.setDataset(["current","end"],{alpha:[0,1]});B.eachSubgraph(D,function(F){F.setData("alpha",1)},"ignore");C.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){callback.onComplete()}})}})}else{callback.onComplete()}},requestNodes:function(z,A){var y=c.merge(this.controller,A),x=this.config.constrained?this.config.levelsToShow:Number.MAX_VALUE;if(y.request){var C=[],B=z._depth;e.Util.eachLevel(z,0,x,function(D){if(D.drawn&&!e.Util.anySubnode(D)){C.push(D);D._level=D._depth-B;if(this.config.constrained){D._level=x-D._level}}});this.group.requestNodes(C,y)}else{y.onComplete()}}});$jit.Icicle.Op=new r({Implements:e.Op});$jit.Icicle.Group=new r({initialize:function(x){this.viz=x;this.canvas=x.canvas;this.config=x.config},requestNodes:function(C,B){var A=0,y=C.length,E={};var z=function(){B.onComplete()};var x=this.viz;if(y==0){z()}for(var D=0;D<y;D++){E[C[D].id]=C[D];B.request(C[D].id,C[D]._level,{onComplete:function(G,F){if(F&&F.children){F.id=G;x.op.sum(F,{type:"nothing"})}if(++A==y){e.Util.computeLevels(x.graph,x.root,0);z()}}})}}});$jit.Icicle.Plot=new r({Implements:e.Plot,plot:function(B,z){B=B||this.viz.controller;var x=this.viz,C=x.graph,y=C.getNode(x.clickedNode&&x.clickedNode.id||x.root),A=y._depth;x.canvas.clear();this.plotTree(y,c.merge(B,{withLabels:true,hideLabels:false,plotSubtree:function(D,E){return !x.config.constrained||(E._depth-A<x.config.levelsToShow)}}),z)}});$jit.Icicle.Label={};$jit.Icicle.Label.Native=new r({Implements:e.Label.Native,renderLabel:function(y,z,B){var E=y.getCtx(),x=z.getData("width"),D=z.getData("height"),F=z.getLabelData("size"),A=E.measureText(z.name);if(D<(F*1.5)||x<A.width){return}var C=z.pos.getc(true);E.fillText(z.name,C.x+x/2,C.y+D/2)}});$jit.Icicle.Label.SVG=new r({Implements:e.Label.SVG,initialize:function(x){this.viz=x},placeLabel:function(y,B,z){var D=B.pos.getc(true),A=this.viz.canvas;var x=A.getSize();var C={x:Math.round(D.x+x.width/2),y:Math.round(D.y+x.height/2)};y.setAttribute("x",C.x);y.setAttribute("y",C.y);z.onPlaceLabel(y,B)}});$jit.Icicle.Label.HTML=new r({Implements:e.Label.HTML,initialize:function(x){this.viz=x},placeLabel:function(y,C,z){var E=C.pos.getc(true),A=this.viz.canvas;var x=A.getSize();var D={x:Math.round(E.x+x.width/2),y:Math.round(E.y+x.height/2)};var B=y.style;B.left=D.x+"px";B.top=D.y+"px";B.display="";z.onPlaceLabel(y,C)}});$jit.Icicle.Plot.NodeTypes=new r({none:{render:c.empty},rectangle:{render:function(A,y,L){var z=this.viz.config;var D=z.offset;var x=A.getData("width");var I=A.getData("height");var C=A.getData("border");var H=A.pos.getc(true);var G=H.x+D/2,E=H.y+D/2;var K=y.getCtx();if(x-D<2||I-D<2){return}if(z.cushion){var B=A.getData("color");var J=K.createRadialGradient(G+(x-D)/2,E+(I-D)/2,1,G+(x-D)/2,E+(I-D)/2,x<I?I:x);var F=c.rgbToHex(c.map(c.hexToRgb(B),function(M){return M*0.3>>0}));J.addColorStop(0,B);J.addColorStop(1,F);K.fillStyle=J}if(C){K.strokeStyle=C;K.lineWidth=3}K.fillRect(G,E,Math.max(0,x-D),Math.max(0,I-D));C&&K.strokeRect(H.x,H.y,x,I)},contains:function(z,B){if(this.viz.clickedNode&&!$jit.Graph.Util.isDescendantOf(z,this.viz.clickedNode.id)){return false}var A=z.pos.getc(true),y=z.getData("width"),x=z.getData("height");return this.nodeHelper.rectangle.contains({x:A.x+y/2,y:A.y+x/2},B,y,x)}}});$jit.Icicle.Plot.EdgeTypes=new r({none:c.empty});g.ForceDirected=new r({getOptions:function(D){var B=this.canvas.getSize();var y=B.width,A=B.height;var C=0;this.graph.eachNode(function(F){C++});var E=y*A/C,z=Math.sqrt(E);var x=this.config.levelDistance;return{width:y,height:A,tstart:y*0.1,nodef:function(F){return E/(F||1)},edgef:function(F){return z*(F-x)}}},compute:function(y,z){var A=c.splat(y||["current","start","end"]);var x=this.getOptions();f.compute(this.graph,A,this.config);this.graph.computeLevels(this.root,0,"ignore");this.graph.eachNode(function(B){c.each(A,function(C){var D=B.getPos(C);if(D.equals(q.KER)){D.x=x.width/5*(Math.random()-0.5);D.y=x.height/5*(Math.random()-0.5)}B.disp={};c.each(A,function(E){B.disp[E]=s(0,0)})})});this.computePositions(A,x,z)},computePositions:function(B,z,C){var D=this.config.iterations,y=0,A=this;if(C){(function x(){for(var F=C.iter,E=0;E<F;E++){z.t=z.tstart*(1-y++/(D-1));A.computePositionStep(B,z);if(y>=D){C.onComplete();return}}C.onStep(Math.round(y/(D-1)*100));setTimeout(x,1)})()}else{for(;y<D;y++){z.t=z.tstart*(1-y/(D-1));this.computePositionStep(B,z)}}},computePositionStep:function(E,x){var F=this.graph;var z=Math.min,D=Math.max;var C=s(0,0);F.eachNode(function(H){c.each(E,function(I){H.disp[I].x=0;H.disp[I].y=0});F.eachNode(function(I){if(I.id!=H.id){c.each(E,function(M){var K=H.getPos(M),J=I.getPos(M);C.x=K.x-J.x;C.y=K.y-J.y;var L=C.norm()||1;H.disp[M].$add(C.$scale(x.nodef(L)/L))})}})});var y=!!F.getNode(this.root).visited;F.eachNode(function(H){H.eachAdjacency(function(I){var J=I.nodeTo;if(!!J.visited===y){c.each(E,function(N){var L=H.getPos(N),K=J.getPos(N);C.x=L.x-K.x;C.y=L.y-K.y;var M=C.norm()||1;H.disp[N].$add(C.$scale(-x.edgef(M)/M));J.disp[N].$add(C.$scale(-1))})}});H.visited=!y});var G=x.t,A=x.width/2,B=x.height/2;F.eachNode(function(H){c.each(E,function(K){var I=H.disp[K];var J=I.norm()||1;var K=H.getPos(K);K.$add(s(I.x*z(Math.abs(I.x),G)/J,I.y*z(Math.abs(I.y),G)/J));K.x=z(A,D(-A,K.x));K.y=z(B,D(-B,K.y))})})}});$jit.ForceDirected=new r({Implements:[d,p,g.ForceDirected],initialize:function(y){var x=$jit.ForceDirected;var z={iterations:50,levelDistance:50};this.controller=this.config=c.merge(o("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),z,y);var A=this.config;if(A.useCanvas){this.canvas=A.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(A.background){A.background=c.merge({type:"Circles"},A.background)}this.canvas=new m(this,A);this.config.labelContainer=(typeof A.injectInto=="string"?A.injectInto:A.injectInto.id)+"-label"}this.graphOptions={complex:true,Node:{selected:false,exist:true,drawn:true}};this.graph=new e(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new x.Label[A.Label.type](this);this.fx=new x.Plot(this,x);this.op=new x.Op(this);this.json=null;this.busy=false;this.initializeExtras()},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},computeIncremental:function(x){x=c.merge({iter:20,property:"end",onStep:c.empty,onComplete:c.empty},x||{});this.config.onBeforeCompute(this.graph.getNode(this.root));this.compute(x.property,x)},plot:function(){this.fx.plot()},animate:function(x){this.fx.animate(c.merge({modes:["linear"]},x||{}))}});$jit.ForceDirected.$extend=true;(function(x){x.Op=new r({Implements:e.Op});x.Plot=new r({Implements:e.Plot});x.Label={};x.Label.Native=new r({Implements:e.Label.Native});x.Label.SVG=new r({Implements:e.Label.SVG,initialize:function(y){this.viz=y},placeLabel:function(I,C,D){var G=C.pos.getc(true),z=this.viz.canvas,A=z.translateOffsetX,y=z.translateOffsetY,H=z.scaleOffsetX,F=z.scaleOffsetY,E=z.getSize();var B={x:Math.round(G.x*H+A+E.width/2),y:Math.round(G.y*F+y+E.height/2)};I.setAttribute("x",B.x);I.setAttribute("y",B.y);D.onPlaceLabel(I,C)}});x.Label.HTML=new r({Implements:e.Label.HTML,initialize:function(y){this.viz=y},placeLabel:function(J,D,E){var H=D.pos.getc(true),A=this.viz.canvas,B=A.translateOffsetX,z=A.translateOffsetY,I=A.scaleOffsetX,G=A.scaleOffsetY,F=A.getSize();var C={x:Math.round(H.x*I+B+F.width/2),y:Math.round(H.y*G+z+F.height/2)};var y=J.style;y.left=C.x+"px";y.top=C.y+"px";y.display=this.fitsInCanvas(C,A)?"":"none";E.onPlaceLabel(J,D)}});x.Plot.NodeTypes=new r({none:{render:c.empty,contains:c.lambda(false)},circle:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.circle.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.circle.contains(A,B,z)}},ellipse:{render:function(B,z){var C=B.pos.getc(true),A=B.getData("width"),y=B.getData("height");this.nodeHelper.ellipse.render("fill",C,A,y,z)},contains:function(A,C){var B=A.pos.getc(true),z=A.getData("width"),y=A.getData("height");return this.nodeHelper.ellipse.contains(B,C,z,y)}},square:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.square.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.square.contains(A,B,z)}},rectangle:{render:function(B,z){var C=B.pos.getc(true),A=B.getData("width"),y=B.getData("height");this.nodeHelper.rectangle.render("fill",C,A,y,z)},contains:function(A,C){var B=A.pos.getc(true),z=A.getData("width"),y=A.getData("height");return this.nodeHelper.rectangle.contains(B,C,z,y)}},triangle:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.triangle.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.triangle.contains(A,B,z)}},star:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.star.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.star.contains(A,B,z)}}});x.Plot.EdgeTypes=new r({none:c.empty,line:{render:function(y,z){var B=y.nodeFrom.pos.getc(true),A=y.nodeTo.pos.getc(true);this.edgeHelper.line.render(B,A,z)},contains:function(y,B){var A=y.nodeFrom.pos.getc(true),z=y.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(A,z,B,this.edge.epsilon)}},arrow:{render:function(z,A){var E=z.nodeFrom.pos.getc(true),D=z.nodeTo.pos.getc(true),C=z.getData("dim"),B=z.data.$direction,y=(B&&B.length>1&&B[0]!=z.nodeFrom.id);this.edgeHelper.arrow.render(E,D,C,y,A)},contains:function(y,B){var A=y.nodeFrom.pos.getc(true),z=y.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(A,z,B,this.edge.epsilon)}}})})($jit.ForceDirected);$jit.TM={};var w=$jit.TM;$jit.TM.$extend=true;w.Base={layout:{orientation:"h",vertical:function(){return this.orientation=="v"},horizontal:function(){return this.orientation=="h"},change:function(){this.orientation=this.vertical()?"h":"v"}},initialize:function(x){var y={orientation:"h",titleHeight:13,offset:2,levelsToShow:0,constrained:false,animate:false,Node:{type:"rectangle",overridable:true,width:3,height:3,color:"#444"},Label:{textAlign:"center",textBaseline:"top"},Edge:{type:"none"},duration:700,fps:45};this.controller=this.config=c.merge(o("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),y,x);this.layout.orientation=this.config.orientation;var z=this.config;if(z.useCanvas){this.canvas=z.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(z.background){z.background=c.merge({type:"Circles"},z.background)}this.canvas=new m(this,z);this.config.labelContainer=(typeof z.injectInto=="string"?z.injectInto:z.injectInto.id)+"-label"}this.graphOptions={complex:true,Node:{selected:false,exist:true,drawn:true}};this.graph=new e(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new w.Label[z.Label.type](this);this.fx=new w.Plot(this);this.op=new w.Op(this);this.group=new w.Group(this);this.geom=new w.Geom(this);this.clickedNode=null;this.busy=false;this.initializeExtras()},refresh:function(){if(this.busy){return}this.busy=true;var y=this;if(this.config.animate){this.compute("end");this.config.levelsToShow>0&&this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root));this.fx.animate(c.merge(this.config,{modes:["linear","node-property:width:height"],onComplete:function(){y.busy=false}}))}else{var x=this.config.Label.type;if(x!="Native"){var y=this;this.graph.eachNode(function(z){y.labels.hideLabel(z,false)})}this.busy=false;this.compute();this.config.levelsToShow>0&&this.geom.setRightLevelToShow(this.graph.getNode(this.clickedNode&&this.clickedNode.id||this.root));this.plot()}},plot:function(){this.fx.plot()},leaf:function(x){return x.getSubnodes([1,1],"ignore").length==0},enter:function(D){if(this.busy){return}this.busy=true;var z=this,y=this.config,B=this.graph,x=D,A=this.clickedNode;var C={onComplete:function(){if(y.levelsToShow>0){z.geom.setRightLevelToShow(D)}if(y.levelsToShow>0||y.request){z.compute()}if(y.animate){B.nodeList.setData("alpha",0,"end");D.eachSubgraph(function(E){E.setData("alpha",1,"end")},"ignore");z.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){z.clickedNode=x;z.compute("end");z.clickedNode=A;z.fx.animate({modes:["linear","node-property:width:height"],duration:1000,onComplete:function(){z.busy=false;z.clickedNode=x}})}})}else{z.busy=false;z.clickedNode=D;z.refresh()}}};if(y.request){this.requestNodes(x,C)}else{C.onComplete()}},out:function(){if(this.busy){return}this.busy=true;this.events.hoveredNode=false;var B=this,z=this.config,D=this.graph,y=D.getNode(this.clickedNode&&this.clickedNode.id||this.root).getParents(),A=y[0],x=A,C=this.clickedNode;if(!A){this.busy=false;return}callback={onComplete:function(){B.clickedNode=A;if(z.request){B.requestNodes(A,{onComplete:function(){B.compute();B.plot();B.busy=false}})}else{B.compute();B.plot();B.busy=false}}};if(z.levelsToShow>0){this.geom.setRightLevelToShow(A)}if(z.animate){this.clickedNode=x;this.compute("end");this.clickedNode=C;this.fx.animate({modes:["linear","node-property:width:height"],duration:1000,onComplete:function(){B.clickedNode=x;D.eachNode(function(E){E.setDataset(["current","end"],{alpha:[0,1]})},"ignore");C.eachSubgraph(function(E){E.setData("alpha",1)},"ignore");B.fx.animate({duration:500,modes:["node-property:alpha"],onComplete:function(){callback.onComplete()}})}})}else{callback.onComplete()}},requestNodes:function(z,A){var y=c.merge(this.controller,A),x=this.config.levelsToShow;if(y.request){var C=[],B=z._depth;z.eachLevel(0,x,function(E){var D=x-(E._depth-B);if(E.drawn&&!E.anySubnode()&&D>0){C.push(E);E._level=D}});this.group.requestNodes(C,y)}else{y.onComplete()}}};w.Op=new r({Implements:e.Op,initialize:function(x){this.viz=x}});w.Geom=new r({Implements:e.Geom,getRightLevelToShow:function(){return this.viz.config.levelsToShow},setRightLevelToShow:function(y){var z=this.getRightLevelToShow(),x=this.viz.labels;y.eachLevel(0,z+1,function(B){var A=B._depth-y._depth;if(A>z){B.drawn=false;B.exist=false;B.ignore=true;x.hideLabel(B,false)}else{B.drawn=true;B.exist=true;delete B.ignore}});y.drawn=true;delete y.ignore}});w.Group=new r({initialize:function(x){this.viz=x;this.canvas=x.canvas;this.config=x.config},requestNodes:function(C,B){var A=0,y=C.length,E={};var z=function(){B.onComplete()};var x=this.viz;if(y==0){z()}for(var D=0;D<y;D++){E[C[D].id]=C[D];B.request(C[D].id,C[D]._level,{onComplete:function(G,F){if(F&&F.children){F.id=G;x.op.sum(F,{type:"nothing"})}if(++A==y){x.graph.computeLevels(x.root,0);z()}}})}}});w.Plot=new r({Implements:e.Plot,initialize:function(x){this.viz=x;this.config=x.config;this.node=this.config.Node;this.edge=this.config.Edge;this.animation=new v;this.nodeTypes=new w.Plot.NodeTypes;this.edgeTypes=new w.Plot.EdgeTypes;this.labels=x.labels},plot:function(z,y){var x=this.viz,A=x.graph;x.canvas.clear();this.plotTree(A.getNode(x.clickedNode&&x.clickedNode.id||x.root),c.merge(x.config,z||{},{withLabels:true,hideLabels:false,plotSubtree:function(C,B){return C.anySubnode("exist")}}),y)}});w.Label={};w.Label.Native=new r({Implements:e.Label.Native,initialize:function(x){this.config=x.config;this.leaf=x.leaf},renderLabel:function(A,B,C){if(!this.leaf(B)&&!this.config.titleHeight){return}var E=B.pos.getc(true),H=A.getCtx(),z=B.getData("width"),G=B.getData("height"),F=E.x+z/2,D=E.y;H.fillText(B.name,F,D,z)}});w.Label.SVG=new r({Implements:e.Label.SVG,initialize:function(x){this.viz=x;this.leaf=x.leaf;this.config=x.config},placeLabel:function(H,B,C){var F=B.pos.getc(true),y=this.viz.canvas,z=y.translateOffsetX,x=y.translateOffsetY,G=y.scaleOffsetX,E=y.scaleOffsetY,D=y.getSize();var A={x:Math.round(F.x*G+z+D.width/2),y:Math.round(F.y*E+x+D.height/2)};H.setAttribute("x",A.x);H.setAttribute("y",A.y);if(!this.leaf(B)&&!this.config.titleHeight){H.style.display="none"}C.onPlaceLabel(H,B)}});w.Label.HTML=new r({Implements:e.Label.HTML,initialize:function(x){this.viz=x;this.leaf=x.leaf;this.config=x.config},placeLabel:function(I,C,D){var G=C.pos.getc(true),z=this.viz.canvas,A=z.translateOffsetX,y=z.translateOffsetY,H=z.scaleOffsetX,F=z.scaleOffsetY,E=z.getSize();var B={x:Math.round(G.x*H+A+E.width/2),y:Math.round(G.y*F+y+E.height/2)};var x=I.style;x.left=B.x+"px";x.top=B.y+"px";x.width=C.getData("width")*H+"px";x.height=C.getData("height")*F+"px";x.zIndex=C._depth*100;x.display="";if(!this.leaf(C)&&!this.config.titleHeight){I.style.display="none"}D.onPlaceLabel(I,C)}});w.Plot.NodeTypes=new r({none:{render:c.empty},rectangle:{render:function(A,y,N){var E=this.viz.leaf(A),z=this.config,J=z.offset,D=z.titleHeight,I=A.pos.getc(true),x=A.getData("width"),K=A.getData("height"),C=A.getData("border"),M=y.getCtx(),H=I.x+J/2,F=I.y+J/2;if(x<=J||K<=J){return}if(E){if(z.cushion){var L=M.createRadialGradient(H+(x-J)/2,F+(K-J)/2,1,H+(x-J)/2,F+(K-J)/2,x<K?K:x);var B=A.getData("color");var G=c.rgbToHex(c.map(c.hexToRgb(B),function(O){return O*0.2>>0}));L.addColorStop(0,B);L.addColorStop(1,G);M.fillStyle=L}M.fillRect(H,F,x-J,K-J);if(C){M.save();M.strokeStyle=C;M.strokeRect(H,F,x-J,K-J);M.restore()}}else{if(D>0){M.fillRect(I.x+J/2,I.y+J/2,x-J,D-J);if(C){M.save();M.strokeStyle=C;M.strokeRect(I.x+J/2,I.y+J/2,x-J,K-J);M.restore()}}}},contains:function(A,C){if(this.viz.clickedNode&&!A.isDescendantOf(this.viz.clickedNode.id)||A.ignore){return false}var B=A.pos.getc(true),z=A.getData("width"),y=this.viz.leaf(A),x=y?A.getData("height"):this.config.titleHeight;return this.nodeHelper.rectangle.contains({x:B.x+z/2,y:B.y+x/2},C,z,x)}}});w.Plot.EdgeTypes=new r({none:c.empty});w.SliceAndDice=new r({Implements:[d,p,w.Base,g.TM.SliceAndDice]});w.Squarified=new r({Implements:[d,p,w.Base,g.TM.Squarified]});w.Strip=new r({Implements:[d,p,w.Base,g.TM.Strip]});$jit.RGraph=new r({Implements:[d,p,g.Radial],initialize:function(x){var y=$jit.RGraph;var z={interpolation:"linear",levelDistance:100};this.controller=this.config=c.merge(o("Canvas","Node","Edge","Fx","Controller","Tips","NodeStyles","Events","Navigation","Label"),z,x);var A=this.config;if(A.useCanvas){this.canvas=A.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(A.background){A.background=c.merge({type:"Circles"},A.background)}this.canvas=new m(this,A);this.config.labelContainer=(typeof A.injectInto=="string"?A.injectInto:A.injectInto.id)+"-label"}this.graphOptions={complex:false,Node:{selected:false,exist:true,drawn:true}};this.graph=new e(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new y.Label[A.Label.type](this);this.fx=new y.Plot(this,y);this.op=new y.Op(this);this.json=null;this.root=null;this.busy=false;this.parent=false;this.initializeExtras()},createLevelDistanceFunc:function(){var x=this.config.levelDistance;return function(y){return(y._depth+1)*x}},refresh:function(){this.compute();this.plot()},reposition:function(){this.compute("end")},plot:function(){this.fx.plot()},getNodeAndParentAngle:function(E){var z=false;var D=this.graph.getNode(E);var B=D.getParents();var A=(B.length>0)?B[0]:false;if(A){var x=A.pos.getc(),C=D.pos.getc();var y=x.add(C.scale(-1));z=Math.atan2(y.y,y.x);if(z<0){z+=2*Math.PI}}return{parent:A,theta:z}},tagChildren:function(B,D){if(B.angleSpan){var C=[];B.eachAdjacency(function(E){C.push(E.nodeTo)},"ignore");var x=C.length;for(var A=0;A<x&&D!=C[A].id;A++){}for(var z=(A+1)%x,y=0;D!=C[z].id;z=(z+1)%x){C[z].dist=y++}}},onClick:function(B,y){if(this.root!=B&&!this.busy){this.busy=true;this.root=B;that=this;this.controller.onBeforeCompute(this.graph.getNode(B));var z=this.getNodeAndParentAngle(B);this.tagChildren(z.parent,B);this.parent=z.parent;this.compute("end");var x=z.theta-z.parent.endPos.theta;this.graph.eachNode(function(C){C.endPos.set(C.endPos.getp().add(l(x,0)))});var A=this.config.interpolation;y=c.merge({onComplete:c.empty},y||{});this.fx.animate(c.merge({hideLabels:true,modes:[A]},y,{onComplete:function(){that.busy=false;y.onComplete()}}))}}});$jit.RGraph.$extend=true;(function(x){x.Op=new r({Implements:e.Op});x.Plot=new r({Implements:e.Plot});x.Label={};x.Label.Native=new r({Implements:e.Label.Native});x.Label.SVG=new r({Implements:e.Label.SVG,initialize:function(y){this.viz=y},placeLabel:function(I,C,D){var G=C.pos.getc(true),z=this.viz.canvas,A=z.translateOffsetX,y=z.translateOffsetY,H=z.scaleOffsetX,F=z.scaleOffsetY,E=z.getSize();var B={x:Math.round(G.x*H+A+E.width/2),y:Math.round(G.y*F+y+E.height/2)};I.setAttribute("x",B.x);I.setAttribute("y",B.y);D.onPlaceLabel(I,C)}});x.Label.HTML=new r({Implements:e.Label.HTML,initialize:function(y){this.viz=y},placeLabel:function(J,D,E){var H=D.pos.getc(true),A=this.viz.canvas,B=A.translateOffsetX,z=A.translateOffsetY,I=A.scaleOffsetX,G=A.scaleOffsetY,F=A.getSize();var C={x:Math.round(H.x*I+B+F.width/2),y:Math.round(H.y*G+z+F.height/2)};var y=J.style;y.left=C.x+"px";y.top=C.y+"px";y.display=this.fitsInCanvas(C,A)?"":"none";E.onPlaceLabel(J,D)}});x.Plot.NodeTypes=new r({none:{render:c.empty,contains:c.lambda(false)},circle:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.circle.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.circle.contains(A,B,z)}},ellipse:{render:function(B,z){var C=B.pos.getc(true),A=B.getData("width"),y=B.getData("height");this.nodeHelper.ellipse.render("fill",C,A,y,z)},contains:function(A,C){var B=A.pos.getc(true),z=A.getData("width"),y=A.getData("height");return this.nodeHelper.ellipse.contains(B,C,z,y)}},square:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.square.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.square.contains(A,B,z)}},rectangle:{render:function(B,z){var C=B.pos.getc(true),A=B.getData("width"),y=B.getData("height");this.nodeHelper.rectangle.render("fill",C,A,y,z)},contains:function(A,C){var B=A.pos.getc(true),z=A.getData("width"),y=A.getData("height");return this.nodeHelper.rectangle.contains(B,C,z,y)}},triangle:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.triangle.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.triangle.contains(A,B,z)}},star:{render:function(z,y){var B=z.pos.getc(true),A=z.getData("dim");this.nodeHelper.star.render("fill",B,A,y)},contains:function(y,B){var A=y.pos.getc(true),z=y.getData("dim");return this.nodeHelper.star.contains(A,B,z)}}});x.Plot.EdgeTypes=new r({none:c.empty,line:{render:function(y,z){var B=y.nodeFrom.pos.getc(true),A=y.nodeTo.pos.getc(true);this.edgeHelper.line.render(B,A,z)},contains:function(y,B){var A=y.nodeFrom.pos.getc(true),z=y.nodeTo.pos.getc(true);return this.edgeHelper.line.contains(A,z,B,this.edge.epsilon)}},arrow:{render:function(z,A){var E=z.nodeFrom.pos.getc(true),D=z.nodeTo.pos.getc(true),C=z.getData("dim"),B=z.data.$direction,y=(B&&B.length>1&&B[0]!=z.nodeFrom.id);this.edgeHelper.arrow.render(E,D,C,y,A)},contains:function(y,B){var A=y.nodeFrom.pos.getc(true),z=y.nodeTo.pos.getc(true);return this.edgeHelper.arrow.contains(A,z,B,this.edge.epsilon)}}})})($jit.RGraph);q.prototype.moebiusTransformation=function(z){var x=this.add(z);var y=z.$conjugate().$prod(this);y.x++;return x.$div(y)};e.Util.moebiusTransformation=function(z,B,A,y,x){this.eachNode(z,function(D){for(var C=0;C<A.length;C++){var F=B[C].scale(-1),E=y?y:A[C];D.getPos(A[C]).set(D.getPos(E).getc().moebiusTransformation(F))}},x)};$jit.Hypertree=new r({Implements:[d,p,g.Radial],initialize:function(x){var A=$jit.Hypertree;var y={radius:"auto",offset:0,Edge:{type:"hyperline"},duration:1500,fps:35};this.controller=this.config=c.merge(o("Canvas","Node","Edge","Fx","Tips","NodeStyles","Events","Navigation","Controller","Label"),y,x);var z=this.config;if(z.useCanvas){this.canvas=z.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(z.background){z.background=c.merge({type:"Circles"},z.background)}this.canvas=new m(this,z);this.config.labelContainer=(typeof z.injectInto=="string"?z.injectInto:z.injectInto.id)+"-label"}this.graphOptions={complex:false,Node:{selected:false,exist:true,drawn:true}};this.graph=new e(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new A.Label[z.Label.type](this);this.fx=new A.Plot(this,A);this.op=new A.Op(this);this.json=null;this.root=null;this.busy=false;this.initializeExtras()},createLevelDistanceFunc:function(){var B=this.getRadius();var D=0,x=Math.max,y=this.config;this.graph.eachNode(function(E){D=x(E._depth,D)},"ignore");D++;var C=function(E){return function(G){G.scale=B;var I=G._depth+1;var H=0,F=Math.pow;while(I){H+=F(E,I--)}return H-y.offset}};for(var A=0.51;A<=1;A+=0.01){var z=(1-Math.pow(A,D))/(1-A);if(z>=2){return C(A-0.01)}}return C(0.75)},getRadius:function(){var x=this.config.radius;if(x!=="auto"){return x}var y=this.canvas.getSize();return Math.min(y.width,y.height)/2},refresh:function(x){if(x){this.reposition();this.graph.eachNode(function(y){y.startPos.rho=y.pos.rho=y.endPos.rho;y.startPos.theta=y.pos.theta=y.endPos.theta})}else{this.compute()}this.plot()},reposition:function(){this.compute("end");var x=this.graph.getNode(this.root).pos.getc().scale(-1);e.Util.moebiusTransformation(this.graph,[x],["end"],"end","ignore");this.graph.eachNode(function(y){if(y.ignore){y.endPos.rho=y.pos.rho;y.endPos.theta=y.pos.theta}})},plot:function(){this.fx.plot()},onClick:function(z,x){var y=this.graph.getNode(z).pos.getc(true);this.move(y,x)},move:function(B,z){var y=s(B.x,B.y);if(this.busy===false&&y.norm()<1){this.busy=true;var x=this.graph.getClosestNodeToPos(y),A=this;this.graph.computeLevels(x.id,0);this.controller.onBeforeCompute(x);z=c.merge({onComplete:c.empty},z||{});this.fx.animate(c.merge({modes:["moebius"],hideLabels:true},z,{onComplete:function(){A.busy=false;z.onComplete()}}),y)}}});$jit.Hypertree.$extend=true;(function(x){x.Op=new r({Implements:e.Op});x.Plot=new r({Implements:e.Plot});x.Label={};x.Label.Native=new r({Implements:e.Label.Native,initialize:function(y){this.viz=y},renderLabel:function(A,C,z){var y=A.getCtx();var D=C.pos.getc(true);var B=this.viz.getRadius();y.fillText(C.name,D.x*B,D.y*B)}});x.Label.SVG=new r({Implements:e.Label.SVG,initialize:function(y){this.viz=y},placeLabel:function(J,D,E){var H=D.pos.getc(true),A=this.viz.canvas,B=A.translateOffsetX,z=A.translateOffsetY,I=A.scaleOffsetX,G=A.scaleOffsetY,F=A.getSize(),y=this.viz.getRadius();var C={x:Math.round((H.x*I)*y+B+F.width/2),y:Math.round((H.y*G)*y+z+F.height/2)};J.setAttribute("x",C.x);J.setAttribute("y",C.y);E.onPlaceLabel(J,D)}});x.Label.HTML=new r({Implements:e.Label.HTML,initialize:function(y){this.viz=y},placeLabel:function(K,E,F){var I=E.pos.getc(true),B=this.viz.canvas,C=B.translateOffsetX,A=B.translateOffsetY,J=B.scaleOffsetX,H=B.scaleOffsetY,G=B.getSize(),y=this.viz.getRadius();var D={x:Math.round((I.x*J)*y+C+G.width/2),y:Math.round((I.y*H)*y+A+G.height/2)};var z=K.style;z.left=D.x+"px";z.top=D.y+"px";z.display=this.fitsInCanvas(D,B)?"":"none";F.onPlaceLabel(K,E)}});x.Plot.NodeTypes=new r({none:{render:c.empty,contains:c.lambda(false)},circle:{render:function(A,y){var z=this.node,C=A.getData("dim"),B=A.pos.getc();C=z.transform?C*(1-B.squaredNorm()):C;B.$scale(A.scale);if(C>0.2){this.nodeHelper.circle.render("fill",B,C,y)}},contains:function(y,B){var z=y.getData("dim"),A=y.pos.getc().$scale(y.scale);return this.nodeHelper.circle.contains(A,B,z)}},ellipse:{render:function(B,z){var C=B.pos.getc().$scale(B.scale),A=B.getData("width"),y=B.getData("height");this.nodeHelper.ellipse.render("fill",C,A,y,z)},contains:function(A,C){var z=A.getData("width"),y=A.getData("height"),B=A.pos.getc().$scale(A.scale);return this.nodeHelper.circle.contains(B,C,z,y)}},square:{render:function(A,y){var z=this.node,C=A.getData("dim"),B=A.pos.getc();C=z.transform?C*(1-B.squaredNorm()):C;B.$scale(A.scale);if(C>0.2){this.nodeHelper.square.render("fill",B,C,y)}},contains:function(y,B){var z=y.getData("dim"),A=y.pos.getc().$scale(y.scale);return this.nodeHelper.square.contains(A,B,z)}},rectangle:{render:function(C,z){var B=this.node,A=C.getData("width"),y=C.getData("height"),D=C.pos.getc();A=B.transform?A*(1-D.squaredNorm()):A;y=B.transform?y*(1-D.squaredNorm()):y;D.$scale(C.scale);if(A>0.2&&y>0.2){this.nodeHelper.rectangle.render("fill",D,A,y,z)}},contains:function(A,C){var z=A.getData("width"),y=A.getData("height"),B=A.pos.getc().$scale(A.scale);return this.nodeHelper.square.contains(B,C,z,y)}},triangle:{render:function(A,y){var z=this.node,C=A.getData("dim"),B=A.pos.getc();C=z.transform?C*(1-B.squaredNorm()):C;B.$scale(A.scale);if(C>0.2){this.nodeHelper.triangle.render("fill",B,C,y)}},contains:function(y,B){var z=y.getData("dim"),A=y.pos.getc().$scale(y.scale);return this.nodeHelper.triangle.contains(A,B,z)}},star:{render:function(A,y){var z=this.node,C=A.getData("dim"),B=A.pos.getc();C=z.transform?C*(1-B.squaredNorm()):C;B.$scale(A.scale);if(C>0.2){this.nodeHelper.star.render("fill",B,C,y)}},contains:function(y,B){var z=y.getData("dim"),A=y.pos.getc().$scale(y.scale);return this.nodeHelper.star.contains(A,B,z)}}});x.Plot.EdgeTypes=new r({none:c.empty,line:{render:function(y,z){var C=y.nodeFrom.pos.getc(true),B=y.nodeTo.pos.getc(true),A=y.nodeFrom.scale;this.edgeHelper.line.render({x:C.x*A,y:C.y*A},{x:B.x*A,y:B.y*A},z)},contains:function(y,C){var B=y.nodeFrom.pos.getc(true),A=y.nodeTo.pos.getc(true),z=y.nodeFrom.scale;this.edgeHelper.line.contains({x:B.x*z,y:B.y*z},{x:A.x*z,y:A.y*z},C,this.edge.epsilon)}},arrow:{render:function(z,A){var F=z.nodeFrom.pos.getc(true),E=z.nodeTo.pos.getc(true),B=z.nodeFrom.scale,D=z.getData("dim"),C=z.data.$direction,y=(C&&C.length>1&&C[0]!=z.nodeFrom.id);this.edgeHelper.arrow.render({x:F.x*B,y:F.y*B},{x:E.x*B,y:E.y*B},D,y,A)},contains:function(y,C){var B=y.nodeFrom.pos.getc(true),A=y.nodeTo.pos.getc(true),z=y.nodeFrom.scale;this.edgeHelper.arrow.contains({x:B.x*z,y:B.y*z},{x:A.x*z,y:A.y*z},C,this.edge.epsilon)}},hyperline:{render:function(y,z){var C=y.nodeFrom.pos.getc(),B=y.nodeTo.pos.getc(),A=this.viz.getRadius();this.edgeHelper.hyperline.render(C,B,A,z)},contains:c.lambda(false)}})})($jit.Hypertree)})();jQuery.fn.wiggle=function(b){var a={speed:50,wiggles:3,travel:5,callback:null};var b=jQuery.extend(a,b);return this.each(function(){var c=this;var e=jQuery(this).wrap('<div class="wiggle-wrap"></div>').css("position","relative");var d=0;for(i=1;i<=b.wiggles;i++){jQuery(this).animate({left:"-="+b.travel},b.speed).animate({left:"+="+b.travel*2},b.speed*2).animate({left:"-="+b.travel},b.speed,function(){d++;if(jQuery(c).parent().hasClass("wiggle-wrap")){jQuery(c).parent().replaceWith(c)}if(d==b.wiggles&&jQuery.isFunction(b.callback)){b.callback()}})}})};jQuery.fn.bob=function(b){var a={speed:50,bobs:3,travel:5,callback:null};var b=jQuery.extend(a,b);return this.each(function(){var c=this;var e=jQuery(this).wrap('<div class="bob-wrap"></div>').css("position","relative");var d=0;for(i=1;i<=b.bobs;i++){jQuery(this).animate({top:"-="+b.travel},b.speed).animate({top:"+="+b.travel*2},b.speed*2).animate({top:"-="+b.travel},b.speed,function(){d++;if(jQuery(c).parent().hasClass("bob-wrap")){jQuery(c).parent().replaceWith(c)}if(d==b.bobs&&jQuery.isFunction(b.callback)){b.callback()}})}})};!function(e){var b;e(document).ready(function(){e.support.transition=(function(){var g=document.body||document.documentElement,h=g.style,f=h.transition!==undefined||h.WebkitTransition!==undefined||h.MozTransition!==undefined||h.MsTransition!==undefined||h.OTransition!==undefined;return f})();if(e.support.transition){b="TransitionEnd";if(e.browser.webkit){b="webkitTransitionEnd"}else{if(e.browser.mozilla){b="transitionend"}else{if(e.browser.opera){b="oTransitionEnd"}}}}});var a=function(g,f){this.settings=e.extend({},e.fn.modal.defaults);this.$element=e(g).delegate(".close","click.modal",e.proxy(this.hide,this));if(f){e.extend(this.settings,f);if(f.show){this.show()}}return this};a.prototype={toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var f=this;this.isShown=true;this.$element.trigger("show");d.call(this);c.call(this,function(){f.$element.appendTo(document.body).show();if(e.support.transition&&f.$element.hasClass("fade")){f.$element[0].offsetWidth}f.$element.addClass("in").trigger("shown")});return this},hide:function(h){h&&h.preventDefault();var g=this;this.isShown=false;d.call(this);this.$element.trigger("hide").removeClass("in");function f(){g.$element.hide().trigger("hidden");c.call(g)}e.support.transition&&this.$element.hasClass("fade")?this.$element.one(b,f):f();return this}};function c(k){var j=this,h=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.settings.backdrop){var g=e.support.transition&&h;this.$backdrop=e('<div class="modal-backdrop '+h+'" />').appendTo(document.body);if(this.settings.backdrop!="static"){this.$backdrop.click(e.proxy(this.hide,this))}if(g){this.$backdrop[0].offsetWidth}this.$backdrop.addClass("in");g?this.$backdrop.one(b,k):k()}else{if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");function f(){j.$backdrop.remove();j.$backdrop=null}e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(b,f):f()}else{if(k){k()}}}}function d(){var f=this;if(this.isShown&&this.settings.keyboard){e(document).bind("keyup.modal",function(g){if(g.which==27){f.hide()}})}else{if(!this.isShown){e(document).unbind("keyup.modal")}}}e.fn.modal=function(f){var g=this.data("modal");if(!g){if(typeof f=="string"){f={show:/show|toggle/.test(f)}}return this.each(function(){e(this).data("modal",new a(this,f))})}if(f===true){return g}if(typeof f=="string"){g[f]()}else{if(g){g.toggle()}}return this};e.fn.modal.Modal=a;e.fn.modal.defaults={backdrop:false,keyboard:false,show:true};e(document).ready(function(){e("body").delegate("[data-controls-modal]","click",function(g){g.preventDefault();var f=e(this).data("show",true);e("#"+f.attr("data-controls-modal")).modal(f.data())})})}(window.jQuery||window.ender);!function(c){var a;c(document).ready(function(){c.support.transition=(function(){var e=document.body||document.documentElement,f=e.style,d=f.transition!==undefined||f.WebkitTransition!==undefined||f.MozTransition!==undefined||f.MsTransition!==undefined||f.OTransition!==undefined;return d})();if(c.support.transition){a="TransitionEnd";if(c.browser.webkit){a="webkitTransitionEnd"}else{if(c.browser.mozilla){a="transitionend"}else{if(c.browser.opera){a="oTransitionEnd"}}}}});var b=function(e,d){this.$element=c(e).delegate(d||".close","click",this.close)};b.prototype={close:function(g){var f=c(this).parent(".alert-message");g&&g.preventDefault();f.removeClass("in");function d(){f.remove()}c.support.transition&&f.hasClass("fade")?f.bind(a,d):d()}};c.fn.alert=function(d){if(d===true){return this.data("alert")}return this.each(function(){var e=c(this);if(typeof d=="string"){return e.data("alert")[d]()}c(this).data("alert",new b(this))})};c(document).ready(function(){new b(c("body"),".alert-message[data-alert] .close")})}(window.jQuery||window.ender);!function(b){var c="a.menu, .dropdown-toggle";function a(){b(c).parent("li").removeClass("open")}b(function(){b("html").bind("click",a);b("body").dropdown("[data-dropdown] a.menu, [data-dropdown] .dropdown-toggle")});b.fn.dropdown=function(d){return this.each(function(){b(this).delegate(d||c,"click",function(h){var f=b(this).parent("li"),g=f.hasClass("open");a();!g&&f.toggleClass("open");return false})})}}(window.jQuery||window.ender);!function(c){var a;c(document).ready(function(){c.support.transition=(function(){var f=document.body||document.documentElement,g=f.style,e=g.transition!==undefined||g.WebkitTransition!==undefined||g.MozTransition!==undefined||g.MsTransition!==undefined||g.OTransition!==undefined;return e})();if(c.support.transition){a="TransitionEnd";if(c.browser.webkit){a="webkitTransitionEnd"}else{if(c.browser.mozilla){a="transitionend"}else{if(c.browser.opera){a="oTransitionEnd"}}}}});var d=function(f,e){this.$element=c(f);this.options=e;this.enabled=true;this.fixTitle()};d.prototype={show:function(){var k,f,j,e,h,g;if(this.getTitle()&&this.enabled){h=this.tip();this.setContent();if(this.options.animate){h.addClass("fade")}h.remove().css({top:0,left:0,display:"block"}).prependTo(document.body);k=c.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});f=h[0].offsetWidth;j=h[0].offsetHeight;e=b.maybeCall(this.options.placement,this.$element[0]);switch(e){case"below":g={top:k.top+k.height+this.options.offset,left:k.left+k.width/2-f/2};break;case"above":g={top:k.top-j-this.options.offset,left:k.left+k.width/2-f/2};break;case"left":g={top:k.top+k.height/2-j/2,left:k.left-f-this.options.offset};break;case"right":g={top:k.top+k.height/2-j/2,left:k.left+k.width+this.options.offset};break}h.css(g).addClass(e).addClass("in")}},setContent:function(){var e=this.tip();e.find(".twipsy-inner")[this.options.html?"html":"text"](this.getTitle());e[0].className="twipsy"},hide:function(){var f=this,g=this.tip();g.removeClass("in");function e(){g.remove()}c.support.transition&&this.$tip.hasClass("fade")?g.bind(a,e):e()},fixTitle:function(){var e=this.$element;if(e.attr("title")||typeof(e.attr("data-original-title"))!="string"){e.attr("data-original-title",e.attr("title")||"").removeAttr("title")}},getTitle:function(){var g,e=this.$element,f=this.options;this.fixTitle();if(typeof f.title=="string"){g=e.attr(f.title=="title"?"data-original-title":f.title)}else{if(typeof f.title=="function"){g=f.title.call(e[0])}}g=(""+g).replace(/(^\s*|\s*$)/,"");return g||f.fallback},tip:function(){if(!this.$tip){this.$tip=c('<div class="twipsy" />').html('<div class="twipsy-arrow"></div><div class="twipsy-inner"></div>')}return this.$tip},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled}};var b={maybeCall:function(f,e){return(typeof f=="function")?(f.call(e)):f}};c.fn.twipsy=function(e){c.fn.twipsy.initWith.call(this,e,d,"twipsy");return this};c.fn.twipsy.initWith=function(o,k,e){var n,m,h,g;if(o===true){return this.data(e)}else{if(typeof o=="string"){n=this.data(e);if(n){n[o]()}return this}}o=c.extend({},c.fn[e].defaults,o);function f(q){var p=c.data(q,e);if(!p){p=new k(q,c.fn.twipsy.elementOptions(q,o));c.data(q,e,p)}return p}function j(){var p=f(this);p.hoverState="in";if(o.delayIn==0){p.show()}else{p.fixTitle();setTimeout(function(){if(p.hoverState=="in"){p.show()}},o.delayIn)}}function l(){var p=f(this);p.hoverState="out";if(o.delayOut==0){p.hide()}else{setTimeout(function(){if(p.hoverState=="out"){p.hide()}},o.delayOut)}}if(!o.live){this.each(function(){f(this)})}if(o.trigger!="manual"){m=o.live?"live":"bind";h=o.trigger=="hover"?"mouseenter":"focus";g=o.trigger=="hover"?"mouseleave":"blur";this[m](h,j)[m](g,l)}return this};c.fn.twipsy.Twipsy=d;c.fn.twipsy.defaults={animate:true,delayIn:0,delayOut:0,fallback:"",placement:"above",html:false,live:false,offset:0,title:"title",trigger:"hover"};c.fn.twipsy.elementOptions=function(f,e){return c.metadata?c.extend({},e,c(f).metadata()):e}}(window.jQuery||window.ender);!function(c){function b(e,d){d.find(".active").removeClass("active");e.addClass("active")}function a(j){var h=c(this),d=h.attr("href"),g=h.closest("ul"),f;if(/^#\w+/.test(d)){j.preventDefault();if(h.hasClass("active")){return}$href=c(d);b(h.parent("li"),g);b($href,$href.parent())}}c.fn.tabs=c.fn.pills=function(d){return this.each(function(){c(this).delegate(d||".tabs li > a, .pills > li > a","click",a)})};c(document).ready(function(){c("body").tabs("ul[data-tabs] li > a, ul[data-pills] > li > a")})}(window.jQuery||window.ender);!function(b){var a=function(d,c){this.$element=b(d);this.options=c;this.enabled=true;this.fixTitle()};a.prototype=b.extend({},b.fn.twipsy.Twipsy.prototype,{setContent:function(){var c=this.tip();c.find(".title")[this.options.html?"html":"text"](this.getTitle());c.find(".content p")[this.options.html?"html":"text"](this.getContent());c[0].className="popover"},getContent:function(){var d,c=this.$element,e=this.options;if(typeof this.options.content=="string"){d=c.attr(e.content)}else{if(typeof this.options.content=="function"){d=this.options.content.call(this.$element[0])}}return d},tip:function(){if(!this.$tip){this.$tip=b('<div class="popover" />').html('<div class="arrow"></div><div class="inner"><h3 class="title"></h3><div class="content"><p></p></div></div>')}return this.$tip}});b.fn.popover=function(c){if(typeof c=="object"){c=b.extend({},b.fn.popover.defaults,c)}b.fn.twipsy.initWith.call(this,c,a,"popover");return this};b.fn.popover.defaults=b.extend({},b.fn.twipsy.defaults,{content:"data-content",placement:"right"})}(window.jQuery||window.ender);(function(){var h;if(typeof exports!=="undefined"){h=exports}else{h=this.Spine={}}h.version="0.0.4";var e=h.$=this.jQuery||this.Zepto||function(){return arguments[0]};var b=h.makeArray=function(m){return Array.prototype.slice.call(m,0)};var g=h.isArray=function(m){return Object.prototype.toString.call(m)=="[object Array]"};if(typeof Array.prototype.indexOf==="undefined"){Array.prototype.indexOf=function(n){for(var m=0;m<this.length;m++){if(this[m]===n){return m}}return -1}}var l=h.Events={bind:function(p,q){var m=p.split(" ");var o=this._callbacks||(this._callbacks={});for(var n=0;n<m.length;n++){(this._callbacks[m[n]]||(this._callbacks[m[n]]=[])).push(q)}return this},trigger:function(){var n=b(arguments);var q=n.shift();var r,p,o,m;if(!(p=this._callbacks)){return false}if(!(r=this._callbacks[q])){return false}for(o=0,m=r.length;o<m;o++){if(r[o].apply(this,n)===false){break}}return true},unbind:function(p,r){if(!p){this._callbacks={};return this}var q,o,n,m;if(!(o=this._callbacks)){return this}if(!(q=this._callbacks[p])){return this}if(!r){delete this._callbacks[p];return this}for(n=0,m=q.length;n<m;n++){if(r===q[n]){q.splice(n,1);break}}return this}};var f=h.Log={trace:true,logPrefix:"(App)",log:function(){if(!this.trace){return}if(typeof console=="undefined"){return}var m=b(arguments);if(this.logPrefix){m.unshift(this.logPrefix)}console.log.apply(console,m);return this}};if(typeof Object.create!=="function"){Object.create=function(n){function m(){}m.prototype=n;return new m()}}var j=["included","extended"];var a=h.Class={inherited:function(){},created:function(){},prototype:{initialize:function(){},init:function(){}},create:function(m,o){var n=Object.create(this);n.parent=this;n.prototype=n.fn=Object.create(this.prototype);if(m){n.include(m)}if(o){n.extend(o)}n.created();this.inherited(n);return n},init:function(){var m=Object.create(this.prototype);m.parent=this;m.initialize.apply(m,arguments);m.init.apply(m,arguments);return m},proxy:function(n){var m=this;return(function(){return n.apply(m,arguments)})},proxyAll:function(){var n=b(arguments);for(var m=0;m<n.length;m++){this[n[m]]=this.proxy(this[n[m]])}},include:function(o){for(var m in o){if(j.indexOf(m)==-1){this.fn[m]=o[m]}}var n=o.included;if(n){n.apply(this)}return this},extend:function(o){for(var n in o){if(j.indexOf(n)==-1){this[n]=o[n]}}var m=o.extended;if(m){m.apply(this)}return this}};a.prototype.proxy=a.proxy;a.prototype.proxyAll=a.proxyAll;a.instancet=a.init;a.sub=a.create;h.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){var n=Math.random()*16|0,m=o=="x"?n:(n&3|8);return m.toString(16)}).toUpperCase()};var c=h.Model=a.create();c.extend(l);c.extend({setup:function(n,o){var m=c.sub();if(n){m.name=n}if(o){m.attributes=o}return m},created:function(m){this.records={};this.attributes=this.attributes?b(this.attributes):[]},find:function(n){var m=this.records[n];if(!m){throw ("Unknown record")}return m.clone()},exists:function(n){try{return this.find(n)}catch(m){return false}},refresh:function(o){o=this.fromJSON(o);this.records={};for(var p=0,n=o.length;p<n;p++){var m=o[p];m.newRecord=false;m.id=m.id||h.guid();this.records[m.id]=m}this.trigger("refresh");return this},createAll:function(o){o=this.fromJSON(o);for(var p=0,n=o.length;p<n;p++){var m=o[p];m.newRecord=false;m.id=m.id||h.guid();this.records[m.id]=m}return this},select:function(o){var m=[];for(var n in this.records){if(o(this.records[n])){m.push(this.records[n])}}return this.cloneArray(m)},findByAttribute:function(m,o){for(var n in this.records){if(this.records[n][m]==o){return this.records[n].clone()}}},findAllByAttribute:function(m,n){return(this.select(function(o){return(o[m]==n)}))},each:function(n){for(var m in this.records){n(this.records[m])}},all:function(){return this.cloneArray(this.recordsValues())},first:function(){var m=this.recordsValues()[0];return(m&&m.clone())},last:function(){var n=this.recordsValues();var m=n[n.length-1];return(m&&m.clone())},count:function(){return this.recordsValues().length},deleteAll:function(){for(var m in this.records){delete this.records[m]}},destroyAll:function(){for(var m in this.records){this.records[m].destroy()}},update:function(n,m){this.find(n).updateAttributes(m)},create:function(n){var m=this.init(n);return m.save()},destroy:function(m){this.find(m).destroy()},sync:function(m){this.bind("change",m)},fetch:function(m){typeof(m)=="function"?this.bind("fetch",m):this.trigger("fetch",m)},toJSON:function(){return this.recordsValues()},fromJSON:function(o){if(!o){return}if(typeof o=="string"){o=JSON.parse(o)}if(g(o)){var n=[];for(var m=0;m<o.length;m++){n.push(this.init(o[m]))}return n}else{return this.init(o)}},recordsValues:function(){var m=[];for(var n in this.records){m.push(this.records[n])}return m},cloneArray:function(o){var m=[];for(var n=0;n<o.length;n++){m.push(o[n].clone())}return m},logAll:function(){for(var m=0;m<this.all().length;m++){var n=this.all()[m];if(window.console){console.log(n.toString())}}}});c.include({model:true,newRecord:true,init:function(m){if(m){this.load(m)}this.trigger("init",this)},isNew:function(){return this.newRecord},isValid:function(){return(!this.validate())},validate:function(){},load:function(n){for(var m in n){this[m]=n[m]}},attributes:function(){var n={};for(var o=0;o<this.parent.attributes.length;o++){var m=this.parent.attributes[o];n[m]=this[m]}n.id=this.id;return n},eql:function(m){return(m&&m.id===this.id&&m.parent===this.parent)},save:function(){var m=this.validate();if(m){this.trigger("error",this,m);return false}this.trigger("beforeSave",this);this.newRecord?this.create():this.update();this.trigger("save",this);return this},updateAttribute:function(m,n){this[m]=n;return this.save()},updateAttributes:function(m){this.load(m);return this.save()},destroy:function(){this.trigger("beforeDestroy",this);delete this.parent.records[this.id];this.destroyed=true;this.trigger("destroy",this);this.trigger("change",this,"destroy")},dup:function(){var m=this.parent.init(this.attributes());m.newRecord=this.newRecord;return m},clone:function(){return Object.create(this)},reload:function(){if(this.newRecord){return this}var m=this.parent.find(this.id);this.load(m.attributes());return m},toJSON:function(){return(this.attributes())},exists:function(){return(this.id&&this.id in this.parent.records)},update:function(){this.trigger("beforeUpdate",this);var m=this.parent.records;m[this.id].load(this.attributes());var n=m[this.id].clone();this.trigger("update",n);this.trigger("change",n,"update")},create:function(){this.trigger("beforeCreate",this);if(!this.id){this.id=h.guid()}this.newRecord=false;var m=this.parent.records;m[this.id]=this.dup();var n=m[this.id].clone();this.trigger("create",n);this.trigger("change",n,"create")},bind:function(m,n){return this.parent.bind(m,this.proxy(function(o){if(o&&this.eql(o)){n.apply(this,arguments)}}))},trigger:function(){return this.parent.trigger.apply(this.parent,arguments)}});var k=/^(\w+)\s*(.*)$/;var d=h.Controller=a.create({tag:"div",initialize:function(m){this.options=m;for(var n in this.options){this[n]=this.options[n]}if(!this.el){this.el=document.createElement(this.tag)}this.el=e(this.el);if(!this.events){this.events=this.parent.events}if(!this.elements){this.elements=this.parent.elements}if(this.events){this.delegateEvents()}if(this.elements){this.refreshElements()}if(this.proxied){this.proxyAll.apply(this,this.proxied)}},$:function(m){return e(m,this.el)},delegateEvents:function(){for(var q in this.events){var o=this.events[q];var r=this.proxy(this[o]);var p=q.match(k);var n=p[1],m=p[2];if(m===""){this.el.bind(n,r)}else{this.el.delegate(m,n,r)}}},refreshElements:function(){for(var m in this.elements){this[this.elements[m]]=this.$(m)}},delay:function(m,n){setTimeout(this.proxy(m),n||0)}});d.include(l);d.include(f);h.App=a.create();h.App.extend(l);d.fn.App=h.App})();var stemText=function(d){var a=d.split(" ");var c=new Array();for(var b=0;b<a.length;b++){var e=a[b];c.push(stemmer(e))}return c.join(" ")};var stemmer=(function(){var h={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},e={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},j="[^aeiou]",l="[aeiouy]",a=j+"[^aeiouy]*",g=l+"[aeiou]*",f="^("+a+")?"+g+a,b="^("+a+")?"+g+a+"("+g+")?$",d="^("+a+")?"+g+a+g+a,k="^("+a+")?"+l;return function(r){var m,t,s,u,p,o,n,c=r;if(r.length<3){return r}s=r.substr(0,1);if(s=="y"){r=s.toUpperCase()+r.substr(1)}u=/^(.+?)(ss|i)es$/;p=/^(.+?)([^s])s$/;if(u.test(r)){r=r.replace(u,"$1$2")}else{if(p.test(r)){r=r.replace(p,"$1$2")}}u=/^(.+?)eed$/;p=/^(.+?)(ed|ing)$/;if(u.test(r)){var q=u.exec(r);u=new RegExp(f);if(u.test(q[1])){u=/.$/;r=r.replace(u,"")}}else{if(p.test(r)){var q=p.exec(r);m=q[1];p=new RegExp(k);if(p.test(m)){r=m;p=/(at|bl|iz)$/;o=new RegExp("([^aeiouylsz])\\1$");n=new RegExp("^"+a+l+"[^aeiouwxy]$");if(p.test(r)){r=r+"e"}else{if(o.test(r)){u=/.$/;r=r.replace(u,"")}else{if(n.test(r)){r=r+"e"}}}}}}u=/^(.+?)y$/;if(u.test(r)){var q=u.exec(r);m=q[1];u=new RegExp(k);if(u.test(m)){r=m+"i"}}u=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/;if(u.test(r)){var q=u.exec(r);m=q[1];t=q[2];u=new RegExp(f);if(u.test(m)){r=m+h[t]}}u=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/;if(u.test(r)){var q=u.exec(r);m=q[1];t=q[2];u=new RegExp(f);if(u.test(m)){r=m+e[t]}}u=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;p=/^(.+?)(s|t)(ion)$/;if(u.test(r)){var q=u.exec(r);m=q[1];u=new RegExp(d);if(u.test(m)){r=m}}else{if(p.test(r)){var q=p.exec(r);m=q[1]+q[2];p=new RegExp(d);if(p.test(m)){r=m}}}u=/^(.+?)e$/;if(u.test(r)){var q=u.exec(r);m=q[1];u=new RegExp(d);p=new RegExp(b);o=new RegExp("^"+a+l+"[^aeiouwxy]$");if(u.test(m)||(p.test(m)&&!(o.test(m)))){r=m}}u=/ll$/;p=new RegExp(d);if(u.test(r)&&p.test(r)){u=/.$/;r=r.replace(u,"")}if(s=="y"){r=s.toLowerCase()+r.substr(1)}return r}})();var pageController=null;var pageParams=new Object();jQuery(function($){jQuery.fn.putCursorAtEnd=function(){return this.each(function(){$(this).focus();if(this.setSelectionRange){var len=$(this).val().length*2;this.setSelectionRange(len,len)}else{$(this).val($(this).val())}this.scrollTop=999999})};var utils=new function(){this.prettyDate=function(time){var date=new Date((time||"").replace(/-/g,"/").replace(/[TZ]/g," ")),diff=(((new Date()).getTime()-date.getTime())/1000),day_diff=Math.floor(diff/86400);if(isNaN(day_diff)||day_diff<0||day_diff>=31){return}return day_diff==0&&(diff<60&&"just now"||diff<120&&"1 minute ago"||diff<3600&&Math.floor(diff/60)+" minutes ago"||diff<7200&&"1 hour ago"||diff<86400&&Math.floor(diff/3600)+" hours ago")||day_diff==1&&"Yesterday"||day_diff<7&&day_diff+" days ago"||day_diff<31&&Math.ceil(day_diff/7)+" weeks ago"};this.get_selection=function(the_id){var e=document.getElementById(the_id);if("selectionStart" in e){var l=e.selectionEnd-e.selectionStart;return{start:e.selectionStart,end:e.selectionEnd,length:l,text:e.value.substr(e.selectionStart,l)}}else{if(document.selection){e.focus();var r=document.selection.createRange();var tr=e.createTextRange();var tr2=tr.duplicate();tr2.moveToBookmark(r.getBookmark());tr.setEndPoint("EndToStart",tr2);if(r==null||tr==null){return{start:e.value.length,end:e.value.length,length:0,text:""}}var text_part=r.text.replace(/[\r\n]/g,".");var text_whole=e.value.replace(/[\r\n]/g,".");var the_start=text_whole.indexOf(text_part,tr.text.length);return{start:the_start,end:the_start+text_part.length,length:text_part.length,text:r.text}}else{return{start:e.value.length,end:e.value.length,length:0,text:""}}}};this.replace_selection=function(the_id,replace_str){var e=document.getElementById(the_id);selection=get_selection(the_id);var start_pos=selection.start;var end_pos=start_pos+replace_str.length;e.value=e.value.substr(0,start_pos)+replace_str+e.value.substr(selection.end,e.value.length);set_selection(the_id,start_pos,end_pos);return{start:start_pos,end:end_pos,length:replace_str.length,text:replace_str}};this.set_selection=function(the_id,start_pos,end_pos){var e=document.getElementById(the_id);if("selectionStart" in e){e.focus();e.selectionStart=start_pos;e.selectionEnd=end_pos}else{if(document.selection){e.focus();var tr=e.createTextRange();var stop_it=start_pos;for(i=0;i<stop_it;i++){if(e.value[i].search(/[\r\n]/)!=-1){start_pos=start_pos-0.5}}stop_it=end_pos;for(i=0;i<stop_it;i++){if(e.value[i].search(/[\r\n]/)!=-1){end_pos=end_pos-0.5}}tr.moveEnd("textedit",-1);tr.moveStart("character",start_pos);tr.moveEnd("character",end_pos-start_pos);tr.select()}}return get_selection(the_id)};this.wrap_selection=function(the_id,left_str,right_str,sel_offset,sel_length){var the_sel_text=get_selection(the_id).text;var selection=replace_selection(the_id,left_str+the_sel_text+right_str);if(sel_offset!==undefined&&sel_length!==undefined){selection=set_selection(the_id,selection.start+sel_offset,selection.start+sel_offset+sel_length)}else{if(the_sel_text==""){selection=set_selection(the_id,selection.start+left_str.length,selection.start+left_str.length)}}return selection};this.traceObject=function(msg){if(window.console){console.log(msg)}};this.trace=function(msg){if(window.console){console.log("ode.la: "+msg)}if(!(typeof msg=="string")){utils.traceObject(msg)}};this.traceMap=function(paramsObj){var k;for(k in paramsObj){var v=paramsObj[k];utils.trace("ode.la: "+k+" = "+v)}};this.error=function(msg){if(window.console){console.log("ode.la/ERROR: "+msg)}};this.warn=function(msg){if(window.console){console.log("ode.la/WARN: "+msg)}};this.replaceLBWithBR=function(str){return str.replace(/(\r\n|\r|\n)/g,"<br/>")};this.loadScript=function(source,onloadCallback){var script_tag=document.createElement("script");script_tag.setAttribute("type","text/javascript");script_tag.setAttribute("src",source);script_tag.onload=onloadCallback;var ref=this;script_tag.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){onloadCallback()}};(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(script_tag)};this.truncateTo=function(str,maxLength){if(str.length>maxLength){return str.substr(0,maxLength-3)+"..."}else{return str}};this.shuffle=function(array){var tmp,current,top=array.length;if(top){while(--top){current=Math.floor(Math.random()*(top+1));tmp=array[current];array[current]=array[top];array[top]=tmp}}return array};this.randomNumber=function(from,to){return Math.floor(Math.random()*(to-from+1)+from)};this.randomFloat=function(from,to){return Math.random()*(to-from+1)+from};this.nl2br=function(str,is_xhtml){var breakTag=(is_xhtml||typeof is_xhtml==="undefined")?"<br />":"<br>";return(str+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+breakTag+"$2")};this.createCookie=function(name,value,days){var expires="";if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString()}document.cookie=name+"="+value+expires+"; path=/"};this.readCookie=function(name){var prefix=name+"=";var cookieArray=document.cookie.split(";");for(var i=0;i<cookieArray.length;i++){var c=cookieArray[i];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(prefix)==0){return c.substring(prefix.length,c.length)}}return null};this.eraseCookie=function(name){this.createCookie(name,"",-1)};this.guid=function(){var S4=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return(S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4())}};var X=new function(){this._TOPBAR="topbar";this._AUTHOR="author";this._HOME="homepage";this._PROFILE="profile";this._FAVORITES="favorites";this._ODE="ode";this._SEARCH="search";this._EXPLORE="explore";this.SAVE_ODE="save-ode";this.PUBLISH_ODE="publish-ode";this.PLAY="play";this.PAUSE="pause-snippets";this.SKIP="skip-snippets";this.SHOW_RELATED="show-related";this.SHOW_RHYMES="show-rhymed";this.SHOW_SNIPPETS="show-snippets";this.HIDE_WIDGETS="hide-widgets";this.VIEW_PROFILE="view-profile";this.VIEW_ODE="view-ode";this.SKIP_RAIN="skip-rain";this.VIEW_FOLLOWERS="view-followers";this.VIEW_FOLLOWING="view-following";this.FOLLOW="follow";this.EDIT_PROFILE="edit-profile";this.SAVE_PROFILE="save-profile";this.VIEW_FAVORITES="view-favorites";this.WRITE="write";this.DELETE_ODE="delete-ode";this.VIEW_LOVERS="view-lovers";this.VIEW_FORKS="view-forks";this.LOVE="love-ode";this.UNLOVE="unlove-ode";this.FORK="fork-ode";this.VIEW_COMMENTS="view-comments";this.SHARE_PRIVATELY_STARTED="share-privately-started";this.SHARE_PRIVATELY_COMPLETED="share-privately-completed";this.INVITE_FRIENDS_STARTED="invite-friends-started";this.INVITE_FRIENDS_COMPLETED="invite-friends-completed";this.SEND_PRIVATE_COMMENT="send-private-comment";this.SIGN_IN_START="sign-in-start";this.SIGN_IN_COMPLETE="sign-in-complete";this.SIGN_OUT_START="sign-out-start";this.SIGN_OUT_COMPLETE="sign-out-complete";this.HELP="view-help";this.PERFORM_SEARCH="perform-search";this.VIEW_RECENTS="view-recents";this.VIEW_POPULAR="view-popular";this.VIEW_FEATURED="view-featured"};var Analytics=new function(){this.log=function(category,action,label){if(label){utils.trace("Analytics - "+category+"/"+action+" ("+label+")")}else{utils.trace("Analytics - "+category+"/"+action)}_gaq.push(["_trackEvent",category,action,label])}};var BaseController=Spine.Controller.create({actionOnAuth:null,proxied:["handleAuthCancel","handleAuthComplete"],enableAuthEvents:function(){UserAuthEvent.bind("cancel",this.proxy(this.handleAuthCancel));UserAuthEvent.bind("signedin",this.proxy(this.handleAuthComplete))},handleAuthCancel:function(){utils.trace("auth cancelled");this.actionOnAuth=null},handleAuthComplete:function(){utils.trace("auth complete "+this.actionOnAuth);if(this.actionOnAuth!=null){this.handleAuthEvent(this.actionOnAuth)}else{Analytics.log(X._TOPBAR,X.SIGN_IN_COMPLETE,"signin")}},setAuthAction:function(action){this.actionOnAuth=action},handleAuthEvent:function(action){throw new Error("Must be overridden by a subclass")},showErrorStatus:function(data){utils.traceObject(data);if(data.status!=200){utils.error(data.status)}},showCompleteStatus:function(data){},showStatus:function(data){},submitFacebookAction:function(action,callback){FB.api("/me/"+action,"post",function(response){if(!response||response.error){utils.error("Error occured while submiting OG action "+action+": "+response.error.message);if(callback){callback(false)}}else{utils.trace("Post was successful! Action ID: "+response.id);if(callback){callback(true)}}})},showMessage:function(message,title){if(title===null){title="message"}$("#message-dialog-title").html(title);$("#message-dialog-content").html(message);$("#message-dialog").modal("show")},showModalMessage:function(message,title){if(title===null){title="message"}$("#modal-message-dialog-title").html(title);$("#modal-message-dialog-content").html(message);$("#modal-message-dialog").modal("show")},hideModalMessage:function(){$("#modal-message-dialog").modal("hide")}});var SignedInUser=Spine.Model.setup("SignedInUser",["username"]);var UserAuthEvent=Spine.Class.sub();UserAuthEvent.extend(Spine.Events);var NavigationEvent=Spine.Class.sub();NavigationEvent.extend(Spine.Events);var AppController=BaseController.create({proxied:["handleUserSignin","handleAuthCancel","onLoginClick","onLogoutClick","handleLogout","onFacebookSignOut","onSignOut"],visitorId:null,inputTriggerSleepTime:2000,writeTriggerTimeout:null,commonInit:function(){jQuery.easing.def="easeOutCubic";$("#topbar").dropdown();$("#menu-user").hide();$("#menu-button-signin").hide();$("#menu-button-logout").click(this.onLogoutClick);$("#menu-button-signin").click(this.onLoginClick);SignedInUser.bind("refresh",this.handleUserSignin);UserAuthEvent.bind("cancel",this.handleAuthCancel);Topic.refresh(metaTopics);utils.trace("isLoggedIn = "+isLoggedIn);if(isLoggedIn){var userObj=new Object();userObj.username=loggedInUsername;SignedInUser.refresh([userObj])}$("#fb-logout").modal({closeOnEscape:true,backdrop:true,keyboard:true});$("#fb-logout-cancel").click(function(e){$("#fb-logout").modal("hide");if(e){e.preventDefault()}});var ref=this;$("#fb-logout-confirm").click(function(e){Analytics.log(X._TOPBAR,X.SIGN_OUT_COMPLETE);UserAuthEvent.trigger("signout");if(e){e.preventDefault()}});this.visitorId=utils.readCookie("ode.la.visitor.id");if(this.visitorId===null){utils.createCookie("ode.la.visitor.id",utils.guid(),90);this.visitorId=utils.readCookie("ode.la.visitor.id");utils.trace("New visitor : "+this.visitorId)}else{utils.trace("Known visitor : "+this.visitorId)}$("#topbar-search-input").keypress(this.proxy(this.processTopbarSearch));$("#topbar-write-input").keypress(this.proxy(this.processTopbarWrite));NavigationEvent.bind("navigation-request",this.proxy(this.handleNavigationRequest));NavigationEvent.bind("navigation-confirmed",this.proxy(this.handleNavigationConfirmation));$("#modal-message-dialog").modal({closeOnEscape:true,backdrop:true,keyboard:true});$("#message-dialog").modal({closeOnEscape:true,backdrop:true,keyboard:true});$("#message-dialog-ok").click(function(){$("#message-dialog").modal("hide")})},processTopbarWrite:function(e){clearTimeout(this.writeTriggerTimeout);if(e.keyCode==13){this.triggerTopbarWrite();e.preventDefault();return false}else{this.writeTriggerTimeout=setTimeout(this.proxy(this.triggerTopbarWrite),this.inputTriggerSleepTime)}},triggerTopbarWrite:function(){var searchInput=jQuery.trim($("#topbar-write-input").val());if(searchInput.length>0){utils.trace("Request Naviation to Write");NavigationEvent.trigger("navigation-request","write")}},processTopbarSearch:function(e){clearTimeout(this.searchTriggerTimeout);if(e.keyCode==13){this.triggerTopbarSearch();e.preventDefault();return false}else{this.searchTriggerTimeout=setTimeout(this.proxy(this.triggerTopbarSearch),this.inputTriggerSleepTime)}},triggerTopbarSearch:function(){var searchInput=jQuery.trim($("#topbar-search-input").val());if(searchInput.length>0){utils.trace("Request Naviation to Search");NavigationEvent.trigger("navigation-request","search")}},handleNavigationRequest:function(target){NavigationEvent.trigger("navigation-confirmed",target)},handleNavigationConfirmation:function(target){utils.trace("handleNavigationConfirmation : "+target);if(target=="search"){var searchInput=jQuery.trim($("#topbar-search-input").val());if(searchInput.length>0){utils.trace("Search for "+searchInput);window.location="/search/"+searchInput}}else{if(target=="write"){Analytics.log(X._TOPBAR,X.WRITE);var writeInput=jQuery.trim($("#topbar-write-input").val());if(writeInput.length>0){var params={text:writeInput};$.post("/api/create-text",params,function(response){utils.trace("on set create text");utils.traceObject(response);if(response.success){window.location="/create"}else{utils.error("Could not set create text")}},"json")}}}},handleAuthCancel:function(){$("#menu-button-signin").show()},onLoginClick:function(e){utils.trace("signin clicked");Analytics.log(X._TOPBAR,X.SIGN_IN_START,"signin");UserAuthEvent.trigger("signin");if(e){e.preventDefault()}},handleUserSignin:function(){utils.trace("AppController.handleUserSignin "+SignedInUser.first().username);$("a#menu-user-name").text(SignedInUser.first().username);$("#menu-user-profile").attr("href","/"+SignedInUser.first().username);$("#menu-user").show();$("#menu-button-signin").hide()},onLogoutClick:function(e){Analytics.log(X._TOPBAR,X.SIGN_OUT_START);$("#fb-logout").modal("show");if(e){e.preventDefault()}},addSpinner:function(){var opts={lines:10,length:4,width:3,radius:6,color:"#999",speed:1,trail:60,shadow:false};this.spinner=new Spinner(opts)},spin:function(){this.stopSpinner();$("#spinnerContainer").html("");var target=document.getElementById("spinnerContainer");this.spinner.spin(target)},stopSpinner:function(){this.spinner.stop()},hideMasthead:function(){$("#masthead").hide()}});var SearchInputController=BaseController.create({execSearchTimeout:null,typingDetecorTimeout:null,lastKnownSearch:null,searchInput:null,proxied:["queueSearch","triggerSearch","onTypingStopped","invokeSearch"],sleeptime:1500,typingDetecorSleepTime:1200,isTypingStopped:true,suspended:false,initSearchInput:function(input,sleeptime){this.sleeptime=sleeptime;this.searchInput=input;this.searchInput.keydown(this.queueSearch)},setSearchSuspended:function(s){this.suspended=s;utils.trace("search suspended = "+this.suspended)},queueSearch:function(){clearTimeout(this.execSearchTimeout);clearTimeout(this.typingDetecorTimeout);if(!this.suspended){this.onTypingStarted();this.execSearchTimeout=setTimeout(this.triggerSearch,this.sleeptime);this.typingDetecorTimeout=setTimeout(this.onTypingStopped,this.typingDetecorSleepTime)}},hasValidInput:function(){var inputText=jQuery.trim(this.searchInput.val());return(this.lastKnownSearch!=inputText&&inputText.length>=3)},onTypingStarted:function(){if(this.isTypingStopped&&this.hasValidInput()){this.isTypingStopped=false;this.invokeTypingStarted()}},onTypingStopped:function(){if(this.hasValidInput()){this.isTypingStopped=true;this.invokeTypingStopped()}},triggerSearch:function(){var inputText=jQuery.trim(this.searchInput.val());if(this.lastKnownSearch!=inputText&&inputText.length>=3){this.lastKnownSearch=inputText;this.invokeSearch(this.lastKnownSearch)}else{this.invokeSearchCancelled()}},invokeSearchCancelled:function(){},invokeSearch:function(searchText){throw new Error("This should be overridden")},invokeTypingStarted:function(){},invokeTypingStopped:function(){}});var FacebookController=BaseController.create({proxied:["onRegister","validateUsername","userRegistered","processLoginStatus","processLoginResponse","loginUser","logoutUser","handleNewUserCheck","loginAuthorized","showCompleteStatus","showErrorStatus","fbInit"],facebookUser:null,isloginAttempt:false,usernameRegularEx:new RegExp("^[a-zA-Z0-9äöüÄÖÜ_\\-\\.]*$"),alphaRegEx:new RegExp("^[a-zA-ZäöüÄÖÜ]+"),init:function(){utils.trace("FacebookController.init");utils.loadScript("//platform.twitter.com/widgets.js",function(){});utils.loadScript("http://connect.facebook.net/en_US/all.js",this.fbInit)},fbInit:function(){utils.trace("fbinit");FB.init({appId:facebookAppId,status:true,cookie:true,xfbml:true,oauth:true});UserAuthEvent.bind("signin",this.loginUser);UserAuthEvent.bind("signout",this.logoutUser);if(!isLoggedIn){$("#dialog-register").modal({closeOnEscape:true,backdrop:true,keyboard:true});$("#dialog-register-username").keyup(this.validateUsername);$("#dialog-register-confirm").click(this.onRegister);UserAuthEvent.trigger("cancel");utils.trace("User not signed in. Checking with facebook.");FB.getLoginStatus(this.processLoginStatus)}},isSignedIn:function(){return SignedInUser.count()==1},processLoginStatus:function(response){utils.trace("processLoginStatus");utils.traceObject(response);if(response.authResponse){utils.trace("Welcome!  Fetching your information.... ");FB.api("/me",this.processLoginResponse)}else{utils.trace("Unknown user");UserAuthEvent.trigger("cancel")}},processLoginResponse:function(response){this.facebookUser=response;console.log("Good to see you, "+this.facebookUser.name+".");utils.traceObject(this.facebookUser);$.getJSON("/api/isNewUser?fbUserId="+this.facebookUser.id,this.handleNewUserCheck).complete(this.showCompleteStatus).error(this.showErrorStatus)},getFacebookUserAsParams:function(){var loginRequestObject=new Object();for(var k in this.facebookUser){var v=this.facebookUser[k];utils.trace(k+" = "+v);loginRequestObject["fbuser."+k]=v}return loginRequestObject},handleNewUserCheck:function(response){utils.trace("handleNewUserCheck");utils.traceObject(response);if(response.success){utils.error("Existing user, proceed with login");var params=jQuery.param(this.getFacebookUserAsParams());utils.trace(params);$.post("/api/login",params,this.loginAuthorized,"json")}else{utils.trace("New user. Need to ask for username");if(this.isloginAttempt){$("#dialog-register-name").val(this.facebookUser.name);$("#dialog-register-username").val(this.facebookUser.username);$("#dialog-register-username-help").html("Your public profile: http://ode.la/"+this.facebookUser.username);$("#dialog-register").modal("show");setTimeout(function(){$("#dialog-register-about").focus()},500)}}},onRegister:function(){if(this.validateUsername()){var name=jQuery.trim($("#dialog-register-name").val());if(name.length==0){$("#dialog-register-name-wrapper").addClass("error");$("#dialog-register-name").focus();return false}$("#dialog-register-name-wrapper").removeClass("error");var username=jQuery.trim($("#dialog-register-username").val());var bio=jQuery.trim($("#dialog-register-about").val());var params=this.getFacebookUserAsParams();params.username=username;params.name=name;params.bio=bio;utils.trace("registering user ");utils.traceObject(params);$.post("/api/register",jQuery.param(params),this.loginAuthorized,"json")}},validateUsername:function(){var username=jQuery.trim($("#dialog-register-username").val());if(username.length<2){$("#dialog-register-username-wrapper").addClass("error");$("#dialog-register-username-help").html("Username must be atleast two characters ");return false}else{if(!this.alphaRegEx.test(username)){$("#dialog-register-username-wrapper").addClass("error");$("#dialog-register-username-help").html("Must contain alphabets");return false}else{if(!this.usernameRegularEx.test(username)){$("#dialog-register-username-wrapper").addClass("error");$("#dialog-register-username-help").html("Only alphabets, numbers and dot (.), underscore (_) or dash (-)");return false}}}$("#dialog-register-username-wrapper").removeClass("error");$("#dialog-register-username-help").html("Your public profile: http://ode.la/"+username);return true},setSignedInUser:function(u){utils.trace("Logged into facebook "+u);var userObj=new Object();userObj.username=u;SignedInUser.refresh([userObj])},loginUser:function(){utils.trace("loginUser");this.isloginAttempt=true;FB.login(this.processLoginStatus,{scope:"email,publish_actions"})},loginUserXtended:function(){utils.trace("loginUser");this.isloginAttempt=true;FB.login(this.processLoginStatus,{scope:"email,publish_actions,manage_pages,user_photos,user_videos"})},logoutUser:function(){utils.trace("logoutUser");$.getJSON("/signOut",function(){utils.trace("Signed out of ode.la");FB.logout(function(){utils.trace("Signed out of facebook");$("#fb-logout").modal("hide");window.location="/"})})},loginAuthorized:function(response){utils.trace("loginAuthorized");utils.traceObject(response);if(response.success){this.setSignedInUser(response.result);UserAuthEvent.trigger("signedin")}else{utils.error("Could not authorize user");UserAuthEvent.trigger("cancel")}$("#dialog-register").modal("hide")}});var UserBoxController=BaseController.create({user:null,container:null,userBoxTemplate:$.template('<div class="user-box"><div class="user-box-piece"><img src="${displayAvatar}" alt=""></div><div class="user-box-piece">    <div class="user-box-info-name"><a href="/${username}">${name}</a></div>    <div>        <ul class="stats user-box-info-stats">            <li class="stats-odes">${odeCount}</li>            <li class="stats-followers">${followerCount}</li>        </ul>    </div></div><div style="clear: both;"></div></div>'),init:function(){utils.trace("rendering user "+this.user.username);$.tmpl(this.userBoxTemplate,this.user).appendTo(this.container)}});var DiscoveryDropBoxController=BaseController.create({TIME_DROP_IN:4000,DELAY_REVEAL:250,TIME_REVEAL:2000,DELAY_DROP_OUT:5000,TIME_DROP_OUT:3500,TIME_ABORT:500,drop:null,container:null,dropBox:null,dropBoxId:null,dropTemplate:$.template('<div id="ode-drop-${id}" class="ode-drop"><div class="ode-drop-content">{{html content}}</div><div class="ode-drop-info"><a href="/view/${permalink}">${title}</a></div><div class="ode-drop-info">by <a href="/${username}">${author}</a></div></div>'),init:function(){$.tmpl(this.dropTemplate,this.drop).appendTo(this.container);this.dropBox=$("#ode-drop-"+this.drop.id);var minY=430;var maxY=$(document).height()-this.dropBox.height()-25;var targetY=utils.randomNumber(minY,maxY);var minX=25;var maxX=$(document).width()-this.dropBox.width()-25;if(maxX>700){maxX=700}var targetX=utils.randomNumber(minX,maxX);this.dropBox.css("left",targetX);this.dropBox.animate({top:targetY},this.TIME_DROP_IN,"easeOutCubic",this.proxy(this.reveal));$(".ode-drop-content",this.dropBox).click(this.proxy(this.dropClick))},dropClick:function(){window.location="/view/"+this.drop.permalink},reveal:function(){setTimeout(this.proxy(this.doReveal),this.DELAY_REVEAL)},doReveal:function(){$(".ode-drop-info",this.dropBox).animate({color:$.Color("#666")},this.TIME_REVEAL,"easeInCubic");$(".ode-drop-info a",this.dropBox).animate({color:$.Color("#666")},this.TIME_REVEAL,"easeInCubic");$(".ode-drop-content",this.dropBox).animate({color:$.Color("#004D9F")},this.TIME_REVEAL,"easeInCubic",this.proxy(this.dropOut))},dropOut:function(){setTimeout(this.proxy(this.doDropOut),this.DELAY_DROP_OUT)},doDropOut:function(){$(".ode-drop-star").animate({color:$.Color("#efefef")},this.TIME_DROP_OUT,"easeInCubic");$(".ode-drop div").animate({color:$.Color("#efefef")},this.TIME_DROP_OUT,"easeInCubic");$(".ode-drop-info").animate({color:$.Color("#efefef")},this.TIME_DROP_OUT,"easeInCubic");$(".ode-drop-info a").animate({color:$.Color("#efefef")},this.TIME_DROP_OUT,"easeInCubic");$(this.dropBox).animate({left:$(document).width()-this.dropBox.width()},this.TIME_DROP_OUT,"easeInCubic",this.proxy(this.destroy))},abort:function(){$(".ode-drop-star").stop();$(".ode-drop div").stop();$(".ode-drop-info").stop();$(".ode-drop-info a").stop();$(this.dropBox).stop();$(this.dropBox).animate({left:$(document).width()-this.dropBox.width()},this.TIME_ABORT,"easeInCubic",this.proxy(this.destroy))},destroy:function(){this.dropBox.remove();DiscoveryDrop.trigger("destroyed")}});var OdeBoxController=BaseController.create({proxied:["onClick","onMouseOver","onMouseOut"],analyticsCategory:null,ode:null,odeCounter:null,container:null,odeBoxId:null,odeBox:null,addSocialActions:true,odeBoxTemplate:$.template('<div id="ode-box-${id}" class="ode-box"><div class="ode-box-unpublished label important" style="background-color: #363636">not published yet</div><div class="ode-box-title">${title}</div><div class="ode-box-text">{{html summary}}</div><div class="ode-box-stats"><ul class="stats"><li class="stats-views" style="margin: 0;" title="${viewCount} views">${viewCount}</li><li class="stats-comments" title="${commentCount} comments">${commentCount}</li><li class="stats-favs" title="${favoritedCount} people call this a favorite">${favoritedCount}</li><li class="stats-fork" title="${forkCount} forks">${forkCount}</li></ul><div style="clear: both"></div></div><div class="ode-box-action"></div></div>'),socialActionsTemplate:$.template('<div class="ode-box-action-twitter"><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ode.la/view/${permalink}" data-count="none" target="_blank">Tweet</a></div><div class="ode-box-action-fb"><div class="fb-like" data-href="http://ode.la/view/${permalink}" data-layout="button_count" data-width="130" data-show-faces="false"></div></div><div style="clear: both"></div>'),labelClasses:["success","warning","important","notice","label"],init:function(){$.tmpl(this.odeBoxTemplate,this.ode).appendTo(this.container);this.odeBoxId="#ode-box-"+this.ode.id;this.odeBox=$("#ode-box-"+this.ode.id);if(this.ode.state==1){$(".ode-box-unpublished",this.odeBox).hide()}else{this.addSocialActions=false}$(".ode-box-title",this.odeBoxId).addClass("label");$(".ode-box-title",this.odeBoxId).addClass(this.labelClasses[(this.odeCounter%5)]);if(this.odeBox.height()>0){this.odeBox.css("min-height",this.odeBox.height());this.odeBox.css("max-height",this.odeBox.height())}$(".ode-box-title",this.odeBoxId).click(this.onClick);$(".ode-box-text",this.odeBoxId).click(this.onClick);this.odeBox.mouseover(this.onMouseOver).mouseout(this.onMouseOut)},onClick:function(){Analytics.log(this.analyticsCategory,X.VIEW_ODE,this.ode.permalink);window.location="/view/"+this.ode.permalink},onMouseOver:function(){this.odeBox.addClass("ode-box-over");$(".ode-box-title",this.odeBox).stop();$(".ode-box-text",this.odeBox).stop();$(".ode-box-action",this.odeBox).stop();$(".ode-box-action",this.odeBox).show();$(".ode-box-title",this.odeBox).animate({"padding-top":"0","padding-bottom":"0"},400,"easeOutQuad");$(".ode-box-text",this.odeBox).animate({"margin-top":"1px","padding-top":"4px","padding-bottom":"4px"},400,"easeOutQuad",this.proxy(this.onMouseOverComplete))},onMouseOverComplete:function(){if(this.addSocialActions){this.addSocialActions=false;var odeBoxAction=this.odeBoxId+" .ode-box-action";utils.trace("hiding "+this.ode.id);$(odeBoxAction).html("");$.tmpl(this.socialActionsTemplate,this.ode).appendTo(odeBoxAction);FB.XFBML.parse(document.getElementById("ode-box-"+this.ode.id))}},onMouseOut:function(){this.odeBox.removeClass("ode-box-over");$(".ode-box-title",this.odeBox).stop();$(".ode-box-text",this.odeBox).stop();$(".ode-box-title",this.odeBox).animate({"padding-top":"5px","padding-bottom":"5px"},400,"easeInQuad");var ref=this;$(".ode-box-text",this.odeBox).animate({"margin-top":"8px","padding-top":"8px","padding-bottom":"8px"},400,"easeInQuad",function(){$(".ode-box-action",ref.odeBox).stop();$(".ode-box-action",ref.odeBox).hide()})}});var metaTopics=[{id:"0",color:"#2c343c",name:"Urban",top:["ya","em","shit","nigga","yo","fuck","hit","ass","bitch","niggaz","gettin","niggas","verse","game","check","cuz","ain't","wit","kick"]},{id:"1",color:"#d5000d",name:"Vivid",top:["light","sun","high","night","blue","sky","morning","fly","city","dark","moon","sea","stars","lights","shine","christmas","bright","ring"]},{id:"11",color:"#1980D7",name:"Rejoice",top:["back","home","gotta","stop","town","coming","bring","goin","train","comin","party","bit","till","top","straight","send","catch","throw"]},{id:"12",color:"#d35a00",name:"Faith",top:["lord","hell","heaven","death","born","land","running","fear","war","men","earth","follow","angel","pray","devil","breath","darkness","evil","jesus"]},{id:"13",color:"#eb8f00",name:"Estrange",top:["don","wanna","leave","stay","wrong","free","care","change","talk","lonely","today","understand","matter","set","hurt","sad","tomorrow","doesn","anymore"]},{id:"14",color:"#327E04",name:"Glam",top:["people","put","bad","uh","goodbye","burn","shake","daddy","drink","power","beautiful","meet","huh","doo","nice","shoes","eat","dirty","guy"]},{id:"15",color:"#6f4b17",name:"Quaint",top:["eyes","hear","fall","cold","stand","door","hands","rain","close","wind","open","sound","ground","lay","falling","walking","standing","summer","calling"]},{id:"16",color:"#681818",name:"Mortal",top:["time","mind","hold","hand","god","soul","waiting","line","late","ready","lies","truth","child","wild","save","control","peace","learn","reach"]},{id:"17",color:"#f56a66",name:"Fragile",top:["world","girl","find","place","inside","mine","end","fire","side","friend","road","deep","fool","girls","hide","blind","burning","number"]},{id:"18",color:"#198087",name:"Linger",top:["long","left","face","thought","didn","days","told","knew","years","tears","heard","couldn","mother","turned","loved","half","felt","looked","nights"]},{id:"10",color:"#ed76d4",name:"Tender",top:["yeah","baby","gonna","night","hey","tonight","walk","rock","ooh","ah","roll","na","alright","sleep","boys","tight","mon","dancing","doin"]},{id:"19",color:"#cd0a0a",name:"Jig",top:["call","show","dance","watch","young","da","street","hot","beat","pretty","listen","word","nothin","ha","feet","dog","talking","story","read"]},{id:"2",color:"#0a6ad1",name:"Virile",top:["run","ride","work","house","lot","fun","car","cool","gun","step","son","caught","full","shot","kids","school","pull","game"]},{id:"3",color:"#d03eb1",name:"Amor",top:["love","heart","give","true","woman","wait","forever","kiss","mama","broken","miss","part","babe","chance","till","lovin","lover","hearts","arms"]},{id:"4",color:"#666666",name:"Dreary",top:["black","dead","white","blood","red","room","water","eye","air","hair","river","gold","green","blow","cut","skin","grow","tear","wine"]},{id:"5",color:"#44cc44",name:"Cradle",top:["make","feel","won","head","real","round","break","makes","move","crazy","touch","body","fine","smile","fast","lady","slow","takes","bout"]},{id:"6",color:"#314660",name:"Resilient",top:["good","ain","thing","hard","big","money","times","lose","easy","fight","honey","wanted","pay","guess","wouldn","tired","kind","feels","wasn't"]},{id:"7",color:"#3399cc",name:"Dreamy",top:["day","things","made","dream","lost","sweet","remember","dreams","feeling","found","friends","words","happy","forget","hate","past","gave","thinking","wake"]},{id:"8",color:"#ff3300",name:"Spirited",top:["life","la","live","turn","die","cry","pain","hope","living","lie","strong","reason","alive","children","lives","laugh","rest","faith","repeat"]},{id:"9",color:"#c41889",name:"Wistful",top:["man","boy","play","song","sing","music","kill","king","star","blues","brother","lead","guitar","poor","country","radio","playing","band","singing"]}];var DiscoveryDrop=Spine.Model.setup("DiscoveryDrop",["content","title","author","username","permalink"]);var Topic=Spine.Model.setup("Topic",["id","name","top","score"]);var User=Spine.Model.setup("User",["facebookId","username","name","bio","avatarUrl","displayName","displayAvatar","displayAvatarBig","odeCount","createdOn","followerCount","followingCount","favoriteCount"]);User.include(({init:function(atts){if(atts){this.load(atts)}this.displayName=(this.name==null)?this.username:this.name;this.displayAvatar=this.avatarUrl?this.avatarUrl:"/public/images/user50.png";this.displayAvatarBig=this.avatarUrl?this.avatarUrl:"/public/images/user100.png";if(this.avatarUrl!=null&&this.avatarUrl.indexOf("facebook")<0){utils.trace("this.avatarUrl = "+this.avatarUrl);this.displayAvatarBig=this.avatarUrl;this.displayAvatar=this.avatarUrl.split("-")[0]+"-50.png"}}}));var Follower=User.setup("Follower");Follower.include(({init:function(atts){if(atts){this.load(atts)}this.displayName=(this.name==null)?this.username:this.name;this.displayAvatar=this.avatarUrl?this.avatarUrl:"/public/images/user50.png";this.displayAvatarBig=this.avatarUrl?this.avatarUrl:"/public/images/user100.png";if(this.avatarUrl!=null&&this.avatarUrl.indexOf("facebook")<0){utils.trace("this.avatarUrl = "+this.avatarUrl);this.displayAvatarBig=this.avatarUrl;this.displayAvatar=this.avatarUrl.split("-")[0]+"-50.png"}}}));var Following=User.setup("Following");Following.include(({init:function(atts){if(atts){this.load(atts)}this.displayName=(this.name==null)?this.username:this.name;this.displayAvatar=this.avatarUrl?this.avatarUrl:"/public/images/user50.png";this.displayAvatarBig=this.avatarUrl?this.avatarUrl:"/public/images/user100.png";if(this.avatarUrl!=null&&this.avatarUrl.indexOf("facebook")<0){utils.trace("this.avatarUrl = "+this.avatarUrl);this.displayAvatarBig=this.avatarUrl;this.displayAvatar=this.avatarUrl.split("-")[0]+"-50.png"}}}));var FeaturedUser=User.setup("FeaturedUser");FeaturedUser.include(({SUMMARY_MIN_LENGTH:300,SUMMARY_MAX_LENGTH:500,init:function(atts){if(atts){this.load(atts)}this.displayName=(this.name==null)?this.username:this.name;this.displayAvatar=this.avatarUrl?this.avatarUrl:"/public/images/user50.png";this.displayAvatarBig=this.avatarUrl?this.avatarUrl:"/public/images/user100.png";if(this.avatarUrl!=null&&this.avatarUrl.indexOf("facebook")<0){utils.trace("this.avatarUrl = "+this.avatarUrl);this.displayAvatarBig=this.avatarUrl;this.displayAvatar=this.avatarUrl.split("-")[0]+"-50.png"}}}));var RecentUser=User.setup("RecentUser");RecentUser.include(({SUMMARY_MIN_LENGTH:300,SUMMARY_MAX_LENGTH:500,init:function(atts){if(atts){this.load(atts)}this.displayName=(this.name==null)?this.username:this.name;this.displayAvatar=this.avatarUrl?this.avatarUrl:"/public/images/user50.png";this.displayAvatarBig=this.avatarUrl?this.avatarUrl:"/public/images/user100.png";if(this.avatarUrl!=null&&this.avatarUrl.indexOf("facebook")<0){utils.trace("this.avatarUrl = "+this.avatarUrl);this.displayAvatarBig=this.avatarUrl;this.displayAvatar=this.avatarUrl.split("-")[0]+"-50.png"}}}));var PopularUser=User.setup("PopularUser");PopularUser.include(({SUMMARY_MIN_LENGTH:300,SUMMARY_MAX_LENGTH:500,init:function(atts){if(atts){this.load(atts)}this.displayName=(this.name==null)?this.username:this.name;this.displayAvatar=this.avatarUrl?this.avatarUrl:"/public/images/user50.png";this.displayAvatarBig=this.avatarUrl?this.avatarUrl:"/public/images/user100.png";if(this.avatarUrl!=null&&this.avatarUrl.indexOf("facebook")<0){utils.trace("this.avatarUrl = "+this.avatarUrl);this.displayAvatarBig=this.avatarUrl;this.displayAvatar=this.avatarUrl.split("-")[0]+"-50.png"}}}));var Ode=Spine.Model.setup("Ode",["id","_id","title","descr","content","imageUrl","rainbow","summary","traySnippets","permalink","authorId","state","publishedOn","tags","originOde","forkedOdes","commentCount","favoritedCount","viewCount","modifiedOn","forkCount"]);Ode.include(({SUMMARY_MIN_LENGTH:300,SUMMARY_MAX_LENGTH:500,init:function(atts){if(atts){this.load(atts)}this.summary=utils.replaceLBWithBR(this.summary)}}));var Favorite=Ode.setup("Favorite");Favorite.include(({SUMMARY_MIN_LENGTH:200,SUMMARY_MAX_LENGTH:300,init:function(atts){if(atts){this.load(atts)}this.summary=utils.replaceLBWithBR(this.summary)}}));var FeaturedOde=Ode.setup("FeaturedOde");FeaturedOde.include({init:function(atts){if(atts){this.load(atts)}this.summary=utils.replaceLBWithBR(this.summary)}});var RecentOde=Ode.setup("RecentOde");RecentOde.include({init:function(atts){if(atts){this.load(atts)}this.summary=utils.replaceLBWithBR(this.summary)}});var PopularOde=Ode.setup("PopularOde");PopularOde.include({init:function(atts){if(atts){this.load(atts)}this.summary=utils.replaceLBWithBR(this.summary)}});var RainbowController=BaseController.create({areaChart:null,dataFrame:null,containerName:null,hide:function(){$("#rainbowContainer").hide()},show:function(){$("#rainbowContainer").show()},getAreaChart:function(){var useGradients=true;var labelType="Native";if(this.areaChart==null){this.areaChart=new $jit.AreaChart({injectInto:this.containerName,animate:true,Margin:{top:0,left:0,right:0,bottom:10},labelOffset:10,showAggregates:false,showLabels:true,type:useGradients?"stacked:gradient":"stacked",Label:{type:labelType,size:12,family:"Calibri",color:"#636363"},Tips:{enable:false,onShow:function(tip,elem){tip.innerHTML="<b>"+elem.name+"</b>: "+elem.value}},filterOnClick:false,restoreOnRightClick:false,selectOnHover:false})}return this.areaChart},getDataFrame:function(){if(this.dataFrame==null){this.dataFrame=new Object();this.dataFrame.label=new Array();this.dataFrame.values=new Array();var valueObject;this.dataFrame.label.push("pre");valueObject=new Object();valueObject.label="pre";valueObject.values=[0];this.dataFrame.values.push(valueObject);for(var i=0;i<Topic.all().length;i++){var topic=Topic.all()[i];this.dataFrame.label.push(topic.name);valueObject=new Object();valueObject.label=topic.name;valueObject.values=[0];this.dataFrame.values.push(valueObject)}this.dataFrame.label.push("post");valueObject=new Object();valueObject.label="post";valueObject.values=[0];this.dataFrame.values.push(valueObject);return this.dataFrame}else{if(this.dataFrame.label!=null){this.dataFrame.label=null;return this.dataFrame}else{return this.dataFrame}}},draw:function(scoresArray,animateDuration){var scores=new Array();for(var i=0;i<scoresArray.length;i++){scores.push(scoresArray[i])}var lowestScore=scoresArray.sort()[0];var highestScore=scoresArray[scoresArray.length-1];var flatScore=lowestScore==highestScore;var highestScoringTopics=[];var isFirstTime=this.dataFrame==null;var dataFrame=this.getDataFrame();for(var i=0;i<scores.length;i++){var score=scores[i];var topic=Topic.find(i);if(score==highestScore){highestScoringTopics.push(topic)}for(var j=1;j<dataFrame.values.length-1;j++){var dfValue=dataFrame.values[j];if(dfValue.label==topic.name){dfValue.colors=new Array();dfValue.colors.push("'"+topic.color+"'");if(flatScore){dfValue.values=[score]}else{dfValue.values=(score==lowestScore)?[Math.random()*(score/4)]:[score]}break}}dataFrame.values[0].values=[0];dataFrame.values[dataFrame.values.length-1].values=[0]}highestScoringTopics=utils.shuffle(highestScoringTopics);var chart=this.getAreaChart();if(isFirstTime){chart.colors=[highestScoringTopics[0].color];dataFrame.colors=[highestScoringTopics[0].color];chart.loadJSON(dataFrame)}else{chart.updateJSON(dataFrame,{onComplete:function(){chart.colors=[highestScoringTopics[0].color];dataFrame.colors=[highestScoringTopics[0].color];chart.updateJSON(dataFrame,{onComplete:function(){}})}},animateDuration)}}});var IndexController=Spine.Controller.create({init:function(){var Snippet=Spine.Model.setup("Snippet",["id","text","score","trackName","albumName","artistName"]);var TopTerm=Spine.Model.setup("TopTerm",["id","term","score"]);Snippet.include(({init:function(atts){if(atts){this.load(atts)}this.text=utils.replaceLBWithBR(this.text)}}));var IndexAppController=AppController.create({toasterContainer:$("#toasterContainer"),started:false,widgetsShown:true,curentWidget:null,init:function(){this.commonInit();this.toasterContainer.hide();this.addSpinner();$("#widgets-toolbar-close").twipsy();if(pageParams.odeId!=null&&pageParams.odeId.length>0){utils.trace("Edit "+pageParams.odeId);$("#masthead").hide();discoveryDropsController.stop();this.start($("#writerInput").val())}else{if(pageParams.text!=null&&pageParams.text.length>0){utils.trace("Write "+pageParams.text);$("#masthead").hide();discoveryDropsController.stop();$("#writerInput").val(pageParams.text);this.start($("#writerInput").val())}}wordExplorerController.setSuspended(true);wordRhymerController.setSuspended(true);this.curentWidget=rouletteController;$("#widgets-toolbar-close").click(this.proxy(this.toggleWidgets));$("#tab-explorer").click(this.proxy(this.showWordExplorer));$("#tab-rhyme").click(this.proxy(this.showWordRhymer));$("#tab-roulette").click(this.proxy(this.showRoulette))},showWordWidget:function(){if(this.curentWidget==rouletteController){this.showWordExplorer()}},dimWidgetTabs:function(){$("#tab-explorer").removeClass("widgets-toolbar-item-lit");$("#tab-rhyme").removeClass("widgets-toolbar-item-lit");$("#tab-roulette").removeClass("widgets-toolbar-item-lit")},showRoulette:function(){Analytics.log(X._AUTHOR,X.SHOW_SNIPPETS);wordExplorerController.setSuspended(true);wordRhymerController.setSuspended(true);rouletteController.setSuspended(false);this.dimWidgetTabs();$("#tab-roulette").addClass("widgets-toolbar-item-lit");rouletteController.show();this.curentWidget=rouletteController},showWordExplorer:function(){Analytics.log(X._AUTHOR,X.SHOW_RELATED);rouletteController.setSuspended(true);wordRhymerController.setSuspended(true);wordExplorerController.setSuspended(false);this.dimWidgetTabs();$("#tab-explorer").addClass("widgets-toolbar-item-lit");wordExplorerController.show();this.curentWidget=wordExplorerController},showWordRhymer:function(){Analytics.log(X._AUTHOR,X.SHOW_RHYMES);rouletteController.setSuspended(true);wordExplorerController.setSuspended(true);wordRhymerController.setSuspended(false);this.dimWidgetTabs();$("#tab-rhyme").addClass("widgets-toolbar-item-lit");wordRhymerController.show();this.curentWidget=wordRhymerController},toggleWidgets:function(e,callback){if(this.widgetsShown){Analytics.log(X._AUTHOR,X.HIDE_WIDGETS);this.hideWidgets(callback)}else{this.showWidgets(callback)}},showWidgets:function(callback){$("#toasterContainerLeft").animate({width:460},750,"easeInQuad");$("#toasterContainerRight").animate({width:460},750,"easeInQuad",function(){$(".widgets-toolbar-shown").show();$("#widgets-toolbar-close").css("background-image","url(/public/images/next.gif)");$("#widgets-toolbar-close").attr("title","Hide wigets");if(callback){callback()}});if(this.curentWidget==rouletteController){this.showRoulette()}else{if(this.curentWidget==wordExplorerController){this.showWordExplorer()}else{if(this.curentWidget==wordRhymerController){this.showWordRhymer()}}}this.widgetsShown=true},hideWidgets:function(callback){rouletteController.setSuspended(true);wordExplorerController.setSuspended(true);wordRhymerController.setSuspended(true);$("#toasterContainerLeft").animate({width:895},750,"easeOutQuad");$("#toasterContainerRight").animate({width:25},750,"easeOutQuad",function(){$("#widgets-toolbar-close").css("background-image","url(/public/images/previous.gif)");$("#widgets-toolbar-close").attr("title","Show wigets");if(callback){callback()}});$(".widgets-toolbar-shown").hide();this.widgetsShown=false},onHelpClicked:function(){toolbarController.pause();var FADE_OUT_TIME=500;var OPACITY=0.15;var EASING="easeInQuad";$("#rainbowContainer").fadeTo(FADE_OUT_TIME,OPACITY,EASING);$("#rouletteContainer").fadeTo(FADE_OUT_TIME,OPACITY,EASING);$("#toolbarContainerLeft").fadeTo(FADE_OUT_TIME,OPACITY,EASING);$("#odeTitle").fadeTo(FADE_OUT_TIME,OPACITY,EASING);$("#toolbarContainerRight").fadeTo(FADE_OUT_TIME,OPACITY,EASING,function(){$("#writerInput").putCursorAtEnd();$("#writer-hint-box").show()})},start:function(inputText){if(!this.started){this.started=true;$("#index-explore-button").stop(false,false);$("#page-corner").stop(false,false);$("#index-explore-button").fadeOut(500);$("#page-corner").fadeOut(500);$("#widgets-toolbar").fadeIn(3000);writerController.invoke(inputText);this.toasterContainer.fadeIn()}}});var WriterController=SearchInputController.create({proxied:["queueSearch","triggerSearch","onTypingStopped","invokeSearch","showCompleteStatus","showErrorStatus","processSearch","invokeSearchCancelled"],writerInput:$("#writerInput"),pageNumber:0,itemsPerPage:10,lastChangeOn:new Date().getTime(),init:function(){this.initSearchInput(this.writerInput,2500)},invoke:function(text){this.writerInput.val(text);this.invokeSearch(text);var ip=this.writerInput;setTimeout(function(){ip.putCursorAtEnd()},1000);this.writerInput.select(this.proxy(this.onContentSelected))},onContentSelected:function(){var textSelectionObj=utils.get_selection("writerInput");var textSelection=jQuery.trim(textSelectionObj.text);textSelection=textSelection.split(" ")[0];this.trigger("text-selected",textSelection)},invokeSearch:function(searchText){this.lastKnownSearch=searchText;this.pageNumber=0;this.getMoreSnippets();this.fetchTopTerms();if(this.isInactive()){toolbarController.play()}this.lastChangeOn=new Date().getTime()},isInactive:function(){var timeSinceLastChange=new Date().getTime()-this.lastChangeOn;utils.trace("timeSinceLastChange = "+timeSinceLastChange);return(timeSinceLastChange>180000)},fetchTopTerms:function(){$.getJSON("/api/top-terms?text="+this.lastKnownSearch+"&limit=25",this.processTopTerms).complete(this.showCompleteStatus).error(this.showErrorStatus)},processTopTerms:function(response){utils.trace("processTopTerms");utils.trace(response);if(response.success){var topTermObjs=new Array();for(var i=0;i<response.result.length;i++){var topWordTuple=response.result[i];var topWordParts=topWordTuple.split(":");topTermObjs.push({term:jQuery.trim(topWordParts[1]),score:jQuery.trim(topWordParts[0])})}TopTerm.refresh(topTermObjs)}else{utils.error("Did not get a successful response")}},invokeSearchCancelled:function(){indexAppController.stopSpinner()},invokeTypingStarted:function(){indexAppController.spin();utils.trace("Typing started!")},invokeTypingStopped:function(searchText){utils.trace("Typing stopped! ")},getMoreSnippets:function(){this.pageNumber++;utils.trace("getMoreSnippets "+this.pageNumber);var skip=(this.pageNumber*this.itemsPerPage);$.getJSON("/snippets?text="+this.lastKnownSearch+"&skip="+skip+"&limit="+this.itemsPerPage,this.processSearch).complete(this.showCompleteStatus).error(this.showErrorStatus)},processSearch:function(response){utils.trace("processSearch");if(response.success){var snippets=response.result.snippets;if(snippets.length>0){Snippet.refresh(snippets);if(this.pageNumber==1){$("#funky-input-message").hide();rainbowController.show();rainbowController.draw(response.result.emotionIndex)}}else{if(this.pageNumber>1){utils.trace("Got empty response @ page "+this.pageNumber+" Resetting it to 0");this.pageNumber=0;this.getMoreSnippets()}else{indexAppController.stopSpinner();rainbowController.hide();utils.trace("Got empty response");$("#funky-input-message").show()}}}else{utils.error("Did not get a successful response")}}});var SnippetController=BaseController.create({proxied:["addSnippetToTray","removeSnippetFromTray"],snippet:null,litTemplate:$.template("<div id='snippet-wrapper-${id}' class='snippetWrapper' style='top: 600px'><img id='snippet-heart-${id}' class='snippetHeartButton' src='/public/images/hold.png'><img id='snippet-heart-remove-${id}' class='snippetHeartButton' src='/public/images/held.png'><img class='snippetDismissButton' src='/public/images/close.gif'><div class='snippetLine'></div><blockquote id='snippet-${id}' class='litBlockquote'><p>{{html text}}<br/>&nbsp;</p><small>${artistName}</small></blockquote></div>"),snippetText:null,snippetAuthor:null,snippetContainer:null,snippetWrapper:null,addSnippetToTrayButton:null,removeSnippetFromTrayButton:null,isDestroyed:false,FADE_TIME:15000,init:function(){this.snippet=this.item;this.snippet.positionY=this.positionY;this.render();this.snippetText=$("#snippet-"+this.snippet.id+" p");this.snippetAuthor=$("#snippet-"+this.snippet.id+" small");this.snippetContainer=$("#snippet-"+this.snippet.id);this.snippetWrapper=$("#snippet-wrapper-"+this.snippet.id);this.addSnippetToTrayButton=$("#snippet-heart-"+this.snippet.id);this.removeSnippetFromTrayButton=$("#snippet-heart-remove-"+this.snippet.id);this.moveTo(this.positionY);if(trayController.containsSnippet(this.snippet.id)){this.addSnippetToTrayButton.hide();this.removeSnippetFromTrayButton.show()}else{this.addSnippetToTrayButton.show();this.removeSnippetFromTrayButton.hide()}this.addSnippetToTrayButton.click(this.addSnippetToTray);$("#toolbar-heart").hide();this.addSnippetToTrayButton.hide();this.removeSnippetFromTrayButton.hide()},addSnippetToTray:function(){trayController.addSnippet(this.snippet);this.addSnippetToTrayButton.hide();this.removeSnippetFromTrayButton.show()},removeSnippetFromTray:function(){trayController.removeSnippet(this.snippet);this.addSnippetToTrayButton.show();this.removeSnippetFromTrayButton.hide()},getHeight:function(){return this.snippetWrapper.height()},render:function(){$.tmpl(this.litTemplate,this.snippet).appendTo(this.container)},fadeOut:function(fadeTime){fadeTime=fadeTime?fadeTime:this.FADE_TIME;this.fadeAbort();this.snippetText.animate({color:$.Color("#dedede")},fadeTime,"easeInQuad");this.snippetAuthor.animate({color:$.Color("#dedede")},fadeTime,"easeInQuad");var ref=this;this.snippetContainer.animate({borderLeftColor:$.Color("#efefef")},fadeTime,"easeInQuad",function(){utils.trace("faded");ref.destroySnippet(true)})},destroySnippet:function(refresh){$(this.snippetWrapper).remove();this.isDestroyed=true;if(refresh){rouletteController.refreshSnippets()}},fadeAbort:function(){this.snippetText.stop(true,true);this.snippetAuthor.stop(true,true);this.snippetContainer.stop(true,true)},fadeIn:function(){this.snippetText.stop(false,false);this.snippetAuthor.stop(false,false);this.snippetContainer.stop(false,false);this.snippetText.animate({color:$.Color("#666")},300);this.snippetAuthor.animate({color:$.Color("#999")},300);this.snippetContainer.animate({borderLeftColor:$.Color("#dedede")},300)},moveTo:function(topY,duration){duration=duration||750;$(this.snippetWrapper).stop(true,true);$(this.snippetWrapper).animate({top:topY},750)}});var MastheadController=SearchInputController.create({masthead:$("#masthead"),mastheadInput:$("#mastheadInput"),spinner:null,init:function(){this.mastheadInput.focus();if(pageParams.animateMasthead){$("#mastheadDetail").hide();setTimeout(function(){$("#mastheadDetail").slideDown(750,function(){$("#mastheadInput").focus()})},1500)}this.addSpinner();this.initSearchInput(this.mastheadInput,2000)},invokeSearch:function(searchText){utils.trace("masthead search : "+searchText);this.setSearchSuspended(true);discoveryDropsController.stop();utils.trace("Sliding up");this.masthead.slideUp(750,function(){indexAppController.start(searchText)})},foldAway:function(){},invokeTypingStarted:function(){this.stopSpinner()},invokeTypingStopped:function(searchText){this.spin()},addSpinner:function(){var opts={lines:12,length:2,width:4,radius:8,color:"#fff",speed:1,trail:60,shadow:true};this.spinner=new Spinner(opts)},spin:function(){var target=document.getElementById("mastheadSpinnerContainer");this.spinner.spin(target)},stopSpinner:function(){this.spinner.stop()}});var SearchReactorController=BaseController.create({proxied:["renderTopicCards"],container:"#searchReactorContainer",reactorAtomTemplate:$.template("<div id='t-${topicId}-${wordIndex}' style='left: ${x}; top: ${y}px}' class='t-atom t${topicId}'>${word}</div>"),YGAP:30,init:function(){$(this.container).html("&nbsp;");var atomY=1000;for(var i=0;i<Topic.all().length;i++){var topic=Topic.all()[i];for(var j=0;j<topic.top.length;j++){var topWord=topic.top[j];var obj=new Object();obj.word=topWord;obj.topicId=topic.id;obj.wordIndex=j;obj.x=0;obj.y=atomY;var x=$.tmpl(this.reactorAtomTemplate,obj).appendTo(this.container);atomY+=this.YGAP}}},getAllAtoms:function(){var allAtoms=new Array();for(var i=0;i<Topic.all().length;i++){var topic=Topic.all()[i];for(var j=0;j<topic.top.length;j++){allAtoms.push("#t-"+topic.id+"-"+j)}}return allAtoms},reset:function(){$(".t-atom").stop(false,false)},shuffle:function(){this.reset();var allAtoms=utils.shuffle(this.getAllAtoms());var atomY=0;var cutoff=this.YGAP*20;for(var i=0;i<allAtoms.length;i++){var atomElement=allAtoms[i];if(atomY>cutoff){$(atomElement).css("top",atomY)}else{$(atomElement).css("left",(95-$(atomElement).width())/2);$(atomElement).animate({top:atomY},utils.randomNumber(250,750),"easeOutCubic")}atomY+=this.YGAP}},rescore:function(scores){var scopeTopicMap=new Object();for(var i=0;i<scores.length;i++){if(scopeTopicMap[scores[i]]==null){scopeTopicMap[scores[i]]=new Array()}scopeTopicMap[scores[i]].push(i)}var uniqueScores=new Array();for(var s in scopeTopicMap){uniqueScores.push(s)}uniqueScores=uniqueScores.sort().reverse();if(uniqueScores.length==1){utils.trace("Cannot rescore. All scores are same.")}else{var firstScoringTopics=scopeTopicMap[uniqueScores[0]];var secondScoringTopics=scopeTopicMap[uniqueScores[1]];if(firstScoringTopics.length==1&&secondScoringTopics.length<10){utils.trace("only 1 high scoring topic and "+secondScoringTopics.length+" second scoring topics");this.distributeTopics(firstScoringTopics,secondScoringTopics)}else{if(firstScoringTopics.length==2&&secondScoringTopics.length<10){utils.trace("2 high scoring topic and "+secondScoringTopics.length+" second scoring topics");this.distributeTopics(firstScoringTopics,secondScoringTopics)}else{utils.trace(firstScoringTopics.length+" high scoring topics");this.distributeTopics(firstScoringTopics)}}}},distributeTopics:function(primaryTopicIdList,secondaryTopicList){this.reset();var renderedAtoms=new Array();var atomY=0;if(secondaryTopicList==null){atomY=this.showAtoms(atomY,primaryTopicIdList,renderedAtoms,18)}else{atomY=this.showAtoms(atomY,primaryTopicIdList,renderedAtoms,12);atomY=this.showAtoms(atomY,secondaryTopicList,renderedAtoms,18)}var upperCutoff=atomY;atomY+=this.YGAP;var allAtoms=utils.shuffle(this.getAllAtoms());for(var i=0;i<allAtoms.length;i++){var atomElement=allAtoms[i];var skip=false;for(var j=0;j<renderedAtoms.length;j++){var renderedElementId=renderedAtoms[j];if(renderedElementId==atomElement){skip=true;break}}if(!skip){var atomTop=$(atomElement).css("top");atomTop=new Number(atomTop.substring(0,atomTop.indexOf("px")));if(atomTop<=upperCutoff){$(atomElement).animate({top:atomY},utils.randomNumber(250,750),"easeInCubic")}else{$(atomElement).css("top",atomY)}atomY+=this.YGAP}}},showAtoms:function(atomY,topicIdList,renderedAtoms,count){utils.trace("topicIdList.length = "+topicIdList.length);for(var i=0;i<topicIdList.length;i++){utils.trace(Topic.find(topicIdList[i]).name)}while(renderedAtoms.length<count){var randomIndex=utils.randomNumber(0,topicIdList.length-1);var topicId=topicIdList[randomIndex];var wordsInTopic=Topic.find(topicId).top;var elementId="#t-"+topicId+"-"+utils.randomNumber(0,wordsInTopic.length-1);var skip=false;for(var j=0;j<renderedAtoms.length;j++){var renderedElementId=renderedAtoms[j];if(renderedElementId==elementId){skip=true;break}}if(!skip){$(elementId).animate({top:atomY},utils.randomNumber(750,1500),"easeOutCubic");var leftP=(95-$(elementId).width())/2;$(elementId).css("left",leftP);atomY+=this.YGAP;renderedAtoms.push(elementId)}}return atomY}});var HelpController=BaseController.create({FADE:500,FADE_FAST:400,OPACITY:0.075,EASING:"easeInQuad",inHelpMode:false,playOnClose:false,init:function(){$("#writer-hint-box").hide();$("#iris-hint-box").hide();$("#snippets-hint-box").hide();$("#toolbar-hint-box").hide();$("#wordexplorer-hint-box").hide();$("#wordrhymes-hint-box").hide();$("#hidewidgets-hint-box").hide();$("#writer-help").twipsy();$("#writer-help").click(this.proxy(this.showHelp));$(".help-close").click(this.proxy(this.closeHelp));$("#help-writer-next").click(this.proxy(this.onWriterNext));$("#help-iris-previous").click(this.proxy(this.onIrisPrevious));$("#help-iris-next").click(this.proxy(this.onIrisNext));$("#help-snippets-previous").click(this.proxy(this.onSnippetsPrevious));$("#help-snippets-next").click(this.proxy(this.onSnippetsNext));$("#help-wordexplorer-previous").click(this.proxy(this.onWordExplorerPrevious));$("#help-wordexplorer-next").click(this.proxy(this.onWordExplorerNext));$("#help-wordrhymes-previous").click(this.proxy(this.onWordRhymerPrevious));$("#help-wordrhymes-next").click(this.proxy(this.onWordRhymerNext));$("#help-hidewidgets-previous").click(this.proxy(this.onHideWidgetsPrevious));$("#help-toolbar-previous").click(this.proxy(this.onToolbarPrevious));$(document).keyup(this.proxy(this.pageKeyUp))},onHideWidgetsPrevious:function(){$("#hidewidgets-hint-box").fadeOut(this.FADE,this.proxy(this.showRhymingWordsHelp))},onWordExplorerPrevious:function(){$("#wordexplorer-hint-box").fadeOut(this.FADE,this.proxy(this.showSnippetsHelp))},onWordExplorerNext:function(){$("#wordexplorer-hint-box").fadeOut(this.FADE,this.proxy(this.showRhymingWordsHelp))},onWordRhymerPrevious:function(){$("#wordrhymes-hint-box").fadeOut(this.FADE,this.proxy(this.showRelatedWordsHelp))},onWordRhymerNext:function(){$("#wordrhymes-hint-box").fadeOut(this.FADE,this.proxy(this.showWidgetClose))},onToolbarPrevious:function(){$("#toolbar-hint-box").fadeOut(this.FADE,this.proxy(this.showSnippetsHelp))},onSnippetsNext:function(){$("#snippets-hint-box").fadeOut(this.FADE,this.proxy(this.showRelatedWordsHelp))},onSnippetsPrevious:function(){$("#snippets-hint-box").fadeOut(this.FADE,this.proxy(this.showIrisHelp))},onIrisNext:function(){$("#iris-hint-box").fadeOut(this.FADE,this.proxy(this.showSnippetsHelp))},showWidgetClose:function(){$("#writerInput").fadeTo(this.FADE+this.FADE/5,1,this.EASING);indexAppController.hideWidgets(function(){$("#widgets-toolbar-close").wiggle({wiggles:2,callback:function(){$("#hidewidgets-hint-box").fadeIn()}})})},showRelatedWordsHelp:function(){indexAppController.showWordExplorer();$("#wordExplorerContainer").fadeTo(this.FADE+this.FADE/5,1,this.EASING,function(){$("#widgets-toolbar").wiggle({wiggles:2});$("#wordExplorerContainer").wiggle({wiggles:2,callback:function(){$("#wordexplorer-hint-box").fadeIn()}})})},showRhymingWordsHelp:function(){indexAppController.showWidgets();indexAppController.showWordRhymer();$("#wordRhymerContainer").fadeTo(this.FADE+this.FADE/5,1,this.EASING,function(){$("#widgets-toolbar").wiggle({wiggles:2});$("#wordRhymerContainer").wiggle({wiggles:2,callback:function(){$("#wordrhymes-hint-box").fadeIn()}})})},showToolbarHelp:function(){$("#rouletteContainer").fadeTo(this.FADE_FAST,this.OPACITY,this.EASING);$("#toolbarContainerRight").fadeTo(this.FADE+this.FADE/5,1,this.EASING);$("#toolbarContainerLeft").fadeTo(this.FADE+this.FADE/5,1,this.EASING,function(){$("#toolbarContainer").wiggle({wiggles:2,callback:function(){$("#toolbar-hint-box").fadeIn()}})})},showSnippetsHelp:function(){indexAppController.showRoulette();this.fadeContainers(this.FADE_FAST,["#rainbowContainer"]);$("#widgets-toolbar").fadeTo(this.FADE+this.FADE/5,1,this.EASING);$("#rouletteContainer").fadeTo(this.FADE+this.FADE/5,1,this.EASING,function(){$("#widgets-toolbar").wiggle({wiggles:2});$("#rouletteContainer").wiggle({wiggles:2,callback:function(){$("#snippets-hint-box").fadeIn()}})})},onIrisPrevious:function(){$("#iris-hint-box").fadeOut(this.FADE,this.proxy(this.showWriterHelp))},showWriterHelp:function(){$("#rainbowContainer").fadeTo(this.FADE_FAST,this.OPACITY,this.EASING);$("#writerInput").fadeTo(this.FADE+this.FADE/5,1,this.EASING,function(){$("#writerInput").wiggle({wiggles:2,callback:function(){$("#writer-hint-box").fadeIn()}})})},pageKeyUp:function(e){if(this.inHelpMode&&e.keyCode==27){this.closeHelp()}},onWriterNext:function(e){$("#writer-hint-box").fadeOut(this.FADE,this.proxy(this.showIrisHelp));if(e){e.preventDefault()}},showIrisHelp:function(){indexAppController.showRoulette();this.fadeContainers(this.FADE_FAST,["#writerInput","#rouletteContainer","#widgets-toolbar"]);$("#rainbowContainer").fadeTo(this.FADE+this.FADE/5,1,this.EASING,function(){$("#rainbowContainer").wiggle({wiggles:2,callback:function(){$("#iris-hint-box").fadeIn()}})})},closeHelp:function(e){this.reset();indexAppController.showRoulette();indexAppController.showWidgets();$("#writer-hint-box").fadeOut();$("#iris-hint-box").fadeOut();$("#snippets-hint-box").fadeOut();$("#toolbar-hint-box").fadeOut();$("#wordexplorer-hint-box").fadeOut();$("#wordrhymes-hint-box").fadeOut();$("#hidewidgets-hint-box").fadeOut();$("#writerInput").fadeTo(this.FADE_FAST,1,this.EASING);$("#rainbowContainer").fadeTo(this.FADE_FAST,1,this.EASING);$("#rouletteContainer").fadeTo(this.FADE_FAST,1,this.EASING);$("#odeTitle").fadeTo(this.FADE_FAST,1,this.EASING);$("#ode-toolbar").fadeTo(this.FADE_FAST,1,this.EASING);$("#widgets-toolbar").fadeTo(this.FADE_FAST,1,this.EASING);$("#floating-widgets-toolbar").fadeTo(this.FADE_FAST,1,this.EASING,function(){$("#writerInput").putCursorAtEnd()});if(this.playOnClose){toolbarController.play()}this.inHelpMode=false;if(e){e.preventDefault()}},showHelp:function(e){if(this.inHelpMode){this.closeHelp()}else{if(!toolbarController.isPaused()){toolbarController.pause();this.playOnClose=true}else{}Analytics.log(X._AUTHOR,X.HELP);this.reset();indexAppController.showRoulette();this.fadeContainers(this.FADE,["#rainbowContainer","#odeTitle","#ode-toolbar","#widgets-toolbar","#floating-widgets-toolbar","#rouletteContainer"],function(){$("#writerInput").wiggle({wiggles:2,callback:function(){$("#writerInput").putCursorAtEnd();$("#writer-hint-box").fadeIn()}})});this.inHelpMode=true}if(e){e.preventDefault()}},fadeContainers:function(fadeTime,containers,callback){for(var i=0;i<containers.length;i++){$(containers[i]).stop(true,true)}for(var i=0;i<containers.length-1;i++){var container=$(containers[i]);container.fadeTo(fadeTime,this.OPACITY,this.EASING)}$(containers[containers.length-1]).fadeTo(fadeTime,this.OPACITY,this.EASING,callback)},reset:function(){$("#rainbowContainer").stop(true,true);$("#rouletteContainer").stop(true,true);$("#floating-widgets-toolbar").stop(true,true);$("#odeTitle").stop(true,true)}});var TrayController=BaseController.create({snippets:[],snippetMap:new Object(),addSnippet:function(snippet){if(!this.containsSnippet(snippet.id)){this.snippets.push(snippet);this.snippetMap[snippet.id]=snippet;toolbarController.wiggleTray(this.snippets.length)}},removeSnippet:function(snippet){if(this.containsSnippet(snippet.id)){this.snippetMap[snippet.id]=null;var updatedSnippets=[];for(var i=0;i<this.snippets.length;i++){var s=this.snippets[i];if(s.id!=snippet.id){updatedSnippets.push(s)}}this.snippets=updatedSnippets;toolbarController.wiggleTray(this.snippets.length)}},containsSnippet:function(id){return this.snippetMap[id]!=null}});var ToolbarController=BaseController.create({proxied:["play","pause","skip","onPublish","onSave","onShowTray","handleAuthCancel","handleAuthComplete"],publishButton:$("#publish-button"),saveButton:$("#save-button"),trayButton:$("#toolbar-heart"),playButton:$("#toolbar-play"),pauseButton:$("#toolbar-pause"),skipButton:$("#toolbar-skip"),trayCountLabel:$("#toolbar-heart-count"),isPublishingOde:false,_isPaused:false,init:function(){this.playButton.hide();this.playButton.click(this.play);this.pauseButton.click(this.pause);this.skipButton.click(this.skip);this.publishButton.click(this.onPublish);this.saveButton.click(this.onSave);this.trayButton.click(this.onShowTray);this.enableAuthEvents()},handleAuthEvent:function(action){utils.trace("auth complete "+action);if(action=="save"){Analytics.log(X._AUTHOR,X.SIGN_IN_COMPLETE,"save");this.saveOde(false)}else{if(action=="publish"){Analytics.log(X._AUTHOR,X.SIGN_IN_COMPLETE,"publish");this.saveOde(true)}else{utils.trace("unknown auth action =  "+action)}}},play:function(){Analytics.log(X._AUTHOR,X.PLAY);this.trigger("play");this.pauseButton.show();this.playButton.hide();this._isPaused=false},pause:function(){Analytics.log(X._AUTHOR,X.PAUSE);this.trigger("pause");this.pauseButton.hide();this.playButton.show();this._isPaused=true},skip:function(){Analytics.log(X._AUTHOR,X.SKIP);this.trigger("skip")},isPaused:function(){return this._isPaused},onSave:function(){if(this.saveButton.hasClass("disabled")){utils.trace("save disabled")}else{this.saveOde(false)}},onPublish:function(){if(this.publishButton.hasClass("disabled")){utils.trace("publish disabled")}else{this.saveOde(true)}},saveOde:function(publish){utils.trace("saveOde: publish="+publish);var odeTitle=jQuery.trim($("#odeTitle").val());var odeText=jQuery.trim($("#writerInput").val());if(odeText.length==0){$("#writerInput").wiggle({callback:function(){$("#writerInput").putCursorAtEnd()}})}else{if(odeTitle.length==0){$("#odeTitle").wiggle({callback:function(){$("#odeTitle").putCursorAtEnd()}})}else{if(facebookController.isSignedIn()){this.saveButton.addClass("disabled");this.publishButton.addClass("disabled");this.isPublishingOde=publish;var params="";params+="title="+odeTitle;params+="&content="+odeText;params+="&publish="+publish;if(pageParams.odeId!=null&&pageParams.odeId.length>0){params+="&odeId="+pageParams.odeId}$.post("/api/saveOde",params,this.proxy(this.onOdeSaved),"json");Analytics.log(X._AUTHOR,publish?X.PUBLISH_ODE:X.SAVE_ODE,odeTitle)}else{this.setAuthAction(publish?"publish":"save");Analytics.log(X._AUTHOR,X.SIGN_IN_START,publish?"publish":"save");facebookController.loginUser()}}}},onOdeSaved:function(response){utils.trace(response);if(response.success){utils.trace("saved ode "+response.result);if(this.isPublishingOde){this.submitFacebookAction("app-ode-la:publish?ode=http://ode.la/view/"+response.result,function(){window.location="/view/"+response.result})}else{window.location="/view/"+response.result}}else{utils.error("Unable to save ode");this.saveButton.removeClass("disabled");this.publishButton.removeClass("disabled")}},onShowTray:function(){},updateTrayCount:function(count){this.trayCountLabel.stop(true,true);this.trayCountLabel.html(count);this.trayCountLabel.show();this.trayCountLabel.fadeOut(1500)},wiggleTray:function(count){this.updateTrayCount(count);this.trayButton.wiggle()},bobTray:function(count){this.updateTrayCount(count);this.trayButton.bob()}});var BaseWidgetcontroller=BaseController.create({container:null,isPaused:false,isSuspended:false,containerIdentifier:null,widgetProgressContainer:null,isFirstTime:true,initWidget:function(c,w){this.container=c;this.containerIdentifier=$(this.container).attr("id");this.widgetProgressContainer=w;utils.trace("BaseWidgetcontroller.init "+this.containerIdentifier);toolbarController.bind("play",this.proxy(this.resume));toolbarController.bind("pause",this.proxy(this.pause));toolbarController.bind("skip",this.proxy(this.skip))},setSuspended:function(suspend){if(suspend){if(!this.isSuspended){utils.trace("Suspending "+this.containerIdentifier);this.pause();this.isSuspended=true}}else{this.isSuspended=false;if(this.isFirstTime){this.isFirstTime=false;utils.trace("Resuming "+this.containerIdentifier+" (first-time)");if(toolbarController.isPaused()){this.resume();this.pause()}else{this.resume()}}else{if(toolbarController.isPaused()){utils.trace("Resuming "+this.containerIdentifier+" (paused)")}else{utils.trace("Resuming "+this.containerIdentifier+" (resumed)");this.resume()}}}},slideProgressBar:function(duration){this.widgetProgressContainer.css("width","0");this.widgetProgressContainer.stop(false,false);this.widgetProgressContainer.animate({width:435},duration,"linear",this.proxy(this.clearProgressBar))},clearProgressBar:function(){this.widgetProgressContainer.stop(false,false);this.widgetProgressContainer.css("width","0")},setPaused:function(p){this.isPaused=p},pause:function(){if(this.isSuspended){utils.trace(this.containerIdentifier+" suspended. Ignoring pause")}else{this.setPaused(true);this.onPause()}},resume:function(){if(this.isSuspended){utils.trace(this.containerIdentifier+" suspended. Ignoring resume")}else{this.setPaused(false);this.onResume()}},skip:function(){if(this.isSuspended){utils.trace(this.containerIdentifier+" suspended. Ignoring skip")}else{this.onSkip()}},onPause:function(){throw new Error("pause must be implemented by subclass")},onResume:function(){throw new Error("resume must be implemented by subclass")},onSkip:function(){throw new Error("skip must be implemented by subclass")},show:function(){$(".widget-container").hide();this.container.show()}});var RouletteController=BaseWidgetcontroller.create({proxied:["queueSnippets","doQueueSnippets"],snippetsContainer:"#snippetsContainer",activeSnippetControllers:[],snippetsQueue:[],snippetFetchThreshold:1,init:function(){this.initWidget($("#rouletteContainer"),$("#rouletteProgress"));Snippet.bind("refresh",this.queueSnippets)},queueSnippets:function(){utils.trace("queueSnippets");if(this.isSuspended){utils.trace("RouletteController suspended. Ignoring snippets refresh")}else{if(writerController.pageNumber==1){while(this.snippetsQueue.length>0){this.snippetsQueue.pop()}rouletteController.clear(this.doQueueSnippets)}else{this.doQueueSnippets(this.snippetFetchThreshold)}}},doQueueSnippets:function(threshold){if(threshold==null){threshold=0}while(this.snippetsQueue.length>threshold){this.snippetsQueue.pop()}for(var i=0;i<Snippet.all().length;i++){this.snippetsQueue.push(Snippet.all()[i])}if(this.getRemainingHeight()>0){indexAppController.stopSpinner();this.refreshSnippets()}},refreshSnippets:function(){utils.trace("---------------");utils.trace("refreshSnippets");var initialActiveSnippetsCount=this.activeSnippetControllers.length;var i=0;var snippetController=null;var remainingActiveSnippetControllers=[];var atleastOneSnippetDestroyed=false;for(i=0;i<this.activeSnippetControllers.length;i++){snippetController=this.activeSnippetControllers[i];if(snippetController.isDestroyed){atleastOneSnippetDestroyed=true}else{remainingActiveSnippetControllers.push(snippetController)}}this.activeSnippetControllers=remainingActiveSnippetControllers;remainingActiveSnippetControllers=[];var allSnippets=$(this.snippetsContainer).children();for(i=0;i<allSnippets.length;i++){var aSnippet=allSnippets[i];var found=false;for(var j=0;j<this.activeSnippetControllers.length;j++){snippetController=this.activeSnippetControllers[j];if(snippetController.snippetWrapper.attr("id")==aSnippet.id){found=true;break}}if(!found){utils.warn("Removing dangling snippet");$(aSnippet).remove()}}if(atleastOneSnippetDestroyed){utils.trace("re-layout");var runningY=0;for(i=0;i<this.activeSnippetControllers.length;i++){snippetController=this.activeSnippetControllers[i];snippetController.moveTo(runningY);runningY+=snippetController.getHeight()}}var snippetsAddedCount=0;while(this.getRemainingHeight()>0&&this.snippetsQueue.length>0){this.activeSnippetControllers.push(SnippetController.init({positionY:this.getUsedHeight(),item:this.snippetsQueue.pop(),container:this.snippetsContainer}));snippetsAddedCount++}if(snippetsAddedCount>0){utils.trace("added more snippets "+snippetsAddedCount)}if((atleastOneSnippetDestroyed||initialActiveSnippetsCount==0)&&this.activeSnippetControllers.length>0&&!this.isPaused){this.slideProgressBar(15000);this.activeSnippetControllers[0].fadeOut()}if(this.snippetsQueue.length<=this.snippetFetchThreshold){utils.trace(this.snippetsQueue.length+" <= "+this.snippetFetchThreshold);writerController.getMoreSnippets()}if(writerController.isInactive()){toolbarController.pause()}},onPause:function(){if(this.activeSnippetControllers.length>0){this.clearProgressBar();this.activeSnippetControllers[0].fadeIn()}},onResume:function(){if(this.activeSnippetControllers.length>0){this.slideProgressBar(15000);this.activeSnippetControllers[0].fadeOut()}},onSkip:function(){if(this.activeSnippetControllers.length>0){var activeSnippetController=this.activeSnippetControllers[0];this.clearProgressBar();activeSnippetController.fadeOut(300);setTimeout(function(){activeSnippetController.destroySnippet(true)},400)}else{utils.trace("nothing to skip")}},clear:function(callback){if(this.activeSnippetControllers.length>0){var resumeAfterClear=!this.isPaused;this.pause();for(var i=0;i<this.activeSnippetControllers.length;i++){var snippetController=this.activeSnippetControllers[i];snippetController.moveTo(-500)}var ref=this;setTimeout(function(){for(var i=0;i<ref.activeSnippetControllers.length;i++){var snippetController=ref.activeSnippetControllers[i];snippetController.destroySnippet(false)}if(resumeAfterClear){ref.resume()}callback()},500)}else{callback()}},getRemainingHeight:function(){var totalHeight=$(this.snippetsContainer).height();var usedHeight=this.getUsedHeight();return totalHeight-usedHeight},getUsedHeight:function(){var usedHeight=0;var allSnippets=$(this.snippetsContainer).children();for(var i=0;i<allSnippets.length;i++){var aSnippet=$(allSnippets[i]);usedHeight+=aSnippet.height()}return usedHeight}});var SingleWordWidgetController=BaseWidgetcontroller.create({termCursor:0,NEXT_TETM_WAIT_DURATION:1000,PROCESS_SELECTION_WAIT_DURATION:2000,REFRESH_DURATION:15000,playbackTimeout:null,nextTermTimeout:null,textSelectionTimeout:null,currentTerm:null,responseCache:new Object(),selectionData:null,initWordWidget:function(){writerController.bind("text-selected",this.proxy(this.onTextSelection))},onTextSelection:function(data){utils.trace("onTextSelection");utils.trace(data);this.selectionData=data;clearTimeout(this.textSelectionTimeout);this.textSelectionTimeout=setTimeout(this.proxy(this.processTextSelection),this.PROCESS_SELECTION_WAIT_DURATION)},processTextSelection:function(){this.clearProgressBar();this.showTerm(this.selectionData,true)},onPause:function(){this.clearSchedule()},onResume:function(){if(this.playbackTimeout){this.scheduleNextTerm()}else{this.showNextTerm()}},scheduleNextTerm:function(){this.slideProgressBar(this.REFRESH_DURATION);clearTimeout(this.playbackTimeout);this.playbackTimeout=setTimeout(this.proxy(this.showNextTerm),this.REFRESH_DURATION)},clearSchedule:function(){this.clearProgressBar();clearTimeout(this.playbackTimeout)},onSkip:function(){clearTimeout(this.nextTermTimeout);this.showNextTerm()},showNextTerm:function(){if(TopTerm.count()>0){if(this.termCursor>=TopTerm.count()){this.termCursor=0}var nextTerm=TopTerm.all()[this.termCursor].term;this.termCursor++;this.showTerm(nextTerm,true)}else{utils.trace(this.containerIdentifier+"no terms to show")}},showTerm:function(term,stem){throw new Error("Must be implemented by sub class")}});var WordExplorerController=SingleWordWidgetController.create({FETCH_COUNT:10,playbackTimeout:null,TYPE_SYNONYM:"synonym",TYPE_ANTONYM:"antonym",TYPE_HYPERNYM:"hypernym",TYPE_HYPONYM:"hyponym",relatedTemplate:$.template('<span style="float: left;" class="related-word ${labelType}">${term}</span>'),stemmedTerm:null,relatedTermsCounter:0,responseCounter:0,init:function(){this.initWidget($("#wordExplorerContainer"),$("#wordExplorerProgress"));this.initWordWidget();this.clear()},showTerm:function(term,stem){utils.trace("showing "+term);$("#wordExplorerWord").html(term);this.clear();this.currentTerm=term;this.stemmedTerm=stem?stemmer(term):term;utils.trace(term+" = "+this.stemmedTerm);this.responseCounter=0;this.relatedTermsCounter=0;indexAppController.spin();this.clearSchedule();clearTimeout(this.nextTermTimeout);this.nextTermTimeout=setTimeout(this.proxy(this.fetch),this.NEXT_TETM_WAIT_DURATION)},clear:function(){$("#synomyms").html("");$("#hypernyms").html("");$("#hyponyms").html("");$("#antonyms").html("");$("#relationship-synomyms").slideUp();$("#relationship-hypernyms").slideUp();$("#relationship-hyponyms").slideUp();$("#relationship-antonyms").slideUp();$("#no-related-message").hide()},fetch:function(){this.fetchType(this.TYPE_SYNONYM);this.fetchType(this.TYPE_HYPONYM);this.fetchType(this.TYPE_HYPERNYM);this.fetchType(this.TYPE_ANTONYM)},fetchType:function(relationshipType){if(this.responseCache[this.stemmedTerm+relationshipType]){this.onRelatedReceived(this.responseCache[this.stemmedTerm+relationshipType])}else{$.getJSON("/api/related/"+this.stemmedTerm+"?limit="+this.FETCH_COUNT+"&relationshipType="+relationshipType,this.proxy(this.onRelatedReceived)).complete(this.showCompleteStatus).error(this.showErrorStatus)}},onRelatedReceived:function(response){utils.trace("onRelatedReceived "+response.result.word+" == "+this.stemmedTerm);utils.trace(response);if(response.success){this.responseCache[this.stemmedTerm+response.result.relationshipType]=response;if(response.result.word==this.stemmedTerm){var words=response.result.words;this.responseCounter++;this.relatedTermsCounter+=words?words.length:0;if(response.result.relationshipType==this.TYPE_SYNONYM){this.addWords(words,"","#synomyms","#relationship-synomyms")}else{if(response.result.relationshipType==this.TYPE_HYPERNYM){this.addWords(words,"","#hypernyms","#relationship-hypernyms")}else{if(response.result.relationshipType==this.TYPE_HYPONYM){this.addWords(words,"","#hyponyms","#relationship-hyponyms")}else{if(response.result.relationshipType==this.TYPE_ANTONYM){this.addWords(words,"","#antonyms","#relationship-antonyms")}}}}var completed=this.responseCounter==4;if(completed){indexAppController.stopSpinner();if(!this.isPaused){this.scheduleNextTerm()}}var completedWithEmptyResponse=completed&&this.relatedTermsCounter==0;if(completedWithEmptyResponse){utils.trace("completedWithEmptyResponse");if(this.currentTerm!=this.stemmedTerm){utils.trace("processing without steming "+this.currentTerm);this.showTerm(this.currentTerm,false)}else{utils.trace("no related found");$("#no-related-message").show()}}}else{utils.trace("Ignoring stale term response")}}else{utils.error("Unable to get related terms")}},addWords:function(words,labelType,targetDiv,containerDiv){if(words&&words.length>0){for(var i=0;i<words.length;i++){var obj={labelType:labelType};obj.term=words[i];$.tmpl(this.relatedTemplate,obj).appendTo(targetDiv)}$(targetDiv).append("<div style='clear:both'></div>");$(containerDiv).stop();$(containerDiv).slideDown(750);utils.trace("Showing "+words.length+" words for "+targetDiv)}else{}}});var WordRhymerController=SingleWordWidgetController.create({relatedTemplate:$.template('<span style="float: left;" class="rhyme-label ${labelType}">${term}</span>'),relatedTemplateAlt:$.template('<span style="float: left;" class="rhyme-label-alt ${labelType}">${term}</span>'),init:function(){this.initWidget($("#wordRhymerContainer"),$("#wordRhymerProgress"));this.initWordWidget()},showTerm:function(term,stem){utils.trace("showing "+term);$("#wordRhymerWord").html(term);$("#rhymes").html("");$("#no-rhymes-message").hide("");$("#relationship-rhymes").slideUp();this.currentTerm=term;indexAppController.spin();this.clearSchedule();clearTimeout(this.nextTermTimeout);this.nextTermTimeout=setTimeout(this.proxy(this.fetch),this.NEXT_TETM_WAIT_DURATION)},fetch:function(){if(this.responseCache[this.currentTerm+"rhyme"]){this.onRhymesReceived(this.responseCache[this.currentTerm+"rhyme"])}else{$.getJSON("/api/rhyme/"+this.currentTerm,this.proxy(this.onRhymesReceived)).complete(this.showCompleteStatus).error(this.showErrorStatus)}},onRhymesReceived:function(response){utils.trace("onRhymesReceived ");utils.trace(response);if(response.success){this.responseCache[this.currentTerm+"rhyme"]=response;if(response.result.word==this.currentTerm){var words=response.result.words;indexAppController.stopSpinner();if(words!=null&words.length>0){this.addWords(words,"","#rhymes","#relationship-rhymes")}else{$("#no-rhymes-message").show()}if(!this.isPaused){this.scheduleNextTerm()}}else{utils.trace("Ignoring stale term response")}}else{utils.error("Unable to get rhyming terms")}},addWords:function(words,labelType,targetDiv,containerDiv){if(words&&words.length>0){for(var i=0;i<words.length;i++){var obj={labelType:labelType};obj.term=words[i];if(i%2==0){$.tmpl(this.relatedTemplate,obj).appendTo(targetDiv)}else{$.tmpl(this.relatedTemplateAlt,obj).appendTo(targetDiv)}}$(targetDiv).append("<div style='clear:both'></div>");$(containerDiv).stop();$(containerDiv).slideDown(750);utils.trace("Showing "+words.length+" words for "+targetDiv)}else{}}});var DiscoveryDropsController=BaseController.create({currentIndex:0,currentDropbox:0,stopped:false,DELAY_MESSAGE:4000,DELAY_DROP_IN:3000,dropsTimeout:null,exploreLinkTimeout:null,init:function(){var drop=new Object();drop.content="Stars of the summer night!<br/>Far in yon azure deeps,<br/>Hide, hide your golden light!";drop.title="Raindrops";drop.author="Sarah Shorthand Rigger";drop.phrase="Stars of the summer night";DiscoveryDrop.bind("refresh",this.proxy(this.start));DiscoveryDrop.bind("destroyed",this.proxy(this.dropOne));this.load()},start:function(){this.dropsTimeout=setTimeout(this.proxy(this.dropOne),this.DELAY_DROP_IN);this.exploreLinkTimeout=setTimeout(function(){$("#index-explore-button").fadeIn(1000);$("#page-corner").fadeIn(2000)},4000)},load:function(){var dropList=new Array();var o;o=new Object();o.content="When to the sessions of sweet silent thought<br/>I summon up <span class='ode-drop-star'>remembrance of things past</span>,<br/>I sigh the lack of many a thing I sought";o.title="Remembrance";o.author="William Shakespeare";o.permalink="remembrance";o.username="shakespeare";dropList.push(o);o=new Object();o.content="So may <span class='ode-drop-star'>some gentle Muse</span><br/>With lucky words favour my destined urn";o.title="Lycidas";o.author="John Milton";o.username="milton";o.permalink="lycidas";dropList.push(o);o=new Object();o.content="I wandered <span class='ode-drop-star'>lonely as a cloud</span><br/>That floats on high o'er vales and hills,<br/>When all at once I saw a crowd,";o.title="Daffodils";o.author="Sir Henry Wotton";o.username="wordsworth";o.permalink="daffodils";dropList.push(o);o=new Object();o.content="How happy is he born and taught<br/>That serveth not another's will;<br/>Whose armour is <span class='ode-drop-star'>his honest thought</span><br/>And simple truth his utmost skill!";o.title="Character of a Happy Life";o.author="Sir Henry Wotton";o.username="wotton";o.permalink="character-of-a-happy-life";dropList.push(o);o=new Object();o.content='A group of sailors, quaintly garbed and bearded;<br/>Strange tales, that <span class="ode-drop-star">snared the fancy of a child</span>:<br/>Of far-off lands, strange beasts, and birds, and people';o.title="Columbus";o.author="Helen L Smith";o.username="smith";o.permalink="columbus";dropList.push(o);o=new Object();o.content='I mourn no more my vanished years;<br/>Beneath <span class="ode-drop-star">a tender rain</span>,<br/>An April rain of smiles and tears,<br/>My heart is young again.';o.title="My Psalm";o.author="John Whittier";o.username="john-whittier";o.permalink="my-psalm";dropList.push(o);DiscoveryDrop.refresh(utils.shuffle(dropList))},dropOne:function(){if(!this.stopped){if(this.currentIndex>=DiscoveryDrop.count()){this.currentIndex=0}var dropToRender=DiscoveryDrop.all()[this.currentIndex];this.currentDropbox=DiscoveryDropBoxController.init({drop:dropToRender,container:"#root-page-content"});this.currentIndex++}},stop:function(){this.stopped=true;if(this.currentDropbox){this.currentDropbox.abort()}clearTimeout(this.dropsTimeout);clearTimeout(this.exploreLinkTimeout);$("#index-explore-button").stop(false,false);$("#page-corner").stop(false,false)}});var mastheadController=MastheadController.init();var discoveryDropsController=DiscoveryDropsController.init();var toolbarController=ToolbarController.init();var writerController=WriterController.init();var wordExplorerController=WordExplorerController.init();var wordRhymerController=WordRhymerController.init();var rouletteController=RouletteController.init();var indexAppController=IndexAppController.init();var helpController=HelpController.init();var rainbowController=RainbowController.init({containerName:"rainbowContainer"});var trayController=TrayController.init();var facebookController=FacebookController.init()}});var OdePageController=Spine.Controller.create({init:function(){var FacebookAlbum=Spine.Model.setup("FacebookAlbum",["id","count","cover_photo","created_time","from","link","name","privacy","type","updated_time"]);var FacebookAccount=Spine.Model.setup("FacebookAccount",["id","name","access_token","category"]);var FacebookPhoto=Spine.Model.setup("FacebookPhoto",["id","created_time","from","height","icon","images","link","picture","position","source","updated_time","width"]);var FacebookVideo=Spine.Model.setup("FacebookVideo",["id","comments","description:","created_time","from","format","embed_html","name","icon","images","link","picture","source","updated_time","width","tags"]);var OdePageAppController=AppController.create({odeId:null,loversLoaded:false,forksLoaded:false,forksColumnCount:2,init:function(){this.commonInit();this.odeId=pageParams.odeId;$("#ode-delete").modal({closeOnEscape:true,backdrop:true,keyboard:true});$("#ode-private-message").modal({closeOnEscape:true,backdrop:true,keyboard:true});$("#ode-attach-media-dialog").modal({closeOnEscape:true,backdrop:true,keyboard:true});$("#show-ode-media-dialog").modal({closeOnEscape:true,backdrop:true,keyboard:true});$("#ode-author-note-dialog").modal({closeOnEscape:true,backdrop:true,keyboard:true});$("ul.stats li").twipsy();$("#love-button").twipsy({placement:"below"});$("#fork-button").twipsy({placement:"below"});$("#love-button").show();$("#loving-button").hide();$("#loving-button-message").hide();$("#love-button").click(this.proxy(this.onLoveClick));$("#loving-button").click(this.proxy(this.onUnloveClick));$("#fork-button").click(this.proxy(this.onForkClick));$("#ode-publish-button").click(this.proxy(this.onPublishClick));$("#invite-friends-button").click(this.proxy(this.onInviteFriends));$("#send-private-comment").click(this.proxy(this.onSendPrivateComment));$("#share-privately").click(this.proxy(this.onSharePrivately));$("#ode-private-message-confirm").click(this.proxy(this.onPrivateMessageConfirm));$("#ode-private-message-cancel").click(function(e){$("#ode-private-message").modal("hide");if(e!=null){e.preventDefault()}});$("#ode-delete-confirm").click(this.proxy(this.onDeleteConfirm));$("#ode-delete-link").click(function(e){$("#ode-delete").modal("show");if(e!=null){e.preventDefault()}});$("#ode-delete-cancel").click(function(e){$("#ode-delete").modal("hide");if(e!=null){e.preventDefault()}});$("#ode-attach-media").click(this.proxy(this.onAttachMedia));$("#ode-attach-media-cancel").click(function(e){$("#ode-attach-media-dialog").modal("hide");if(e){e.preventDefault()}});$("#tab-ode-comments").click(this.proxy(this.onCommentsTabClick));$("#tab-ode-lovers").click(this.proxy(this.onLoversTabClick));$("#tab-ode-forks").click(this.proxy(this.onForksTabClick));$("#view-author").click(function(){Analytics.log(X._ODE,X.VIEW_PROFILE,pageParams.odeAuthor)});$("#view-origin-author").click(function(){Analytics.log(X._ODE,X.VIEW_PROFILE,pageParams.originOdeAuthor)});this.enableAuthEvents();this.isLovingOde();$.getJSON("/api/logOdeView?odeId="+this.odeId,function(response){if(response.success){utils.trace("logged ode view")}else{utils.error("Unable to log ode view")}}).complete(this.showCompleteStatus).error(this.showErrorStatus);$(".close","#privately-shared-info-bar").click(function(e){$("#privately-shared-info-bar").fadeOut();if(e){e.preventDefault()}});FacebookAlbum.bind("refresh",this.proxy(this.fetchFacebookAccounts));FacebookAccount.bind("refresh",this.proxy(this.initAndShowAttachMediaDialog));FacebookPhoto.bind("refresh",this.proxy(this.showFacebookPhotos));FacebookVideo.bind("refresh",this.proxy(this.showFacebookVideos));$("#accountSelect").change(this.proxy(this.refreshMedia));$("#albumSelect").change(this.proxy(this.refreshMedia));$("input[name=mediaTypeRadios]").change(this.proxy(this.refreshMedia));$("#ode-remove-media").click(this.proxy(this.removeMedia));if($("#ode-media").html().length>0){$("#ode-remove-media").show();$("#ode-attach-media").html("Change Media");$(".ode-media-image").click(this.proxy(this.mediaImageClicked))}$("#ode-note-edit").twipsy();$("#ode-note-edit").click(this.proxy(this.onOdeNoteEdit));$("#ode-author-note-dialog-confirm").click(this.proxy(this.onOdeNoteSave));$("#ode-author-note-dialog-cancel").click(function(e){$("#ode-author-note-dialog").modal("hide");if(e!=null){e.preventDefault()}})},onOdeNoteSave:function(e){var odeNote=jQuery.trim($("#ode-note-content-edit").val());if(odeNote.length>0){utils.trace("Saving ode note "+odeNote);var params=new Object();params.odeId=pageParams.odeId;params.note=odeNote;params.isPublic=$("input[name=noteTypeRadios]:checked").val()=="public";if(params.note.length<=500){utils.trace(params);$.post("/api/update-ode-note",jQuery.param(params),this.proxy(this.onOdeNotSaved),"json");$("#ode-author-note-dialog").modal("hide");if(params.isPublic){$("#ode-note-content").html(params.note)}else{$("#ode-note-content").html('<span style="font-style: italic;">Private Note:&nbsp;</span>'+params.note)}}else{this.showMessage("The note must be no more than 500 characters.","Note too long!")}}else{$("#ode-note-content-edit").focus()}if(e){e.preventDefault()}},onOdeNotSaved:function(response){utils.trace("onOdeNotSaved");utils.trace(response)},onOdeNoteEdit:function(e){$("#ode-author-note-dialog").modal("show");setTimeout(function(){$("#ode-note-content-edit").focus()},500);if(e){e.preventDefault()}},onAttachMedia:function(e){if(FacebookAlbum.count()==0){utils.trace("onAttachMedia");this.setAuthAction("attach-media");facebookController.loginUserXtended()}else{this.showAttachMediaDialog()}if(e){e.preventDefault()}},removeMedia:function(e){$("#ode-media").fadeOut(500,function(){$("#ode-attach-media").html("Attach Media");$("#ode-remove-media").hide();$("#ode-media").html("")});var params=new Object();params.odeId=pageParams.odeId;$.post("/api/clear-ode-image",jQuery.param(params),this.proxy(this.onOdeImageCleared),"json");if(e){e.preventDefault()}},showPhotos:null,selectedAccount:null,selectedAlbum:null,refreshMedia:function(){var _showPhotos=$("input[name=mediaTypeRadios]:checked").val()=="photo";var _selectedAccount=$("#accountSelect").val();var _selectedAlbum=$("#albumSelect").val();utils.trace("refreshMedia showPhotos="+_showPhotos+" "+_selectedAccount+"/"+_selectedAlbum);var mediaTypeChanged=this.showPhotos!=_showPhotos;var accountChanged=this.selectedAccount!=_selectedAccount;var albumChanged=this.selectedAlbum!=_selectedAlbum;if(mediaTypeChanged){utils.trace("media changed");if(_showPhotos){$("#albumSelect").show()}else{$("#albumSelect").hide()}}else{if(accountChanged){FB.api("/"+_selectedAccount+"/albums",function(response){utils.trace(response);$("#albumSelect").html("");if(response.data.length>0){for(var i=0;i<response.data.length;i++){$("#albumSelect").append($("<option>",{value:response.data[i].id}).text(response.data[i].name))}}else{}odePageAppController.refreshMedia()});utils.trace("account changed")}else{if(albumChanged){utils.trace("album changed")}}}if(this.selectedAccount==null||!accountChanged){if(_showPhotos){FB.api("/"+_selectedAlbum+"/photos",function(response){utils.trace(response);FacebookPhoto.refresh(response.data)})}else{FB.api("/"+_selectedAccount+"/videos",function(response){utils.trace(response);FacebookVideo.refresh(response.data)})}}this.selectedAccount=_selectedAccount;this.showPhotos=_showPhotos;this.selectedAlbum=_selectedAlbum},attachSelectedMedia:function(e){var id=$(e.target).attr("id");var source=$(e.target).data("mediaSource");var thumbnail=$(e.target).data("mediaThumbnail");var params=new Object();params.odeId=pageParams.odeId;params.id=id;params.source=source;params.thumbnail=thumbnail;$.post("/api/update-ode-image",jQuery.param(params),this.proxy(this.onOdeImageUpdated),"json");this.attachMedia(id,source,thumbnail)},onOdeImageUpdated:function(response){utils.trace("onOdeImageUpdated");utils.trace(response)},onOdeImageCleared:function(response){utils.trace("onOdeImageCleared");utils.trace(response)},mediaImageClicked:function(){var mediaImage=$($(".ode-media-image")[0]).attr("src");utils.trace(mediaImage);$("#show-ode-media-body").html("");$("#show-ode-media-body").html("<img class='show-ode-media-body-image' src='"+mediaImage+"'>");$("#show-ode-media-dialog").modal("show")},attachMedia:function(id,source,thumbnail){utils.trace("attachMedia");utils.trace(id+" // "+source);utils.trace(id+" // "+thumbnail);$("#ode-attach-media-dialog").modal("hide");$("#ode-media").html("");$("#ode-media").show();if(source.indexOf("http")==0){utils.trace("adding image");$("#ode-media").append("<img class='ode-media-image' src='"+source+"'>");$(".ode-media-image").unbind("click");$(".ode-media-image").click(this.proxy(this.mediaImageClicked))}else{$("#ode-media").append(source)}$("#ode-remove-media").show();$("#ode-attach-media").html("Change Media")},showMediaThumbnails:function(model){$("#album-media").html("");$(".facebook-media-thumbnail").unbind("click");if(model.count()>0){model.each(function(o){$("#album-media").append("<img id='"+o.id+"' class='facebook-media-thumbnail' src='"+o.picture+"'>");$("#"+o.id).data("mediaSource",o.embed_html?o.embed_html:o.source);$("#"+o.id).data("mediaThumbnail",o.picture)})}else{$("#album-media").append("<h6>none</h6>")}$(".facebook-media-thumbnail").click(this.proxy(this.attachSelectedMedia))},showFacebookPhotos:function(){this.showMediaThumbnails(FacebookPhoto)},showFacebookVideos:function(){utils.trace("showFacebookVideos");this.showMediaThumbnails(FacebookVideo)},initAndShowAttachMediaDialog:function(){this.hideModalMessage();utils.trace("initAndShowAttachMediaDialog");$("#accountSelect").append($("<option>",{value:"me"}).text(loggedInUsername));FacebookAccount.each(function(o){$("#accountSelect").append($("<option>",{value:o.id}).text(o.name))});FacebookAlbum.each(function(o){$("#albumSelect").append($("<option>",{value:o.id}).text(o.name))});this.refreshMedia();this.showAttachMediaDialog()},showAttachMediaDialog:function(){utils.trace("showAttachMediaDialog");$("#ode-attach-media-dialog").modal("show")},fetchPhotoAlbums:function(){this.showModalMessage("Preparing Photo/Video Selection","Please Wait");utils.trace("fetchPhotoAlbums");FB.api("/me/albums",function(response){if(response.data){FacebookAlbum.refresh(response.data)}else{utils.error("Error while fetching albums");utils.trace(response)}})},fetchFacebookAccounts:function(){utils.trace("fetchFacebookAccounts");FB.api("/me/accounts",function(response){utils.trace(response);if(response.data){FacebookAccount.refresh(response.data)}else{utils.error("Error while fetching accounts");utils.trace(response)}})},fetchAlbumPhotos:function(){utils.trace("fetchAlbumPhotos");FacebookAlbum.each(function(o){FB.api("/"+o.id+"/photos",function(response){utils.trace(response)})})},data_sharePrivately:null,onSharePrivately:function(e){utils.trace("onSharePrivately");if(facebookController.isSignedIn()){this.sharePrivately()}else{this.setAuthAction("share-privately");Analytics.log(X._ODE,X.SIGN_IN_START,"share-privately");facebookController.loginUser()}if(e!=null){e.preventDefault()}},sharePrivately:function(e){utils.trace("sharePrivately");var params=new Object();params.requestType="p";params.targetOde=pageParams.odeId;$.post("/api/request-token",jQuery.param(params),this.proxy(this.sharePrivatelyDo),"json");if(e!=null){e.preventDefault()}},sharePrivatelyDo:function(response){utils.trace("sharePrivatelyDo");utils.traceObject(response);if(response.success){utils.trace(response.result);this.data_sharePrivately=response.result;Analytics.log(X._ODE,X.SHARE_PRIVATELY_STARTED,pageParams.odePermalink);FB.ui({method:"apprequests",title:utils.truncateTo("Share privately:"+pageParams.odeTitle,50),message:"Private Invitation to read "+pageParams.odeTitle,data:response.result},this.proxy(this.sharePrivatelyDone))}else{utils.error("Unable to get request token")}},sharePrivatelyDone:function(data){Analytics.log(X._ODE,X.SHARE_PRIVATELY_COMPLETED,pageParams.odePermalink);utils.trace("sharePrivatelyDone");utils.trace(data);this.saveRequestToken(data,this.data_sharePrivately)},saveRequestToken:function(fbdata,data){var params=new Object();params.requestId=fbdata.request;params.data=data;params.users="";for(var i=0;i<fbdata.to.length;i++){if(i>0){params.users+=","}params.users+=fbdata.to[i]}$.post("/api/save-request-token",jQuery.param(params),this.proxy(this.requestTokenSaved),"json")},requestTokenSaved:function(response){utils.trace("requestTokenSaved");utils.traceObject(response);if(response.success){}else{utils.error("Unable to save requestToken")}},onSendPrivateComment:function(e){utils.trace("onSendPrivateComment");Analytics.log(X._ODE,X.SEND_PRIVATE_COMMENT,pageParams.odePermalink);if(facebookController.isSignedIn()){this.sendPrivateComment()}else{this.setAuthAction("send-private-comment");Analytics.log(X._ODE,X.SIGN_IN_START,"send-private-comment");facebookController.loginUser()}if(e!=null){e.preventDefault()}},onPrivateMessageConfirm:function(e){utils.trace("onPrivateMessageConfirm");var messageText=jQuery.trim($("#private-message-text").val());if(messageText.length>0){var params=new Object();params.odeId=pageParams.odeId;params.message=messageText;$.post("/api/send-private-message",jQuery.param(params),this.proxy(this.onPrivateMessageSent),"json");$("#ode-private-message").modal("hide")}if(e!=null){e.preventDefault()}},onPrivateMessageSent:function(response){utils.trace("onPrivateMessageSent");utils.trace(response)},sendPrivateComment:function(){utils.trace("sendPrivateComment");$("#ode-private-message").modal("show")},data_shareInviteToRead:null,onInviteFriends:function(e){var params=new Object();params.requestType="r";params.targetOde=pageParams.odeId;$.post("/api/request-token",jQuery.param(params),this.proxy(this.onInviteFriendsDo),"json");if(e!=null){e.preventDefault()}},onInviteFriendsDo:function(response){utils.trace("onInviteFriendsDo");utils.traceObject(response);if(response.success){utils.trace(response.result);this.data_shareInviteToRead=response.result;Analytics.log(X._ODE,X.INVITE_FRIENDS_STARTED,pageParams.odePermalink);FB.ui({method:"apprequests",title:utils.truncateTo("Invite friends to read "+pageParams.odeTitle,50),message:"Read "+pageParams.odeTitle+" by "+pageParams.odeAuthor,data:response.result},this.proxy(this.onInviteFriendsDone))}else{utils.error("Unable to get request token")}},onInviteFriendsDone:function(data){Analytics.log(X._ODE,X.INVITE_FRIENDS_COMPLETED,pageParams.odePermalink);utils.trace("onInviteFriendsDone");utils.trace(data);this.saveRequestToken(data,this.data_shareInviteToRead)},onCommentsTabClick:function(){utils.trace("onLoversTabClick");Analytics.log(X._ODE,X.VIEW_COMMENTS,pageParams.odePermalink)},onLoversTabClick:function(){utils.trace("onLoversTabClick");Analytics.log(X._ODE,X.VIEW_LOVERS,pageParams.odePermalink);if(!this.loversLoaded){this.loadLovers()}},loadLovers:function(){this.loversLoaded=true;$.getJSON("/api/odeLovers?odeId="+this.odeId,this.proxy(this.onLoversReceived)).complete(this.showCompleteStatus).error(this.showErrorStatus)},onLoversReceived:function(response){utils.trace("onLoversReceived");utils.traceObject(response);if(response.success){$("#lovers-list").html("");if(response.result&&response.result.length>0){$("#no-lovers-message").hide();utils.trace(response.result.length+" lovers received");User.refresh(response.result);for(var i=0;i<User.all().length;i++){var user=User.all()[i];var userBox=UserBoxController.init({user:user,container:"#lovers-list"})}$("ul.stats li").twipsy()}else{utils.trace("no lovers");$("#no-lovers-message").show()}}else{utils.error("Unable to receive ode lovers")}},onUnloveClick:function(e){utils.trace("onUnloveClick");Analytics.log(X._ODE,X.UNLOVE,pageParams.odePermalink);$.getJSON("/api/unloveOde?odeId="+this.odeId,this.proxy(this.processUnlovedOde)).complete(this.showCompleteStatus).error(this.showErrorStatus);if(e){e.preventDefault()}},processUnlovedOde:function(response){utils.trace("processUnlovedOde");utils.traceObject(response);if(response.success){utils.trace("unloved executed");$("#love-button").show();$("#loving-button").hide();$("#loving-button-message").hide();$("#love-button-message").show();this.loadLovers();this.refreshOdeStats()}else{utils.error("Unable to unlove ode")}},onLoveClick:function(e){utils.trace("onLoveClick");Analytics.log(X._ODE,X.LOVE,pageParams.odePermalink);if(facebookController.isSignedIn()){this.loveOde()}else{this.setAuthAction("love");Analytics.log(X._ODE,X.SIGN_IN_START,"love");facebookController.loginUser()}if(e){e.preventDefault()}},loveOde:function(){if(pageParams.odeState==0){this.showMessage("To love it, you need to first publish it","Cannot Love it")}else{this.submitFacebookAction("app-ode-la:favorite?ode=http://ode.la/view/"+pageParams.odePermalink);$.getJSON("/api/loveOde?odeId="+this.odeId,this.proxy(this.processLovedOde)).complete(this.showCompleteStatus).error(this.showErrorStatus)}},processLovedOde:function(response){utils.trace("processLovedOde");utils.traceObject(response);if(response.success){utils.trace("loved executed");$("#love-button").hide();$("#loving-button").show();$("#loving-button-message").show();$("#love-button-message").hide();this.loadLovers();this.refreshOdeStats()}else{utils.error("Unable to love ode")}},isLovingOde:function(){$.getJSON("/api/isLovingOde?odeId="+this.odeId,this.proxy(this.processIsLovingOde)).complete(this.showCompleteStatus).error(this.showErrorStatus)},processIsLovingOde:function(response){utils.trace("processIsLovingOde");utils.traceObject(response);if(response.success){var isLoving=response.result=="true";utils.trace("isLoving "+response.result+" // "+isLoving);if(isLoving){$("#love-button").hide();$("#loving-button").show();$("#loving-button-message").show();$("#love-button-message").hide()}else{$("#love-button").show();$("#loving-button").hide();$("#loving-button-message").hide();$("#love-button-message").show()}}else{utils.error("Unable to love ode")}},onForksTabClick:function(){utils.trace("onForksTabClick");Analytics.log(X._ODE,X.VIEW_FORKS,pageParams.odePermalink);if(!this.forksLoaded){this.forksLoaded=true;$.getJSON("/api/forks?odeId="+this.odeId,this.proxy(this.onForksReceived)).complete(this.showCompleteStatus).error(this.showErrorStatus)}},onForksReceived:function(response){utils.trace("onForksReceived");utils.traceObject(response);if(response.success){if(response.result&&response.result.length>0){utils.trace(response.result.length+" forks received");Ode.refresh(response.result);for(var i=0;i<Ode.all().length;i++){var ode=Ode.all()[i];var columnNumber=((i%this.forksColumnCount)+1);var odeBox=OdeBoxController.init({ode:ode,container:"#fork-grid-column-"+columnNumber,odeCounter:i,analyticsCategory:X._ODE})}$("ul.stats li").twipsy();$(".ode-box-action").hide()}else{utils.trace("no forks");$("#no-forks-message").show()}}else{utils.error("Unable to receive ode forks")}},onForkClick:function(e){utils.trace("onForkClick");Analytics.log(X._ODE,X.FORK,pageParams.odePermalink);if(facebookController.isSignedIn()){this.forkOde()}else{this.setAuthAction("fork");Analytics.log(X._ODE,X.SIGN_IN_START,"fork");facebookController.loginUser()}if(e){e.preventDefault()}},forkOde:function(){if($("#fork-button").hasClass("disabled")){utils.trace("fork disabled")}else{if(pageParams.odeState==0){this.showMessage("To fork it, you need to first publish it","Cannot Fork it")}else{$("#fork-button").addClass("disabled");window.location="/fork/"+pageParams.odePermalink}}},onDeleteConfirm:function(){Analytics.log(X._ODE,X.DELETE_ODE,pageParams.odePermalink);$.getJSON("/api/deleteOde?odeId="+this.odeId,function(response){if(response.success){utils.trace("Deleted ode");window.location="/"+pageParams.odeAuthor}else{utils.error("Unable to delete")}}).complete(this.showCompleteStatus).error(this.showErrorStatus)},onPublishClick:function(){if($("#ode-publish-button").hasClass("disabled")){utils.trace("publish disabled")}else{Analytics.log(X._ODE,X.PUBLISH_ODE,pageParams.odePermalink);$("#ode-publish-button").addClass("disabled");$.getJSON("/api/publishOde?odeId="+this.odeId,this.proxy(this.onPublishComplete)).complete(this.showCompleteStatus).error(this.showErrorStatus)}},onPublishComplete:function(response){if(response.success){utils.trace("Published ode");window.location="/view/"+pageParams.odePermalink}else{utils.error("Unable to publish")}this.submitFacebookAction("app-ode-la:publish?ode=http://ode.la/view/"+pageParams.odePermalink)},refreshOdeStats:function(){$.getJSON("/api/odeStats?odeId="+this.odeId,this.proxy(this.processOdeStats)).complete(this.showCompleteStatus).error(this.showErrorStatus)},processOdeStats:function(response){utils.trace("processOdeStats");utils.traceObject(response);if(response.success){var viewCount=response.result.viewCount;var commentCount=response.result.commentCount;var favoritedCount=response.result.favoritedCount;var forkCount=response.result.forkCount;$("#view-count").html(viewCount);$("#comment-count").html(commentCount);$("#fav-count").html(favoritedCount);$("#fork-count").html(forkCount)}else{utils.error("Unable to get ode stats")}},handleAuthEvent:function(action){utils.trace("auth complete "+action);if(action=="love"){Analytics.log(X._ODE,X.SIGN_IN_COMPLETE,"love");this.loveOde()}else{if(action=="fork"){Analytics.log(X._ODE,X.SIGN_IN_COMPLETE,"fork");this.forkOde()}else{if(action=="send-private-comment"){Analytics.log(X._ODE,X.SIGN_IN_COMPLETE,"send-private-comment");this.sendPrivateComment()}else{if(action=="share-privately"){Analytics.log(X._ODE,X.SIGN_IN_COMPLETE,"share-privately");this.sharePrivately()}else{if(action=="attach-media"){this.fetchPhotoAlbums()}else{utils.trace("unknown auth action =  "+action)}}}}}}});var odePageAppController=OdePageAppController.init();var facebookController=FacebookController.init()}});var BlankPageController=Spine.Controller.create({init:function(){var BlankPageAppController=AppController.create({init:function(){this.commonInit();FacebookController.init()}});BlankPageAppController.init()}});var AboutPageController=Spine.Controller.create({init:function(){var AboutPageAppController=AppController.create({init:function(){this.commonInit();$("#menu-button-about").addClass("active");FacebookController.init()}});AboutPageAppController.init()}});var ProfileController=Spine.Controller.create({init:function(){var ProfileAppController=AppController.create({proxied:["toggleEmotionalPalette","onFollowingReceived","onFollowClicked","onFollowersRefreshed","onFollowingRefreshed","onUnFollowClicked","onFollowersReceived","processIsFollowingUser","processFollowingUser","processUnFollowingUser","showCompleteStatus","showErrorStatus"],userId:null,rainbow:null,isFirstVisit:null,bareDocumentHeight:null,init:function(){utils.trace("ProfileAppController.init");this.commonInit();this.bareDocumentHeight=$(document).height();$("#message-loading").show();$("#lower-frame-right").hide();$("#profile-tabs").hide();this.userId=pageParams.userId;if(pageParams.userRainbow!=null&&pageParams.userRainbow.length>0){this.rainbow=pageParams.userRainbow.split(",")}$(".tabs").tabs();$("#expand-rainbow-icon").hide();$("#expand-rainbow-icon").twipsy();$("#expand-rainbow-icon").click(this.toggleEmotionalPalette);$("#word-rain-icon").hide();$("#word-rain-icon").twipsy({placement:"below"});$("#word-rain-icon").click(this.proxy(this.showWordRain));$("#follow-button").click(this.onFollowClicked);$("#following-button").click(this.onUnFollowClicked);$("#follow-button").show();$("#following-button").hide();$("#dialog-profile").modal({closeOnEscape:true,backdrop:true,keyboard:true});$(".bot-avatar").bind("dblclick",function(){$("#dialog-profile").modal("show")});$("#edit-profile-link").click(this.proxy(this.editProfileClick));$("#dialog-profile-confirm").click(this.proxy(this.saveProfileClick));$("#dialog-bot-profile-confirm").click(this.proxy(this.saveBotProfileClick));$("#dialog-profile-cancel").click(function(){$("#dialog-profile").modal("hide")});this.enableAuthEvents();$("#tab-following").click(function(){Analytics.log(X._PROFILE,X.VIEW_FOLLOWING)});$("#tab-followers").click(function(){Analytics.log(X._PROFILE,X.VIEW_FOLLOWERS)});Follower.bind("refresh",this.onFollowersRefreshed);Following.bind("refresh",this.onFollowingRefreshed);$.getJSON("/api/logProfileView?username="+pageParams.username+"&force="+Math.random(),this.proxy(this.profileViewLogged)).complete(this.showCompleteStatus).error(this.showErrorStatus)},profileViewLogged:function(response){if(response.success){utils.trace("logged profile view: "+response.result);this.render(response.result)}else{utils.error("Unable to log profile view");this.render(true)}},render:function(isFirstVisit){utils.trace("isFirst : '"+isFirstVisit+"'");this.isFirstVisit=isFirstVisit=="true";odeGridController=OdeGridController.init()},showWordRain:function(){utils.trace("showWordRain");WordRainController.init().render()},saveProfileClick:function(){var name=jQuery.trim($("#dialog-profile-name").val());if(name.length==0){$("#dialog-profile-name-wrapper").addClass("error");$("#dialog-profile-name").focus();return false}var params=new Object();params.name=name;params.bio=jQuery.trim($("#dialog-profile-about").val());$.post("/api/profile",jQuery.param(params),this.proxy(this.onSavedProfile),"json");Analytics.log(X._PROFILE,X.SAVE_PROFILE)},onSavedProfile:function(response){utils.trace("saved profile");utils.trace(response);if(response.success){var prefsParams=new Object();prefsParams.followed="checked"==$("#pref-followed").attr("checked");prefsParams.odeLoved="checked"==$("#pref-odeLoved").attr("checked");prefsParams.odeForked="checked"==$("#pref-odeForked").attr("checked");prefsParams.receivedMessage="checked"==$("#pref-receivedMessage").attr("checked");prefsParams.newsletter="checked"==$("#pref-newsletter").attr("checked");utils.trace("saving pref");utils.trace(prefsParams);$.post("/api/email-prefs",jQuery.param(prefsParams),function(response){utils.trace("saved pref");utils.trace(response);if(response.success){$("#dialog-profile").modal("hide")}else{utils.error("Unable to save prefs")}},"json")}else{utils.error("Unable to save profile")}},saveBotProfileClick:function(){var name=jQuery.trim($("#dialog-profile-name").val());if(name.length==0){$("#dialog-profile-name-wrapper").addClass("error");$("#dialog-profile-name").focus();return false}var params=new Object();params.name=name;params.userId=this.userId;params.bio=jQuery.trim($("#dialog-profile-about").val());params.imageUrl=jQuery.trim($("#dialog-profile-image").val());$.post("/api/botProfile",jQuery.param(params),function(response){utils.trace(response);if(response.success){$("#dialog-profile").modal("hide");window.location="/"+pageParams.username}else{utils.error("Unable to save bot profile")}},"json")},editProfileClick:function(){Analytics.log(X._PROFILE,X.EDIT_PROFILE);$.getJSON("/api/me",function(response){if(response.success){var user=response.result.user;var notificationPrefs=response.result.notificationPrefs;$("#dialog-profile-name").val(user.name);$("#dialog-profile-about").val(user.bio);$("#pref-followed").prop("checked",notificationPrefs.followed==true);$("#pref-odeLoved").prop("checked",notificationPrefs.odeLoved==true);$("#pref-odeForked").prop("checked",notificationPrefs.odeForked==true);$("#pref-receivedMessage").prop("checked",notificationPrefs.receivedMessage==true);$("#pref-newsletter").prop("checked",notificationPrefs.newsletter==true);$("#dialog-profile").modal("show")}else{utils.error("Unable to get logon user details")}}).complete(this.showCompleteStatus).error(this.showErrorStatus)},onFollowersRefreshed:function(){$("#follower-count").html(Follower.count());if(Follower.count()==0){$("#follower-count").attr("title","no followers, show some love, be the first")}else{if(Follower.count()==1){$("#follower-count").attr("title",Follower.count()+" follower")}else{$("#follower-count").attr("title",Follower.count()+" followers")}}$("#followers").html("");for(var i=0;i<Follower.all().length;i++){var user=Follower.all()[i];var userBox=UserBoxController.init({user:user,container:"#followers"})}},onFollowingRefreshed:function(){$("#following").html("");for(var i=0;i<Following.all().length;i++){var user=Following.all()[i];utils.trace("user.displayAvatar = "+user.displayAvatar);var userBox=UserBoxController.init({user:user,container:"#following"})}},handleAuthEvent:function(action){utils.trace("auth complete "+action);if(action=="follow"){Analytics.log(X._PROFILE,X.SIGN_IN_COMPLETE,"follow");this.follow()}else{if(action=="unfollow"){Analytics.log(X._PROFILE,X.SIGN_IN_COMPLETE,"unfollow");this.unfollow()}else{utils.trace("unknown auth action =  "+action)}}},onFollowClicked:function(){utils.trace("onFollowClicked");Analytics.log(X._PROFILE,X.FOLLOW,pageParams.username);if(facebookController.isSignedIn()){this.follow()}else{this.setAuthAction("follow");Analytics.log(X._PROFILE,X.SIGN_IN_START,"profile");facebookController.loginUser()}},follow:function(){this.submitFacebookAction("app-ode-la:follow?author=http://ode.la/"+pageParams.username);$.getJSON("/api/followUser?userId="+this.userId,this.processFollowingUser).complete(this.showCompleteStatus).error(this.showErrorStatus)},processFollowingUser:function(response){utils.trace("processFollowingUser");utils.traceObject(response);if(response.success){utils.trace("follow executed");$("#follow-button").hide();$("#following-button").show();this.fetchFollowers()}else{utils.error("Unable to follow")}},fetchFollowers:function(){$.getJSON("/api/followers?userId="+this.userId,this.onFollowersReceived).complete(this.showCompleteStatus).error(this.showErrorStatus)},onFollowersReceived:function(response){utils.trace("onFollowersReceived");utils.traceObject(response);if(response.success){if(response.result.length>0){Follower.refresh(response.result)}else{$("#followers").html("<h6>No Followers yet</h6>")}}else{utils.error("Unable to receive followers")}},fetchFollowing:function(){$.getJSON("/api/following?userId="+this.userId,this.onFollowingReceived).complete(this.showCompleteStatus).error(this.showErrorStatus)},onFollowingReceived:function(response){utils.trace("onFollowingReceived");utils.traceObject(response);if(response.success){if(response.result.length>0){Following.refresh(response.result)}else{$("#following").html("<h6>Not following anyone yet</h6>")}}else{utils.error("Unable to receive following")}},onUnFollowClicked:function(){utils.trace("onUnFollowClicked");if(facebookController.isSignedIn()){this.unfollow()}else{this.setAuthAction("unfollow");Analytics.log(X._ODE,X.SIGN_IN_START,"unfollow");facebookController.loginUser()}},unfollow:function(){$.getJSON("/api/unfollowUser?userId="+this.userId,this.processUnFollowingUser).complete(this.showCompleteStatus).error(this.showErrorStatus)},processUnFollowingUser:function(response){utils.trace("processUnFollowingUser");utils.traceObject(response);if(response.success){utils.trace("unfollow executed");$("#follow-button").show();$("#following-button").hide();this.fetchFollowers()}else{utils.error("Unable to unfollow")}},processIsFollowingUser:function(response){utils.trace("processIsFollowingUser");utils.traceObject(response);if(response.success){var isFollowing=response.result=="true";utils.trace("is-following "+response.result+" // "+isFollowing);if(isFollowing){$("#follow-button").hide();$("#following-button").show()}else{$("#follow-button").show();$("#following-button").hide()}}else{utils.error("Unable to determine if user is being followed")}},toggleEmotionalPalette:function(){$("#lower-frame").stop(true,true);var top=$("#lower-frame").css("top");if(top=="0px"){$("#lower-frame").animate({top:-90},1000,"easeOutCubic")}else{$("#lower-frame").animate({top:0},1000,"easeOutCubic")}},showLowerFrame:function(animate){utils.trace("showLowerFrame: "+$("#lower-frame").position().top);$("#message-loading").hide();$("#message-accelerator").hide();$(".floating-text").each(function(){$(this).remove()});$("html").css("overflow-y","auto");$("#lower-frame-right").show();$("#profile-tabs").show();if(animate){$("#lower-frame").animate({top:-90},2000,"easeOutExpo",this.proxy(this.peekRainbow));$("#lower-frame").fadeIn(3000)}else{$("#lower-frame").css("top",-90);this.peekRainbow()}$.getJSON("/api/isFollowingUser?userId="+this.userId,this.processIsFollowingUser).complete(this.showCompleteStatus).error(this.showErrorStatus);this.fetchFollowers();this.fetchFollowing();$("#message-loading").hide()},peekRainbow:function(){this.revealWordRainButton();if(Ode.count()>0){if(rainbowController==null){if(profileAppController.rainbow!=null&&profileAppController.rainbow.length>0){rainbowController=RainbowController.init({containerName:"profileRainbowContainer"});utils.trace("profileAppController.rainbow = "+profileAppController.rainbow);rainbowController.draw(profileAppController.rainbow,3000);$("#lower-frame").delay(3000).animate({top:0},1000,"easeOutCubic",function(){setTimeout(function(){utils.trace("lf = "+$("#lower-frame").position().top);if($("#lower-frame").position().top>=0){$("#expand-rainbow-icon").fadeIn(1000);$("#lower-frame").animate({top:-90},1000,"easeOutCubic",function(){})}},3000)})}}else{$("#expand-rainbow-icon").show()}}},revealWordRainButton:function(){$("#word-rain-icon").fadeIn(2000)}});var OdeGridController=BaseController.create({proxied:["onOdeRefresh","renderOdeBox","onOdesReceived","showCompleteStatus","showErrorStatus"],columnCount:null,favoritesLoaded:false,init:function(){this.columnCount=pageParams.columnCount;Ode.bind("refresh",this.onOdeRefresh);Favorite.bind("refresh",this.proxy(this.onFavoriteRefresh));utils.trace("getting odes");$.getJSON("/api/odes?userId="+profileAppController.userId,this.onOdesReceived).complete(this.showCompleteStatus).error(this.showErrorStatus);$("#tab-favorite").click(this.proxy(this.onFavoriteTabClick))},onFavoriteTabClick:function(){Analytics.log(X._PROFILE,X.VIEW_FAVORITES,pageParams.username);utils.trace("onFavoriteTabClick");if(!this.favoritesLoaded){this.favoritesLoaded=true;$.getJSON("/api/favorites?userId="+profileAppController.userId,this.proxy(this.onFavoritesReceived)).complete(this.showCompleteStatus).error(this.showErrorStatus)}},onFavoritesReceived:function(response){utils.trace("onFavoritesReceived");utils.traceObject(response);if(response.success){utils.trace("Got "+response.result.length+" favs.");if(response.result.length>0){Favorite.refresh(response.result)}else{$("#favorites").html("<h6>No Favorites yet</h6>")}}else{utils.error("Unable to receive favs")}},onFavoriteRefresh:function(){for(var i=0;i<Favorite.all().length;i++){var ode=Favorite.all()[i];var columnNumber=((i%this.columnCount)+1);var odeBox=OdeBoxController.init({ode:ode,container:"#fav-grid-column-"+columnNumber,odeCounter:i,analyticsCategory:X._FAVORITES})}$("ul.stats li").twipsy();$(".ode-box-action").hide()},onOdesReceived:function(response){utils.trace("onOdesReceived");utils.traceObject(response);if(response.success){utils.trace("Got "+response.result.length+" odes.");if(response.result.length>0){Ode.refresh(response.result)}else{$("#no-odes-message").show();profileAppController.showLowerFrame(false)}}else{utils.error("Unable to receive odes")}},onOdeRefresh:function(){for(var i=0;i<Ode.all().length;i++){var ode=Ode.all()[i];var columnNumber=((i%this.columnCount)+1);var odeBox=OdeBoxController.init({ode:ode,container:"#ode-grid-column-"+columnNumber,odeCounter:i,analyticsCategory:X._PROFILE})}if(profileAppController.isFirstVisit){WordRainController.init().render()}else{profileAppController.showLowerFrame(false)}$("ul.stats li").twipsy();$(".ode-box-action").hide()}});var WordRainController=BaseController.create({words:new Array(),labelClasses:["label","success","warning","important","notice"],animationCompleteCounter:0,proxied:["onOdeRefresh"],titlesToUseCount:10,topWordsToUseCount:30,topWords:new Array(),topWordsScore:new Array(),escaped:false,init:function(){window.scrollTo(0,0);$(document).keyup(this.proxy(this.pageKeyUp));this.words=[];this.topWords=[];this.topWordsScore=[];var topWordsArray=pageParams.topWords.split(",");for(var i=0;i<topWordsArray.length;i++){var topWordTuple=topWordsArray[i];var topWordParts=topWordTuple.split(":");this.topWords.push(jQuery.trim(topWordParts[1]));this.topWordsScore.push(jQuery.trim(topWordParts[0]))}for(var j=0;j<this.topWords.length&&j<this.topWordsToUseCount;j++){this.words.push(this.topWords[j])}this.words=this.words.reverse()},pageKeyUp:function(e){if(!this.escaped&&Ode.count()>0&&(e.keyCode==27||e.keyCode==32||e.keyCode==40)){utils.trace("Escaping "+$(".floating-text").length);$(".floating-text").stop(true,true);profileAppController.showLowerFrame(true);this.escaped=$(".floating-text").length==0;Analytics.log(X._PROFILE,X.SKIP_RAIN)}},render:function(){var odeTitles=new Array();for(var i=0;i<Ode.all().length;i++){odeTitles.push(Ode.all()[i].title)}odeTitles=utils.shuffle(odeTitles);for(var j=0;j<odeTitles.length&&j<this.titlesToUseCount;j++){this.words.push(odeTitles[j])}this.run()},run:function(){utils.trace("WordRainController.run");$("#lower-frame").stop(true,true);$("#lower-frame").css("top",(0-$("#lower-frame").height()-200));$("#word-rain-icon").hide();$("#expand-rainbow-icon").hide();$("#expand-rainbow-icon").hide();$("#message-loading").hide();$("#message-accelerator").show();$("#message-accelerator").fadeOut(4000);var atomX=0;var X_GAP=10;var Y_BOTTOM_MARGIN=45;var rowNumber=1;var shuffledArray=utils.shuffle(this.words);$("html").css("overflow-y","hidden");$("html").css("overflow-y","hidden");for(var i=0;i<shuffledArray.length;i++){var w=shuffledArray[i];var wordAtom=$(document.createElement("span")).html(w);wordAtom.addClass("floating-text");wordAtom.addClass(this.labelClasses[utils.randomNumber(0,4)]);wordAtom.css("top",0);$("#word-rain").append(wordAtom);if((atomX+wordAtom.width())>=$("#profile-header").width()){atomX=0;rowNumber++}wordAtom.css("left",atomX);atomX+=wordAtom.width()+X_GAP;var delayTime=utils.randomNumber(100,750)*(rowNumber-1);wordAtom.delay(delayTime).animate({top:profileAppController.bareDocumentHeight-Y_BOTTOM_MARGIN},utils.randomNumber(2000,4000),"easeInCubic",this.proxy(this.onComplete))}},onComplete:function(){this.animationCompleteCounter++;if(this.animationCompleteCounter==this.words.length){utils.trace("Word rain finished");profileAppController.showLowerFrame(true)}}});var profileAppController=ProfileAppController.init();var facebookController=FacebookController.init();var odeGridController=null;var wordRainController=null;var rainbowController=null}});var SearchController=Spine.Controller.create({init:function(){var SearchAppController=AppController.create({proxied:["showCompleteStatus","showErrorStatus"],PAGE_SIZE:30,searchColumnCount:3,init:function(){this.commonInit();$("#topbar-search-input").val(pageParams.searchTerm);$("#topbar-search-input").putCursorAtEnd();this.performSeach()},performSeach:function(){var searchInput=this.getSearchTerm();if(searchInput.length>0){utils.trace("Search for "+searchInput);Analytics.log(X._SEARCH,X.PERFORM_SEARCH,searchInput);$("#search-results-users").html("");for(var i=1;i<=this.searchColumnCount;i++){$("#search-grid-column-"+i).html("")}$.getJSON("/api/search?term="+searchInput+"&limit="+this.PAGE_SIZE,this.proxy(this.handleSearchResults)).complete(this.showCompleteStatus).error(this.showErrorStatus)}},getSearchTerm:function(){return jQuery.trim($("#topbar-search-input").val())},handleNavigationRequest:function(target){utils.trace("SearchController.handleNavigationRequest : "+target);if(target=="search"){$("#matching-odes-info").html("");$("#matching-users-info").html("");$("#search-info").html("searching for "+this.getSearchTerm());this.performSeach()}else{NavigationEvent.trigger("navigation-confirmed",target)}},handleSearchResults:function(response){utils.trace("handleSearchResults");utils.trace(response);if(response.success){var matchingUsers=response.result.users;var matchingOdes=response.result.odes;var message="";var odesMessage=null;var usersMessage=null;if(matchingUsers.length==0&&matchingOdes.length==0){message="No matches";odesMessage="no matching odes";usersMessage="no matching users"}else{if(matchingOdes.length==0){odesMessage="no matching odes"}else{if(matchingOdes.length==1){odesMessage="1 matching ode"}else{odesMessage=matchingOdes.length+" matching odes"}}message+=odesMessage;message+=", ";if(matchingUsers.length==0){usersMessage="no matching users"}else{if(matchingUsers.length==1){usersMessage="1 matching user"}else{usersMessage=matchingUsers.length+" matching users"}}message+=usersMessage}$("#search-info").html(this.getSearchTerm());utils.trace(message);$("#matching-odes-info").html(odesMessage);$("#matching-users-info").html(usersMessage);if(matchingOdes.length>0){Ode.refresh(matchingOdes);for(var i=0;i<Ode.all().length;i++){var ode=Ode.all()[i];var columnNumber=((i%this.searchColumnCount)+1);var odeBox=OdeBoxController.init({ode:ode,container:"#search-grid-column-"+columnNumber,odeCounter:i,analyticsCategory:X._SEARCH})}$("ul.stats li").twipsy();$(".ode-box-action").hide()}else{$("#search-grid-column-1").html("&nbsp")}if(matchingUsers.length>0){User.refresh(matchingUsers);for(var i=0;i<User.all().length;i++){var user=User.all()[i];var userBox=UserBoxController.init({user:user,container:"#search-results-users"})}$("ul.stats li").twipsy()}}else{utils.error("Could not perform search")}}});var searchAppController=SearchAppController.init();var facebookController=FacebookController.init()}});var AdminInterfaceController=Spine.Controller.create({init:function(){var AdminInterfaceAppController=AppController.create({proxied:["markAsFeatured"],featuredButton:$("#mark-as-featured"),init:function(){this.commonInit();this.featuredButton.click(this.markAsFeatured)},markAsFeatured:function(){var params=new Object();params.odesPermaLinks=jQuery.trim($("#featured-odes-permalinks").val());params.authorsUserNames=jQuery.trim($("#featured-usernames").val());$.post("/api/markAsFeatured",jQuery.param(params),function(response){utils.trace(response);if(!response.success){utils.error("Unable to mark as featured")}},"json")}});var adminInterfaceAppController=AdminInterfaceAppController.init()}});var ExploreInterfaceContoller=Spine.Controller.create({init:function(){var ExploreController=AppController.create({proxied:["onFeaturedOdeRefresh","onRecentOdeRefresh","onPopularOdeRefresh","onFeaturedUserRefresh","onPopularUserRefresh","onRecentUserRefresh"],PAGE_SIZE:30,columnCount:null,featuredItemsLoaded:false,popularItemsLoaded:false,recentItemsLoaded:false,init:function(){this.commonInit();$("#menu-button-explore").addClass("active");$("#explore-selector").animate({left:900},3000,"easeInOutElastic");this.showTab();this.columnCount=pageParams.columnCount;FeaturedOde.bind("refresh",this.onFeaturedOdeRefresh);RecentOde.bind("refresh",this.onRecentOdeRefresh);PopularOde.bind("refresh",this.onPopularOdeRefresh);FeaturedUser.bind("refresh",this.onFeaturedUserRefresh);PopularUser.bind("refresh",this.onPopularUserRefresh);RecentUser.bind("refresh",this.onRecentUserRefresh);$("#tab-featured").click(this.proxy(this.onFeaturedTabClicked));$("#tab-popular").click(this.proxy(this.onPopularTabClick));$("#tab-recent").click(this.proxy(this.onRecentTabClick));this.showFromHash();$(window).bind("hashchange",this.proxy(this.showFromHash))},showFromHash:function(e){var token=window.location.hash;utils.trace("token = "+token);if(token==null||token.length==0){this.onFeaturedTabClicked()}else{var t=token.substr(1);utils.trace(t);if(t=="recent"){this.onRecentTabClick()}else{if(t=="popular"){this.onPopularTabClick()}else{this.onFeaturedTabClicked()}}}if(e){e.preventDefault()}},showTab:function(tabId){$("#tab-featured").removeClass("explore-item-lit");$("#tab-popular").removeClass("explore-item-lit");$("#tab-recent").removeClass("explore-item-lit");$("#featured-container").hide();$("#popular-container").hide();$("#recent-container").hide();if(tabId){window.location.hash=tabId;$("#tab-"+tabId).addClass("explore-item-lit");var callback=function(){utils.trace("tabId = "+tabId);$("#"+tabId+"-container").show()};$("#explore-selector").stop(false,false);if(tabId=="featured"){$("#explore-selector").animate({left:328},750,"easeOutCubic",callback)}else{if(tabId=="recent"){$("#explore-selector").animate({left:492},750,"easeOutCubic",callback)}else{if(tabId=="popular"){$("#explore-selector").animate({left:642},750,"easeOutCubic",callback)}}}}},onFeaturedTabClicked:function(){Analytics.log(X._EXPLORE,X.VIEW_FEATURED);if(!this.featuredItemsLoaded){this.featuredItemsLoaded=true;$.getJSON("/api/featured?limit="+this.PAGE_SIZE,this.proxy(this.onFeaturedItemsReceived)).complete(this.showCompleteStatus).error(this.showErrorStatus)}else{this.showTab("featured")}},onPopularTabClick:function(){Analytics.log(X._EXPLORE,X.VIEW_POPULAR);if(!this.popularItemsLoaded){this.popularItemsLoaded=true;$.getJSON("/api/popular?limit="+this.PAGE_SIZE,this.proxy(this.onPopularItemsReceived)).complete(this.showCompleteStatus).error(this.showErrorStatus)}else{this.showTab("popular")}},onRecentTabClick:function(){Analytics.log(X._EXPLORE,X.VIEW_RECENTS);if(!this.recentItemsLoaded){this.recentItemsLoaded=true;$.getJSON("/api/recent?limit="+this.PAGE_SIZE,this.proxy(this.onRecentItemsReceived)).complete(this.showCompleteStatus).error(this.showErrorStatus)}else{this.showTab("recent")}},onFeaturedItemsReceived:function(response){utils.trace("onFeaturedItemsReceived");utils.traceObject(response);if(response.success){var featuredUsers=response.result.users;var featuredOdes=response.result.odes;utils.trace("Got "+featuredUsers.length+" featured users.");utils.trace("Got "+featuredOdes.length+" featured odes.");if(featuredOdes.length>0){FeaturedOde.refresh(featuredOdes)}else{$("#explore-featured-odes-frame").html("<h6>No featured odes found now</h6>")}if(featuredUsers.length>0){FeaturedUser.refresh(featuredUsers)}else{$("#featured-users").html("<h6>No featured users found now</h6>")}this.showTab("featured")}else{utils.error("Unable to receive featured items")}},onPopularItemsReceived:function(response){utils.trace("onPopulatItemsReceived");utils.traceObject(response);if(response.success){var popularUsers=response.result.users;var popularOdes=response.result.odes;utils.trace("Got "+popularUsers.length+" popular users.");utils.trace("Got "+popularOdes.length+" popular odes.");if(popularOdes.length>0){PopularOde.refresh(popularOdes)}else{$("#explore-popular-odes-frame").html("<h6>No popular odes found now</h6>")}if(popularUsers.length>0){PopularUser.refresh(popularUsers)}else{$("#popular-users").html("<h6>No popular users found now</h6>")}this.showTab("popular")}else{utils.error("Unable to receive popular items")}},onRecentItemsReceived:function(response){utils.trace("onRecentItemsReceived");utils.traceObject(response);if(response.success){var recentUsers=response.result.users;var recentOdes=response.result.odes;utils.trace("Got "+recentUsers.length+" recent users.");utils.trace("Got "+recentOdes.length+" recent odes.");if(recentOdes.length>0){RecentOde.refresh(recentOdes)}else{$("#explore-recent-odes-frame").html("<h6>No recent odes found now</h6>")}if(recentUsers.length>0){RecentUser.refresh(recentUsers)}else{$("#recent-users").html("<h6>No recent users found now</h6>")}this.showTab("recent")}else{utils.error("Unable to receive recent items")}},onFeaturedOdeRefresh:function(){this.showExploreContent();for(var i=0;i<FeaturedOde.all().length;i++){var ode=FeaturedOde.all()[i];var columnNumber=((i%this.columnCount)+1);OdeBoxController.init({ode:ode,container:"#featured-grid-column-"+columnNumber,odeCounter:i,analyticsCategory:X._EXPLORE})}},onRecentOdeRefresh:function(){this.showExploreContent();for(var i=0;i<RecentOde.all().length;i++){var ode=RecentOde.all()[i];var columnNumber=((i%this.columnCount)+1);OdeBoxController.init({ode:ode,container:"#recent-grid-column-"+columnNumber,odeCounter:i,analyticsCategory:X._EXPLORE})}},onPopularOdeRefresh:function(){this.showExploreContent();for(var i=0;i<PopularOde.all().length;i++){var ode=PopularOde.all()[i];var columnNumber=((i%this.columnCount)+1);OdeBoxController.init({ode:ode,container:"#popular-grid-column-"+columnNumber,odeCounter:i,analyticsCategory:X._EXPLORE})}},onFeaturedUserRefresh:function(){this.showExploreContent();for(var i=0;i<FeaturedUser.all().length;i++){var user=FeaturedUser.all()[i];var userBox=UserBoxController.init({user:user,container:"#featured-users"})}},onPopularUserRefresh:function(){this.showExploreContent();for(var i=0;i<PopularUser.all().length;i++){var user=PopularUser.all()[i];var userBox=UserBoxController.init({user:user,container:"#popular-users"})}},onRecentUserRefresh:function(){this.showExploreContent();for(var i=0;i<RecentUser.all().length;i++){var user=RecentUser.all()[i];var userBox=UserBoxController.init({user:user,container:"#recent-users"})}},showExploreContent:function(){}});ExploreController.init();var facebookController=FacebookController.init()}});if(pageController==null){throw new Error("Page Controller not set")}else{eval(pageController+".init()")}});